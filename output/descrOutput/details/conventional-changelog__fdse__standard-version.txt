repo name: conventional-changelog/standard-version
=====================================================================
start time: Sun Oct 17 00:00:00 CST 2021
end time: Fri Dec 31 00:00:00 CST 2021
### Features* add .cjs config file ([#717](https://github.com/conventional-changelog/standard-version/issues/717)) ([eceaedf](https://github.com/conventional-changelog/standard-version/commit/eceaedf8b3cdeb282ee06bfa9c65503f42404858))### Bug Fixes* Ensures provided `packageFiles` arguments are merged with `bumpFiles` when no `bumpFiles` argument is specified (default). ([#534](https://github.com/conventional-changelog/standard-version/issues/534)) ([2785023](https://github.com/conventional-changelog/standard-version/commit/2785023c91668e7300e6a22e55d31b6bd9dae59b)), closes [#533](https://github.com/conventional-changelog/standard-version/issues/533)
diff --git a/CHANGELOG.md b/CHANGELOG.md
index d1221f4..bab204d 100644
--- a/CHANGELOG.md
+++ b/CHANGELOG.md
@@ -2,6 +2,13 @@
 
 All notable changes to this project will be documented in this file. See [standard-version](https://github.com/conventional-changelog/standard-version) for commit guidelines.
 
+### [9.3.2](https://www.github.com/conventional-changelog/standard-version/compare/v9.3.1...v9.3.2) (2021-10-17)
+
+
+### Bug Fixes
+
+* **deps:** update dependency conventional-changelog-conventionalcommits to v4.6.1 ([#752](https://www.github.com/conventional-changelog/standard-version/issues/752)) ([bb8869d](https://www.github.com/conventional-changelog/standard-version/commit/bb8869de7d8bcace1ec92f29e389e7fab506d64e))
+
 ### [9.3.1](https://www.github.com/conventional-changelog/standard-version/compare/v9.3.0...v9.3.1) (2021-07-14)
 
 
diff --git a/index.js b/index.js
index 3a35555..56f3106 100755
--- a/index.js
+++ b/index.js
@@ -37,10 +37,18 @@
     throw Error(`custom changelog header must not match ${changelog.START_OF_LAST_RELEASE_PATTERN}`)
   }
 
+  /**
+   * If an argument for `packageFiles` provided, we include it as a "default" `bumpFile`.
+   */
+  if (argv.packageFiles) {
+    defaults.bumpFiles = defaults.bumpFiles.concat(argv.packageFiles)
+  }
+
   const args = Object.assign({}, defaults, argv)
   let pkg
   for (const packageFile of args.packageFiles) {
     const updater = resolveUpdaterObjectFromArgument(packageFile)
+    if (!updater) return
     const pkgPath = path.resolve(process.cwd(), updater.filename)
     try {
       const contents = fs.readFileSync(pkgPath, 'utf8')
diff --git a/lib/lifecycles/changelog.js b/lib/lifecycles/changelog.js
index b52f529..f3977f9 100644
--- a/lib/lifecycles/changelog.js
+++ b/lib/lifecycles/changelog.js
@@ -1,4 +1,3 @@
-const accessSync = require('fs-access').sync
 const chalk = require('chalk')
 const checkpoint = require('../checkpoint')
 const conventionalChangelog = require('conventional-changelog')
@@ -56,7 +55,7 @@
 
 function createIfMissing (args) {
   try {
-    accessSync(args.infile, fs.F_OK)
+    fs.accessSync(args.infile, fs.F_OK)
   } catch (err) {
     if (err.code === 'ENOENT') {
       checkpoint(args, 'created %s', [args.infile])
diff --git a/lib/updaters/index.js b/lib/updaters/index.js
index 1e68630..ec561a8 100644
--- a/lib/updaters/index.js
+++ b/lib/updaters/index.js
@@ -26,7 +26,7 @@
   )
 }
 
-function getCustomUpdater (updater) {
+function getCustomUpdaterFromPath (updater) {
   if (typeof updater === 'string') {
     return require(path.resolve(process.cwd(), updater))
   }
@@ -39,32 +39,45 @@
   throw new Error('Updater must be a string path or an object with readVersion and writeVersion methods')
 }
 
+/**
+ * Simple check to determine if the object provided is a compatible updater.
+ */
+function isValidUpdater (obj) {
+  return (
+    typeof obj.readVersion === 'function' &&
+    typeof obj.writeVersion === 'function'
+  )
+}
+
 module.exports.resolveUpdaterObjectFromArgument = function (arg) {
   /**
    * If an Object was not provided, we assume it's the path/filename
    * of the updater.
    */
   let updater = arg
+  if (isValidUpdater(updater)) {
+    return updater
+  }
   if (typeof updater !== 'object') {
     updater = {
       filename: arg
     }
   }
   try {
-    if (updater.updater) {
-      updater.updater = getCustomUpdater(updater.updater)
+    if (typeof updater.updater === 'string') {
+      updater.updater = getCustomUpdaterFromPath(updater.updater)
     } else if (updater.type) {
       updater.updater = getUpdaterByType(updater.type)
     } else {
       updater.updater = getUpdaterByFilename(updater.filename)
     }
   } catch (err) {
-    if (err.code !== 'ENOENT') console.warn(err.message)
+    if (err.code !== 'ENOENT') console.warn(`Unable to obtain updater for: ${JSON.stringify(arg)}\n - Error: ${err.message}\n - Skipping...`)
   }
   /**
    * We weren't able to resolve an updater for the argument.
    */
-  if (!updater.updater) {
+  if (!isValidUpdater(updater.updater)) {
     return false
   }
 
diff --git a/package.json b/package.json
index 51c48ba..f8a247b 100644
--- a/package.json
+++ b/package.json
@@ -1,6 +1,6 @@
 {
   "name": "standard-version",
-  "version": "9.3.1",
+  "version": "9.3.2",
   "description": "replacement for `npm version` with automatic CHANGELOG generation",
   "bin": "bin/cli.js",
   "scripts": {
@@ -40,14 +40,13 @@
     "chalk": "^2.4.2",
     "conventional-changelog": "3.1.24",
     "conventional-changelog-config-spec": "2.1.0",
-    "conventional-changelog-conventionalcommits": "4.5.0",
+    "conventional-changelog-conventionalcommits": "4.6.1",
     "conventional-recommended-bump": "6.1.0",
     "detect-indent": "^6.0.0",
     "detect-newline": "^3.1.0",
     "dotgitignore": "^2.1.0",
     "figures": "^3.1.0",
     "find-up": "^5.0.0",
-    "fs-access": "^1.0.1",
     "git-semver-tags": "^4.0.0",
     "semver": "^7.1.1",
     "stringify-package": "^1.0.1",
@@ -59,7 +58,7 @@
     "eslint-config-standard": "^16.0.2",
     "eslint-plugin-import": "^2.22.1",
     "eslint-plugin-node": "^11.1.0",
-    "eslint-plugin-promise": "^4.2.1",
+    "eslint-plugin-promise": "^5.0.0",
     "mocha": "^8.2.1",
     "mock-fs": "^4.13.0",
     "mockery": "^2.1.0",
diff --git a/test/core.spec.js b/test/core.spec.js
index 22d2b8e..448e107 100644
--- a/test/core.spec.js
+++ b/test/core.spec.js
@@ -568,6 +568,32 @@
     })
   })
 
+  it('`packageFiles` are bumped along with `bumpFiles` defaults [standard-version#533]', async function () {
+    mock({
+      bump: 'minor',
+      fs: {
+        '.gitignore': '',
+        'package-lock.json': JSON.stringify({ version: '1.0.0' }),
+        'manifest.json': fs.readFileSync('./test/mocks/manifest-6.3.1.json')
+      },
+      tags: ['v1.0.0']
+    })
+
+    await exec({
+      silent: true,
+      packageFiles: [
+        {
+          filename: 'manifest.json',
+          type: 'json'
+        }
+      ]
+    })
+
+    JSON.parse(fs.readFileSync('manifest.json', 'utf-8')).version.should.equal('6.4.0')
+    JSON.parse(fs.readFileSync('package.json', 'utf-8')).version.should.equal('6.4.0')
+    JSON.parse(fs.readFileSync('package-lock.json', 'utf-8')).version.should.equal('6.4.0')
+  })
+
   it('bumps version # in npm-shrinkwrap.json', async function () {
     mock({
       bump: 'minor',
@@ -619,12 +645,22 @@
     mock({
       bump: 'minor',
       fs: {
-        '.gitignore': 'bower.json',
-        'bower.json': JSON.stringify({ version: '1.0.0' })
+        '.gitignore': 'package-lock.json\nbower.json',
+        // test a defaults.packageFiles
+        'bower.json': JSON.stringify({ version: '1.0.0' }),
+        // test a defaults.bumpFiles
+        'package-lock.json': JSON.stringify({
+          name: '@org/package',
+          version: '1.0.0',
+          lockfileVersion: 1
+        })
       },
       tags: ['v1.0.0']
     })
     await exec()
+    JSON.parse(fs.readFileSync('package-lock.json', 'utf-8')).version.should.equal(
+      '1.0.0'
+    )
     JSON.parse(fs.readFileSync('bower.json', 'utf-8')).version.should.equal(
       '1.0.0'
     )
diff --git a/test/mocks/manifest-6.3.1.json b/test/mocks/manifest-6.3.1.json
new file mode 100644
index 0000000..22a4630
--- /dev/null
+++ b/test/mocks/manifest-6.3.1.json
@@ -0,0 +1,3 @@
+{
+  "version": "6.3.1"
+}
\ No newline at end of file
diff --git a/test/preset.spec.js b/test/preset.spec.js
new file mode 100644
index 0000000..509dec8
--- /dev/null
+++ b/test/preset.spec.js
@@ -0,0 +1,52 @@
+/* global describe it beforeEach, afterEach */
+
+const shell = require('shelljs')
+const fs = require('fs')
+
+require('chai').should()
+
+function exec (opt) {
+  const cli = require('../command')
+  opt = cli.parse(`standard-version ${opt} --silent`)
+  opt.skip = { commit: true, tag: true }
+  return require('../index')(opt)
+}
+
+describe('presets', () => {
+  beforeEach(function () {
+    shell.rm('-rf', 'tmp')
+    shell.config.silent = true
+    shell.mkdir('tmp')
+    shell.cd('tmp')
+    shell.exec('git init')
+    shell.exec('git config commit.gpgSign false')
+    shell.exec('git config core.autocrlf false')
+    shell.exec('git commit --allow-empty -m "initial commit"')
+    shell.exec('git commit --allow-empty -m "feat: A feature commit."')
+    shell.exec('git commit --allow-empty -m "perf: A performance change."')
+    shell.exec('git commit --allow-empty -m "chore: A chore commit."')
+    shell.exec('git commit --allow-empty -m "ci: A ci commit."')
+    shell.exec('git commit --allow-empty -m "custom: A custom commit."')
+  })
+
+  afterEach(function () {
+    shell.cd('../')
+    shell.rm('-rf', 'tmp')
+  })
+
+  it('Conventional Commits (default)', async function () {
+    await exec()
+    const content = fs.readFileSync('CHANGELOG.md', 'utf-8')
+    content.should.contain('### Features')
+    content.should.not.contain('### Performance Improvements')
+    content.should.not.contain('### Custom')
+  })
+
+  it('Angular', async function () {
+    await exec('--preset angular')
+    const content = fs.readFileSync('CHANGELOG.md', 'utf-8')
+    content.should.contain('### Features')
+    content.should.contain('### Performance Improvements')
+    content.should.not.contain('### Custom')
+  })
+})

=====================================================================
start time: Wed Jul 14 00:00:00 CST 2021
end time: Sun Oct 17 00:00:00 CST 2021
### Bug Fixes* **deps:** update dependency conventional-changelog-conventionalcommits to v4.6.1 ([#752](https://www.github.com/conventional-changelog/standard-version/issues/752)) ([bb8869d](https://www.github.com/conventional-changelog/standard-version/commit/bb8869de7d8bcace1ec92f29e389e7fab506d64e))
diff --git a/CHANGELOG.md b/CHANGELOG.md
index 356c915..d1221f4 100644
--- a/CHANGELOG.md
+++ b/CHANGELOG.md
@@ -2,6 +2,13 @@
 
 All notable changes to this project will be documented in this file. See [standard-version](https://github.com/conventional-changelog/standard-version) for commit guidelines.
 
+### [9.3.1](https://www.github.com/conventional-changelog/standard-version/compare/v9.3.0...v9.3.1) (2021-07-14)
+
+
+### Bug Fixes
+
+* **updater:** npm7 package lock's inner version not being updated ([#713](https://www.github.com/conventional-changelog/standard-version/issues/713)) ([a316dd0](https://www.github.com/conventional-changelog/standard-version/commit/a316dd02f5a7d8dee33d99370afda8738985bc10))
+
 ## [9.3.0](https://www.github.com/conventional-changelog/standard-version/compare/v9.2.0...v9.3.0) (2021-05-04)
 
 
diff --git a/package.json b/package.json
index 69796f0..51c48ba 100644
--- a/package.json
+++ b/package.json
@@ -1,6 +1,6 @@
 {
   "name": "standard-version",
-  "version": "9.3.0",
+  "version": "9.3.1",
   "description": "replacement for `npm version` with automatic CHANGELOG generation",
   "bin": "bin/cli.js",
   "scripts": {

=====================================================================
start time: Tue May 04 00:00:00 CST 2021
end time: Wed Jul 14 00:00:00 CST 2021
### Bug Fixes* **updater:** npm7 package lock's inner version not being updated ([#713](https://www.github.com/conventional-changelog/standard-version/issues/713)) ([a316dd0](https://www.github.com/conventional-changelog/standard-version/commit/a316dd02f5a7d8dee33d99370afda8738985bc10))
diff --git a/CHANGELOG.md b/CHANGELOG.md
index ebe6789..356c915 100644
--- a/CHANGELOG.md
+++ b/CHANGELOG.md
@@ -2,6 +2,13 @@
 
 All notable changes to this project will be documented in this file. See [standard-version](https://github.com/conventional-changelog/standard-version) for commit guidelines.
 
+## [9.3.0](https://www.github.com/conventional-changelog/standard-version/compare/v9.2.0...v9.3.0) (2021-05-04)
+
+
+### Features
+
+* add --lerna-package flag used to extract tags in case of lerna repo ([#503](https://www.github.com/conventional-changelog/standard-version/issues/503)) ([f579ff0](https://www.github.com/conventional-changelog/standard-version/commit/f579ff08f386aaae022a395ed0dbec9af77a5d49))
+
 ## [9.2.0](https://www.github.com/conventional-changelog/standard-version/compare/v9.1.1...v9.2.0) (2021-04-06)
 
 
diff --git a/package.json b/package.json
index 77a93ac..69796f0 100644
--- a/package.json
+++ b/package.json
@@ -1,6 +1,6 @@
 {
   "name": "standard-version",
-  "version": "9.2.0",
+  "version": "9.3.0",
   "description": "replacement for `npm version` with automatic CHANGELOG generation",
   "bin": "bin/cli.js",
   "scripts": {

=====================================================================
start time: Tue Apr 06 00:00:00 CST 2021
end time: Tue May 04 00:00:00 CST 2021
### Features* add --lerna-package flag used to extract tags in case of lerna repo ([#503](https://www.github.com/conventional-changelog/standard-version/issues/503)) ([f579ff0](https://www.github.com/conventional-changelog/standard-version/commit/f579ff08f386aaae022a395ed0dbec9af77a5d49))
diff --git a/CHANGELOG.md b/CHANGELOG.md
index 1504ec3..ebe6789 100644
--- a/CHANGELOG.md
+++ b/CHANGELOG.md
@@ -2,6 +2,13 @@
 
 All notable changes to this project will be documented in this file. See [standard-version](https://github.com/conventional-changelog/standard-version) for commit guidelines.
 
+## [9.2.0](https://www.github.com/conventional-changelog/standard-version/compare/v9.1.1...v9.2.0) (2021-04-06)
+
+
+### Features
+
+* allows seperate prefixTag version sequences ([#573](https://www.github.com/conventional-changelog/standard-version/issues/573)) ([3bbba02](https://www.github.com/conventional-changelog/standard-version/commit/3bbba025057ba40c3e15880fede2af851841165b))
+
 ### [9.1.1](https://www.github.com/conventional-changelog/standard-version/compare/v9.1.0...v9.1.1) (2021-02-06)
 
 
diff --git a/package.json b/package.json
index 4c930d1..77a93ac 100644
--- a/package.json
+++ b/package.json
@@ -1,6 +1,6 @@
 {
   "name": "standard-version",
-  "version": "9.1.1",
+  "version": "9.2.0",
   "description": "replacement for `npm version` with automatic CHANGELOG generation",
   "bin": "bin/cli.js",
   "scripts": {

=====================================================================
start time: Sat Feb 06 00:00:00 CST 2021
end time: Tue Apr 06 00:00:00 CST 2021
### Features* allows seperate prefixTag version sequences ([#573](https://www.github.com/conventional-changelog/standard-version/issues/573)) ([3bbba02](https://www.github.com/conventional-changelog/standard-version/commit/3bbba025057ba40c3e15880fede2af851841165b))
diff --git a/.github/workflows/ci.yaml b/.github/workflows/ci.yaml
index 471408a..a631c6c 100644
--- a/.github/workflows/ci.yaml
+++ b/.github/workflows/ci.yaml
@@ -6,10 +6,14 @@
 name: ci
 jobs:
   test:
-    runs-on: ubuntu-latest
+    runs-on: ${{ matrix.os }}
     strategy:
       matrix:
         node: [10, 12, 14]
+        os: [ubuntu-latest, windows-latest]
+    env: 
+        OS: ${{ matrix.os }}
+        NODE_VERSION: ${{ matrix.node }}
     steps:
       - uses: actions/checkout@v2
       - run: git fetch --prune --unshallow
@@ -21,15 +25,8 @@
       - run: node --version
       - run: npm install --engine-strict
       - run: npm test
-  windows:
-    runs-on: windows-latest
-    steps:
-      - uses: actions/checkout@v2
-      - run: git fetch --prune --unshallow
-      - run: git config --global user.name 'Actions'
-      - run: git config --global user.email 'dummy@example.org'
-      - uses: actions/setup-node@v2
+      - run: npm run coverage
+      - name: Codecov
+        uses: codecov/codecov-action@v1
         with:
-          node-version: 12
-      - run: npm install
-      - run: npm test
+          env_vars: OS, NODE_VERSION
\ No newline at end of file
diff --git a/CHANGELOG.md b/CHANGELOG.md
index ef2d010..1504ec3 100644
--- a/CHANGELOG.md
+++ b/CHANGELOG.md
@@ -2,6 +2,14 @@
 
 All notable changes to this project will be documented in this file. See [standard-version](https://github.com/conventional-changelog/standard-version) for commit guidelines.
 
+### [9.1.1](https://www.github.com/conventional-changelog/standard-version/compare/v9.1.0...v9.1.1) (2021-02-06)
+
+
+### Bug Fixes
+
+* **deps:** update dependency conventional-recommended-bump to v6.1.0 ([#695](https://www.github.com/conventional-changelog/standard-version/issues/695)) ([65dd070](https://www.github.com/conventional-changelog/standard-version/commit/65dd070b9f01ffe1764e64ba739bc064b84f4129))
+* **deps:** update dependency yargs to v16 ([#660](https://www.github.com/conventional-changelog/standard-version/issues/660)) ([f6a7430](https://www.github.com/conventional-changelog/standard-version/commit/f6a7430329919874e1e744ac5dca2f83bba355df))
+
 ## [9.1.0](https://www.github.com/conventional-changelog/standard-version/compare/v9.0.0...v9.1.0) (2020-12-01)
 
 
diff --git a/README.md b/README.md
index 66e56fc..f924f60 100644
--- a/README.md
+++ b/README.md
@@ -4,7 +4,7 @@
 
 ![ci](https://github.com/conventional-changelog/standard-version/workflows/ci/badge.svg)
 [![NPM version](https://img.shields.io/npm/v/standard-version.svg)](https://www.npmjs.com/package/standard-version)
-[![Coverage Status](https://coveralls.io/repos/conventional-changelog/standard-version/badge.svg?branch=)](https://coveralls.io/r/conventional-changelog/standard-version?branch=master)
+[![codecov](https://codecov.io/gh/conventional-changelog/standard-version/branch/master/graph/badge.svg?token=J7zMN7vTTd)](https://codecov.io/gh/conventional-changelog/standard-version)
 [![Conventional Commits](https://img.shields.io/badge/Conventional%20Commits-1.0.0-yellow.svg)](https://conventionalcommits.org)
 [![Community slack](http://devtoolscommunity.herokuapp.com/badge.svg)](http://devtoolscommunity.herokuapp.com)
 
@@ -267,11 +267,24 @@
 
 ### Committing Generated Artifacts in the Release Commit
 
-If you want to commit generated artifacts in the release commit (e.g. [#96](https://github.com/conventional-changelog/standard-version/issues/96)), you can use the `--commit-all` or `-a` flag. You will need to stage the artifacts you want to commit, so your `release` command could look like this:
+If you want to commit generated artifacts in the release commit, you can use the `--commit-all` or `-a` flag. You will need to stage the artifacts you want to commit, so your `release` command could look like this:
 
 ```json
-"prerelease": "webpack -p --bail",
-"release": "git add <file(s) to commit> && standard-version -a"
+{
+  "standard-version": {
+    "scripts": {
+      "prerelease": "webpack -p --bail && git add <file(s) to commit>"
+    }
+  }
+}
+```
+
+```json
+{
+  "scripts": {
+    "release": "standard-version -a"
+  }
+}
 ```
 
 ### Dry Run Mode
@@ -296,7 +309,9 @@
 
 This will prefix your tags to look something like `@scope/package@2.0.0`
 
-If you do not want to have any tag prefix you can use the `-t` flag without value.
+If you do not want to have any tag prefix you can use the `-t` flag and provide it with an **empty string** as value.
+
+> Note: simply -t or --tag-prefix without any value will fallback to the default 'v'
 
 ### CLI Help
 
@@ -355,9 +370,7 @@
 
 1. Specify a custom `bumpFile` "`filename`", this is the path to the file you want to "bump"
 2. Specify the `bumpFile` "`updater`", this is _how_ the file will be bumped.
-  
     a. If you're using a common type, you can use one of  `standard-version`'s built-in `updaters` by specifying a `type`.
-
     b. If your using an less-common version file, you can create your own `updater`.
 
 ```js
diff --git a/package.json b/package.json
index 5a901f1..4c930d1 100644
--- a/package.json
+++ b/package.json
@@ -1,6 +1,6 @@
 {
   "name": "standard-version",
-  "version": "9.1.0",
+  "version": "9.1.1",
   "description": "replacement for `npm version` with automatic CHANGELOG generation",
   "bin": "bin/cli.js",
   "scripts": {
@@ -8,6 +8,7 @@
     "posttest": "eslint .",
     "test": "nyc mocha --timeout=30000",
     "test:unit": "mocha --exclude test/git.spec.js",
+    "coverage": "nyc report --reporter=lcov",
     "release": "bin/cli.js"
   },
   "nyc": {
@@ -54,16 +55,15 @@
   },
   "devDependencies": {
     "chai": "^4.2.0",
-    "coveralls": "^3.1.0",
     "eslint": "^7.14.0",
     "eslint-config-standard": "^16.0.2",
     "eslint-plugin-import": "^2.22.1",
     "eslint-plugin-node": "^11.1.0",
     "eslint-plugin-promise": "^4.2.1",
-    "mocha": "^8.0.0",
-    "mock-fs": "^4.12.0",
+    "mocha": "^8.2.1",
+    "mock-fs": "^4.13.0",
     "mockery": "^2.1.0",
-    "nyc": "^14.1.1",
+    "nyc": "^15.1.0",
     "shelljs": "^0.8.4",
     "std-mocks": "^1.0.1"
   }

=====================================================================
start time: Tue Dec 01 00:00:00 CST 2020
end time: Sat Feb 06 00:00:00 CST 2021
### Bug Fixes* **deps:** update dependency conventional-recommended-bump to v6.1.0 ([#695](https://www.github.com/conventional-changelog/standard-version/issues/695)) ([65dd070](https://www.github.com/conventional-changelog/standard-version/commit/65dd070b9f01ffe1764e64ba739bc064b84f4129))* **deps:** update dependency yargs to v16 ([#660](https://www.github.com/conventional-changelog/standard-version/issues/660)) ([f6a7430](https://www.github.com/conventional-changelog/standard-version/commit/f6a7430329919874e1e744ac5dca2f83bba355df))
diff --git a/.github/workflows/ci.yaml b/.github/workflows/ci.yaml
index 77d63aa..471408a 100644
--- a/.github/workflows/ci.yaml
+++ b/.github/workflows/ci.yaml
@@ -15,7 +15,7 @@
       - run: git fetch --prune --unshallow
       - run: git config --global user.name 'Actions'
       - run: git config --global user.email 'dummy@example.org'
-      - uses: actions/setup-node@v1
+      - uses: actions/setup-node@v2
         with:
           node-version: ${{ matrix.node }}
       - run: node --version
@@ -28,7 +28,7 @@
       - run: git fetch --prune --unshallow
       - run: git config --global user.name 'Actions'
       - run: git config --global user.email 'dummy@example.org'
-      - uses: actions/setup-node@v1
+      - uses: actions/setup-node@v2
         with:
           node-version: 12
       - run: npm install
diff --git a/CHANGELOG.md b/CHANGELOG.md
index 645c4f5..ef2d010 100644
--- a/CHANGELOG.md
+++ b/CHANGELOG.md
@@ -2,6 +2,21 @@
 
 All notable changes to this project will be documented in this file. See [standard-version](https://github.com/conventional-changelog/standard-version) for commit guidelines.
 
+## [9.1.0](https://www.github.com/conventional-changelog/standard-version/compare/v9.0.0...v9.1.0) (2020-12-01)
+
+
+### Features
+
+* support custom updater as object as well as path ([#630](https://www.github.com/conventional-changelog/standard-version/issues/630)) ([55bbde8](https://www.github.com/conventional-changelog/standard-version/commit/55bbde8476013de7a2f24bf29c7c12cb07f96e3f))
+
+
+### Bug Fixes
+
+* **deps:** update dependency conventional-changelog to v3.1.24 ([#677](https://www.github.com/conventional-changelog/standard-version/issues/677)) ([cc45036](https://www.github.com/conventional-changelog/standard-version/commit/cc45036d9960b6d83e0e850ccbbe8e8098d36ae6))
+* **deps:** update dependency conventional-changelog-conventionalcommits to v4.5.0 ([#678](https://www.github.com/conventional-changelog/standard-version/issues/678)) ([6317d36](https://www.github.com/conventional-changelog/standard-version/commit/6317d36130767cfd85114ab9033a6f1ef110388d))
+* **deps:** update dependency conventional-recommended-bump to v6.0.11 ([#679](https://www.github.com/conventional-changelog/standard-version/issues/679)) ([360789a](https://www.github.com/conventional-changelog/standard-version/commit/360789ab84957a67d3919cb28db1882cb68296fc))
+* **deps:** update dependency find-up to v5 ([#651](https://www.github.com/conventional-changelog/standard-version/issues/651)) ([df8db83](https://www.github.com/conventional-changelog/standard-version/commit/df8db832327a751d5c62fe361b6ac2d2b5f66bf6))
+
 ## [9.0.0](https://www.github.com/conventional-changelog/standard-version/compare/v8.0.2...v9.0.0) (2020-08-15)
 
 
diff --git a/lib/updaters/index.js b/lib/updaters/index.js
index faaab5e..1e68630 100644
--- a/lib/updaters/index.js
+++ b/lib/updaters/index.js
@@ -22,7 +22,7 @@
     return getUpdaterByType('plain-text')
   }
   throw Error(
-    `Unsupported file (${filename}) provided for bumping.\n Please specifcy the updater \`type\` or use a custom \`updater\`.`
+    `Unsupported file (${filename}) provided for bumping.\n Please specify the updater \`type\` or use a custom \`updater\`.`
   )
 }
 
diff --git a/package.json b/package.json
index 3c149c5..b282608 100644
--- a/package.json
+++ b/package.json
@@ -1,6 +1,6 @@
 {
   "name": "standard-version",
-  "version": "9.0.0",
+  "version": "9.1.0",
   "description": "replacement for `npm version` with automatic CHANGELOG generation",
   "bin": "bin/cli.js",
   "scripts": {
@@ -50,7 +50,7 @@
     "git-semver-tags": "^4.0.0",
     "semver": "^7.1.1",
     "stringify-package": "^1.0.1",
-    "yargs": "^15.3.1"
+    "yargs": "^16.0.0"
   },
   "devDependencies": {
     "chai": "^4.2.0",

=====================================================================
start time: Sat Aug 15 00:00:00 CST 2020
end time: Tue Dec 01 00:00:00 CST 2020
### Features* support custom updater as object as well as path ([#630](https://www.github.com/conventional-changelog/standard-version/issues/630)) ([55bbde8](https://www.github.com/conventional-changelog/standard-version/commit/55bbde8476013de7a2f24bf29c7c12cb07f96e3f))### Bug Fixes* **deps:** update dependency conventional-changelog to v3.1.24 ([#677](https://www.github.com/conventional-changelog/standard-version/issues/677)) ([cc45036](https://www.github.com/conventional-changelog/standard-version/commit/cc45036d9960b6d83e0e850ccbbe8e8098d36ae6))* **deps:** update dependency conventional-changelog-conventionalcommits to v4.5.0 ([#678](https://www.github.com/conventional-changelog/standard-version/issues/678)) ([6317d36](https://www.github.com/conventional-changelog/standard-version/commit/6317d36130767cfd85114ab9033a6f1ef110388d))* **deps:** update dependency conventional-recommended-bump to v6.0.11 ([#679](https://www.github.com/conventional-changelog/standard-version/issues/679)) ([360789a](https://www.github.com/conventional-changelog/standard-version/commit/360789ab84957a67d3919cb28db1882cb68296fc))* **deps:** update dependency find-up to v5 ([#651](https://www.github.com/conventional-changelog/standard-version/issues/651)) ([df8db83](https://www.github.com/conventional-changelog/standard-version/commit/df8db832327a751d5c62fe361b6ac2d2b5f66bf6))
diff --git a/.github/workflows/ci.yaml b/.github/workflows/ci.yaml
index c3c5903..77d63aa 100644
--- a/.github/workflows/ci.yaml
+++ b/.github/workflows/ci.yaml
@@ -19,7 +19,7 @@
         with:
           node-version: ${{ matrix.node }}
       - run: node --version
-      - run: npm install
+      - run: npm install --engine-strict
       - run: npm test
   windows:
     runs-on: windows-latest
diff --git a/CHANGELOG.md b/CHANGELOG.md
index 56a456c..645c4f5 100644
--- a/CHANGELOG.md
+++ b/CHANGELOG.md
@@ -2,6 +2,24 @@
 
 All notable changes to this project will be documented in this file. See [standard-version](https://github.com/conventional-changelog/standard-version) for commit guidelines.
 
+## [9.0.0](https://www.github.com/conventional-changelog/standard-version/compare/v8.0.2...v9.0.0) (2020-08-15)
+
+
+### âš  BREAKING CHANGES
+
+* NodeJS@8 is no longer supported. (#612)
+
+### Bug Fixes
+
+* **deps:** update dependency conventional-changelog to v3.1.23 ([#652](https://www.github.com/conventional-changelog/standard-version/issues/652)) ([00dd3c0](https://www.github.com/conventional-changelog/standard-version/commit/00dd3c01aab20d28a8bbd1e174e416d6c2b34d90))
+* **deps:** update dependency conventional-changelog-conventionalcommits to v4.4.0 ([#650](https://www.github.com/conventional-changelog/standard-version/issues/650)) ([9f201a6](https://www.github.com/conventional-changelog/standard-version/commit/9f201a61bb50ec12053a04faccfaea20e44d6ff2))
+* **deps:** update dependency conventional-recommended-bump to v6.0.10 ([#653](https://www.github.com/conventional-changelog/standard-version/issues/653)) ([c360d6a](https://www.github.com/conventional-changelog/standard-version/commit/c360d6a307909c6e571b29d4a329fd786b4d4543))
+
+
+### Build System
+
+* NodeJS@8 is no longer supported. ([#612](https://www.github.com/conventional-changelog/standard-version/issues/612)) ([05edef2](https://www.github.com/conventional-changelog/standard-version/commit/05edef2de79d8d4939a6e699ce0979ff8da12de9))
+
 ### [8.0.2](https://www.github.com/conventional-changelog/standard-version/compare/v8.0.1...v8.0.2) (2020-07-14)
 
 
diff --git a/README.md b/README.md
index e1002e7..66e56fc 100644
--- a/README.md
+++ b/README.md
@@ -2,7 +2,7 @@
 
 A utility for versioning using [semver](https://semver.org/) and CHANGELOG generation powered by [Conventional Commits](https://conventionalcommits.org).
 
-[![Build Status](https://travis-ci.org/conventional-changelog/standard-version.svg?branch=master)](https://travis-ci.org/conventional-changelog/standard-version)
+![ci](https://github.com/conventional-changelog/standard-version/workflows/ci/badge.svg)
 [![NPM version](https://img.shields.io/npm/v/standard-version.svg)](https://www.npmjs.com/package/standard-version)
 [![Coverage Status](https://coveralls.io/repos/conventional-changelog/standard-version/badge.svg?branch=)](https://coveralls.io/r/conventional-changelog/standard-version?branch=master)
 [![Conventional Commits](https://img.shields.io/badge/Conventional%20Commits-1.0.0-yellow.svg)](https://conventionalcommits.org)
@@ -18,7 +18,7 @@
 
 `standard-version` will then do the following:
 
-1. Retrieve the current version of your repository by looking at `bumpFiles`[[1]](#bumpfiles-packagefiles-and-updaters), falling back to the last `git tag`.
+1. Retrieve the current version of your repository by looking at `packageFiles`[[1]](#bumpfiles-packagefiles-and-updaters), falling back to the last `git tag`.
 2. `bump` the version in `bumpFiles`[[1]](#bumpfiles-packagefiles-and-updaters) based on your commits.
 4. Generates a `changelog` based on your commits (uses [conventional-changelog](https://github.com/conventional-changelog/conventional-changelog) under the hood).
 5. Creates a new `commit` including your `bumpFiles`[[1]](#bumpfiles-packagefiles-and-updaters) and updated CHANGELOG.
@@ -356,7 +356,7 @@
 1. Specify a custom `bumpFile` "`filename`", this is the path to the file you want to "bump"
 2. Specify the `bumpFile` "`updater`", this is _how_ the file will be bumped.
   
-    a. If your using a common type, you can use one of  `standard-version`'s built-in `updaters` by specifying a `type`.
+    a. If you're using a common type, you can use one of  `standard-version`'s built-in `updaters` by specifying a `type`.
 
     b. If your using an less-common version file, you can create your own `updater`.
 
@@ -383,6 +383,21 @@
 }
 ```
 
+If using `.versionrc.js` as your configuration file, the `updater` may also be set as an object, rather than a path:
+
+```js
+// .versionrc.js
+const tracker = {
+  filename: 'VERSION_TRACKER.json',
+  updater: require('./path/to/custom-version-updater')
+}
+
+module.exports = {
+  bumpFiles: [tracker],
+  packageFiles: [tracker]
+}
+```
+
 #### Custom `updater`s
 
 An `updater` is expected to be a Javascript module with _atleast_ two methods exposed: `readVersion` and `writeVersion`.
diff --git a/index.js b/index.js
index 74de6e0..aa18e0a 100755
--- a/index.js
+++ b/index.js
@@ -8,7 +8,7 @@
 const tag = require('./lib/lifecycles/tag')
 const { resolveUpdaterObjectFromArgument } = require('./lib/updaters')
 
-module.exports = function standardVersion (argv) {
+module.exports = async function standardVersion (argv) {
   const defaults = require('./defaults')
   /**
    * `--message` (`-m`) support will be removed in the next major version.
@@ -39,8 +39,7 @@
 
   const args = Object.assign({}, defaults, argv)
   let pkg
-  args.packageFiles.forEach((packageFile) => {
-    if (pkg) return
+  for (const packageFile of args.packageFiles) {
     const updater = resolveUpdaterObjectFromArgument(packageFile)
     const pkgPath = path.resolve(process.cwd(), updater.filename)
     try {
@@ -49,39 +48,25 @@
         version: updater.updater.readVersion(contents),
         private: typeof updater.updater.isPrivate === 'function' ? updater.updater.isPrivate(contents) : false
       }
+      break
     } catch (err) {}
-  })
-  let newVersion
-  return Promise.resolve()
-    .then(() => {
-      if (!pkg && args.gitTagFallback) {
-        return latestSemverTag()
-      } else if (!pkg) {
-        throw new Error('no package file found')
-      } else {
-        return pkg.version
-      }
-    })
-    .then(version => {
-      newVersion = version
-    })
-    .then(() => {
-      return bump(args, newVersion)
-    })
-    .then((_newVersion) => {
-      // if bump runs, it calculaes the new version that we
-      // should release at.
-      if (_newVersion) newVersion = _newVersion
-      return changelog(args, newVersion)
-    })
-    .then(() => {
-      return commit(args, newVersion)
-    })
-    .then(() => {
-      return tag(newVersion, pkg ? pkg.private : false, args)
-    })
-    .catch((err) => {
-      printError(args, err.message)
-      throw err
-    })
+  }
+  try {
+    let version
+    if (pkg) {
+      version = pkg.version
+    } else if (args.gitTagFallback) {
+      version = await latestSemverTag()
+    } else {
+      throw new Error('no package file found')
+    }
+
+    const newVersion = await bump(args, version)
+    await changelog(args, newVersion)
+    await commit(args, newVersion)
+    await tag(newVersion, pkg ? pkg.private : false, args)
+  } catch (err) {
+    printError(args, err.message)
+    throw err
+  }
 }
diff --git a/lib/lifecycles/bump.js b/lib/lifecycles/bump.js
index b59c46c..119025f 100644
--- a/lib/lifecycles/bump.js
+++ b/lib/lifecycles/bump.js
@@ -14,34 +14,26 @@
 const { resolveUpdaterObjectFromArgument } = require('../updaters')
 let configsToUpdate = {}
 
-function Bump (args, version) {
+async function Bump (args, version) {
   // reset the cache of updated config files each
   // time we perform the version bump step.
   configsToUpdate = {}
 
-  if (args.skip.bump) return Promise.resolve()
+  if (args.skip.bump) return version
   let newVersion = version
-  return runLifecycleScript(args, 'prerelease')
-    .then(runLifecycleScript.bind(this, args, 'prebump'))
-    .then((stdout) => {
-      if (stdout && stdout.trim().length) args.releaseAs = stdout.trim()
-      return bumpVersion(args.releaseAs, version, args)
-    })
-    .then((release) => {
-      if (!args.firstRelease) {
-        const releaseType = getReleaseType(args.prerelease, release.releaseType, version)
-        newVersion = semver.valid(releaseType) || semver.inc(version, releaseType, args.prerelease)
-        updateConfigs(args, newVersion)
-      } else {
-        checkpoint(args, 'skip version bump on first release', [], chalk.red(figures.cross))
-      }
-    })
-    .then(() => {
-      return runLifecycleScript(args, 'postbump')
-    })
-    .then(() => {
-      return newVersion
-    })
+  await runLifecycleScript(args, 'prerelease')
+  const stdout = await runLifecycleScript(args, 'prebump')
+  if (stdout && stdout.trim().length) args.releaseAs = stdout.trim()
+  const release = await bumpVersion(args.releaseAs, version, args)
+  if (!args.firstRelease) {
+    const releaseType = getReleaseType(args.prerelease, release.releaseType, version)
+    newVersion = semver.valid(releaseType) || semver.inc(version, releaseType, args.prerelease)
+    updateConfigs(args, newVersion)
+  } else {
+    checkpoint(args, 'skip version bump on first release', [], chalk.red(figures.cross))
+  }
+  await runLifecycleScript(args, 'postbump')
+  return newVersion
 }
 
 Bump.getUpdatedConfigs = function () {
diff --git a/lib/lifecycles/changelog.js b/lib/lifecycles/changelog.js
index dff90ab..b52f529 100644
--- a/lib/lifecycles/changelog.js
+++ b/lib/lifecycles/changelog.js
@@ -8,15 +8,11 @@
 const writeFile = require('../write-file')
 const START_OF_LAST_RELEASE_PATTERN = /(^#+ \[?[0-9]+\.[0-9]+\.[0-9]+|<a name=)/m
 
-function Changelog (args, newVersion) {
-  if (args.skip.changelog) return Promise.resolve()
-  return runLifecycleScript(args, 'prechangelog')
-    .then(() => {
-      return outputChangelog(args, newVersion)
-    })
-    .then(() => {
-      return runLifecycleScript(args, 'postchangelog')
-    })
+async function Changelog (args, newVersion) {
+  if (args.skip.changelog) return
+  await runLifecycleScript(args, 'prechangelog')
+  await outputChangelog(args, newVersion)
+  await runLifecycleScript(args, 'postchangelog')
 }
 
 Changelog.START_OF_LAST_RELEASE_PATTERN = START_OF_LAST_RELEASE_PATTERN
diff --git a/lib/lifecycles/commit.js b/lib/lifecycles/commit.js
index bcde6f2..7b90a8f 100644
--- a/lib/lifecycles/commit.js
+++ b/lib/lifecycles/commit.js
@@ -5,19 +5,15 @@
 const runExecFile = require('../run-execFile')
 const runLifecycleScript = require('../run-lifecycle-script')
 
-module.exports = function (args, newVersion) {
-  if (args.skip.commit) return Promise.resolve()
-  return runLifecycleScript(args, 'precommit')
-    .then((message) => {
-      if (message && message.length) args.releaseCommitMessageFormat = message
-      return execCommit(args, newVersion)
-    })
-    .then(() => {
-      return runLifecycleScript(args, 'postcommit')
-    })
+module.exports = async function (args, newVersion) {
+  if (args.skip.commit) return
+  const message = await runLifecycleScript(args, 'precommit')
+  if (message && message.length) args.releaseCommitMessageFormat = message
+  await execCommit(args, newVersion)
+  await runLifecycleScript(args, 'postcommit')
 }
 
-function execCommit (args, newVersion) {
+async function execCommit (args, newVersion) {
   let msg = 'committing %s'
   let paths = []
   const verify = args.verify === false || args.n ? ['--no-verify'] : []
@@ -51,25 +47,23 @@
 
   // nothing to do, exit without commit anything
   if (args.skip.changelog && args.skip.bump && toAdd.length === 0) {
-    return Promise.resolve()
+    return
   }
 
-  return runExecFile(args, 'git', ['add'].concat(toAdd))
-    .then(() => {
-      return runExecFile(
-        args,
-        'git',
-        [
-          'commit'
-        ].concat(
-          verify,
-          sign,
-          args.commitAll ? [] : toAdd,
-          [
-            '-m',
-            `${formatCommitMessage(args.releaseCommitMessageFormat, newVersion)}`
-          ]
-        )
-      )
-    })
+  await runExecFile(args, 'git', ['add'].concat(toAdd))
+  await runExecFile(
+    args,
+    'git',
+    [
+      'commit'
+    ].concat(
+      verify,
+      sign,
+      args.commitAll ? [] : toAdd,
+      [
+        '-m',
+        `${formatCommitMessage(args.releaseCommitMessageFormat, newVersion)}`
+      ]
+    )
+  )
 }
diff --git a/lib/lifecycles/tag.js b/lib/lifecycles/tag.js
index f160ce7..ec1b88e 100644
--- a/lib/lifecycles/tag.js
+++ b/lib/lifecycles/tag.js
@@ -6,18 +6,14 @@
 const runExecFile = require('../run-execFile')
 const runLifecycleScript = require('../run-lifecycle-script')
 
-module.exports = function (newVersion, pkgPrivate, args) {
-  if (args.skip.tag) return Promise.resolve()
-  return runLifecycleScript(args, 'pretag')
-    .then(() => {
-      return execTag(newVersion, pkgPrivate, args)
-    })
-    .then(() => {
-      return runLifecycleScript(args, 'posttag')
-    })
+module.exports = async function (newVersion, pkgPrivate, args) {
+  if (args.skip.tag) return
+  await runLifecycleScript(args, 'pretag')
+  await execTag(newVersion, pkgPrivate, args)
+  await runLifecycleScript(args, 'posttag')
 }
 
-function execTag (newVersion, pkgPrivate, args) {
+async function execTag (newVersion, pkgPrivate, args) {
   let tagOption
   if (args.sign) {
     tagOption = '-s'
@@ -25,21 +21,19 @@
     tagOption = '-a'
   }
   checkpoint(args, 'tagging release %s%s', [args.tagPrefix, newVersion])
-  return runExecFile(args, 'git', ['tag', tagOption, args.tagPrefix + newVersion, '-m', `${formatCommitMessage(args.releaseCommitMessageFormat, newVersion)}`])
-    .then(() => runExecFile('', 'git', ['rev-parse', '--abbrev-ref', 'HEAD']))
-    .then((currentBranch) => {
-      let message = 'git push --follow-tags origin ' + currentBranch.trim()
-      if (pkgPrivate !== true && bump.getUpdatedConfigs()['package.json']) {
-        message += ' && npm publish'
-        if (args.prerelease !== undefined) {
-          if (args.prerelease === '') {
-            message += ' --tag prerelease'
-          } else {
-            message += ' --tag ' + args.prerelease
-          }
-        }
+  await runExecFile(args, 'git', ['tag', tagOption, args.tagPrefix + newVersion, '-m', `${formatCommitMessage(args.releaseCommitMessageFormat, newVersion)}`])
+  const currentBranch = await runExecFile('', 'git', ['rev-parse', '--abbrev-ref', 'HEAD'])
+  let message = 'git push --follow-tags origin ' + currentBranch.trim()
+  if (pkgPrivate !== true && bump.getUpdatedConfigs()['package.json']) {
+    message += ' && npm publish'
+    if (args.prerelease !== undefined) {
+      if (args.prerelease === '') {
+        message += ' --tag prerelease'
+      } else {
+        message += ' --tag ' + args.prerelease
       }
+    }
+  }
 
-      checkpoint(args, 'Run `%s` to publish', [message], chalk.blue(figures.info))
-    })
+  checkpoint(args, 'Run `%s` to publish', [message], chalk.blue(figures.info))
 }
diff --git a/lib/run-exec.js b/lib/run-exec.js
index ffcd17d..eec2feb 100644
--- a/lib/run-exec.js
+++ b/lib/run-exec.js
@@ -1,20 +1,18 @@
-const exec = require('child_process').exec
+const { promisify } = require('util')
 const printError = require('./print-error')
 
-module.exports = function (args, cmd) {
-  if (args.dryRun) return Promise.resolve()
-  return new Promise((resolve, reject) => {
-    // Exec given cmd and handle possible errors
-    exec(cmd, function (err, stdout, stderr) {
-      // If exec returns content in stderr, but no error, print it as a warning
-      // If exec returns an error, print it and exit with return code 1
-      if (err) {
-        printError(args, stderr || err.message)
-        return reject(err)
-      } else if (stderr) {
-        printError(args, stderr, { level: 'warn', color: 'yellow' })
-      }
-      return resolve(stdout)
-    })
-  })
+const exec = promisify(require('child_process').exec)
+
+module.exports = async function (args, cmd) {
+  if (args.dryRun) return
+  try {
+    const { stderr, stdout } = await exec(cmd)
+    // If exec returns content in stderr, but no error, print it as a warning
+    if (stderr) printError(args, stderr, { level: 'warn', color: 'yellow' })
+    return stdout
+  } catch (error) {
+    // If exec returns an error, print it and exit with return code 1
+    printError(args, error.stderr || error.message)
+    throw error
+  }
 }
diff --git a/lib/run-execFile.js b/lib/run-execFile.js
index 076f951..c0c814d 100644
--- a/lib/run-execFile.js
+++ b/lib/run-execFile.js
@@ -1,20 +1,18 @@
-const { execFile } = require('child_process')
+const { promisify } = require('util')
 const printError = require('./print-error')
 
-module.exports = function (args, cmd, cmdArgs) {
-  if (args.dryRun) return Promise.resolve()
-  return new Promise((resolve, reject) => {
-    // Exec given cmd and handle possible errors
-    execFile(cmd, cmdArgs, function (err, stdout, stderr) {
-      // If exec returns content in stderr, but no error, print it as a warning
-      // If exec returns an error, print it and exit with return code 1
-      if (err) {
-        printError(args, stderr || err.message)
-        return reject(err)
-      } else if (stderr) {
-        printError(args, stderr, { level: 'warn', color: 'yellow' })
-      }
-      return resolve(stdout)
-    })
-  })
+const execFile = promisify(require('child_process').execFile)
+
+module.exports = async function (args, cmd, cmdArgs) {
+  if (args.dryRun) return
+  try {
+    const { stderr, stdout } = await execFile(cmd, cmdArgs)
+    // If execFile returns content in stderr, but no error, print it as a warning
+    if (stderr) printError(args, stderr, { level: 'warn', color: 'yellow' })
+    return stdout
+  } catch (error) {
+    // If execFile returns an error, print it and exit with return code 1
+    printError(args, error.stderr || error.message)
+    throw error
+  }
 }
diff --git a/lib/run-lifecycle-hook.js b/lib/run-lifecycle-hook.js
deleted file mode 100644
index f96b8d1..0000000
--- a/lib/run-lifecycle-hook.js
+++ /dev/null
@@ -1,12 +0,0 @@
-const chalk = require('chalk')
-const checkpoint = require('./checkpoint')
-const figures = require('figures')
-const runExec = require('./run-exec')
-
-module.exports = function (args, hookName, newVersion, hooks, cb) {
-  if (!hooks[hookName]) return Promise.resolve()
-  const command = hooks[hookName] + ' --new-version="' + newVersion + '"'
-  checkpoint(args, 'Running lifecycle hook "%s"', [hookName])
-  checkpoint(args, '- hook command: "%s"', [command], chalk.blue(figures.info))
-  return runExec(args, command)
-}
diff --git a/lib/updaters/index.js b/lib/updaters/index.js
index 84ed1a0..faaab5e 100644
--- a/lib/updaters/index.js
+++ b/lib/updaters/index.js
@@ -1,13 +1,17 @@
 const path = require('path')
 const JSON_BUMP_FILES = require('../../defaults').bumpFiles
+const updatersByType = {
+  json: require('./types/json'),
+  'plain-text': require('./types/plain-text')
+}
 const PLAIN_TEXT_BUMP_FILES = ['VERSION.txt', 'version.txt']
 
 function getUpdaterByType (type) {
-  try {
-    return require(`./types/${type}`)
-  } catch (e) {
-    throw Error(`Unable to locate updated for provided type (${type}).`)
+  const updater = updatersByType[type]
+  if (!updater) {
+    throw Error(`Unable to locate updater for provided type (${type}).`)
   }
+  return updater
 }
 
 function getUpdaterByFilename (filename) {
@@ -23,7 +27,16 @@
 }
 
 function getCustomUpdater (updater) {
-  return require(path.resolve(process.cwd(), updater))
+  if (typeof updater === 'string') {
+    return require(path.resolve(process.cwd(), updater))
+  }
+  if (
+    typeof updater.readVersion === 'function' &&
+    typeof updater.writeVersion === 'function'
+  ) {
+    return updater
+  }
+  throw new Error('Updater must be a string path or an object with readVersion and writeVersion methods')
 }
 
 module.exports.resolveUpdaterObjectFromArgument = function (arg) {
diff --git a/package.json b/package.json
index e29de7f..7f9c218 100644
--- a/package.json
+++ b/package.json
@@ -1,12 +1,13 @@
 {
   "name": "standard-version",
-  "version": "8.0.2",
+  "version": "9.0.0",
   "description": "replacement for `npm version` with automatic CHANGELOG generation",
   "bin": "bin/cli.js",
   "scripts": {
     "fix": "eslint . --fix",
     "posttest": "eslint .",
-    "test": "nyc mocha --timeout=30000 test.js",
+    "test": "nyc mocha --timeout=30000",
+    "test:unit": "mocha --exclude test/git.spec.js",
     "release": "bin/cli.js"
   },
   "nyc": {
@@ -36,15 +37,15 @@
   "homepage": "https://github.com/conventional-changelog/standard-version#readme",
   "dependencies": {
     "chalk": "^2.4.2",
-    "conventional-changelog": "3.1.21",
+    "conventional-changelog": "3.1.24",
     "conventional-changelog-config-spec": "2.1.0",
     "conventional-changelog-conventionalcommits": "4.4.0",
-    "conventional-recommended-bump": "6.0.9",
+    "conventional-recommended-bump": "6.0.11",
     "detect-indent": "^6.0.0",
     "detect-newline": "^3.1.0",
     "dotgitignore": "^2.1.0",
     "figures": "^3.1.0",
-    "find-up": "^4.1.0",
+    "find-up": "^5.0.0",
     "fs-access": "^1.0.1",
     "git-semver-tags": "^4.0.0",
     "semver": "^7.1.1",
@@ -54,16 +55,16 @@
   "devDependencies": {
     "chai": "^4.2.0",
     "coveralls": "^3.1.0",
-    "eslint": "^6.8.0",
-    "eslint-config-standard": "^14.1.1",
-    "eslint-plugin-import": "^2.20.0",
-    "eslint-plugin-node": "^10.0.0",
+    "eslint": "^7.14.0",
+    "eslint-config-standard": "^16.0.2",
+    "eslint-plugin-import": "^2.22.1",
+    "eslint-plugin-node": "^11.1.0",
     "eslint-plugin-promise": "^4.2.1",
-    "eslint-plugin-standard": "^4.0.1",
     "mocha": "^8.0.0",
-    "mock-git": "^2.0.0",
+    "mock-fs": "^4.12.0",
     "mockery": "^2.1.0",
     "nyc": "^14.1.1",
-    "shelljs": "^0.8.4"
+    "shelljs": "^0.8.4",
+    "std-mocks": "^1.0.1"
   }
 }
diff --git a/test.js b/test.js
deleted file mode 100644
index 83627fa..0000000
--- a/test.js
+++ /dev/null
@@ -1,1338 +0,0 @@
-/* global describe it beforeEach afterEach */
-
-'use strict'
-
-const shell = require('shelljs')
-const fs = require('fs')
-const path = require('path')
-const stream = require('stream')
-const mockGit = require('mock-git')
-const mockery = require('mockery')
-const semver = require('semver')
-const formatCommitMessage = require('./lib/format-commit-message')
-const cli = require('./command')
-const standardVersion = require('./index')
-
-const isWindows = process.platform === 'win32'
-
-require('chai').should()
-
-const cliPath = path.resolve(__dirname, './bin/cli.js')
-
-function branch (branch) {
-  shell.exec('git branch ' + branch)
-}
-
-function checkout (branch) {
-  shell.exec('git checkout ' + branch)
-}
-
-function commit (msg) {
-  shell.exec('git commit --allow-empty -m"' + msg + '"')
-}
-
-function merge (msg, branch) {
-  shell.exec('git merge --no-ff -m"' + msg + '" ' + branch)
-}
-
-function execCli (argString) {
-  return shell.exec('node ' + cliPath + (argString != null ? ' ' + argString : ''))
-}
-
-function execCliAsync (argString) {
-  return standardVersion(cli.parse('standard-version ' + argString + ' --silent'))
-}
-
-function writePackageJson (version, option) {
-  option = option || {}
-  const pkg = Object.assign(option, { version: version })
-  fs.writeFileSync('package.json', JSON.stringify(pkg), 'utf-8')
-}
-
-function writeBowerJson (version, option) {
-  option = option || {}
-  const bower = Object.assign(option, { version: version })
-  fs.writeFileSync('bower.json', JSON.stringify(bower), 'utf-8')
-}
-
-function writeManifestJson (version, option) {
-  option = option || {}
-  const manifest = Object.assign(option, { version: version })
-  fs.writeFileSync('manifest.json', JSON.stringify(manifest), 'utf-8')
-}
-
-function writeNpmShrinkwrapJson (version, option) {
-  option = option || {}
-  const shrinkwrap = Object.assign(option, { version: version })
-  fs.writeFileSync('npm-shrinkwrap.json', JSON.stringify(shrinkwrap), 'utf-8')
-}
-
-function writePackageLockJson (version, option) {
-  option = option || {}
-  const pkgLock = Object.assign(option, { version: version })
-  fs.writeFileSync('package-lock.json', JSON.stringify(pkgLock), 'utf-8')
-}
-
-function writeGitPreCommitHook () {
-  fs.writeFileSync('.git/hooks/pre-commit', '#!/bin/sh\necho "precommit ran"\nexit 1', 'utf-8')
-  fs.chmodSync('.git/hooks/pre-commit', '755')
-}
-
-function writePostBumpHook (causeError) {
-  writeHook('postbump', causeError)
-}
-
-function writeHook (hookName, causeError, script) {
-  shell.mkdir('-p', 'scripts')
-  let content = script || 'console.error("' + hookName + ' ran")'
-  content += causeError ? '\nthrow new Error("' + hookName + '-failure")' : ''
-  fs.writeFileSync('scripts/' + hookName + '.js', content, 'utf-8')
-  fs.chmodSync('scripts/' + hookName + '.js', '755')
-}
-
-function initInTempFolder () {
-  shell.rm('-rf', 'tmp')
-  shell.config.silent = true
-  shell.mkdir('tmp')
-  shell.cd('tmp')
-  shell.exec('git init')
-  shell.exec('git config commit.gpgSign false')
-  commit('root-commit')
-  writePackageJson('1.0.0')
-}
-
-function finishTemp () {
-  shell.cd('../')
-  shell.rm('-rf', 'tmp')
-}
-
-function getPackageVersion () {
-  return JSON.parse(fs.readFileSync('package.json', 'utf-8')).version
-}
-
-describe('format-commit-message', function () {
-  it('works for no {{currentTag}}', function () {
-    formatCommitMessage('chore(release): 1.0.0', '1.0.0').should.equal('chore(release): 1.0.0')
-  })
-  it('works for one {{currentTag}}', function () {
-    formatCommitMessage('chore(release): {{currentTag}}', '1.0.0').should.equal('chore(release): 1.0.0')
-  })
-  it('works for two {{currentTag}}', function () {
-    formatCommitMessage('chore(release): {{currentTag}} \n\n* CHANGELOG: https://github.com/conventional-changelog/standard-version/blob/v{{currentTag}}/CHANGELOG.md', '1.0.0').should.equal('chore(release): 1.0.0 \n\n* CHANGELOG: https://github.com/conventional-changelog/standard-version/blob/v1.0.0/CHANGELOG.md')
-  })
-})
-
-describe('cli', function () {
-  beforeEach(initInTempFolder)
-  afterEach(finishTemp)
-
-  describe('CHANGELOG.md does not exist', function () {
-    it('populates changelog with commits since last tag by default', function () {
-      commit('feat: first commit')
-      shell.exec('git tag -a v1.0.0 -m "my awesome first release"')
-      commit('fix: patch release')
-
-      execCli().code.should.equal(0)
-
-      const content = fs.readFileSync('CHANGELOG.md', 'utf-8')
-      content.should.match(/patch release/)
-      content.should.not.match(/first commit/)
-    })
-
-    it('includes all commits if --first-release is true', function () {
-      writePackageJson('1.0.1')
-
-      commit('feat: first commit')
-      commit('fix: patch release')
-      execCli('--first-release').code.should.equal(0)
-
-      const content = fs.readFileSync('CHANGELOG.md', 'utf-8')
-      content.should.match(/patch release/)
-      content.should.match(/first commit/)
-      shell.exec('git tag').stdout.should.match(/1\.0\.1/)
-    })
-
-    it('skipping changelog will not create a changelog file', function () {
-      writePackageJson('1.0.0')
-
-      commit('feat: first commit')
-      return execCliAsync('--skip.changelog true')
-        .then(function () {
-          getPackageVersion().should.equal('1.1.0')
-          let fileNotFound = false
-          try {
-            fs.readFileSync('CHANGELOG.md', 'utf-8')
-          } catch (err) {
-            fileNotFound = true
-          }
-
-          fileNotFound.should.equal(true)
-        })
-    })
-  })
-
-  describe('CHANGELOG.md exists', function () {
-    it('appends the new release above the last release, removing the old header (legacy format)', function () {
-      fs.writeFileSync('CHANGELOG.md', 'legacy header format<a name="1.0.0">\n', 'utf-8')
-
-      commit('feat: first commit')
-      shell.exec('git tag -a v1.0.0 -m "my awesome first release"')
-      commit('fix: patch release')
-
-      execCli().code.should.equal(0)
-      const content = fs.readFileSync('CHANGELOG.md', 'utf-8')
-      content.should.match(/1\.0\.1/)
-      content.should.not.match(/legacy header format/)
-    })
-
-    // TODO: we should use snapshots which are easier to update than large
-    // string assertions; we should also consider not using the CLI which
-    // is slower than calling standard-version directly.
-    it('appends the new release above the last release, removing the old header (new format)', function () {
-      // we don't create a package.json, so no {{host}} and {{repo}} tag
-      // will be populated, let's use a compareUrlFormat without these.
-      const cliArgs = '--compareUrlFormat=/compare/{{previousTag}}...{{currentTag}}'
-
-      commit('feat: first commit')
-      shell.exec('git tag -a v1.0.0 -m "my awesome first release"')
-      commit('fix: patch release')
-
-      execCli(cliArgs).code.should.equal(0)
-      let content = fs.readFileSync('CHANGELOG.md', 'utf-8')
-
-      // remove commit hashes and dates to make testing against a static string easier:
-      content = content.replace(/patch release [0-9a-f]{6,8}/g, 'patch release ABCDEFXY').replace(/\([0-9]{4}-[0-9]{2}-[0-9]{2}\)/g, '(YYYY-MM-DD)')
-      content.should.equal('# Changelog\n\nAll notable changes to this project will be documented in this file. See [standard-version](https://github.com/conventional-changelog/standard-version) for commit guidelines.\n\n### [1.0.1](/compare/v1.0.0...v1.0.1) (YYYY-MM-DD)\n\n\n### Bug Fixes\n\n* patch release ABCDEFXY\n')
-
-      commit('fix: another patch release')
-      // we've populated no package.json, so no {{host}} and
-      execCli(cliArgs).code.should.equal(0)
-      content = fs.readFileSync('CHANGELOG.md', 'utf-8')
-      content = content.replace(/patch release [0-9a-f]{6,8}/g, 'patch release ABCDEFXY').replace(/\([0-9]{4}-[0-9]{2}-[0-9]{2}\)/g, '(YYYY-MM-DD)')
-      content.should.equal('# Changelog\n\nAll notable changes to this project will be documented in this file. See [standard-version](https://github.com/conventional-changelog/standard-version) for commit guidelines.\n\n### [1.0.2](/compare/v1.0.1...v1.0.2) (YYYY-MM-DD)\n\n\n### Bug Fixes\n\n* another patch release ABCDEFXY\n\n### [1.0.1](/compare/v1.0.0...v1.0.1) (YYYY-MM-DD)\n\n\n### Bug Fixes\n\n* patch release ABCDEFXY\n')
-    })
-
-    it('commits all staged files', function () {
-      fs.writeFileSync('CHANGELOG.md', 'legacy header format<a name="1.0.0">\n', 'utf-8')
-
-      commit('feat: first commit')
-      shell.exec('git tag -a v1.0.0 -m "my awesome first release"')
-      commit('fix: patch release')
-
-      fs.writeFileSync('STUFF.md', 'stuff\n', 'utf-8')
-
-      shell.exec('git add STUFF.md')
-
-      execCli('--commit-all').code.should.equal(0)
-
-      const content = fs.readFileSync('CHANGELOG.md', 'utf-8')
-      const status = shell.exec('git status --porcelain') // see http://unix.stackexchange.com/questions/155046/determine-if-git-working-directory-is-clean-from-a-script
-
-      status.should.equal('')
-      status.should.not.match(/STUFF.md/)
-
-      content.should.match(/1\.0\.1/)
-      content.should.not.match(/legacy header format/)
-    })
-
-    it('[DEPRECATED] (--changelogHeader) allows for a custom changelog header', function () {
-      fs.writeFileSync('CHANGELOG.md', '', 'utf-8')
-      commit('feat: first commit')
-      execCli('--changelogHeader="# Pork Chop Log"').code.should.equal(0)
-      const content = fs.readFileSync('CHANGELOG.md', 'utf-8')
-      content.should.match(/# Pork Chop Log/)
-    })
-
-    it('[DEPRECATED] (--changelogHeader) exits with error if changelog header matches last version search regex', function () {
-      fs.writeFileSync('CHANGELOG.md', '', 'utf-8')
-      commit('feat: first commit')
-      execCli('--changelogHeader="## 3.0.2"').code.should.equal(1)
-    })
-  })
-
-  // TODO: investigate why mock-git does not play well with execFile on Windows.
-  if (!isWindows) {
-    describe('with mocked git', function () {
-      it('--sign signs the commit and tag', function () {
-        // mock git with file that writes args to gitcapture.log
-        return mockGit('require("fs").appendFileSync("gitcapture.log", JSON.stringify(process.argv.splice(2)) + "\\n")')
-          .then(function (unmock) {
-            execCli('--sign').code.should.equal(0)
-
-            const captured = shell.cat('gitcapture.log').stdout.split('\n').map(function (line) {
-              return line ? JSON.parse(line) : line
-            })
-            /* eslint-disable no-useless-escape */
-            captured[captured.length - 4].should.deep.equal(['commit', '-S', 'CHANGELOG.md', 'package.json', '-m', 'chore(release): 1.0.1'])
-            captured[captured.length - 3].should.deep.equal(['tag', '-s', 'v1.0.1', '-m', 'chore(release): 1.0.1'])
-            /* eslint-enable no-useless-escape */
-            unmock()
-          })
-      })
-
-      it('exits with error code if git commit fails', function () {
-        // mock git by throwing on attempt to commit
-        return mockGit('console.error("commit yourself"); process.exit(128);', 'commit')
-          .then(function (unmock) {
-            const result = execCli()
-            result.code.should.equal(1)
-            result.stderr.should.match(/commit yourself/)
-
-            unmock()
-          })
-      })
-
-      it('exits with error code if git add fails', function () {
-        // mock git by throwing on attempt to add
-        return mockGit('console.error("addition is hard"); process.exit(128);', 'add')
-          .then(function (unmock) {
-            const result = execCli()
-            result.code.should.equal(1)
-            result.stderr.should.match(/addition is hard/)
-
-            unmock()
-          })
-      })
-
-      it('exits with error code if git tag fails', function () {
-        // mock git by throwing on attempt to commit
-        return mockGit('console.error("tag, you\'re it"); process.exit(128);', 'tag')
-          .then(function (unmock) {
-            const result = execCli()
-            result.code.should.equal(1)
-            result.stderr.should.match(/tag, you're it/)
-
-            unmock()
-          })
-      })
-
-      it('doesn\'t fail fast on stderr output from git', function () {
-        // mock git by throwing on attempt to commit
-        return mockGit('console.error("haha, kidding, this is just a warning"); process.exit(0);', 'add')
-          .then(function (unmock) {
-            writePackageJson('1.0.0')
-
-            const result = execCli()
-            result.code.should.equal(1)
-            result.stderr.should.match(/haha, kidding, this is just a warning/)
-
-            unmock()
-          })
-      })
-    })
-  }
-
-  describe('lifecycle scripts', () => {
-    describe('prerelease hook', function () {
-      it('should run the prerelease hook when provided', function () {
-        writePackageJson('1.0.0', {
-          'standard-version': {
-            scripts: {
-              prerelease: 'node scripts/prerelease'
-            }
-          }
-        })
-        writeHook('prerelease')
-        fs.writeFileSync('CHANGELOG.md', 'legacy header format<a name="1.0.0">\n', 'utf-8')
-
-        commit('feat: first commit')
-        const result = execCli('--patch')
-        result.code.should.equal(0)
-        result.stderr.should.match(/prerelease ran/)
-      })
-
-      it('should abort if the hook returns a non-zero exit code', function () {
-        writePackageJson('1.0.0', {
-          'standard-version': {
-            scripts: {
-              prerelease: 'node scripts/prerelease && exit 1'
-            }
-          }
-        })
-        writeHook('prerelease')
-        fs.writeFileSync('CHANGELOG.md', 'legacy header format<a name="1.0.0">\n', 'utf-8')
-
-        commit('feat: first commit')
-        const result = execCli('--patch')
-        result.code.should.equal(1)
-        result.stderr.should.match(/prerelease ran/)
-      })
-    })
-
-    describe('prebump hook', function () {
-      it('should allow prebump hook to return an alternate version #', function () {
-        writePackageJson('1.0.0', {
-          'standard-version': {
-            scripts: {
-              prebump: 'node scripts/prebump'
-            }
-          }
-        })
-        writeHook('prebump', false, 'console.log("9.9.9")')
-        fs.writeFileSync('CHANGELOG.md', 'legacy header format<a name="1.0.0">\n', 'utf-8')
-
-        commit('feat: first commit')
-        const result = execCli('--patch')
-        result.stdout.should.match(/9\.9\.9/)
-        result.code.should.equal(0)
-      })
-    })
-
-    describe('postbump hook', function () {
-      it('should run the postbump hook when provided', function () {
-        writePackageJson('1.0.0', {
-          'standard-version': {
-            scripts: {
-              postbump: 'node scripts/postbump'
-            }
-          }
-        })
-        writePostBumpHook()
-        fs.writeFileSync('CHANGELOG.md', 'legacy header format<a name="1.0.0">\n', 'utf-8')
-
-        commit('feat: first commit')
-        const result = execCli('--patch')
-        result.code.should.equal(0)
-        result.stderr.should.match(/postbump ran/)
-      })
-
-      it('should run the postbump and exit with error when postbump fails', function () {
-        writePackageJson('1.0.0', {
-          'standard-version': {
-            scripts: {
-              postbump: 'node scripts/postbump'
-            }
-          }
-        })
-        writePostBumpHook(true)
-        fs.writeFileSync('CHANGELOG.md', 'legacy header format<a name="1.0.0">\n', 'utf-8')
-
-        commit('feat: first commit')
-        const result = execCli('--patch')
-        result.code.should.equal(1)
-        result.stderr.should.match(/postbump-failure/)
-      })
-    })
-
-    describe('precommit hook', function () {
-      it('should run the precommit hook when provided via .versionrc.json (#371)', function () {
-        fs.writeFileSync('.versionrc.json', JSON.stringify({
-          scripts: {
-            precommit: 'node scripts/precommit'
-          }
-        }), 'utf-8')
-
-        writeHook('precommit')
-        fs.writeFileSync('CHANGELOG.md', 'legacy header format<a name="1.0.0">\n', 'utf-8')
-        commit('feat: first commit')
-        const result = execCli()
-        result.code.should.equal(0)
-        result.stderr.should.match(/precommit ran/)
-      })
-
-      it('should run the precommit hook when provided', function () {
-        writePackageJson('1.0.0', {
-          'standard-version': {
-            scripts: {
-              precommit: 'node scripts/precommit'
-            }
-          }
-        })
-        writeHook('precommit')
-        fs.writeFileSync('CHANGELOG.md', 'legacy header format<a name="1.0.0">\n', 'utf-8')
-
-        commit('feat: first commit')
-        const result = execCli('--patch')
-        result.code.should.equal(0)
-        result.stderr.should.match(/precommit ran/)
-      })
-
-      it('should run the precommit hook and exit with error when precommit fails', function () {
-        writePackageJson('1.0.0', {
-          'standard-version': {
-            scripts: {
-              precommit: 'node scripts/precommit'
-            }
-          }
-        })
-        writeHook('precommit', true)
-        fs.writeFileSync('CHANGELOG.md', 'legacy header format<a name="1.0.0">\n', 'utf-8')
-
-        commit('feat: first commit')
-        const result = execCli('--patch')
-        result.code.should.equal(1)
-        result.stderr.should.match(/precommit-failure/)
-      })
-
-      it('should allow an alternate commit message to be provided by precommit script', function () {
-        writePackageJson('1.0.0', {
-          'standard-version': {
-            scripts: {
-              precommit: 'node scripts/precommit'
-            }
-          }
-        })
-        writeHook('precommit', false, 'console.log("releasing %s delivers #222")')
-        fs.writeFileSync('CHANGELOG.md', 'legacy header format<a name="1.0.0">\n', 'utf-8')
-
-        commit('feat: first commit')
-        const result = execCli('--patch')
-        result.code.should.equal(0)
-        shell.exec('git log --oneline -n1').should.match(/delivers #222/)
-      })
-    })
-  })
-
-  describe('pre-release', function () {
-    it('works fine without specifying a tag id when prereleasing', function () {
-      writePackageJson('1.0.0')
-      fs.writeFileSync('CHANGELOG.md', 'legacy header format<a name="1.0.0">\n', 'utf-8')
-
-      commit('feat: first commit')
-      return execCliAsync('--prerelease')
-        .then(function () {
-          // it's a feature commit, so it's minor type
-          getPackageVersion().should.equal('1.1.0-0')
-        })
-    })
-
-    it('advises use of --tag prerelease for publishing to npm', function () {
-      writePackageJson('1.0.0')
-      fs.writeFileSync('CHANGELOG.md', 'legacy header format<a name="1.0.0">\n', 'utf-8')
-
-      commit('feat: first commit')
-      execCli('--prerelease').stdout.should.include('--tag prerelease')
-    })
-
-    it('advises use of --tag alpha for publishing to npm when tagging alpha', function () {
-      writePackageJson('1.0.0')
-      fs.writeFileSync('CHANGELOG.md', 'legacy header format<a name="1.0.0">\n', 'utf-8')
-
-      commit('feat: first commit')
-      execCli('--prerelease alpha').stdout.should.include('--tag alpha')
-    })
-
-    it('does not advise use of --tag prerelease for private modules', function () {
-      writePackageJson('1.0.0', { private: true })
-      fs.writeFileSync('CHANGELOG.md', 'legacy header format<a name="1.0.0">\n', 'utf-8')
-
-      commit('feat: first commit')
-      execCli('--prerelease').stdout.should.not.include('--tag prerelease')
-    })
-  })
-
-  describe('manual-release', function () {
-    it('throws error when not specifying a release type', function () {
-      writePackageJson('1.0.0')
-      fs.writeFileSync('CHANGELOG.md', 'legacy header format<a name="1.0.0">\n', 'utf-8')
-
-      commit('fix: first commit')
-      execCli('--release-as').code.should.above(0)
-    })
-
-    describe('release-types', function () {
-      const regularTypes = ['major', 'minor', 'patch']
-
-      regularTypes.forEach(function (type) {
-        it('creates a ' + type + ' release', function () {
-          const originVer = '1.0.0'
-          writePackageJson(originVer)
-          fs.writeFileSync('CHANGELOG.md', 'legacy header format<a name="1.0.0">\n', 'utf-8')
-
-          commit('fix: first commit')
-
-          return execCliAsync('--release-as ' + type)
-            .then(function () {
-              const version = {
-                major: semver.major(originVer),
-                minor: semver.minor(originVer),
-                patch: semver.patch(originVer)
-              }
-
-              version[type] += 1
-
-              getPackageVersion().should.equal(version.major + '.' + version.minor + '.' + version.patch)
-            })
-        })
-      })
-
-      // this is for pre-releases
-      regularTypes.forEach(function (type) {
-        it('creates a pre' + type + ' release', function () {
-          const originVer = '1.0.0'
-          writePackageJson(originVer)
-          fs.writeFileSync('CHANGELOG.md', 'legacy header format<a name="1.0.0">\n', 'utf-8')
-
-          commit('fix: first commit')
-
-          return execCliAsync('--release-as ' + type + ' --prerelease ' + type)
-            .then(function () {
-              const version = {
-                major: semver.major(originVer),
-                minor: semver.minor(originVer),
-                patch: semver.patch(originVer)
-              }
-
-              version[type] += 1
-
-              getPackageVersion().should.equal(version.major + '.' + version.minor + '.' + version.patch + '-' + type + '.0')
-            })
-        })
-      })
-    })
-
-    describe('release-as-exact', function () {
-      it('releases as v100.0.0', function () {
-        const originVer = '1.0.0'
-        writePackageJson(originVer)
-        fs.writeFileSync('CHANGELOG.md', 'legacy header format<a name="1.0.0">\n', 'utf-8')
-
-        commit('fix: first commit')
-
-        return execCliAsync('--release-as v100.0.0')
-          .then(function () {
-            getPackageVersion().should.equal('100.0.0')
-          })
-      })
-
-      it('releases as 200.0.0-amazing', function () {
-        const originVer = '1.0.0'
-        writePackageJson(originVer)
-        fs.writeFileSync('CHANGELOG.md', 'legacy header format<a name="1.0.0">\n', 'utf-8')
-
-        commit('fix: first commit')
-
-        return execCliAsync('--release-as 200.0.0-amazing')
-          .then(function () {
-            getPackageVersion().should.equal('200.0.0-amazing')
-          })
-      })
-    })
-
-    it('creates a prerelease with a new minor version after two prerelease patches', function () {
-      writePackageJson('1.0.0')
-      fs.writeFileSync('CHANGELOG.md', 'legacy header format<a name="1.0.0">\n', 'utf-8')
-
-      commit('fix: first patch')
-      return execCliAsync('--release-as patch --prerelease dev')
-        .then(function () {
-          getPackageVersion().should.equal('1.0.1-dev.0')
-        })
-
-        // second
-        .then(function () {
-          commit('fix: second patch')
-          return execCliAsync('--prerelease dev')
-        })
-        .then(function () {
-          getPackageVersion().should.equal('1.0.1-dev.1')
-        })
-
-        // third
-        .then(function () {
-          commit('feat: first new feat')
-          return execCliAsync('--release-as minor --prerelease dev')
-        })
-        .then(function () {
-          getPackageVersion().should.equal('1.1.0-dev.0')
-        })
-
-        .then(function () {
-          commit('fix: third patch')
-          return execCliAsync('--release-as minor --prerelease dev')
-        })
-        .then(function () {
-          getPackageVersion().should.equal('1.1.0-dev.1')
-        })
-
-        .then(function () {
-          commit('fix: forth patch')
-          return execCliAsync('--prerelease dev')
-        })
-        .then(function () {
-          getPackageVersion().should.equal('1.1.0-dev.2')
-        })
-    })
-  })
-
-  it('handles commit messages longer than 80 characters', function () {
-    commit('feat: first commit')
-    shell.exec('git tag -a v1.0.0 -m "my awesome first release"')
-    commit('fix: this is my fairly long commit message which is testing whether or not we allow for long commit messages')
-
-    execCli().code.should.equal(0)
-
-    const content = fs.readFileSync('CHANGELOG.md', 'utf-8')
-    content.should.match(/this is my fairly long commit message which is testing whether or not we allow for long commit messages/)
-  })
-
-  it('formats the commit and tag messages appropriately', function () {
-    commit('feat: first commit')
-    shell.exec('git tag -a v1.0.0 -m "my awesome first release"')
-    commit('feat: new feature!')
-
-    execCli().code.should.equal(0)
-
-    // check last commit message
-    shell.exec('git log --oneline -n1').stdout.should.match(/chore\(release\): 1\.1\.0/)
-    // check annotated tag message
-    shell.exec('git tag -l -n1 v1.1.0').stdout.should.match(/chore\(release\): 1\.1\.0/)
-  })
-
-  it('appends line feed at end of package.json', function () {
-    execCli().code.should.equal(0)
-
-    const pkgJson = fs.readFileSync('package.json', 'utf-8')
-    pkgJson.should.equal(['{', '  "version": "1.0.1"', '}', ''].join('\n'))
-  })
-
-  it('preserves indentation of tabs in package.json', function () {
-    const indentation = '\t'
-    const newPkgJson = ['{', indentation + '"version": "1.0.0"', '}', ''].join('\n')
-    fs.writeFileSync('package.json', newPkgJson, 'utf-8')
-
-    execCli().code.should.equal(0)
-    const pkgJson = fs.readFileSync('package.json', 'utf-8')
-    pkgJson.should.equal(['{', indentation + '"version": "1.0.1"', '}', ''].join('\n'))
-  })
-
-  it('preserves indentation of spaces in package.json', function () {
-    const indentation = '     '
-    const newPkgJson = ['{', indentation + '"version": "1.0.0"', '}', ''].join('\n')
-    fs.writeFileSync('package.json', newPkgJson, 'utf-8')
-
-    execCli().code.should.equal(0)
-    const pkgJson = fs.readFileSync('package.json', 'utf-8')
-    pkgJson.should.equal(['{', indentation + '"version": "1.0.1"', '}', ''].join('\n'))
-  })
-
-  it('preserves line feed in package.json', function () {
-    const newPkgJson = ['{', '  "version": "1.0.0"', '}', ''].join('\n')
-    fs.writeFileSync('package.json', newPkgJson, 'utf-8')
-
-    execCli().code.should.equal(0)
-    const pkgJson = fs.readFileSync('package.json', 'utf-8')
-    pkgJson.should.equal(['{', '  "version": "1.0.1"', '}', ''].join('\n'))
-  })
-
-  it('preserves carriage return + line feed in package.json', function () {
-    const newPkgJson = ['{', '  "version": "1.0.0"', '}', ''].join('\r\n')
-    fs.writeFileSync('package.json', newPkgJson, 'utf-8')
-
-    execCli().code.should.equal(0)
-    const pkgJson = fs.readFileSync('package.json', 'utf-8')
-    pkgJson.should.equal(['{', '  "version": "1.0.1"', '}', ''].join('\r\n'))
-  })
-
-  it('does not run git hooks if the --no-verify flag is passed', function () {
-    writeGitPreCommitHook()
-
-    commit('feat: first commit')
-    execCli('--no-verify').code.should.equal(0)
-    commit('feat: second commit')
-    execCli('-n').code.should.equal(0)
-  })
-
-  it('does not print output when the --silent flag is passed', function () {
-    const result = execCli('--silent')
-    result.code.should.equal(0)
-    result.stdout.should.equal('')
-    result.stderr.should.equal('')
-  })
-
-  it('does not display `npm publish` if the package is private', function () {
-    writePackageJson('1.0.0', { private: true })
-
-    const result = execCli()
-    result.code.should.equal(0)
-    result.stdout.should.not.match(/npm publish/)
-  })
-
-  it('does not display `all staged files` without the --commit-all flag', function () {
-    const result = execCli()
-    result.code.should.equal(0)
-    result.stdout.should.not.match(/and all staged files/)
-  })
-
-  it('does display `all staged files` if the --commit-all flag is passed', function () {
-    const result = execCli('--commit-all')
-    result.code.should.equal(0)
-    result.stdout.should.match(/and all staged files/)
-  })
-
-  it('includes merge commits', function () {
-    const branchName = 'new-feature'
-    commit('feat: first commit')
-    shell.exec('git tag -a v1.0.0 -m "my awesome first release"')
-    branch(branchName)
-    checkout(branchName)
-    commit('Implementing new feature')
-    checkout('master')
-    merge('feat: new feature from branch', branchName)
-
-    execCli().code.should.equal(0)
-
-    const content = fs.readFileSync('CHANGELOG.md', 'utf-8')
-    content.should.match(/new feature from branch/)
-
-    const pkgJson = fs.readFileSync('package.json', 'utf-8')
-    pkgJson.should.equal(['{', '  "version": "1.1.0"', '}', ''].join('\n'))
-  })
-
-  it('exits with error code if "scripts" is not an object', () => {
-    writePackageJson('1.0.0', {
-      'standard-version': {
-        scripts: 'echo hello'
-      }
-    })
-
-    commit('feat: first commit')
-    const result = execCli()
-    result.code.should.equal(1)
-    result.stderr.should.match(/scripts must be an object/)
-  })
-
-  it('exits with error code if "skip" is not an object', () => {
-    writePackageJson('1.0.0', {
-      'standard-version': {
-        skip: true
-      }
-    })
-
-    commit('feat: first commit')
-    const result = execCli()
-    result.code.should.equal(1)
-    result.stderr.should.match(/skip must be an object/)
-  })
-})
-
-describe('standard-version', function () {
-  beforeEach(initInTempFolder)
-  afterEach(finishTemp)
-
-  describe('with mocked conventionalRecommendedBump', function () {
-    beforeEach(function () {
-      mockery.enable({ warnOnUnregistered: false, useCleanCache: true })
-      mockery.registerMock('conventional-recommended-bump', function (_, cb) {
-        cb(new Error('bump err'))
-      })
-    })
-
-    afterEach(function () {
-      mockery.deregisterMock('conventional-recommended-bump')
-      mockery.disable()
-    })
-
-    it('should exit on bump error', function (done) {
-      commit('feat: first commit')
-      shell.exec('git tag -a v1.0.0 -m "my awesome first release"')
-      commit('feat: new feature!')
-
-      require('./index')({ silent: true })
-        .catch((err) => {
-          err.message.should.match(/bump err/)
-          done()
-        })
-    })
-  })
-
-  describe('with mocked conventionalChangelog', function () {
-    beforeEach(function () {
-      mockery.enable({ warnOnUnregistered: false, useCleanCache: true })
-      mockery.registerMock('conventional-changelog', function () {
-        const readable = new stream.Readable({ objectMode: true })
-        readable._read = function () {
-        }
-        setImmediate(readable.emit.bind(readable), 'error', new Error('changelog err'))
-        return readable
-      })
-    })
-
-    afterEach(function () {
-      mockery.deregisterMock('conventional-changelog')
-      mockery.disable()
-    })
-
-    it('should exit on changelog error', function (done) {
-      commit('feat: first commit')
-      shell.exec('git tag -a v1.0.0 -m "my awesome first release"')
-      commit('feat: new feature!')
-
-      require('./index')({ silent: true })
-        .catch((err) => {
-          err.message.should.match(/changelog err/)
-          return done()
-        })
-    })
-  })
-
-  it('formats the commit and tag messages appropriately', function (done) {
-    commit('feat: first commit')
-    shell.exec('git tag -a v1.0.0 -m "my awesome first release"')
-    commit('feat: new feature!')
-
-    require('./index')({ silent: true })
-      .then(() => {
-        // check last commit message
-        shell.exec('git log --oneline -n1').stdout.should.match(/chore\(release\): 1\.1\.0/)
-        // check annotated tag message
-        shell.exec('git tag -l -n1 v1.1.0').stdout.should.match(/chore\(release\): 1\.1\.0/)
-        done()
-      })
-  })
-
-  describe('without a package file to bump', function () {
-    it('should exit with error', function () {
-      shell.rm('package.json')
-      return require('./index')({
-        silent: true,
-        gitTagFallback: false
-      })
-        .catch((err) => {
-          err.message.should.equal('no package file found')
-        })
-    })
-  })
-
-  describe('bower.json support', function () {
-    beforeEach(function () {
-      writeBowerJson('1.0.0')
-    })
-
-    it('bumps version # in bower.json', function () {
-      commit('feat: first commit')
-      shell.exec('git tag -a v1.0.0 -m "my awesome first release"')
-      commit('feat: new feature!')
-      return require('./index')({ silent: true })
-        .then(() => {
-          JSON.parse(fs.readFileSync('bower.json', 'utf-8')).version.should.equal('1.1.0')
-          getPackageVersion().should.equal('1.1.0')
-        })
-    })
-  })
-
-  describe('manifest.json support', function () {
-    beforeEach(function () {
-      writeManifestJson('1.0.0')
-    })
-
-    it('bumps version # in manifest.json', function () {
-      commit('feat: first commit')
-      shell.exec('git tag -a v1.0.0 -m "my awesome first release"')
-      commit('feat: new feature!')
-      return require('./index')({ silent: true })
-        .then(() => {
-          JSON.parse(fs.readFileSync('manifest.json', 'utf-8')).version.should.equal('1.1.0')
-          getPackageVersion().should.equal('1.1.0')
-        })
-    })
-  })
-
-  describe('custom `bumpFiles` support', function () {
-    it('mix.exs + version.txt', function () {
-      // @todo This file path is relative to the `tmp` directory, which is a little confusing
-      fs.copyFileSync('../test/mocks/mix.exs', 'mix.exs')
-      fs.copyFileSync('../test/mocks/version.txt', 'version.txt')
-      fs.copyFileSync('../test/mocks/updater/customer-updater.js', 'custom-updater.js')
-      commit('feat: first commit')
-      shell.exec('git tag -a v1.0.0 -m "my awesome first release"')
-      commit('feat: new feature!')
-      return require('./index')({
-        silent: true,
-        bumpFiles: [
-          'version.txt',
-          {
-            filename: 'mix.exs',
-            updater: 'custom-updater.js'
-          }
-        ]
-      })
-        .then(() => {
-          fs.readFileSync('mix.exs', 'utf-8').should.contain('version: "1.1.0"')
-          fs.readFileSync('version.txt', 'utf-8').should.equal('1.1.0')
-        })
-    })
-
-    it('bumps a custom `plain-text` file', function () {
-      fs.copyFileSync('../test/mocks/VERSION-1.0.0.txt', 'VERSION_TRACKER.txt')
-      commit('feat: first commit')
-      return require('./index')({
-        silent: true,
-        bumpFiles: [
-          {
-            filename: 'VERSION_TRACKER.txt',
-            type: 'plain-text'
-          }
-        ]
-      })
-        .then(() => {
-          fs.readFileSync('VERSION_TRACKER.txt', 'utf-8').should.equal('1.1.0')
-        })
-    })
-  })
-
-  describe('custom `packageFiles` support', function () {
-    it('reads and writes to a custom `plain-text` file', function () {
-      fs.copyFileSync('../test/mocks/VERSION-6.3.1.txt', 'VERSION_TRACKER.txt')
-      commit('feat: yet another commit')
-      return require('./index')({
-        silent: true,
-        packageFiles: [
-          {
-            filename: 'VERSION_TRACKER.txt',
-            type: 'plain-text'
-          }
-        ],
-        bumpFiles: [
-          {
-            filename: 'VERSION_TRACKER.txt',
-            type: 'plain-text'
-          }
-        ]
-      })
-        .then(() => {
-          fs.readFileSync('VERSION_TRACKER.txt', 'utf-8').should.equal('6.4.0')
-        })
-    })
-  })
-
-  describe('npm-shrinkwrap.json support', function () {
-    beforeEach(function () {
-      writeNpmShrinkwrapJson('1.0.0')
-    })
-
-    it('bumps version # in npm-shrinkwrap.json', function (done) {
-      commit('feat: first commit')
-      shell.exec('git tag -a v1.0.0 -m "my awesome first release"')
-      commit('feat: new feature!')
-      require('./index')({ silent: true })
-        .then(() => {
-          JSON.parse(fs.readFileSync('npm-shrinkwrap.json', 'utf-8')).version.should.equal('1.1.0')
-          getPackageVersion().should.equal('1.1.0')
-          return done()
-        })
-    })
-  })
-
-  describe('package-lock.json support', function () {
-    beforeEach(function () {
-      writePackageLockJson('1.0.0')
-      fs.writeFileSync('.gitignore', '', 'utf-8')
-    })
-
-    it('bumps version # in package-lock.json', function () {
-      commit('feat: first commit')
-      shell.exec('git tag -a v1.0.0 -m "my awesome first release"')
-      commit('feat: new feature!')
-      return require('./index')({ silent: true })
-        .then(() => {
-          JSON.parse(fs.readFileSync('package-lock.json', 'utf-8')).version.should.equal('1.1.0')
-          getPackageVersion().should.equal('1.1.0')
-        })
-    })
-  })
-
-  describe('dry-run', function () {
-    it('skips all non-idempotent steps', function (done) {
-      commit('feat: first commit')
-      shell.exec('git tag -a v1.0.0 -m "my awesome first release"')
-      commit('feat: new feature!')
-      execCli('--dry-run').stdout.should.match(/### Features/)
-      shell.exec('git log --oneline -n1').stdout.should.match(/feat: new feature!/)
-      shell.exec('git tag').stdout.should.match(/1\.0\.0/)
-      getPackageVersion().should.equal('1.0.0')
-      return done()
-    })
-  })
-
-  describe('skip', () => {
-    it('allows bump and changelog generation to be skipped', function () {
-      const changelogContent = 'legacy header format<a name="1.0.0">\n'
-      writePackageJson('1.0.0')
-      fs.writeFileSync('CHANGELOG.md', changelogContent, 'utf-8')
-
-      commit('feat: first commit')
-      return execCliAsync('--skip.bump true --skip.changelog true')
-        .then(function () {
-          getPackageVersion().should.equal('1.0.0')
-          const content = fs.readFileSync('CHANGELOG.md', 'utf-8')
-          content.should.equal(changelogContent)
-        })
-    })
-
-    it('allows the commit phase to be skipped', function () {
-      const changelogContent = 'legacy header format<a name="1.0.0">\n'
-      writePackageJson('1.0.0')
-      fs.writeFileSync('CHANGELOG.md', changelogContent, 'utf-8')
-
-      commit('feat: new feature from branch')
-      return execCliAsync('--skip.commit true')
-        .then(function () {
-          getPackageVersion().should.equal('1.1.0')
-          const content = fs.readFileSync('CHANGELOG.md', 'utf-8')
-          content.should.match(/new feature from branch/)
-          // check last commit message
-          shell.exec('git log --oneline -n1').stdout.should.match(/feat: new feature from branch/)
-        })
-    })
-  })
-
-  describe('.gitignore', () => {
-    beforeEach(function () {
-      writeBowerJson('1.0.0')
-    })
-
-    it('does not update files present in .gitignore', () => {
-      fs.writeFileSync('.gitignore', 'bower.json', 'utf-8')
-
-      commit('feat: first commit')
-      shell.exec('git tag -a v1.0.0 -m "my awesome first release"')
-      commit('feat: new feature!')
-      return require('./index')({ silent: true })
-        .then(() => {
-          JSON.parse(fs.readFileSync('bower.json', 'utf-8')).version.should.equal('1.0.0')
-          getPackageVersion().should.equal('1.1.0')
-        })
-    })
-  })
-
-  describe('.gitignore', () => {
-    beforeEach(function () {
-      writeBowerJson('1.0.0')
-    })
-
-    it('does not update files present in .gitignore', () => {
-      fs.writeFileSync('.gitignore', 'bower.json', 'utf-8')
-
-      commit('feat: first commit')
-      shell.exec('git tag -a v1.0.0 -m "my awesome first release"')
-      commit('feat: new feature!')
-      return require('./index')({ silent: true })
-        .then(() => {
-          JSON.parse(fs.readFileSync('bower.json', 'utf-8')).version.should.equal('1.0.0')
-          getPackageVersion().should.equal('1.1.0')
-        })
-    })
-  })
-
-  describe('gitTagFallback', () => {
-    it('defaults to 1.0.0 if no tags in git history', () => {
-      shell.rm('package.json')
-      commit('feat: first commit')
-      return require('./index')({ silent: true })
-        .then(() => {
-          const output = shell.exec('git tag')
-          output.stdout.should.include('v1.1.0')
-        })
-    })
-
-    it('bases version on last tag, if tags are found', () => {
-      shell.rm('package.json')
-      shell.exec('git tag -a v5.0.0 -m "a release"')
-      shell.exec('git tag -a v3.0.0 -m "another release"')
-      commit('feat: another commit')
-      return require('./index')({ silent: true })
-        .then(() => {
-          const output = shell.exec('git tag')
-          output.stdout.should.include('v5.1.0')
-        })
-    })
-
-    it('does not display `npm publish` if there is no package.json', function () {
-      shell.rm('package.json')
-      const result = execCli()
-      result.code.should.equal(0)
-      result.stdout.should.not.match(/npm publish/)
-    })
-  })
-
-  describe('configuration', () => {
-    it('reads config from package.json', function () {
-      writePackageJson('1.0.0', {
-        repository: {
-          url: 'git+https://company@scm.org/office/app.git'
-        },
-        'standard-version': {
-          issueUrlFormat: 'https://standard-version.company.net/browse/{{id}}'
-        }
-      })
-      commit('feat: another commit addresses issue #1')
-      execCli()
-      // CHANGELOG should have the new issue URL format.
-      const content = fs.readFileSync('CHANGELOG.md', 'utf-8')
-      content.should.include('https://standard-version.company.net/browse/1')
-    })
-
-    it('reads config from .versionrc', function () {
-      // write configuration that overrides default issue
-      // URL format.
-      fs.writeFileSync('.versionrc', JSON.stringify({
-        issueUrlFormat: 'http://www.foo.com/{{id}}'
-      }), 'utf-8')
-      commit('feat: another commit addresses issue #1')
-      execCli()
-      // CHANGELOG should have the new issue URL format.
-      const content = fs.readFileSync('CHANGELOG.md', 'utf-8')
-      content.should.include('http://www.foo.com/1')
-    })
-
-    it('reads config from .versionrc.json', function () {
-      // write configuration that overrides default issue
-      // URL format.
-      fs.writeFileSync('.versionrc.json', JSON.stringify({
-        issueUrlFormat: 'http://www.foo.com/{{id}}'
-      }), 'utf-8')
-      commit('feat: another commit addresses issue #1')
-      execCli()
-      // CHANGELOG should have the new issue URL format.
-      const content = fs.readFileSync('CHANGELOG.md', 'utf-8')
-      content.should.include('http://www.foo.com/1')
-    })
-
-    it('evaluates a config-function from .versionrc.js', function () {
-      // write configuration that overrides default issue
-      // URL format.
-      fs.writeFileSync(
-        '.versionrc.js',
-        `module.exports = function() {
-          return {
-            issueUrlFormat: 'http://www.versionrc.js/function/{{id}}'
-          }
-        }`,
-        'utf-8'
-      )
-      commit('feat: another commit addresses issue #1')
-      execCli()
-      // CHANGELOG should have the new issue URL format.
-      const content = fs.readFileSync('CHANGELOG.md', 'utf-8')
-      content.should.include('http://www.versionrc.js/function/1')
-    })
-
-    it('evaluates a config-object from .versionrc.js', function () {
-      // write configuration that overrides default issue
-      // URL format.
-      fs.writeFileSync(
-        '.versionrc.js',
-        `module.exports = {
-          issueUrlFormat: 'http://www.versionrc.js/object/{{id}}'
-        }`,
-        'utf-8'
-      )
-      commit('feat: another commit addresses issue #1')
-      execCli()
-      // CHANGELOG should have the new issue URL format.
-      const content = fs.readFileSync('CHANGELOG.md', 'utf-8')
-      content.should.include('http://www.versionrc.js/object/1')
-    })
-
-    it('throws an error when a non-object is returned from .versionrc.js', function () {
-      // write configuration that overrides default issue
-      // URL format.
-      fs.writeFileSync(
-        '.versionrc.js',
-        'module.exports = 3',
-        'utf-8'
-      )
-      commit('feat: another commit addresses issue #1')
-      execCli().code.should.equal(1)
-    })
-
-    it('.versionrc : releaseCommitMessageFormat', function () {
-      // write configuration that overrides default issue
-      // URL format.
-      fs.writeFileSync('.versionrc', JSON.stringify({
-        releaseCommitMessageFormat: 'This commit represents release: {{currentTag}}'
-      }), 'utf-8')
-      commit('feat: another commit addresses issue #1')
-      execCli()
-      shell.exec('git log --oneline -n1').should.include('This commit represents release: 1.1.0')
-    })
-
-    it('--releaseCommitMessageFormat', function () {
-      commit('feat: another commit addresses issue #1')
-      execCli('--releaseCommitMessageFormat="{{currentTag}} is the version."')
-      shell.exec('git log --oneline -n1').should.include('1.1.0 is the version.')
-    })
-
-    it('.versionrc : issuePrefixes', function () {
-      // write configuration that overrides default issuePrefixes
-      // and reference prefix in issue URL format.
-      fs.writeFileSync('.versionrc', JSON.stringify({
-        issueUrlFormat: 'http://www.foo.com/{{prefix}}{{id}}',
-        issuePrefixes: ['ABC-']
-      }), 'utf-8')
-      commit('feat: another commit addresses issue ABC-1')
-      execCli()
-      // CHANGELOG should have the new issue URL format.
-      const content = fs.readFileSync('CHANGELOG.md', 'utf-8')
-      content.should.include('http://www.foo.com/ABC-1')
-    })
-
-    it('--header', function () {
-      fs.writeFileSync('CHANGELOG.md', '', 'utf-8')
-      commit('feat: first commit')
-      execCli('--header="# Welcome to our CHANGELOG.md"').code.should.equal(0)
-      const content = fs.readFileSync('CHANGELOG.md', 'utf-8')
-      content.should.match(/# Welcome to our CHANGELOG.md/)
-    })
-
-    it('--issuePrefixes and --issueUrlFormat', function () {
-      commit('feat: another commit addresses issue ABC-1')
-      execCli('--issuePrefixes="ABC-" --issueUrlFormat="http://www.foo.com/{{prefix}}{{id}}"')
-      const content = fs.readFileSync('CHANGELOG.md', 'utf-8')
-      content.should.include('http://www.foo.com/ABC-1')
-    })
-
-    it('[LEGACY] supports --message (and single %s replacement)', function () {
-      commit('feat: another commit addresses issue #1')
-      execCli('--message="V:%s"')
-      shell.exec('git log --oneline -n1').should.include('V:1.1.0')
-    })
-
-    it('[LEGACY] supports -m (and multiple %s replacements)', function () {
-      commit('feat: another commit addresses issue #1')
-      execCli('--message="V:%s is the %s."')
-      shell.exec('git log --oneline -n1').should.include('V:1.1.0 is the 1.1.0.')
-    })
-  })
-
-  describe('pre-major', () => {
-    it('bumps the minor rather than major, if version < 1.0.0', function () {
-      writePackageJson('0.5.0', {
-        repository: {
-          url: 'https://github.com/yargs/yargs.git'
-        }
-      })
-      commit('feat!: this is a breaking change')
-      execCli()
-      getPackageVersion().should.equal('0.6.0')
-    })
-
-    it('bumps major if --release-as=major specified, if version < 1.0.0', function () {
-      writePackageJson('0.5.0', {
-        repository: {
-          url: 'https://github.com/yargs/yargs.git'
-        }
-      })
-      commit('feat!: this is a breaking change')
-      execCli('-r major')
-      getPackageVersion().should.equal('1.0.0')
-    })
-  })
-})
-
-describe('GHSL-2020-111', function () {
-  beforeEach(initInTempFolder)
-  afterEach(finishTemp)
-  it('does not allow command injection via basic configuration', function () {
-    return standardVersion({
-      silent: true,
-      noVerify: true,
-      infile: 'foo.txt',
-      releaseCommitMessageFormat: 'bla `touch exploit`'
-    }).then(function () {
-      const stat = shell.test('-f', './exploit')
-      stat.should.equal(false)
-    })
-  })
-})
diff --git a/test/config-files.spec.js b/test/config-files.spec.js
new file mode 100644
index 0000000..68f718b
--- /dev/null
+++ b/test/config-files.spec.js
@@ -0,0 +1,174 @@
+/* global describe it beforeEach afterEach */
+
+'use strict'
+
+const shell = require('shelljs')
+const fs = require('fs')
+const { Readable } = require('stream')
+const mockery = require('mockery')
+const stdMocks = require('std-mocks')
+
+require('chai').should()
+
+function exec () {
+  const cli = require('../command')
+  const opt = cli.parse('standard-version')
+  opt.skip = { commit: true, tag: true }
+  return require('../index')(opt)
+}
+
+/**
+ * Mock external conventional-changelog modules
+ *
+ * Mocks should be unregistered in test cleanup by calling unmock()
+ *
+ * bump?: 'major' | 'minor' | 'patch' | Error | (opt, cb) => { cb(err) | cb(null, { releaseType }) }
+ * changelog?: string | Error | Array<string | Error | (opt) => string | null>
+ * tags?: string[] | Error
+ */
+function mock ({ bump, changelog, tags } = {}) {
+  mockery.enable({ warnOnUnregistered: false, useCleanCache: true })
+
+  mockery.registerMock('conventional-recommended-bump', function (opt, cb) {
+    if (typeof bump === 'function') bump(opt, cb)
+    else if (bump instanceof Error) cb(bump)
+    else cb(null, bump ? { releaseType: bump } : {})
+  })
+
+  if (!Array.isArray(changelog)) changelog = [changelog]
+  mockery.registerMock(
+    'conventional-changelog',
+    (opt) =>
+      new Readable({
+        read (_size) {
+          const next = changelog.shift()
+          if (next instanceof Error) {
+            this.destroy(next)
+          } else if (typeof next === 'function') {
+            this.push(next(opt))
+          } else {
+            this.push(next ? Buffer.from(next, 'utf8') : null)
+          }
+        }
+      })
+  )
+
+  mockery.registerMock('git-semver-tags', function (cb) {
+    if (tags instanceof Error) cb(tags)
+    else cb(null, tags | [])
+  })
+
+  stdMocks.use()
+  return () => stdMocks.flush()
+}
+
+describe('config files', () => {
+  beforeEach(function () {
+    shell.rm('-rf', 'tmp')
+    shell.config.silent = true
+    shell.mkdir('tmp')
+    shell.cd('tmp')
+    fs.writeFileSync(
+      'package.json',
+      JSON.stringify({ version: '1.0.0' }),
+      'utf-8'
+    )
+  })
+
+  afterEach(function () {
+    shell.cd('../')
+    shell.rm('-rf', 'tmp')
+
+    mockery.deregisterAll()
+    mockery.disable()
+    stdMocks.restore()
+
+    // push out prints from the Mocha reporter
+    const { stdout } = stdMocks.flush()
+    for (const str of stdout) {
+      if (str.startsWith(' ')) process.stdout.write(str)
+    }
+  })
+
+  it('reads config from package.json', async function () {
+    const issueUrlFormat = 'https://standard-version.company.net/browse/{{id}}'
+    mock({
+      bump: 'minor',
+      changelog: ({ preset }) => preset.issueUrlFormat
+    })
+    const pkg = {
+      version: '1.0.0',
+      repository: { url: 'git+https://company@scm.org/office/app.git' },
+      'standard-version': { issueUrlFormat }
+    }
+    fs.writeFileSync('package.json', JSON.stringify(pkg), 'utf-8')
+
+    await exec()
+    const content = fs.readFileSync('CHANGELOG.md', 'utf-8')
+    content.should.include(issueUrlFormat)
+  })
+
+  it('reads config from .versionrc', async function () {
+    const issueUrlFormat = 'http://www.foo.com/{{id}}'
+    const changelog = ({ preset }) => preset.issueUrlFormat
+    mock({ bump: 'minor', changelog })
+    fs.writeFileSync('.versionrc', JSON.stringify({ issueUrlFormat }), 'utf-8')
+
+    await exec()
+    const content = fs.readFileSync('CHANGELOG.md', 'utf-8')
+    content.should.include(issueUrlFormat)
+  })
+
+  it('reads config from .versionrc.json', async function () {
+    const issueUrlFormat = 'http://www.foo.com/{{id}}'
+    const changelog = ({ preset }) => preset.issueUrlFormat
+    mock({ bump: 'minor', changelog })
+    fs.writeFileSync(
+      '.versionrc.json',
+      JSON.stringify({ issueUrlFormat }),
+      'utf-8'
+    )
+
+    await exec()
+    const content = fs.readFileSync('CHANGELOG.md', 'utf-8')
+    content.should.include(issueUrlFormat)
+  })
+
+  it('evaluates a config-function from .versionrc.js', async function () {
+    const issueUrlFormat = 'http://www.foo.com/{{id}}'
+    const src = `module.exports = function() { return ${JSON.stringify({
+      issueUrlFormat
+    })} }`
+    const changelog = ({ preset }) => preset.issueUrlFormat
+    mock({ bump: 'minor', changelog })
+    fs.writeFileSync('.versionrc.js', src, 'utf-8')
+
+    await exec()
+    const content = fs.readFileSync('CHANGELOG.md', 'utf-8')
+    content.should.include(issueUrlFormat)
+  })
+
+  it('evaluates a config-object from .versionrc.js', async function () {
+    const issueUrlFormat = 'http://www.foo.com/{{id}}'
+    const src = `module.exports = ${JSON.stringify({ issueUrlFormat })}`
+    const changelog = ({ preset }) => preset.issueUrlFormat
+    mock({ bump: 'minor', changelog })
+    fs.writeFileSync('.versionrc.js', src, 'utf-8')
+
+    await exec()
+    const content = fs.readFileSync('CHANGELOG.md', 'utf-8')
+    content.should.include(issueUrlFormat)
+  })
+
+  it('throws an error when a non-object is returned from .versionrc.js', async function () {
+    mock({ bump: 'minor' })
+    fs.writeFileSync('.versionrc.js', 'module.exports = 3', 'utf-8')
+    try {
+      await exec()
+      /* istanbul ignore next */
+      throw new Error('Unexpected success')
+    } catch (error) {
+      error.message.should.match(/Invalid configuration/)
+    }
+  })
+})
diff --git a/test/core.spec.js b/test/core.spec.js
new file mode 100644
index 0000000..22d2b8e
--- /dev/null
+++ b/test/core.spec.js
@@ -0,0 +1,793 @@
+/* global describe it afterEach */
+
+'use strict'
+
+const shell = require('shelljs')
+const fs = require('fs')
+const { resolve } = require('path')
+const { Readable } = require('stream')
+const mockFS = require('mock-fs')
+const mockery = require('mockery')
+const stdMocks = require('std-mocks')
+
+const cli = require('../command')
+const formatCommitMessage = require('../lib/format-commit-message')
+
+require('chai').should()
+
+// set by mock()
+let standardVersion
+
+function exec (opt = '', git) {
+  if (typeof opt === 'string') {
+    opt = cli.parse(`standard-version ${opt}`)
+  }
+  if (!git) opt.skip = Object.assign({}, opt.skip, { commit: true, tag: true })
+  return standardVersion(opt)
+}
+
+function getPackageVersion () {
+  return JSON.parse(fs.readFileSync('package.json', 'utf-8')).version
+}
+
+/**
+ * Mock external conventional-changelog modules
+ *
+ * Mocks should be unregistered in test cleanup by calling unmock()
+ *
+ * bump?: 'major' | 'minor' | 'patch' | Error | (opt, cb) => { cb(err) | cb(null, { releaseType }) }
+ * changelog?: string | Error | Array<string | Error | (opt) => string | null>
+ * execFile?: ({ dryRun, silent }, cmd, cmdArgs) => Promise<string>
+ * fs?: { [string]: string | Buffer | any }
+ * pkg?: { [string]: any }
+ * tags?: string[] | Error
+ */
+function mock ({ bump, changelog, execFile, fs, pkg, tags } = {}) {
+  mockery.enable({ warnOnUnregistered: false, useCleanCache: true })
+
+  mockery.registerMock('conventional-recommended-bump', function (opt, cb) {
+    if (typeof bump === 'function') bump(opt, cb)
+    else if (bump instanceof Error) cb(bump)
+    else cb(null, bump ? { releaseType: bump } : {})
+  })
+
+  if (!Array.isArray(changelog)) changelog = [changelog]
+  mockery.registerMock(
+    'conventional-changelog',
+    (opt) =>
+      new Readable({
+        read (_size) {
+          const next = changelog.shift()
+          if (next instanceof Error) {
+            this.destroy(next)
+          } else if (typeof next === 'function') {
+            this.push(next(opt))
+          } else {
+            this.push(next ? Buffer.from(next, 'utf8') : null)
+          }
+        }
+      })
+  )
+
+  mockery.registerMock('git-semver-tags', function (cb) {
+    if (tags instanceof Error) cb(tags)
+    else cb(null, tags | [])
+  })
+
+  if (typeof execFile === 'function') {
+    // called from commit & tag lifecycle methods
+    mockery.registerMock('../run-execFile', execFile)
+  }
+
+  // needs to be set after mockery, but before mock-fs
+  standardVersion = require('../index')
+
+  fs = Object.assign({}, fs)
+  if (pkg) {
+    fs['package.json'] = JSON.stringify(pkg)
+  } else if (pkg === undefined && !fs['package.json']) {
+    fs['package.json'] = JSON.stringify({ version: '1.0.0' })
+  }
+  mockFS(fs)
+
+  stdMocks.use()
+  return () => stdMocks.flush()
+}
+
+function unmock () {
+  mockery.deregisterAll()
+  mockery.disable()
+  mockFS.restore()
+  stdMocks.restore()
+  standardVersion = null
+
+  // push out prints from the Mocha reporter
+  const { stdout } = stdMocks.flush()
+  for (const str of stdout) {
+    if (str.startsWith(' ')) process.stdout.write(str)
+  }
+}
+
+describe('format-commit-message', function () {
+  it('works for no {{currentTag}}', function () {
+    formatCommitMessage('chore(release): 1.0.0', '1.0.0').should.equal(
+      'chore(release): 1.0.0'
+    )
+  })
+  it('works for one {{currentTag}}', function () {
+    formatCommitMessage('chore(release): {{currentTag}}', '1.0.0').should.equal(
+      'chore(release): 1.0.0'
+    )
+  })
+  it('works for two {{currentTag}}', function () {
+    formatCommitMessage(
+      'chore(release): {{currentTag}} \n\n* CHANGELOG: https://github.com/conventional-changelog/standard-version/blob/v{{currentTag}}/CHANGELOG.md',
+      '1.0.0'
+    ).should.equal(
+      'chore(release): 1.0.0 \n\n* CHANGELOG: https://github.com/conventional-changelog/standard-version/blob/v1.0.0/CHANGELOG.md'
+    )
+  })
+})
+
+describe('cli', function () {
+  afterEach(unmock)
+
+  describe('CHANGELOG.md does not exist', function () {
+    it('populates changelog with commits since last tag by default', async function () {
+      mock({ bump: 'patch', changelog: 'patch release\n', tags: ['v1.0.0'] })
+      await exec()
+      const content = fs.readFileSync('CHANGELOG.md', 'utf-8')
+      content.should.match(/patch release/)
+    })
+
+    it('includes all commits if --first-release is true', async function () {
+      mock({
+        bump: 'minor',
+        changelog: 'first commit\npatch release\n',
+        pkg: { version: '1.0.1' }
+      })
+      await exec('--first-release')
+      const content = fs.readFileSync('CHANGELOG.md', 'utf-8')
+      content.should.match(/patch release/)
+      content.should.match(/first commit/)
+    })
+
+    it('skipping changelog will not create a changelog file', async function () {
+      mock({ bump: 'minor', changelog: 'foo\n' })
+      await exec('--skip.changelog true')
+      getPackageVersion().should.equal('1.1.0')
+      try {
+        fs.readFileSync('CHANGELOG.md', 'utf-8')
+        throw new Error('File should not exist')
+      } catch (err) {
+        err.code.should.equal('ENOENT')
+      }
+    })
+  })
+
+  describe('CHANGELOG.md exists', function () {
+    it('appends the new release above the last release, removing the old header (legacy format)', async function () {
+      mock({
+        bump: 'patch',
+        changelog: 'release 1.0.1\n',
+        fs: { 'CHANGELOG.md': 'legacy header format<a name="1.0.0">\n' },
+        tags: ['v1.0.0']
+      })
+      await exec()
+      const content = fs.readFileSync('CHANGELOG.md', 'utf-8')
+      content.should.match(/1\.0\.1/)
+      content.should.not.match(/legacy header format/)
+    })
+
+    it('appends the new release above the last release, removing the old header (new format)', async function () {
+      const { header } = require('../defaults')
+      const changelog1 =
+        '### [1.0.1](/compare/v1.0.0...v1.0.1) (YYYY-MM-DD)\n\n\n### Bug Fixes\n\n* patch release ABCDEFXY\n'
+      mock({ bump: 'patch', changelog: changelog1, tags: ['v1.0.0'] })
+      await exec()
+      let content = fs.readFileSync('CHANGELOG.md', 'utf-8')
+      content.should.equal(header + '\n' + changelog1)
+
+      const changelog2 =
+        '### [1.0.2](/compare/v1.0.1...v1.0.2) (YYYY-MM-DD)\n\n\n### Bug Fixes\n\n* another patch release ABCDEFXY\n'
+      unmock()
+      mock({
+        bump: 'patch',
+        changelog: changelog2,
+        fs: { 'CHANGELOG.md': content },
+        tags: ['v1.0.0', 'v1.0.1']
+      })
+      await exec()
+      content = fs.readFileSync('CHANGELOG.md', 'utf-8')
+      content.should.equal(header + '\n' + changelog2 + changelog1)
+    })
+
+    it('[DEPRECATED] (--changelogHeader) allows for a custom changelog header', async function () {
+      const header = '# Pork Chop Log'
+      mock({
+        bump: 'minor',
+        changelog: header + '\n',
+        fs: { 'CHANGELOG.md': '' }
+      })
+      await exec(`--changelogHeader="${header}"`)
+      const content = fs.readFileSync('CHANGELOG.md', 'utf-8')
+      content.should.match(new RegExp(header))
+    })
+
+    it('[DEPRECATED] (--changelogHeader) exits with error if changelog header matches last version search regex', async function () {
+      mock({ bump: 'minor', fs: { 'CHANGELOG.md': '' } })
+      try {
+        await exec('--changelogHeader="## 3.0.2"')
+        throw new Error('That should not have worked')
+      } catch (error) {
+        error.message.should.match(/custom changelog header must not match/)
+      }
+    })
+  })
+
+  describe('lifecycle scripts', () => {
+    describe('prerelease hook', function () {
+      it('should run the prerelease hook when provided', async function () {
+        const flush = mock({
+          bump: 'minor',
+          fs: { 'CHANGELOG.md': 'legacy header format<a name="1.0.0">\n' }
+        })
+
+        await exec({
+          scripts: { prerelease: 'node -e "console.error(\'prerelease\' + \' ran\')"' }
+        })
+        const { stderr } = flush()
+        stderr.join('\n').should.match(/prerelease ran/)
+      })
+
+      it('should abort if the hook returns a non-zero exit code', async function () {
+        mock({
+          bump: 'minor',
+          fs: { 'CHANGELOG.md': 'legacy header format<a name="1.0.0">\n' }
+        })
+
+        try {
+          await exec({
+            scripts: {
+              prerelease: 'node -e "throw new Error(\'prerelease\' + \' fail\')"'
+            }
+          })
+          /* istanbul ignore next */
+          throw new Error('Unexpected success')
+        } catch (error) {
+          error.message.should.match(/prerelease fail/)
+        }
+      })
+    })
+
+    describe('prebump hook', function () {
+      it('should allow prebump hook to return an alternate version #', async function () {
+        const flush = mock({
+          bump: 'minor',
+          fs: { 'CHANGELOG.md': 'legacy header format<a name="1.0.0">\n' }
+        })
+
+        await exec({ scripts: { prebump: 'node -e "console.log(Array.of(9, 9, 9).join(\'.\'))"' } })
+        const { stdout } = flush()
+        stdout.join('').should.match(/9\.9\.9/)
+      })
+    })
+
+    describe('postbump hook', function () {
+      it('should run the postbump hook when provided', async function () {
+        const flush = mock({
+          bump: 'minor',
+          fs: { 'CHANGELOG.md': 'legacy header format<a name="1.0.0">\n' }
+        })
+
+        await exec({
+          scripts: { postbump: 'node -e "console.error(\'postbump\' + \' ran\')"' }
+        })
+        const { stderr } = flush()
+        stderr.join('\n').should.match(/postbump ran/)
+      })
+
+      it('should run the postbump and exit with error when postbump fails', async function () {
+        mock({
+          bump: 'minor',
+          fs: { 'CHANGELOG.md': 'legacy header format<a name="1.0.0">\n' }
+        })
+
+        try {
+          await exec({
+            scripts: { postbump: 'node -e "throw new Error(\'postbump\' + \' fail\')"' }
+          })
+          await exec('--patch')
+          /* istanbul ignore next */
+          throw new Error('Unexpected success')
+        } catch (error) {
+          error.message.should.match(/postbump fail/)
+        }
+      })
+    })
+  })
+
+  describe('manual-release', function () {
+    describe('release-types', function () {
+      const regularTypes = ['major', 'minor', 'patch']
+      const nextVersion = { major: '2.0.0', minor: '1.1.0', patch: '1.0.1' }
+
+      regularTypes.forEach(function (type) {
+        it('creates a ' + type + ' release', async function () {
+          mock({
+            bump: 'patch',
+            fs: { 'CHANGELOG.md': 'legacy header format<a name="1.0.0">\n' }
+          })
+          await exec('--release-as ' + type)
+          getPackageVersion().should.equal(nextVersion[type])
+        })
+      })
+
+      // this is for pre-releases
+      regularTypes.forEach(function (type) {
+        it('creates a pre' + type + ' release', async function () {
+          mock({
+            bump: 'patch',
+            fs: { 'CHANGELOG.md': 'legacy header format<a name="1.0.0">\n' }
+          })
+          await exec('--release-as ' + type + ' --prerelease ' + type)
+          getPackageVersion().should.equal(`${nextVersion[type]}-${type}.0`)
+        })
+      })
+    })
+
+    describe('release-as-exact', function () {
+      it('releases as v100.0.0', async function () {
+        mock({
+          bump: 'patch',
+          fs: { 'CHANGELOG.md': 'legacy header format<a name="1.0.0">\n' }
+        })
+        await exec('--release-as v100.0.0')
+        getPackageVersion().should.equal('100.0.0')
+      })
+
+      it('releases as 200.0.0-amazing', async function () {
+        mock({
+          bump: 'patch',
+          fs: { 'CHANGELOG.md': 'legacy header format<a name="1.0.0">\n' }
+        })
+        await exec('--release-as 200.0.0-amazing')
+        getPackageVersion().should.equal('200.0.0-amazing')
+      })
+    })
+
+    it('creates a prerelease with a new minor version after two prerelease patches', async function () {
+      let releaseType = 'patch'
+      const bump = (_, cb) => cb(null, { releaseType })
+      mock({
+        bump,
+        fs: { 'CHANGELOG.md': 'legacy header format<a name="1.0.0">\n' }
+      })
+
+      await exec('--release-as patch --prerelease dev')
+      getPackageVersion().should.equal('1.0.1-dev.0')
+
+      await exec('--prerelease dev')
+      getPackageVersion().should.equal('1.0.1-dev.1')
+
+      releaseType = 'minor'
+      await exec('--release-as minor --prerelease dev')
+      getPackageVersion().should.equal('1.1.0-dev.0')
+
+      await exec('--release-as minor --prerelease dev')
+      getPackageVersion().should.equal('1.1.0-dev.1')
+
+      await exec('--prerelease dev')
+      getPackageVersion().should.equal('1.1.0-dev.2')
+    })
+  })
+
+  it('appends line feed at end of package.json', async function () {
+    mock({ bump: 'patch' })
+    await exec()
+    const pkgJson = fs.readFileSync('package.json', 'utf-8')
+    pkgJson.should.equal('{\n  "version": "1.0.1"\n}\n')
+  })
+
+  it('preserves indentation of tabs in package.json', async function () {
+    mock({
+      bump: 'patch',
+      fs: { 'package.json': '{\n\t"version": "1.0.0"\n}\n' }
+    })
+    await exec()
+    const pkgJson = fs.readFileSync('package.json', 'utf-8')
+    pkgJson.should.equal('{\n\t"version": "1.0.1"\n}\n')
+  })
+
+  it('preserves indentation of spaces in package.json', async function () {
+    mock({
+      bump: 'patch',
+      fs: { 'package.json': '{\n    "version": "1.0.0"\n}\n' }
+    })
+    await exec()
+    const pkgJson = fs.readFileSync('package.json', 'utf-8')
+    pkgJson.should.equal('{\n    "version": "1.0.1"\n}\n')
+  })
+
+  it('preserves carriage return + line feed in package.json', async function () {
+    mock({
+      bump: 'patch',
+      fs: { 'package.json': '{\r\n  "version": "1.0.0"\r\n}\r\n' }
+    })
+    await exec()
+    const pkgJson = fs.readFileSync('package.json', 'utf-8')
+    pkgJson.should.equal('{\r\n  "version": "1.0.1"\r\n}\r\n')
+  })
+
+  it('does not print output when the --silent flag is passed', async function () {
+    const flush = mock()
+    await exec('--silent')
+    flush().should.eql({ stdout: [], stderr: [] })
+  })
+})
+
+describe('standard-version', function () {
+  afterEach(unmock)
+
+  it('should exit on bump error', async function () {
+    mock({ bump: new Error('bump err') })
+    try {
+      await exec()
+      /* istanbul ignore next */
+      throw new Error('Unexpected success')
+    } catch (err) {
+      err.message.should.match(/bump err/)
+    }
+  })
+
+  it('should exit on changelog error', async function () {
+    mock({ bump: 'minor', changelog: new Error('changelog err') })
+    try {
+      await exec()
+      /* istanbul ignore next */
+      throw new Error('Unexpected success')
+    } catch (err) {
+      err.message.should.match(/changelog err/)
+    }
+  })
+
+  it('should exit with error without a package file to bump', async function () {
+    mock({ bump: 'patch', pkg: false })
+    try {
+      await exec({ gitTagFallback: false })
+      /* istanbul ignore next */
+      throw new Error('Unexpected success')
+    } catch (err) {
+      err.message.should.equal('no package file found')
+    }
+  })
+
+  it('bumps version # in bower.json', async function () {
+    mock({
+      bump: 'minor',
+      fs: { 'bower.json': JSON.stringify({ version: '1.0.0' }) },
+      tags: ['v1.0.0']
+    })
+    await exec()
+    JSON.parse(fs.readFileSync('bower.json', 'utf-8')).version.should.equal(
+      '1.1.0'
+    )
+    getPackageVersion().should.equal('1.1.0')
+  })
+
+  it('bumps version # in manifest.json', async function () {
+    mock({
+      bump: 'minor',
+      fs: { 'manifest.json': JSON.stringify({ version: '1.0.0' }) },
+      tags: ['v1.0.0']
+    })
+    await exec()
+    JSON.parse(fs.readFileSync('manifest.json', 'utf-8')).version.should.equal(
+      '1.1.0'
+    )
+    getPackageVersion().should.equal('1.1.0')
+  })
+
+  describe('custom `bumpFiles` support', function () {
+    it('mix.exs + version.txt', async function () {
+      const updater = 'custom-updater.js'
+      const updaterModule = require('./mocks/updater/customer-updater')
+      mock({
+        bump: 'minor',
+        fs: {
+          'mix.exs': fs.readFileSync('./test/mocks/mix.exs'),
+          'version.txt': fs.readFileSync('./test/mocks/version.txt')
+        },
+        tags: ['v1.0.0']
+      })
+      mockery.registerMock(resolve(process.cwd(), updater), updaterModule)
+
+      await exec({
+        bumpFiles: [
+          'version.txt',
+          { filename: 'mix.exs', updater: 'custom-updater.js' }
+        ]
+      })
+      fs.readFileSync('mix.exs', 'utf-8').should.contain('version: "1.1.0"')
+      fs.readFileSync('version.txt', 'utf-8').should.equal('1.1.0')
+    })
+
+    it('bumps a custom `plain-text` file', async function () {
+      mock({
+        bump: 'minor',
+        fs: {
+          'VERSION_TRACKER.txt': fs.readFileSync(
+            './test/mocks/VERSION-1.0.0.txt'
+          )
+        }
+      })
+      await exec({
+        bumpFiles: [{ filename: 'VERSION_TRACKER.txt', type: 'plain-text' }]
+      })
+      fs.readFileSync('VERSION_TRACKER.txt', 'utf-8').should.equal('1.1.0')
+    })
+  })
+
+  describe('custom `packageFiles` support', function () {
+    it('reads and writes to a custom `plain-text` file', async function () {
+      mock({
+        bump: 'minor',
+        fs: {
+          'VERSION_TRACKER.txt': fs.readFileSync(
+            './test/mocks/VERSION-6.3.1.txt'
+          )
+        }
+      })
+      await exec({
+        packageFiles: [{ filename: 'VERSION_TRACKER.txt', type: 'plain-text' }],
+        bumpFiles: [{ filename: 'VERSION_TRACKER.txt', type: 'plain-text' }]
+      })
+      fs.readFileSync('VERSION_TRACKER.txt', 'utf-8').should.equal('6.4.0')
+    })
+
+    it('allows same object to be used in packageFiles and bumpFiles', async function () {
+      mock({
+        bump: 'minor',
+        fs: {
+          'VERSION_TRACKER.txt': fs.readFileSync(
+            './test/mocks/VERSION-6.3.1.txt'
+          )
+        }
+      })
+      const origWarn = console.warn
+      console.warn = () => {
+        throw new Error('console.warn should not be called')
+      }
+      const filedesc = { filename: 'VERSION_TRACKER.txt', type: 'plain-text' }
+      try {
+        await exec({ packageFiles: [filedesc], bumpFiles: [filedesc] })
+        fs.readFileSync('VERSION_TRACKER.txt', 'utf-8').should.equal('6.4.0')
+      } finally {
+        console.warn = origWarn
+      }
+    })
+  })
+
+  it('bumps version # in npm-shrinkwrap.json', async function () {
+    mock({
+      bump: 'minor',
+      fs: {
+        'npm-shrinkwrap.json': JSON.stringify({ version: '1.0.0' })
+      },
+      tags: ['v1.0.0']
+    })
+    await exec()
+    JSON.parse(
+      fs.readFileSync('npm-shrinkwrap.json', 'utf-8')
+    ).version.should.equal('1.1.0')
+    getPackageVersion().should.equal('1.1.0')
+  })
+
+  it('bumps version # in package-lock.json', async function () {
+    mock({
+      bump: 'minor',
+      fs: {
+        '.gitignore': '',
+        'package-lock.json': JSON.stringify({ version: '1.0.0' })
+      },
+      tags: ['v1.0.0']
+    })
+    await exec()
+    JSON.parse(
+      fs.readFileSync('package-lock.json', 'utf-8')
+    ).version.should.equal('1.1.0')
+    getPackageVersion().should.equal('1.1.0')
+  })
+
+  describe('skip', () => {
+    it('allows bump and changelog generation to be skipped', async function () {
+      const changelogContent = 'legacy header format<a name="1.0.0">\n'
+      mock({
+        bump: 'minor',
+        changelog: 'foo\n',
+        fs: { 'CHANGELOG.md': changelogContent }
+      })
+
+      await exec('--skip.bump true --skip.changelog true')
+      getPackageVersion().should.equal('1.0.0')
+      const content = fs.readFileSync('CHANGELOG.md', 'utf-8')
+      content.should.equal(changelogContent)
+    })
+  })
+
+  it('does not update files present in .gitignore', async () => {
+    mock({
+      bump: 'minor',
+      fs: {
+        '.gitignore': 'bower.json',
+        'bower.json': JSON.stringify({ version: '1.0.0' })
+      },
+      tags: ['v1.0.0']
+    })
+    await exec()
+    JSON.parse(fs.readFileSync('bower.json', 'utf-8')).version.should.equal(
+      '1.0.0'
+    )
+    getPackageVersion().should.equal('1.1.0')
+  })
+
+  describe('configuration', () => {
+    it('--header', async function () {
+      mock({ bump: 'minor', fs: { 'CHANGELOG.md': '' } })
+      await exec('--header="# Welcome to our CHANGELOG.md"')
+      const content = fs.readFileSync('CHANGELOG.md', 'utf-8')
+      content.should.match(/# Welcome to our CHANGELOG.md/)
+    })
+
+    it('--issuePrefixes and --issueUrlFormat', async function () {
+      const format = 'http://www.foo.com/{{prefix}}{{id}}'
+      const prefix = 'ABC-'
+      const changelog = ({ preset }) =>
+        preset.issueUrlFormat + ':' + preset.issuePrefixes
+      mock({ bump: 'minor', changelog })
+      await exec(`--issuePrefixes="${prefix}" --issueUrlFormat="${format}"`)
+      const content = fs.readFileSync('CHANGELOG.md', 'utf-8')
+      content.should.include(`${format}:${prefix}`)
+    })
+  })
+
+  describe('pre-major', () => {
+    it('bumps the minor rather than major, if version < 1.0.0', async function () {
+      mock({
+        bump: 'minor',
+        pkg: {
+          version: '0.5.0',
+          repository: { url: 'https://github.com/yargs/yargs.git' }
+        }
+      })
+      await exec()
+      getPackageVersion().should.equal('0.6.0')
+    })
+
+    it('bumps major if --release-as=major specified, if version < 1.0.0', async function () {
+      mock({
+        bump: 'major',
+        pkg: {
+          version: '0.5.0',
+          repository: { url: 'https://github.com/yargs/yargs.git' }
+        }
+      })
+      await exec('-r major')
+      getPackageVersion().should.equal('1.0.0')
+    })
+  })
+})
+
+describe('GHSL-2020-111', function () {
+  afterEach(unmock)
+
+  it('does not allow command injection via basic configuration', async function () {
+    mock({ bump: 'patch' })
+    await exec({
+      noVerify: true,
+      infile: 'foo.txt',
+      releaseCommitMessageFormat: 'bla `touch exploit`'
+    })
+    const stat = shell.test('-f', './exploit')
+    stat.should.equal(false)
+  })
+})
+
+describe('with mocked git', function () {
+  afterEach(unmock)
+
+  it('--sign signs the commit and tag', async function () {
+    const gitArgs = [
+      ['add', 'CHANGELOG.md', 'package.json'],
+      ['commit', '-S', 'CHANGELOG.md', 'package.json', '-m', 'chore(release): 1.0.1'],
+      ['tag', '-s', 'v1.0.1', '-m', 'chore(release): 1.0.1'],
+      ['rev-parse', '--abbrev-ref', 'HEAD']
+    ]
+    const execFile = (_args, cmd, cmdArgs) => {
+      cmd.should.equal('git')
+      const expected = gitArgs.shift()
+      cmdArgs.should.deep.equal(expected)
+      if (expected[0] === 'rev-parse') return Promise.resolve('master')
+      return Promise.resolve('')
+    }
+    mock({ bump: 'patch', changelog: 'foo\n', execFile })
+
+    await exec('--sign', true)
+    gitArgs.should.have.lengthOf(0)
+  })
+
+  it('fails if git add fails', async function () {
+    const gitArgs = [
+      ['add', 'CHANGELOG.md', 'package.json']
+    ]
+    const execFile = (_args, cmd, cmdArgs) => {
+      cmd.should.equal('git')
+      const expected = gitArgs.shift()
+      cmdArgs.should.deep.equal(expected)
+      if (expected[0] === 'add') {
+        return Promise.reject(new Error('Command failed: git\nfailed add'))
+      }
+      return Promise.resolve('')
+    }
+    mock({ bump: 'patch', changelog: 'foo\n', execFile })
+
+    try {
+      await exec({}, true)
+      /* istanbul ignore next */
+      throw new Error('Unexpected success')
+    } catch (error) {
+      error.message.should.match(/failed add/)
+    }
+  })
+
+  it('fails if git commit fails', async function () {
+    const gitArgs = [
+      ['add', 'CHANGELOG.md', 'package.json'],
+      ['commit', 'CHANGELOG.md', 'package.json', '-m', 'chore(release): 1.0.1']
+    ]
+    const execFile = (_args, cmd, cmdArgs) => {
+      cmd.should.equal('git')
+      const expected = gitArgs.shift()
+      cmdArgs.should.deep.equal(expected)
+      if (expected[0] === 'commit') {
+        return Promise.reject(new Error('Command failed: git\nfailed commit'))
+      }
+      return Promise.resolve('')
+    }
+    mock({ bump: 'patch', changelog: 'foo\n', execFile })
+
+    try {
+      await exec({}, true)
+      /* istanbul ignore next */
+      throw new Error('Unexpected success')
+    } catch (error) {
+      error.message.should.match(/failed commit/)
+    }
+  })
+
+  it('fails if git tag fails', async function () {
+    const gitArgs = [
+      ['add', 'CHANGELOG.md', 'package.json'],
+      ['commit', 'CHANGELOG.md', 'package.json', '-m', 'chore(release): 1.0.1'],
+      ['tag', '-a', 'v1.0.1', '-m', 'chore(release): 1.0.1']
+    ]
+    const execFile = (_args, cmd, cmdArgs) => {
+      cmd.should.equal('git')
+      const expected = gitArgs.shift()
+      cmdArgs.should.deep.equal(expected)
+      if (expected[0] === 'tag') {
+        return Promise.reject(new Error('Command failed: git\nfailed tag'))
+      }
+      return Promise.resolve('')
+    }
+    mock({ bump: 'patch', changelog: 'foo\n', execFile })
+
+    try {
+      await exec({}, true)
+      /* istanbul ignore next */
+      throw new Error('Unexpected success')
+    } catch (error) {
+      error.message.should.match(/failed tag/)
+    }
+  })
+})
diff --git a/test/git.spec.js b/test/git.spec.js
new file mode 100644
index 0000000..4489372
--- /dev/null
+++ b/test/git.spec.js
@@ -0,0 +1,352 @@
+/* global describe it beforeEach afterEach */
+
+'use strict'
+
+const shell = require('shelljs')
+const fs = require('fs')
+const { Readable } = require('stream')
+const mockery = require('mockery')
+const stdMocks = require('std-mocks')
+
+require('chai').should()
+
+function exec (opt = '') {
+  if (typeof opt === 'string') {
+    const cli = require('../command')
+    opt = cli.parse(`standard-version ${opt}`)
+  }
+  return require('../index')(opt)
+}
+
+function writePackageJson (version, option) {
+  const pkg = Object.assign({}, option, { version })
+  fs.writeFileSync('package.json', JSON.stringify(pkg), 'utf-8')
+}
+
+function writeHook (hookName, causeError, script) {
+  shell.mkdir('-p', 'scripts')
+  let content = script || 'console.error("' + hookName + ' ran")'
+  content += causeError ? '\nthrow new Error("' + hookName + '-failure")' : ''
+  fs.writeFileSync('scripts/' + hookName + '.js', content, 'utf-8')
+  fs.chmodSync('scripts/' + hookName + '.js', '755')
+}
+
+function getPackageVersion () {
+  return JSON.parse(fs.readFileSync('package.json', 'utf-8')).version
+}
+
+/**
+ * Mock external conventional-changelog modules
+ *
+ * bump: 'major' | 'minor' | 'patch' | Error | (opt, cb) => { cb(err) | cb(null, { releaseType }) }
+ * changelog?: string | Error | Array<string | Error | (opt) => string | null>
+ * tags?: string[] | Error
+ */
+function mock ({ bump, changelog, tags }) {
+  if (bump === undefined) throw new Error('bump must be defined for mock()')
+  mockery.enable({ warnOnUnregistered: false, useCleanCache: true })
+
+  mockery.registerMock('conventional-recommended-bump', function (opt, cb) {
+    if (typeof bump === 'function') bump(opt, cb)
+    else if (bump instanceof Error) cb(bump)
+    else cb(null, { releaseType: bump })
+  })
+
+  if (!Array.isArray(changelog)) changelog = [changelog]
+  mockery.registerMock('conventional-changelog', (opt) => new Readable({
+    read (_size) {
+      const next = changelog.shift()
+      if (next instanceof Error) {
+        this.destroy(next)
+      } else if (typeof next === 'function') {
+        this.push(next(opt))
+      } else {
+        this.push(next ? Buffer.from(next, 'utf8') : null)
+      }
+    }
+  }))
+
+  mockery.registerMock('git-semver-tags', function (cb) {
+    if (tags instanceof Error) cb(tags)
+    else cb(null, tags || [])
+  })
+
+  stdMocks.use()
+  return () => stdMocks.flush()
+}
+
+describe('git', function () {
+  beforeEach(function () {
+    shell.rm('-rf', 'tmp')
+    shell.config.silent = true
+    shell.mkdir('tmp')
+    shell.cd('tmp')
+    shell.exec('git init')
+    shell.exec('git config commit.gpgSign false')
+    shell.exec('git config core.autocrlf false')
+    shell.exec('git commit --allow-empty -m"root-commit"')
+    writePackageJson('1.0.0')
+  })
+
+  afterEach(function () {
+    shell.cd('../')
+    shell.rm('-rf', 'tmp')
+
+    mockery.deregisterAll()
+    mockery.disable()
+    stdMocks.restore()
+
+    // push out prints from the Mocha reporter
+    const { stdout } = stdMocks.flush()
+    for (const str of stdout) {
+      if (str.startsWith(' ')) process.stdout.write(str)
+    }
+  })
+
+  it('formats the commit and tag messages appropriately', async function () {
+    mock({ bump: 'minor', tags: ['v1.0.0'] })
+    await exec({})
+    // check last commit message
+    shell.exec('git log --oneline -n1').stdout.should.match(/chore\(release\): 1\.1\.0/)
+    // check annotated tag message
+    shell.exec('git tag -l -n1 v1.1.0').stdout.should.match(/chore\(release\): 1\.1\.0/)
+  })
+
+  it('formats the tag if --first-release is true', async function () {
+    writePackageJson('1.0.1')
+    mock({ bump: 'minor' })
+    await exec('--first-release')
+    shell.exec('git tag').stdout.should.match(/1\.0\.1/)
+  })
+
+  it('commits all staged files', async function () {
+    fs.writeFileSync('CHANGELOG.md', 'legacy header format<a name="1.0.0">\n', 'utf-8')
+    fs.writeFileSync('STUFF.md', 'stuff\n', 'utf-8')
+    shell.exec('git add STUFF.md')
+
+    mock({ bump: 'patch', changelog: 'release 1.0.1\n', tags: ['v1.0.0'] })
+    await exec('--commit-all')
+    const status = shell.exec('git status --porcelain') // see http://unix.stackexchange.com/questions/155046/determine-if-git-working-directory-is-clean-from-a-script
+    status.should.equal('')
+    status.should.not.match(/STUFF.md/)
+
+    const content = fs.readFileSync('CHANGELOG.md', 'utf-8')
+    content.should.match(/1\.0\.1/)
+    content.should.not.match(/legacy header format/)
+  })
+
+  it('does not run git hooks if the --no-verify flag is passed', async function () {
+    fs.writeFileSync('.git/hooks/pre-commit', '#!/bin/sh\necho "precommit ran"\nexit 1', 'utf-8')
+    fs.chmodSync('.git/hooks/pre-commit', '755')
+
+    mock({ bump: 'minor' })
+    await exec('--no-verify')
+    await exec('-n')
+  })
+
+  it('allows the commit phase to be skipped', async function () {
+    const changelogContent = 'legacy header format<a name="1.0.0">\n'
+    writePackageJson('1.0.0')
+    fs.writeFileSync('CHANGELOG.md', changelogContent, 'utf-8')
+
+    mock({ bump: 'minor', changelog: 'new feature\n' })
+    await exec('--skip.commit true')
+    getPackageVersion().should.equal('1.1.0')
+    const content = fs.readFileSync('CHANGELOG.md', 'utf-8')
+    content.should.match(/new feature/)
+    shell.exec('git log --oneline -n1').stdout.should.match(/root-commit/)
+  })
+
+  it('dry-run skips all non-idempotent steps', async function () {
+    shell.exec('git tag -a v1.0.0 -m "my awesome first release"')
+    const flush = mock({ bump: 'minor', changelog: '### Features\n', tags: ['v1.0.0'] })
+    await exec('--dry-run')
+    const { stdout } = flush()
+    stdout.join('').should.match(/### Features/)
+    shell.exec('git log --oneline -n1').stdout.should.match(/root-commit/)
+    shell.exec('git tag').stdout.should.match(/1\.0\.0/)
+    getPackageVersion().should.equal('1.0.0')
+  })
+
+  it('works fine without specifying a tag id when prereleasing', async function () {
+    writePackageJson('1.0.0')
+    fs.writeFileSync('CHANGELOG.md', 'legacy header format<a name="1.0.0">\n', 'utf-8')
+    mock({ bump: 'minor' })
+    await exec('--prerelease')
+    getPackageVersion().should.equal('1.1.0-0')
+  })
+
+  describe('gitTagFallback', () => {
+    it('defaults to 1.0.0 if no tags in git history', async () => {
+      shell.rm('package.json')
+      mock({ bump: 'minor' })
+      await exec({})
+      const output = shell.exec('git tag')
+      output.stdout.should.include('v1.1.0')
+    })
+
+    it('bases version on greatest version tag, if tags are found', async () => {
+      shell.rm('package.json')
+      mock({ bump: 'minor', tags: ['v3.9.0', 'v5.0.0', 'v3.0.0'] })
+      await exec({})
+      const output = shell.exec('git tag')
+      output.stdout.should.include('v5.1.0')
+    })
+  })
+
+  describe('configuration', () => {
+    it('.versionrc : releaseCommitMessageFormat', async function () {
+      fs.writeFileSync('.versionrc', JSON.stringify({
+        releaseCommitMessageFormat: 'This commit represents release: {{currentTag}}'
+      }), 'utf-8')
+      mock({ bump: 'minor' })
+      await exec('')
+      shell.exec('git log --oneline -n1').should.include('This commit represents release: 1.1.0')
+    })
+
+    it('--releaseCommitMessageFormat', async function () {
+      mock({ bump: 'minor' })
+      await exec('--releaseCommitMessageFormat="{{currentTag}} is the version."')
+      shell.exec('git log --oneline -n1').should.include('1.1.0 is the version.')
+    })
+
+    it('[LEGACY] supports --message (and single %s replacement)', async function () {
+      mock({ bump: 'minor' })
+      await exec('--message="V:%s"')
+      shell.exec('git log --oneline -n1').should.include('V:1.1.0')
+    })
+
+    it('[LEGACY] supports -m (and multiple %s replacements)', async function () {
+      mock({ bump: 'minor' })
+      await exec('--message="V:%s is the %s."')
+      shell.exec('git log --oneline -n1').should.include('V:1.1.0 is the 1.1.0.')
+    })
+  })
+
+  describe('precommit hook', function () {
+    it('should run the precommit hook when provided via .versionrc.json (#371)', async function () {
+      fs.writeFileSync('.versionrc.json', JSON.stringify({
+        scripts: { precommit: 'node scripts/precommit' }
+      }), 'utf-8')
+
+      writeHook('precommit')
+      fs.writeFileSync('CHANGELOG.md', 'legacy header format<a name="1.0.0">\n', 'utf-8')
+      const flush = mock({ bump: 'minor' })
+      await exec('')
+      const { stderr } = flush()
+      stderr[0].should.match(/precommit ran/)
+    })
+
+    it('should run the precommit hook when provided', async function () {
+      writePackageJson('1.0.0', {
+        'standard-version': {
+          scripts: { precommit: 'node scripts/precommit' }
+        }
+      })
+      writeHook('precommit')
+      fs.writeFileSync('CHANGELOG.md', 'legacy header format<a name="1.0.0">\n', 'utf-8')
+
+      const flush = mock({ bump: 'minor' })
+      await exec('--patch')
+      const { stderr } = flush()
+      stderr[0].should.match(/precommit ran/)
+    })
+
+    it('should run the precommit hook and exit with error when precommit fails', async function () {
+      writePackageJson('1.0.0', {
+        'standard-version': {
+          scripts: { precommit: 'node scripts/precommit' }
+        }
+      })
+      writeHook('precommit', true)
+      fs.writeFileSync('CHANGELOG.md', 'legacy header format<a name="1.0.0">\n', 'utf-8')
+
+      mock({ bump: 'minor' })
+      try {
+        await exec('--patch')
+        /* istanbul ignore next */
+        throw new Error('Unexpected success')
+      } catch (error) {
+        error.message.should.match(/precommit-failure/)
+      }
+    })
+
+    it('should allow an alternate commit message to be provided by precommit script', async function () {
+      writePackageJson('1.0.0', {
+        'standard-version': {
+          scripts: { precommit: 'node scripts/precommit' }
+        }
+      })
+      writeHook('precommit', false, 'console.log("releasing %s delivers #222")')
+      fs.writeFileSync('CHANGELOG.md', 'legacy header format<a name="1.0.0">\n', 'utf-8')
+
+      mock({ bump: 'minor' })
+      await exec('--patch')
+      shell.exec('git log --oneline -n1').should.match(/delivers #222/)
+    })
+  })
+
+  describe('Run ... to publish', function () {
+    it('does normally display `npm publish`', async function () {
+      const flush = mock({ bump: 'patch' })
+      await exec('')
+      flush().stdout.join('').should.match(/npm publish/)
+    })
+
+    it('does not display `npm publish` if the package is private', async function () {
+      writePackageJson('1.0.0', { private: true })
+      const flush = mock({ bump: 'patch' })
+      await exec('')
+      flush().stdout.join('').should.not.match(/npm publish/)
+    })
+
+    it('does not display `npm publish` if there is no package.json', async function () {
+      shell.rm('package.json')
+      const flush = mock({ bump: 'patch' })
+      await exec('')
+      flush().stdout.join('').should.not.match(/npm publish/)
+    })
+
+    it('does not display `all staged files` without the --commit-all flag', async function () {
+      const flush = mock({ bump: 'patch' })
+      await exec('')
+      flush().stdout.join('').should.not.match(/all staged files/)
+    })
+
+    it('does display `all staged files` if the --commit-all flag is passed', async function () {
+      const flush = mock({ bump: 'patch' })
+      await exec('--commit-all')
+      flush().stdout.join('').should.match(/all staged files/)
+    })
+
+    it('advises use of --tag prerelease for publishing to npm', async function () {
+      writePackageJson('1.0.0')
+      fs.writeFileSync('CHANGELOG.md', 'legacy header format<a name="1.0.0">\n', 'utf-8')
+
+      const flush = mock({ bump: 'patch' })
+      await exec('--prerelease')
+      const { stdout } = flush()
+      stdout.join('').should.include('--tag prerelease')
+    })
+
+    it('advises use of --tag alpha for publishing to npm when tagging alpha', async function () {
+      writePackageJson('1.0.0')
+      fs.writeFileSync('CHANGELOG.md', 'legacy header format<a name="1.0.0">\n', 'utf-8')
+
+      const flush = mock({ bump: 'patch' })
+      await exec('--prerelease alpha')
+      const { stdout } = flush()
+      stdout.join('').should.include('--tag alpha')
+    })
+
+    it('does not advise use of --tag prerelease for private modules', async function () {
+      writePackageJson('1.0.0', { private: true })
+      fs.writeFileSync('CHANGELOG.md', 'legacy header format<a name="1.0.0">\n', 'utf-8')
+
+      const flush = mock({ bump: 'minor' })
+      await exec('--prerelease')
+      const { stdout } = flush()
+      stdout.join('').should.not.include('--tag prerelease')
+    })
+  })
+})

=====================================================================
start time: Tue Jul 14 00:00:00 CST 2020
end time: Sat Aug 15 00:00:00 CST 2020
### âš  BREAKING CHANGES* NodeJS@8 is no longer supported. (#612)### Bug Fixes* **deps:** update dependency conventional-changelog to v3.1.23 ([#652](https://www.github.com/conventional-changelog/standard-version/issues/652)) ([00dd3c0](https://www.github.com/conventional-changelog/standard-version/commit/00dd3c01aab20d28a8bbd1e174e416d6c2b34d90))* **deps:** update dependency conventional-changelog-conventionalcommits to v4.4.0 ([#650](https://www.github.com/conventional-changelog/standard-version/issues/650)) ([9f201a6](https://www.github.com/conventional-changelog/standard-version/commit/9f201a61bb50ec12053a04faccfaea20e44d6ff2))* **deps:** update dependency conventional-recommended-bump to v6.0.10 ([#653](https://www.github.com/conventional-changelog/standard-version/issues/653)) ([c360d6a](https://www.github.com/conventional-changelog/standard-version/commit/c360d6a307909c6e571b29d4a329fd786b4d4543))### Build System* NodeJS@8 is no longer supported. ([#612](https://www.github.com/conventional-changelog/standard-version/issues/612)) ([05edef2](https://www.github.com/conventional-changelog/standard-version/commit/05edef2de79d8d4939a6e699ce0979ff8da12de9))
diff --git a/.github/workflows/ci.yaml b/.github/workflows/ci.yaml
index 4b9d309..c3c5903 100644
--- a/.github/workflows/ci.yaml
+++ b/.github/workflows/ci.yaml
@@ -9,7 +9,7 @@
     runs-on: ubuntu-latest
     strategy:
       matrix:
-        node: [8, 10, 12, 14]
+        node: [10, 12, 14]
     steps:
       - uses: actions/checkout@v2
       - run: git fetch --prune --unshallow
diff --git a/CHANGELOG.md b/CHANGELOG.md
index 52810c7..56a456c 100644
--- a/CHANGELOG.md
+++ b/CHANGELOG.md
@@ -2,6 +2,13 @@
 
 All notable changes to this project will be documented in this file. See [standard-version](https://github.com/conventional-changelog/standard-version) for commit guidelines.
 
+### [8.0.2](https://www.github.com/conventional-changelog/standard-version/compare/v8.0.1...v8.0.2) (2020-07-14)
+
+
+### Bug Fixes
+
+* Commit message and tag name is no longer enclosed in quotes. ([#619](https://www.github.com/conventional-changelog/standard-version/issues/619)) ([ae032bf](https://www.github.com/conventional-changelog/standard-version/commit/ae032bfa9268a0a14351b0d78b6deedee7891e3a)), closes [#621](https://www.github.com/conventional-changelog/standard-version/issues/621) [#620](https://www.github.com/conventional-changelog/standard-version/issues/620)
+
 ### [8.0.1](https://www.github.com/conventional-changelog/standard-version/compare/v8.0.0...v8.0.1) (2020-07-12)
 
 
diff --git a/package.json b/package.json
index 205aff7..c701310 100644
--- a/package.json
+++ b/package.json
@@ -1,6 +1,6 @@
 {
   "name": "standard-version",
-  "version": "8.0.1",
+  "version": "8.0.2",
   "description": "replacement for `npm version` with automatic CHANGELOG generation",
   "bin": "bin/cli.js",
   "scripts": {
@@ -16,7 +16,7 @@
   },
   "repository": "conventional-changelog/standard-version",
   "engines": {
-    "node": ">=8.0"
+    "node": ">=10"
   },
   "keywords": [
     "conventional-changelog",
@@ -60,7 +60,7 @@
     "eslint-plugin-node": "^10.0.0",
     "eslint-plugin-promise": "^4.2.1",
     "eslint-plugin-standard": "^4.0.1",
-    "mocha": "^7.2.0",
+    "mocha": "^8.0.0",
     "mock-git": "^2.0.0",
     "mockery": "^2.1.0",
     "nyc": "^14.1.1",

=====================================================================
start time: Sun Jul 12 00:00:00 CST 2020
end time: Tue Jul 14 00:00:00 CST 2020
### Bug Fixes* Commit message and tag name is no longer enclosed in quotes. ([#619](https://www.github.com/conventional-changelog/standard-version/issues/619)) ([ae032bf](https://www.github.com/conventional-changelog/standard-version/commit/ae032bfa9268a0a14351b0d78b6deedee7891e3a)), closes [#621](https://www.github.com/conventional-changelog/standard-version/issues/621) [#620](https://www.github.com/conventional-changelog/standard-version/issues/620)
diff --git a/.github/ISSUE_TEMPLATE/ask-a-question.md b/.github/ISSUE_TEMPLATE/ask-a-question.md
new file mode 100644
index 0000000..8085180
--- /dev/null
+++ b/.github/ISSUE_TEMPLATE/ask-a-question.md
@@ -0,0 +1,10 @@
+---
+name: Ask a Question
+about: '"How can I X?" â€“ ask a question about how to use standard-version.'
+title: ''
+labels: question
+assignees: ''
+
+---
+
+
diff --git a/.github/ISSUE_TEMPLATE/bug-report.md b/.github/ISSUE_TEMPLATE/bug-report.md
new file mode 100644
index 0000000..3c1b10d
--- /dev/null
+++ b/.github/ISSUE_TEMPLATE/bug-report.md
@@ -0,0 +1,31 @@
+---
+name: Bug Report
+about: Use this template if something isn't working as expected.
+title: ''
+labels: bug
+assignees: ''
+
+---
+
+**Describe the bug**
+A clear and concise description of what the bug is.
+
+**Current behavior**
+A clear and concise description of the behavior.
+
+
+**Expected behavior**
+A clear and concise description of what you expected to happen.
+
+
+
+**Environment**
+- `standard-version` version(s): [e.g. v6.0.0, v8.0.0, master]
+- Node/npm version: [e.g. Node 10/npm 6]
+- OS: [e.g. OSX 10.13.4, Windows 10]
+
+**Possible Solution**
+<!--- If you have suggestions on a fix for the bug -->
+
+**Additional context**
+Add any other context about the problem here. Or a screenshot if applicable
diff --git a/CHANGELOG.md b/CHANGELOG.md
index 2d82b77..52810c7 100644
--- a/CHANGELOG.md
+++ b/CHANGELOG.md
@@ -2,6 +2,17 @@
 
 All notable changes to this project will be documented in this file. See [standard-version](https://github.com/conventional-changelog/standard-version) for commit guidelines.
 
+### [8.0.1](https://www.github.com/conventional-changelog/standard-version/compare/v8.0.0...v8.0.1) (2020-07-12)
+
+
+### Bug Fixes
+
+* **deps:** update dependency conventional-changelog to v3.1.21 ([#586](https://www.github.com/conventional-changelog/standard-version/issues/586)) ([fd456c9](https://www.github.com/conventional-changelog/standard-version/commit/fd456c995f3f88497fbb912fb8aabb8a42d97dbb))
+* **deps:** update dependency conventional-changelog-conventionalcommits to v4.3.0 ([#587](https://www.github.com/conventional-changelog/standard-version/issues/587)) ([b3b5eed](https://www.github.com/conventional-changelog/standard-version/commit/b3b5eedea3eaf062d74d1004a55a0a6b1e3ca6c6))
+* **deps:** update dependency conventional-recommended-bump to v6.0.9 ([#588](https://www.github.com/conventional-changelog/standard-version/issues/588)) ([d4d2ac2](https://www.github.com/conventional-changelog/standard-version/commit/d4d2ac2a99c095227118da795e1c9e19d06c9a0a))
+* **deps:** update dependency git-semver-tags to v4 ([#589](https://www.github.com/conventional-changelog/standard-version/issues/589)) ([a0f0e81](https://www.github.com/conventional-changelog/standard-version/commit/a0f0e813b2be4a2065600a19075fda4d6f331ef8))
+* Vulnerability Report GHSL-2020-11101 ([9d978ac](https://www.github.com/conventional-changelog/standard-version/commit/9d978ac9d4f64be4c7b9d514712ab3757732d561))
+
 ## [8.0.0](https://www.github.com/conventional-changelog/standard-version/compare/v7.1.0...v8.0.0) (2020-05-06)
 
 
diff --git a/package.json b/package.json
index ab8f73a..205aff7 100644
--- a/package.json
+++ b/package.json
@@ -1,9 +1,10 @@
 {
   "name": "standard-version",
-  "version": "8.0.0",
+  "version": "8.0.1",
   "description": "replacement for `npm version` with automatic CHANGELOG generation",
   "bin": "bin/cli.js",
   "scripts": {
+    "fix": "eslint . --fix",
     "posttest": "eslint .",
     "test": "nyc mocha --timeout=30000 test.js",
     "release": "bin/cli.js"
@@ -34,35 +35,35 @@
   },
   "homepage": "https://github.com/conventional-changelog/standard-version#readme",
   "dependencies": {
-    "chalk": "2.4.2",
+    "chalk": "^2.4.2",
     "conventional-changelog": "3.1.21",
     "conventional-changelog-config-spec": "2.1.0",
     "conventional-changelog-conventionalcommits": "4.3.0",
     "conventional-recommended-bump": "6.0.9",
-    "detect-indent": "6.0.0",
-    "detect-newline": "3.1.0",
-    "dotgitignore": "2.1.0",
-    "figures": "3.1.0",
-    "find-up": "4.1.0",
-    "fs-access": "1.0.1",
-    "git-semver-tags": "4.0.0",
-    "semver": "7.1.1",
-    "stringify-package": "1.0.1",
-    "yargs": "15.3.1"
+    "detect-indent": "^6.0.0",
+    "detect-newline": "^3.1.0",
+    "dotgitignore": "^2.1.0",
+    "figures": "^3.1.0",
+    "find-up": "^4.1.0",
+    "fs-access": "^1.0.1",
+    "git-semver-tags": "^4.0.0",
+    "semver": "^7.1.1",
+    "stringify-package": "^1.0.1",
+    "yargs": "^15.3.1"
   },
   "devDependencies": {
-    "chai": "4.2.0",
-    "coveralls": "3.1.0",
-    "eslint": "6.8.0",
-    "eslint-config-standard": "14.1.1",
-    "eslint-plugin-import": "2.20.0",
-    "eslint-plugin-node": "10.0.0",
-    "eslint-plugin-promise": "4.2.1",
-    "eslint-plugin-standard": "4.0.1",
-    "mocha": "7.2.0",
-    "mock-git": "2.0.0",
-    "mockery": "2.1.0",
-    "nyc": "14.1.1",
-    "shelljs": "0.8.4"
+    "chai": "^4.2.0",
+    "coveralls": "^3.1.0",
+    "eslint": "^6.8.0",
+    "eslint-config-standard": "^14.1.1",
+    "eslint-plugin-import": "^2.20.0",
+    "eslint-plugin-node": "^10.0.0",
+    "eslint-plugin-promise": "^4.2.1",
+    "eslint-plugin-standard": "^4.0.1",
+    "mocha": "^7.2.0",
+    "mock-git": "^2.0.0",
+    "mockery": "^2.1.0",
+    "nyc": "^14.1.1",
+    "shelljs": "^0.8.4"
   }
 }
diff --git a/renovate.json b/renovate.json
index f45d8f1..5ec138e 100644
--- a/renovate.json
+++ b/renovate.json
@@ -1,5 +1,9 @@
 {
   "extends": [
     "config:base"
-  ]
+  ],
+  "pinVersions": false,
+  "rebaseStalePrs": true,
+  "gitAuthor": null,
+  "ignoreDeps": ["decamelize"]
 }
diff --git a/test.js b/test.js
index 0a60ab8..5b011fd 100644
--- a/test.js
+++ b/test.js
@@ -13,6 +13,8 @@
 const cli = require('./command')
 const standardVersion = require('./index')
 
+const isWindows = process.platform === 'win32'
+
 require('chai').should()
 
 const cliPath = path.resolve(__dirname, './bin/cli.js')
@@ -248,74 +250,77 @@
     })
   })
 
-  describe('with mocked git', function () {
-    it('--sign signs the commit and tag', function () {
-      // mock git with file that writes args to gitcapture.log
-      return mockGit('require("fs").appendFileSync("gitcapture.log", JSON.stringify(process.argv.splice(2)) + "\\n")')
-        .then(function (unmock) {
-          execCli('--sign').code.should.equal(0)
+  // TODO: investigate why mock-git does not play well with execFile on Windows.
+  if (!isWindows) {
+    describe('with mocked git', function () {
+      it('--sign signs the commit and tag', function () {
+        // mock git with file that writes args to gitcapture.log
+        return mockGit('require("fs").appendFileSync("gitcapture.log", JSON.stringify(process.argv.splice(2)) + "\\n")')
+          .then(function (unmock) {
+            execCli('--sign').code.should.equal(0)
 
-          const captured = shell.cat('gitcapture.log').stdout.split('\n').map(function (line) {
-            return line ? JSON.parse(line) : line
+            const captured = shell.cat('gitcapture.log').stdout.split('\n').map(function (line) {
+              return line ? JSON.parse(line) : line
+            })
+            /* eslint-disable no-useless-escape */
+            captured[captured.length - 4].should.deep.equal(['commit', '-S', 'CHANGELOG.md', 'package.json', '-m', '\"chore(release): 1.0.1\"'])
+            captured[captured.length - 3].should.deep.equal(['tag', '-s', 'v1.0.1', '-m', '\"chore(release): 1.0.1\"'])
+            /* eslint-enable no-useless-escape */
+            unmock()
           })
-          /* eslint-disable no-useless-escape */
-          captured[captured.length - 4].should.deep.equal(['commit', '-S', 'CHANGELOG.md', 'package.json', '-m', '\"chore(release): 1.0.1\"'])
-          captured[captured.length - 3].should.deep.equal(['tag', '-s', 'v1.0.1', '-m', '\"chore(release): 1.0.1\"'])
-          /* eslint-enable no-useless-escape */
-          unmock()
-        })
+      })
+
+      it('exits with error code if git commit fails', function () {
+        // mock git by throwing on attempt to commit
+        return mockGit('console.error("commit yourself"); process.exit(128);', 'commit')
+          .then(function (unmock) {
+            const result = execCli()
+            result.code.should.equal(1)
+            result.stderr.should.match(/commit yourself/)
+
+            unmock()
+          })
+      })
+
+      it('exits with error code if git add fails', function () {
+        // mock git by throwing on attempt to add
+        return mockGit('console.error("addition is hard"); process.exit(128);', 'add')
+          .then(function (unmock) {
+            const result = execCli()
+            result.code.should.equal(1)
+            result.stderr.should.match(/addition is hard/)
+
+            unmock()
+          })
+      })
+
+      it('exits with error code if git tag fails', function () {
+        // mock git by throwing on attempt to commit
+        return mockGit('console.error("tag, you\'re it"); process.exit(128);', 'tag')
+          .then(function (unmock) {
+            const result = execCli()
+            result.code.should.equal(1)
+            result.stderr.should.match(/tag, you're it/)
+
+            unmock()
+          })
+      })
+
+      it('doesn\'t fail fast on stderr output from git', function () {
+        // mock git by throwing on attempt to commit
+        return mockGit('console.error("haha, kidding, this is just a warning"); process.exit(0);', 'add')
+          .then(function (unmock) {
+            writePackageJson('1.0.0')
+
+            const result = execCli()
+            result.code.should.equal(1)
+            result.stderr.should.match(/haha, kidding, this is just a warning/)
+
+            unmock()
+          })
+      })
     })
-
-    it('exits with error code if git commit fails', function () {
-      // mock git by throwing on attempt to commit
-      return mockGit('console.error("commit yourself"); process.exit(128);', 'commit')
-        .then(function (unmock) {
-          const result = execCli()
-          result.code.should.equal(1)
-          result.stderr.should.match(/commit yourself/)
-
-          unmock()
-        })
-    })
-
-    it('exits with error code if git add fails', function () {
-      // mock git by throwing on attempt to add
-      return mockGit('console.error("addition is hard"); process.exit(128);', 'add')
-        .then(function (unmock) {
-          const result = execCli()
-          result.code.should.equal(1)
-          result.stderr.should.match(/addition is hard/)
-
-          unmock()
-        })
-    })
-
-    it('exits with error code if git tag fails', function () {
-      // mock git by throwing on attempt to commit
-      return mockGit('console.error("tag, you\'re it"); process.exit(128);', 'tag')
-        .then(function (unmock) {
-          const result = execCli()
-          result.code.should.equal(1)
-          result.stderr.should.match(/tag, you're it/)
-
-          unmock()
-        })
-    })
-
-    it('doesn\'t fail fast on stderr output from git', function () {
-      // mock git by throwing on attempt to commit
-      return mockGit('console.error("haha, kidding, this is just a warning"); process.exit(0);', 'add')
-        .then(function (unmock) {
-          writePackageJson('1.0.0')
-
-          const result = execCli()
-          result.code.should.equal(1)
-          result.stderr.should.match(/haha, kidding, this is just a warning/)
-
-          unmock()
-        })
-    })
-  })
+  }
 
   describe('lifecycle scripts', () => {
     describe('prerelease hook', function () {

=====================================================================
start time: Wed May 06 00:00:00 CST 2020
end time: Sun Jul 12 00:00:00 CST 2020
### Bug Fixes* **deps:** update dependency conventional-changelog to v3.1.21 ([#586](https://www.github.com/conventional-changelog/standard-version/issues/586)) ([fd456c9](https://www.github.com/conventional-changelog/standard-version/commit/fd456c995f3f88497fbb912fb8aabb8a42d97dbb))* **deps:** update dependency conventional-changelog-conventionalcommits to v4.3.0 ([#587](https://www.github.com/conventional-changelog/standard-version/issues/587)) ([b3b5eed](https://www.github.com/conventional-changelog/standard-version/commit/b3b5eedea3eaf062d74d1004a55a0a6b1e3ca6c6))* **deps:** update dependency conventional-recommended-bump to v6.0.9 ([#588](https://www.github.com/conventional-changelog/standard-version/issues/588)) ([d4d2ac2](https://www.github.com/conventional-changelog/standard-version/commit/d4d2ac2a99c095227118da795e1c9e19d06c9a0a))* **deps:** update dependency git-semver-tags to v4 ([#589](https://www.github.com/conventional-changelog/standard-version/issues/589)) ([a0f0e81](https://www.github.com/conventional-changelog/standard-version/commit/a0f0e813b2be4a2065600a19075fda4d6f331ef8))* Vulnerability Report GHSL-2020-11101 ([9d978ac](https://www.github.com/conventional-changelog/standard-version/commit/9d978ac9d4f64be4c7b9d514712ab3757732d561))
diff --git a/.github/publish.yml b/.github/publish.yml
new file mode 100644
index 0000000..e933b63
--- /dev/null
+++ b/.github/publish.yml
@@ -0,0 +1,2 @@
+project: oss-automation
+secretId: node-tooling
diff --git a/.github/release-please.yml b/.github/release-please.yml
new file mode 100644
index 0000000..3c06599
--- /dev/null
+++ b/.github/release-please.yml
@@ -0,0 +1,2 @@
+releaseType: node
+handleGHRelease: true
diff --git a/.github/workflows/ci.yaml b/.github/workflows/ci.yaml
new file mode 100644
index 0000000..4b9d309
--- /dev/null
+++ b/.github/workflows/ci.yaml
@@ -0,0 +1,35 @@
+on:
+  push:
+    branches:
+      - master
+  pull_request:
+name: ci
+jobs:
+  test:
+    runs-on: ubuntu-latest
+    strategy:
+      matrix:
+        node: [8, 10, 12, 14]
+    steps:
+      - uses: actions/checkout@v2
+      - run: git fetch --prune --unshallow
+      - run: git config --global user.name 'Actions'
+      - run: git config --global user.email 'dummy@example.org'
+      - uses: actions/setup-node@v1
+        with:
+          node-version: ${{ matrix.node }}
+      - run: node --version
+      - run: npm install
+      - run: npm test
+  windows:
+    runs-on: windows-latest
+    steps:
+      - uses: actions/checkout@v2
+      - run: git fetch --prune --unshallow
+      - run: git config --global user.name 'Actions'
+      - run: git config --global user.email 'dummy@example.org'
+      - uses: actions/setup-node@v1
+        with:
+          node-version: 12
+      - run: npm install
+      - run: npm test
diff --git a/.travis.yml b/.travis.yml
deleted file mode 100644
index 6c05713..0000000
--- a/.travis.yml
+++ /dev/null
@@ -1,13 +0,0 @@
-language: node_js
-os:
-  - linux
-  - windows
-node_js:
-  - "8"
-  - "10"
-  - "12"
-  - "node"
-before_script:
-  - git config --global user.name 'Travis-CI'
-  - git config --global user.email 'dummy@example.org'
-after_success: npm run coverage
diff --git a/CHANGELOG.md b/CHANGELOG.md
index 7bf20a2..2d82b77 100644
--- a/CHANGELOG.md
+++ b/CHANGELOG.md
@@ -2,6 +2,20 @@
 
 All notable changes to this project will be documented in this file. See [standard-version](https://github.com/conventional-changelog/standard-version) for commit guidelines.
 
+## [8.0.0](https://www.github.com/conventional-changelog/standard-version/compare/v7.1.0...v8.0.0) (2020-05-06)
+
+
+### âš  BREAKING CHANGES
+
+* `composer.json` and `composer.lock` will no longer be read from or bumped by default. If you need to obtain a version or write a version to these files, please use `bumpFiles` and/or `packageFiles` options accordingly.
+
+### Bug Fixes
+
+* composer.json and composer.lock have been removed from default package and bump files. ([c934f3a](https://www.github.com/conventional-changelog/standard-version/commit/c934f3a38da4e7234d9dba3b2405f3b7e4dc5aa8)), closes [#495](https://www.github.com/conventional-changelog/standard-version/issues/495) [#394](https://www.github.com/conventional-changelog/standard-version/issues/394)
+* **deps:** update dependency conventional-changelog to v3.1.18 ([#510](https://www.github.com/conventional-changelog/standard-version/issues/510)) ([e6aeb77](https://www.github.com/conventional-changelog/standard-version/commit/e6aeb779fe53ffed2a252e6cfd69cfcb786b9ef9))
+* **deps:** update dependency yargs to v15.1.0 ([#518](https://www.github.com/conventional-changelog/standard-version/issues/518)) ([8f36f9e](https://www.github.com/conventional-changelog/standard-version/commit/8f36f9e073119fcbf5ad843237fb06a4ca42a0f9))
+* **deps:** update dependency yargs to v15.3.1 ([#559](https://www.github.com/conventional-changelog/standard-version/issues/559)) ([d98cd46](https://www.github.com/conventional-changelog/standard-version/commit/d98cd4674b4d074c0b7f4d50d052ae618cf494c6))
+
 ## [7.1.0](https://github.com/conventional-changelog/standard-version/compare/v7.0.1...v7.1.0) (2019-12-08)
 
 
diff --git a/package.json b/package.json
index 3693809..ab8f73a 100644
--- a/package.json
+++ b/package.json
@@ -1,11 +1,10 @@
 {
   "name": "standard-version",
-  "version": "7.1.0",
+  "version": "8.0.0",
   "description": "replacement for `npm version` with automatic CHANGELOG generation",
   "bin": "bin/cli.js",
   "scripts": {
     "posttest": "eslint .",
-    "coverage": "nyc report --reporter=text-lcov | coveralls",
     "test": "nyc mocha --timeout=30000 test.js",
     "release": "bin/cli.js"
   },
@@ -14,10 +13,7 @@
       "tmp/**"
     ]
   },
-  "repository": {
-    "type": "git",
-    "url": "git+https://github.com/conventional-changelog/standard-version.git"
-  },
+  "repository": "conventional-changelog/standard-version",
   "engines": {
     "node": ">=8.0"
   },
@@ -39,34 +35,34 @@
   "homepage": "https://github.com/conventional-changelog/standard-version#readme",
   "dependencies": {
     "chalk": "2.4.2",
-    "conventional-changelog": "3.1.18",
+    "conventional-changelog": "3.1.21",
     "conventional-changelog-config-spec": "2.1.0",
-    "conventional-changelog-conventionalcommits": "4.2.3",
-    "conventional-recommended-bump": "6.0.5",
+    "conventional-changelog-conventionalcommits": "4.3.0",
+    "conventional-recommended-bump": "6.0.9",
     "detect-indent": "6.0.0",
     "detect-newline": "3.1.0",
     "dotgitignore": "2.1.0",
     "figures": "3.1.0",
     "find-up": "4.1.0",
     "fs-access": "1.0.1",
-    "git-semver-tags": "3.0.1",
+    "git-semver-tags": "4.0.0",
     "semver": "7.1.1",
     "stringify-package": "1.0.1",
     "yargs": "15.3.1"
   },
   "devDependencies": {
     "chai": "4.2.0",
-    "coveralls": "3.0.9",
-    "eslint": "6.7.2",
-    "eslint-config-standard": "14.1.0",
+    "coveralls": "3.1.0",
+    "eslint": "6.8.0",
+    "eslint-config-standard": "14.1.1",
     "eslint-plugin-import": "2.20.0",
     "eslint-plugin-node": "10.0.0",
     "eslint-plugin-promise": "4.2.1",
     "eslint-plugin-standard": "4.0.1",
-    "mocha": "7.0.1",
+    "mocha": "7.2.0",
     "mock-git": "2.0.0",
     "mockery": "2.1.0",
     "nyc": "14.1.1",
-    "shelljs": "0.8.3"
+    "shelljs": "0.8.4"
   }
 }

=====================================================================
start time: Sun Dec 08 00:00:00 CST 2019
end time: Wed May 06 00:00:00 CST 2020
### âš  BREAKING CHANGES* `composer.json` and `composer.lock` will no longer be read from or bumped by default. If you need to obtain a version or write a version to these files, please use `bumpFiles` and/or `packageFiles` options accordingly.### Bug Fixes* composer.json and composer.lock have been removed from default package and bump files. ([c934f3a](https://www.github.com/conventional-changelog/standard-version/commit/c934f3a38da4e7234d9dba3b2405f3b7e4dc5aa8)), closes [#495](https://www.github.com/conventional-changelog/standard-version/issues/495) [#394](https://www.github.com/conventional-changelog/standard-version/issues/394)* **deps:** update dependency conventional-changelog to v3.1.18 ([#510](https://www.github.com/conventional-changelog/standard-version/issues/510)) ([e6aeb77](https://www.github.com/conventional-changelog/standard-version/commit/e6aeb779fe53ffed2a252e6cfd69cfcb786b9ef9))* **deps:** update dependency yargs to v15.1.0 ([#518](https://www.github.com/conventional-changelog/standard-version/issues/518)) ([8f36f9e](https://www.github.com/conventional-changelog/standard-version/commit/8f36f9e073119fcbf5ad843237fb06a4ca42a0f9))* **deps:** update dependency yargs to v15.3.1 ([#559](https://www.github.com/conventional-changelog/standard-version/issues/559)) ([d98cd46](https://www.github.com/conventional-changelog/standard-version/commit/d98cd4674b4d074c0b7f4d50d052ae618cf494c6))
diff --git a/.travis.yml b/.travis.yml
index 64f2049..6c05713 100644
--- a/.travis.yml
+++ b/.travis.yml
@@ -5,6 +5,7 @@
 node_js:
   - "8"
   - "10"
+  - "12"
   - "node"
 before_script:
   - git config --global user.name 'Travis-CI'
diff --git a/CHANGELOG.md b/CHANGELOG.md
index c7497a1..7bf20a2 100644
--- a/CHANGELOG.md
+++ b/CHANGELOG.md
@@ -2,6 +2,28 @@
 
 All notable changes to this project will be documented in this file. See [standard-version](https://github.com/conventional-changelog/standard-version) for commit guidelines.
 
+## [7.1.0](https://github.com/conventional-changelog/standard-version/compare/v7.0.1...v7.1.0) (2019-12-08)
+
+
+### Features
+
+* Adds support for `header` (--header) configuration based on the spec. ([#364](https://github.com/conventional-changelog/standard-version/issues/364)) ([ba80a0c](https://github.com/conventional-changelog/standard-version/commit/ba80a0c27029f54c751fe845560504925b45eab8))
+* custom 'bumpFiles' and 'packageFiles' support ([#372](https://github.com/conventional-changelog/standard-version/issues/372)) ([564d948](https://github.com/conventional-changelog/standard-version/commit/564d9482a459d5d7a2020c2972b4d39167ded4bf))
+
+
+### Bug Fixes
+
+* **deps:** update dependency conventional-changelog to v3.1.15 ([#479](https://github.com/conventional-changelog/standard-version/issues/479)) ([492e721](https://github.com/conventional-changelog/standard-version/commit/492e72192ebf35d7c58c00526b1e6bd2abac7f13))
+* **deps:** update dependency conventional-changelog-conventionalcommits to v4.2.3 ([#496](https://github.com/conventional-changelog/standard-version/issues/496)) ([bc606f8](https://github.com/conventional-changelog/standard-version/commit/bc606f8e96bcef1d46b28305622fc76dfbf306cf))
+* **deps:** update dependency conventional-recommended-bump to v6.0.5 ([#480](https://github.com/conventional-changelog/standard-version/issues/480)) ([1e1e215](https://github.com/conventional-changelog/standard-version/commit/1e1e215a633963188cdb02be1316b5506e3b99b7))
+* **deps:** update dependency yargs to v15 ([#484](https://github.com/conventional-changelog/standard-version/issues/484)) ([35b90c3](https://github.com/conventional-changelog/standard-version/commit/35b90c3f24cfb8237e94482fd20997900569193e))
+* use require.resolve for the default preset ([#465](https://github.com/conventional-changelog/standard-version/issues/465)) ([d557372](https://github.com/conventional-changelog/standard-version/commit/d55737239530f5eee684e9cbf959f7238d609fd4))
+* **deps:** update dependency detect-newline to v3.1.0 ([#482](https://github.com/conventional-changelog/standard-version/issues/482)) ([04ab36a](https://github.com/conventional-changelog/standard-version/commit/04ab36a12be58915cfa9c60771890e074d1f5685))
+* **deps:** update dependency figures to v3.1.0 ([#468](https://github.com/conventional-changelog/standard-version/issues/468)) ([63300a9](https://github.com/conventional-changelog/standard-version/commit/63300a935c0079fd03e8e1acc55fd5b1dcea677f))
+* **deps:** update dependency git-semver-tags to v3.0.1 ([#485](https://github.com/conventional-changelog/standard-version/issues/485)) ([9cc188c](https://github.com/conventional-changelog/standard-version/commit/9cc188cbb84ee3ae80d5e66f5c54727877313b14))
+* **deps:** update dependency yargs to v14.2.1 ([#483](https://github.com/conventional-changelog/standard-version/issues/483)) ([dc1fa61](https://github.com/conventional-changelog/standard-version/commit/dc1fa6170ffe12d4f8b44b70d23688a64d2ad0fb))
+* **deps:** update dependency yargs to v14.2.2 ([#488](https://github.com/conventional-changelog/standard-version/issues/488)) ([ecf26b6](https://github.com/conventional-changelog/standard-version/commit/ecf26b6fc9421a78fb81793c4a932f579f7e9d4a))
+
 ### [7.0.1](https://github.com/conventional-changelog/standard-version/compare/v7.0.0...v7.0.1) (2019-11-07)
 
 
diff --git a/README.md b/README.md
index e0c9f2a..e1002e7 100644
--- a/README.md
+++ b/README.md
@@ -18,10 +18,10 @@
 
 `standard-version` will then do the following:
 
-1. Retreive the current version of your repository by looking at `bumpFiles`[1](), falling back to the last `git tag`.
-2. `bump` the version in `bumpFiles`[1]() based on your commits.
-4. Generates a `changelog` based on your commints (uses [conventional-changelog](https://github.com/conventional-changelog/conventional-changelog) under the hood).
-5. Creates a new `commit` including your `bumpFiles`[1]() and updated CHANGELOG.
+1. Retrieve the current version of your repository by looking at `bumpFiles`[[1]](#bumpfiles-packagefiles-and-updaters), falling back to the last `git tag`.
+2. `bump` the version in `bumpFiles`[[1]](#bumpfiles-packagefiles-and-updaters) based on your commits.
+4. Generates a `changelog` based on your commits (uses [conventional-changelog](https://github.com/conventional-changelog/conventional-changelog) under the hood).
+5. Creates a new `commit` including your `bumpFiles`[[1]](#bumpfiles-packagefiles-and-updaters) and updated CHANGELOG.
 6. Creates a new `tag` with the new version number.
 
 
@@ -29,7 +29,7 @@
 
 `standard-version` uses a few key concepts for handling version bumping in your project.
 
-- **`packageFiles`** â€“ User-defined files where versions can be read from _and_ "bumped".
+- **`packageFiles`** â€“ User-defined files where versions can be read from _and_ be "bumped".
   - Examples: `package.json`, `manifest.json`
   - In most cases (including the default), `packageFiles` are a subset of `bumpFiles`.
 - **`bumpFiles`** â€“Â User-defined files where versions should be "bumped", but not explicitly read from.
@@ -38,7 +38,7 @@
 
 By default, `standard-version` assumes you're working in a NodeJS based project... because of this, for the majority of projects you might never need to interact with these options.
 
-That said, if you find your self asking ["How can I use `standard-version` for additional metadata files, languages or version files?"](#how-can-I-use-standard-version-for-additional metadata-files-languages-or-version-files) â€“ these configuration options will help!
+That said, if you find your self asking [How can I use standard-version for additional metadata files, languages or version files?](#can-i-use-standard-version-for-additional-metadata-files-languages-or-version-files) â€“ these configuration options will help!
 
 ## Installing `standard-version`
 
@@ -190,7 +190,7 @@
 npm run release -- --release-as 1.1.0
 ```
 
-you will get version `1.1.0` rather than what would be the auto-generated version `1.0.1`.
+You will get version `1.1.0` rather than what would be the auto-generated version `1.0.1`.
 
 > **NOTE:** you can combine `--release-as` and `--prerelease` to generate a release. This is useful when publishing experimental feature(s).
 
@@ -351,31 +351,31 @@
 
 ### Can I use `standard-version` for additional metadata files, languages or version files?
 
-YES! Using `bumpFiles` (and `packageFiles`) configurations you should be able to configure `standard-version` to work for you.
+As of version `7.1.0` you can configure multiple `bumpFiles` and `packageFiles`.
 
-1. Specify a custom `bumpFile` "`file`", this is the path to the file you want to "bump"
+1. Specify a custom `bumpFile` "`filename`", this is the path to the file you want to "bump"
 2. Specify the `bumpFile` "`updater`", this is _how_ the file will be bumped.
   
     a. If your using a common type, you can use one of  `standard-version`'s built-in `updaters` by specifying a `type`.
 
     b. If your using an less-common version file, you can create your own `updater`.
 
-```json
+```js
 // .versionrc
 {
   "bumpFiles": [
     {
-      "file": "MY_VERSION_TRACKER.txt",
+      "filename": "MY_VERSION_TRACKER.txt",
       // The `plain-text` updater assumes the file contents represents the version.
       "type": "plain-text"
     },
     {
-      "file": "a/deep/package/dot/json/file/package.json",
+      "filename": "a/deep/package/dot/json/file/package.json",
       // The `json` updater assumes the version is available under a `version` key in the provided JSON document.
       "type": "json"
-    }
+    },
     {
-      "file": "VERSION_TRACKER.json",
+      "filename": "VERSION_TRACKER.json",
       //  See "Custom `updater`s" for more details.
       "updater": "standard-version-updater.js"
     }
diff --git a/defaults.js b/defaults.js
index dd9c684..614c453 100644
--- a/defaults.js
+++ b/defaults.js
@@ -32,14 +32,12 @@
 defaults.packageFiles = [
   'package.json',
   'bower.json',
-  'manifest.json',
-  'composer.json'
+  'manifest.json'
 ]
 
 defaults.bumpFiles = defaults.packageFiles.concat([
   'package-lock.json',
-  'npm-shrinkwrap.json',
-  'composer.lock'
+  'npm-shrinkwrap.json'
 ])
 
 module.exports = defaults
diff --git a/package.json b/package.json
index 98273db..ec0d5fe 100644
--- a/package.json
+++ b/package.json
@@ -1,6 +1,6 @@
 {
   "name": "standard-version",
-  "version": "7.0.1",
+  "version": "7.1.0",
   "description": "replacement for `npm version` with automatic CHANGELOG generation",
   "bin": "bin/cli.js",
   "scripts": {
@@ -39,7 +39,7 @@
   "homepage": "https://github.com/conventional-changelog/standard-version#readme",
   "dependencies": {
     "chalk": "2.4.2",
-    "conventional-changelog": "3.1.15",
+    "conventional-changelog": "3.1.18",
     "conventional-changelog-config-spec": "2.1.0",
     "conventional-changelog-conventionalcommits": "4.2.3",
     "conventional-recommended-bump": "6.0.5",
@@ -50,20 +50,20 @@
     "find-up": "4.1.0",
     "fs-access": "1.0.1",
     "git-semver-tags": "3.0.1",
-    "semver": "6.3.0",
+    "semver": "7.1.1",
     "stringify-package": "1.0.1",
-    "yargs": "15.0.2"
+    "yargs": "15.1.0"
   },
   "devDependencies": {
     "chai": "4.2.0",
     "coveralls": "3.0.9",
     "eslint": "6.7.2",
     "eslint-config-standard": "14.1.0",
-    "eslint-plugin-import": "2.18.2",
+    "eslint-plugin-import": "2.20.0",
     "eslint-plugin-node": "10.0.0",
     "eslint-plugin-promise": "4.2.1",
     "eslint-plugin-standard": "4.0.1",
-    "mocha": "6.2.2",
+    "mocha": "7.0.1",
     "mock-git": "2.0.0",
     "mockery": "2.1.0",
     "nyc": "14.1.1",

=====================================================================
start time: Thu Nov 07 00:00:00 CST 2019
end time: Sun Dec 08 00:00:00 CST 2019
### Features* Adds support for `header` (--header) configuration based on the spec. ([#364](https://github.com/conventional-changelog/standard-version/issues/364)) ([ba80a0c](https://github.com/conventional-changelog/standard-version/commit/ba80a0c27029f54c751fe845560504925b45eab8))* custom 'bumpFiles' and 'packageFiles' support ([#372](https://github.com/conventional-changelog/standard-version/issues/372)) ([564d948](https://github.com/conventional-changelog/standard-version/commit/564d9482a459d5d7a2020c2972b4d39167ded4bf))### Bug Fixes* **deps:** update dependency conventional-changelog to v3.1.15 ([#479](https://github.com/conventional-changelog/standard-version/issues/479)) ([492e721](https://github.com/conventional-changelog/standard-version/commit/492e72192ebf35d7c58c00526b1e6bd2abac7f13))* **deps:** update dependency conventional-changelog-conventionalcommits to v4.2.3 ([#496](https://github.com/conventional-changelog/standard-version/issues/496)) ([bc606f8](https://github.com/conventional-changelog/standard-version/commit/bc606f8e96bcef1d46b28305622fc76dfbf306cf))* **deps:** update dependency conventional-recommended-bump to v6.0.5 ([#480](https://github.com/conventional-changelog/standard-version/issues/480)) ([1e1e215](https://github.com/conventional-changelog/standard-version/commit/1e1e215a633963188cdb02be1316b5506e3b99b7))* **deps:** update dependency yargs to v15 ([#484](https://github.com/conventional-changelog/standard-version/issues/484)) ([35b90c3](https://github.com/conventional-changelog/standard-version/commit/35b90c3f24cfb8237e94482fd20997900569193e))* use require.resolve for the default preset ([#465](https://github.com/conventional-changelog/standard-version/issues/465)) ([d557372](https://github.com/conventional-changelog/standard-version/commit/d55737239530f5eee684e9cbf959f7238d609fd4))* **deps:** update dependency detect-newline to v3.1.0 ([#482](https://github.com/conventional-changelog/standard-version/issues/482)) ([04ab36a](https://github.com/conventional-changelog/standard-version/commit/04ab36a12be58915cfa9c60771890e074d1f5685))* **deps:** update dependency figures to v3.1.0 ([#468](https://github.com/conventional-changelog/standard-version/issues/468)) ([63300a9](https://github.com/conventional-changelog/standard-version/commit/63300a935c0079fd03e8e1acc55fd5b1dcea677f))* **deps:** update dependency git-semver-tags to v3.0.1 ([#485](https://github.com/conventional-changelog/standard-version/issues/485)) ([9cc188c](https://github.com/conventional-changelog/standard-version/commit/9cc188cbb84ee3ae80d5e66f5c54727877313b14))* **deps:** update dependency yargs to v14.2.1 ([#483](https://github.com/conventional-changelog/standard-version/issues/483)) ([dc1fa61](https://github.com/conventional-changelog/standard-version/commit/dc1fa6170ffe12d4f8b44b70d23688a64d2ad0fb))* **deps:** update dependency yargs to v14.2.2 ([#488](https://github.com/conventional-changelog/standard-version/issues/488)) ([ecf26b6](https://github.com/conventional-changelog/standard-version/commit/ecf26b6fc9421a78fb81793c4a932f579f7e9d4a))
diff --git a/README.md b/README.md
index e614ff2..e0c9f2a 100644
--- a/README.md
+++ b/README.md
@@ -1,37 +1,48 @@
 # Standard Version
 
+A utility for versioning using [semver](https://semver.org/) and CHANGELOG generation powered by [Conventional Commits](https://conventionalcommits.org).
+
 [![Build Status](https://travis-ci.org/conventional-changelog/standard-version.svg?branch=master)](https://travis-ci.org/conventional-changelog/standard-version)
 [![NPM version](https://img.shields.io/npm/v/standard-version.svg)](https://www.npmjs.com/package/standard-version)
 [![Coverage Status](https://coveralls.io/repos/conventional-changelog/standard-version/badge.svg?branch=)](https://coveralls.io/r/conventional-changelog/standard-version?branch=master)
 [![Conventional Commits](https://img.shields.io/badge/Conventional%20Commits-1.0.0-yellow.svg)](https://conventionalcommits.org)
-[![community slack](http://devtoolscommunity.herokuapp.com/badge.svg)](http://devtoolscommunity.herokuapp.com)
+[![Community slack](http://devtoolscommunity.herokuapp.com/badge.svg)](http://devtoolscommunity.herokuapp.com)
 
-_Having problems? want to contribute? join our [community slack](http://devtoolscommunity.herokuapp.com)_.
+_Having problems? Want to contribute? Join us on the [node-tooling community Slack](http://devtoolscommunity.herokuapp.com)_.
 
 
-Automate versioning and CHANGELOG generation, with [semver](https://semver.org/) and
-[conventional commit messages](https://conventionalcommits.org).
+_How It Works:_
 
-_how it works:_
+1. Follow the [Conventional Commits Specification](https://conventionalcommits.org) in your repository.
+2. When you're ready to release, run `standard-version`.
 
-1. when you land commits on your `master` branch, select the _Squash and Merge_ option.
-2. add a title and body that follows the [Conventional Commits Specification](https://conventionalcommits.org).
-3. when you're ready to release:
-  1. `git checkout master; git pull origin master`
-  2. run `standard-version`
-  3. `git push --follow-tags origin master && npm publish`
-     _(or, `docker push`, `gem push`, etc.)_
+`standard-version` will then do the following:
 
-`standard-version` does the following:
+1. Retreive the current version of your repository by looking at `bumpFiles`[1](), falling back to the last `git tag`.
+2. `bump` the version in `bumpFiles`[1]() based on your commits.
+4. Generates a `changelog` based on your commints (uses [conventional-changelog](https://github.com/conventional-changelog/conventional-changelog) under the hood).
+5. Creates a new `commit` including your `bumpFiles`[1]() and updated CHANGELOG.
+6. Creates a new `tag` with the new version number.
 
-1. bumps the version in metadata files (package.json, composer.json, etc).
-2. uses [conventional-changelog](https://github.com/conventional-changelog/conventional-changelog) to update _CHANGELOG.md_
-3. commits _package.json (et al.)_ and _CHANGELOG.md_
-4. tags a new release
 
-## Installation
+### `bumpFiles`, `packageFiles` and `updaters`
 
-### As `npm run` script
+`standard-version` uses a few key concepts for handling version bumping in your project.
+
+- **`packageFiles`** â€“ User-defined files where versions can be read from _and_ "bumped".
+  - Examples: `package.json`, `manifest.json`
+  - In most cases (including the default), `packageFiles` are a subset of `bumpFiles`.
+- **`bumpFiles`** â€“Â User-defined files where versions should be "bumped", but not explicitly read from.
+  - Examples: `package-lock.json`, `npm-shrinkwrap.json`
+- **`updaters`** â€“Â Simple modules used for reading `packageFiles` and writing to `bumpFiles`.
+
+By default, `standard-version` assumes you're working in a NodeJS based project... because of this, for the majority of projects you might never need to interact with these options.
+
+That said, if you find your self asking ["How can I use `standard-version` for additional metadata files, languages or version files?"](#how-can-I-use-standard-version-for-additional metadata-files-languages-or-version-files) â€“ these configuration options will help!
+
+## Installing `standard-version`
+
+### As a local `npm run` script
 
 Install and add to `devDependencies`:
 
@@ -39,7 +50,7 @@
 npm i --save-dev standard-version
 ```
 
-Add an [`npm run` script](https://docs.npmjs.com/cli/run-script) to your _package.json_:
+Add an [`npm run` script](https://docs.npmjs.com/cli/run-script) to your `package.json`:
 
 ```json
 {
@@ -53,7 +64,7 @@
 
 This has the benefit of making your repo/package more portable, so that other developers can cut releases without having to globally install `standard-version` on their machine.
 
-### As global bin
+### As global `bin`
 
 Install globally (add to your `PATH`):
 
@@ -65,6 +76,12 @@
 
 This has the benefit of allowing you to use `standard-version` on any repo/package without adding a dev dependency to each one.
 
+### Using `npx`
+
+As of `npm@5.2.0`, `npx` is installed alongside `npm`. Using `npx` you can use `standard-version` without having to keep a `package.json` file by running: `npx standard-version`.
+
+This method is especially useful when using `standard-version` in non-JavaScript projects.
+
 ## Configuration
 
 You can configure `standard-version` either by:
@@ -80,15 +97,15 @@
 
 ### Customizing CHANGELOG Generation
 
-By default, `standard-version` uses the [conventionalcommits preset](https://github.com/conventional-changelog/conventional-changelog/tree/master/packages/conventional-changelog-conventionalcommits).
+By default (as of `6.0.0`), `standard-version` uses the [conventionalcommits preset](https://github.com/conventional-changelog/conventional-changelog/tree/master/packages/conventional-changelog-conventionalcommits).
 
 This preset:
 
-* adheres closely to the [conventionalcommits.org](https://www.conventionalcommits.org)
+* Adheres closely to the [conventionalcommits.org](https://www.conventionalcommits.org)
   specification.
-* is highly configurable, following the configuration specification
+* Is highly configurable, following the configuration specification
   [maintained here](https://github.com/conventional-changelog/conventional-changelog-config-spec).
-  * _we've documented these config settings as a recommendation to other tooling makers._
+  * _We've documented these config settings as a recommendation to other tooling makers._
 
 There are a variety of dials and knobs you can turn related to CHANGELOG generation.
 
@@ -111,15 +128,17 @@
 ```sh
 # npm run script
 npm run release -- --first-release
-# or global bin
+# global bin
 standard-version --first-release
+# npx
+npx standard-version --first-release
 ```
 
-This will tag a release **without bumping the version in package.json (_et al._)**.
+This will tag a release **without bumping the version `bumpFiles`[1]()**.
 
-When ready, push the git tag and `npm publish` your first release. \o/
+When you are ready, push the git tag and `npm publish` your first release. \o/
 
-### Cut a Release
+### Cutting Releases
 
 If you typically use `npm version` to cut a new release, do this instead:
 
@@ -134,7 +153,7 @@
 
 After you cut a release, you can push the new git tag and `npm publish` (or `npm publish --tag next`) when you're ready.
 
-### Release as a pre-release
+### Release as a Pre-Release
 
 Use the flag `--prerelease` to generate pre-releases:
 
@@ -144,7 +163,7 @@
 # npm run script
 npm run release -- --prerelease
 ```
-you will get version `1.0.1-0`.
+This will tag your version as: `1.0.1-0`.
 
 If you want to name the pre-release, you specify the name via `--prerelease <name>`.
 
@@ -155,14 +174,14 @@
 npm run release -- --prerelease alpha
 ```
 
-this will tag the version `1.0.1-alpha.0`
+This will tag the version as: `1.0.1-alpha.0`
 
-### Release as a target type imperatively like `npm version`
+### Release as a Target Type Imperatively (`npm version`-like)
 
-To forgo the automated version bump use `--release-as` with the argument `major`, `minor` or `patch`:
+To forgo the automated version bump use `--release-as` with the argument `major`, `minor` or `patch`.
 
 Suppose the last version of your code is `1.0.0`, you've only landed `fix:` commits, but
-you would like your next release to be a `minor`. Simply do:
+you would like your next release to be a `minor`. Simply run the following:
 
 ```bash
 # npm run script
@@ -171,7 +190,7 @@
 npm run release -- --release-as 1.1.0
 ```
 
-you will get version `1.1.0` rather than the auto generated version `1.0.1`.
+you will get version `1.1.0` rather than what would be the auto-generated version `1.0.1`.
 
 > **NOTE:** you can combine `--release-as` and `--prerelease` to generate a release. This is useful when publishing experimental feature(s).
 
@@ -186,11 +205,11 @@
 standard-version --no-verify
 ```
 
-### Signing commits and tags
+### Signing Commits and Tags
 
 If you have your GPG key set up, add the `--sign` or `-s` flag to your `standard-version` command.
 
-### Lifecycle scripts
+### Lifecycle Scripts
 
 `standard-version` supports lifecycle scripts. These allow you to execute your
 own supplementary commands during the release. The following
@@ -231,7 +250,7 @@
 }
 ```
 
-### Skipping lifecycle steps
+### Skipping Lifecycle Steps
 
 You can skip any of the lifecycle steps (`bump`, `changelog`, `commit`, `tag`),
 by adding the following to your package.json:
@@ -246,7 +265,7 @@
 }
 ```
 
-### Committing generated artifacts in the release commit
+### Committing Generated Artifacts in the Release Commit
 
 If you want to commit generated artifacts in the release commit (e.g. [#96](https://github.com/conventional-changelog/standard-version/issues/96)), you can use the `--commit-all` or `-a` flag. You will need to stage the artifacts you want to commit, so your `release` command could look like this:
 
@@ -255,7 +274,7 @@
 "release": "git add <file(s) to commit> && standard-version -a"
 ```
 
-### Dry run mode
+### Dry Run Mode
 
 running `standard-version` with the flag `--dry-run` allows you to see what
 commands would be run, without committing to git or updating files.
@@ -288,10 +307,7 @@
 standard-version --help
 ```
 
-## Code usage
-
-Use the `silent` option to stop `standard-version` from printing anything
-to the console.
+## Code Usage
 
 ```js
 const standardVersion = require('standard-version')
@@ -309,47 +325,7 @@
 })
 ```
 
-## Commit Message Convention, at a Glance
-
-_patches:_
-
-```sh
-git commit -a -m "fix(parsing): fixed a bug in our parser"
-```
-
-_features:_
-
-```sh
-git commit -a -m "feat(parser): we now have a parser \o/"
-```
-
-_breaking changes:_
-
-```sh
-git commit -a -m "feat(new-parser): introduces a new parsing library
-BREAKING CHANGE: new library does not support foo-construct"
-```
-
-_other changes:_
-
-You decide, e.g., docs, chore, etc.
-
-```sh
-git commit -a -m "docs: fixed up the docs a bit"
-```
-
-_but wait, there's more!_
-
-Github usernames (`@bcoe`) and issue references (#133) will be swapped out for the
-appropriate URLs in your CHANGELOG.
-
-## Badges!
-
-Tell your users that you adhere to the Conventional Commits specification:
-
-```markdown
-[![Conventional Commits](https://img.shields.io/badge/Conventional%20Commits-1.0.0-yellow.svg)](https://conventionalcommits.org)
-```
+_TIP: Use the `silent` option to prevent `standard-version` from printing to the `console`._
 
 ## FAQ
 
@@ -373,6 +349,92 @@
 
 For this reason, we recommend keeping the scope of each PR to one general feature or fix. In practice, this allows you to use unstructured commit messages when committing each little change and then squash them into a single commit with a structured message (referencing the PR number) once they have been reviewed and accepted.
 
+### Can I use `standard-version` for additional metadata files, languages or version files?
+
+YES! Using `bumpFiles` (and `packageFiles`) configurations you should be able to configure `standard-version` to work for you.
+
+1. Specify a custom `bumpFile` "`file`", this is the path to the file you want to "bump"
+2. Specify the `bumpFile` "`updater`", this is _how_ the file will be bumped.
+  
+    a. If your using a common type, you can use one of  `standard-version`'s built-in `updaters` by specifying a `type`.
+
+    b. If your using an less-common version file, you can create your own `updater`.
+
+```json
+// .versionrc
+{
+  "bumpFiles": [
+    {
+      "file": "MY_VERSION_TRACKER.txt",
+      // The `plain-text` updater assumes the file contents represents the version.
+      "type": "plain-text"
+    },
+    {
+      "file": "a/deep/package/dot/json/file/package.json",
+      // The `json` updater assumes the version is available under a `version` key in the provided JSON document.
+      "type": "json"
+    }
+    {
+      "file": "VERSION_TRACKER.json",
+      //  See "Custom `updater`s" for more details.
+      "updater": "standard-version-updater.js"
+    }
+  ]
+}
+```
+
+#### Custom `updater`s
+
+An `updater` is expected to be a Javascript module with _atleast_ two methods exposed: `readVersion` and `writeVersion`.
+
+##### `readVersion(contents = string): string`
+
+This method is used to read the version from the provided file contents.
+
+The return value is expected to be a semantic version string.
+
+##### `writeVersion(contents = string, version: string): string`
+
+This method is used to write the version to the provided contents.
+
+The return value will be written directly (overwrite) to the provided file.
+
+---
+
+Let's assume our `VERSION_TRACKER.json` has the following contents:
+
+```json
+{
+  "tracker": {
+    "package": {
+      "version": "1.0.0"
+    }
+  }
+}
+
+```
+
+An acceptable `standard-version-updater.js` would be:
+
+```js
+// standard-version-updater.js
+const stringifyPackage = require('stringify-package')
+const detectIndent = require('detect-indent')
+const detectNewline = require('detect-newline')
+
+module.exports.readVersion = function (contents) {
+  return JSON.parse(contents).tracker.package.version;
+}
+
+module.exports.writeVersion = function (contents, version) {
+  const json = JSON.parse(contents)
+  let indent = detectIndent(contents).indent
+  let newline = detectNewline(contents)
+  json.tracker.package.version = version
+  return stringifyPackage(json, indent, newline)
+}
+```
+
 ## License
 
 ISC
diff --git a/command.js b/command.js
index 1674aec..95d1582 100755
--- a/command.js
+++ b/command.js
@@ -5,6 +5,14 @@
 
 const yargs = require('yargs')
   .usage('Usage: $0 [options]')
+  .option('packageFiles', {
+    default: defaults.packageFiles,
+    array: true
+  })
+  .option('bumpFiles', {
+    default: defaults.bumpFiles,
+    array: true
+  })
   .option('release-as', {
     alias: 'r',
     describe: 'Specify the release type manually (like npm version <major|minor|patch>)',
diff --git a/defaults.js b/defaults.js
index 202b8f4..fc88a5f 100644
--- a/defaults.js
+++ b/defaults.js
@@ -12,7 +12,7 @@
   skip: {},
   dryRun: false,
   gitTagFallback: true,
-  preset: 'conventionalcommits'
+  preset: require.resolve('conventional-changelog-conventionalcommits')
 }
 
 /**
@@ -23,4 +23,17 @@
   defaults[propertyKey] = property.default
 })
 
+defaults.packageFiles = [
+  'package.json',
+  'bower.json',
+  'manifest.json',
+  'composer.json'
+]
+
+defaults.bumpFiles = defaults.packageFiles.concat([
+  'package-lock.json',
+  'npm-shrinkwrap.json',
+  'composer.lock'
+])
+
 module.exports = defaults
diff --git a/index.js b/index.js
index 00dbadd..9ee4585 100755
--- a/index.js
+++ b/index.js
@@ -6,8 +6,10 @@
 const path = require('path')
 const printError = require('./lib/print-error')
 const tag = require('./lib/lifecycles/tag')
+const { resolveUpdaterObjectFromArgument } = require('./lib/updaters')
 
 module.exports = function standardVersion (argv) {
+  const defaults = require('./defaults')
   /**
    * `--message` (`-m`) support will be removed in the next major version.
    */
@@ -24,19 +26,21 @@
     }
   }
 
+  const args = Object.assign({}, defaults, argv)
   let pkg
-  bump.pkgFiles.forEach((filename) => {
+  args.packageFiles.forEach((packageFile) => {
     if (pkg) return
-    const pkgPath = path.resolve(process.cwd(), filename)
+    const updater = resolveUpdaterObjectFromArgument(packageFile)
+    const pkgPath = path.resolve(process.cwd(), updater.filename)
     try {
-      const data = fs.readFileSync(pkgPath, 'utf8')
-      pkg = JSON.parse(data)
+      const contents = fs.readFileSync(pkgPath, 'utf8')
+      pkg = {
+        version: updater.updater.readVersion(contents),
+        private: typeof updater.updater.isPrivate === 'function' ? updater.updater.isPrivate(contents) : false
+      }
     } catch (err) {}
   })
   let newVersion
-  const defaults = require('./defaults')
-  const args = Object.assign({}, defaults, argv)
-
   return Promise.resolve()
     .then(() => {
       if (!pkg && args.gitTagFallback) {
diff --git a/lib/lifecycles/bump.js b/lib/lifecycles/bump.js
index 86bb774..b59c46c 100644
--- a/lib/lifecycles/bump.js
+++ b/lib/lifecycles/bump.js
@@ -3,8 +3,6 @@
 const chalk = require('chalk')
 const checkpoint = require('../checkpoint')
 const conventionalRecommendedBump = require('conventional-recommended-bump')
-const detectIndent = require('detect-indent')
-const detectNewline = require('detect-newline')
 const figures = require('figures')
 const fs = require('fs')
 const DotGitignore = require('dotgitignore')
@@ -12,9 +10,8 @@
 const presetLoader = require('../preset-loader')
 const runLifecycleScript = require('../run-lifecycle-script')
 const semver = require('semver')
-const stringifyPackage = require('stringify-package')
 const writeFile = require('../write-file')
-
+const { resolveUpdaterObjectFromArgument } = require('../updaters')
 let configsToUpdate = {}
 
 function Bump (args, version) {
@@ -51,19 +48,6 @@
   return configsToUpdate
 }
 
-Bump.pkgFiles = [
-  'package.json',
-  'bower.json',
-  'manifest.json',
-  'composer.json'
-]
-
-Bump.lockFiles = [
-  'package-lock.json',
-  'npm-shrinkwrap.json',
-  'composer.lock'
-]
-
 function getReleaseType (prerelease, expectedReleaseType, currentVersion) {
   if (isString(prerelease)) {
     if (isInPrerelease(currentVersion)) {
@@ -154,32 +138,38 @@
 }
 
 /**
- * attempt to update the version # in a collection of common config
- * files, e.g., package.json, bower.json.
- *
+ * attempt to update the version number in provided `bumpFiles`
  * @param args config object
- * @param newVersion version # to update to.
- * @return {string}
+ * @param newVersion version number to update to.
+ * @return void
  */
 function updateConfigs (args, newVersion) {
   const dotgit = DotGitignore()
-  Bump.pkgFiles.concat(Bump.lockFiles).forEach(function (filename) {
-    const configPath = path.resolve(process.cwd(), filename)
+  args.bumpFiles.forEach(function (bumpFile) {
+    const updater = resolveUpdaterObjectFromArgument(bumpFile)
+    if (!updater) {
+      return
+    }
+    const configPath = path.resolve(process.cwd(), updater.filename)
     try {
       if (dotgit.ignore(configPath)) return
       const stat = fs.lstatSync(configPath)
-      if (stat.isFile()) {
-        const data = fs.readFileSync(configPath, 'utf8')
-        const indent = detectIndent(data).indent
-        const newline = detectNewline(data)
-        const config = JSON.parse(data)
-        checkpoint(args, 'bumping version in ' + filename + ' from %s to %s', [config.version, newVersion])
-        config.version = newVersion
-        writeFile(args, configPath, stringifyPackage(config, indent, newline))
-        // flag any config files that we modify the version # for
-        // as having been updated.
-        configsToUpdate[filename] = true
-      }
+
+      if (!stat.isFile()) return
+      const contents = fs.readFileSync(configPath, 'utf8')
+      checkpoint(
+        args,
+        'bumping version in ' + updater.filename + ' from %s to %s',
+        [updater.updater.readVersion(contents), newVersion]
+      )
+      writeFile(
+        args,
+        configPath,
+        updater.updater.writeVersion(contents, newVersion)
+      )
+      // flag any config files that we modify the version # for
+      // as having been updated.
+      configsToUpdate[updater.filename] = true
     } catch (err) {
       if (err.code !== 'ENOENT') console.warn(err.message)
     }
diff --git a/lib/preset-loader.js b/lib/preset-loader.js
index 72cb4d3..a7c0772 100644
--- a/lib/preset-loader.js
+++ b/lib/preset-loader.js
@@ -3,10 +3,11 @@
 const spec = require('conventional-changelog-config-spec')
 
 module.exports = (args) => {
-  let preset = args.preset || 'conventionalcommits'
-  if (preset === 'conventionalcommits') {
+  const defaultPreset = require.resolve('conventional-changelog-conventionalcommits')
+  let preset = args.preset || defaultPreset
+  if (preset === defaultPreset) {
     preset = {
-      name: preset
+      name: defaultPreset
     }
     Object.keys(spec.properties).forEach(key => {
       if (args[key] !== undefined) preset[key] = args[key]
diff --git a/lib/updaters/index.js b/lib/updaters/index.js
new file mode 100644
index 0000000..84ed1a0
--- /dev/null
+++ b/lib/updaters/index.js
@@ -0,0 +1,59 @@
+const path = require('path')
+const JSON_BUMP_FILES = require('../../defaults').bumpFiles
+const PLAIN_TEXT_BUMP_FILES = ['VERSION.txt', 'version.txt']
+
+function getUpdaterByType (type) {
+  try {
+    return require(`./types/${type}`)
+  } catch (e) {
+    throw Error(`Unable to locate updated for provided type (${type}).`)
+  }
+}
+
+function getUpdaterByFilename (filename) {
+  if (JSON_BUMP_FILES.includes(path.basename(filename))) {
+    return getUpdaterByType('json')
+  }
+  if (PLAIN_TEXT_BUMP_FILES.includes(filename)) {
+    return getUpdaterByType('plain-text')
+  }
+  throw Error(
+    `Unsupported file (${filename}) provided for bumping.\n Please specifcy the updater \`type\` or use a custom \`updater\`.`
+  )
+}
+
+function getCustomUpdater (updater) {
+  return require(path.resolve(process.cwd(), updater))
+}
+
+module.exports.resolveUpdaterObjectFromArgument = function (arg) {
+  /**
+   * If an Object was not provided, we assume it's the path/filename
+   * of the updater.
+   */
+  let updater = arg
+  if (typeof updater !== 'object') {
+    updater = {
+      filename: arg
+    }
+  }
+  try {
+    if (updater.updater) {
+      updater.updater = getCustomUpdater(updater.updater)
+    } else if (updater.type) {
+      updater.updater = getUpdaterByType(updater.type)
+    } else {
+      updater.updater = getUpdaterByFilename(updater.filename)
+    }
+  } catch (err) {
+    if (err.code !== 'ENOENT') console.warn(err.message)
+  }
+  /**
+   * We weren't able to resolve an updater for the argument.
+   */
+  if (!updater.updater) {
+    return false
+  }
+
+  return updater
+}
diff --git a/lib/updaters/types/json.js b/lib/updaters/types/json.js
new file mode 100644
index 0000000..4494aab
--- /dev/null
+++ b/lib/updaters/types/json.js
@@ -0,0 +1,19 @@
+const stringifyPackage = require('stringify-package')
+const detectIndent = require('detect-indent')
+const detectNewline = require('detect-newline')
+
+module.exports.readVersion = function (contents) {
+  return JSON.parse(contents).version
+}
+
+module.exports.writeVersion = function (contents, version) {
+  const json = JSON.parse(contents)
+  const indent = detectIndent(contents).indent
+  const newline = detectNewline(contents)
+  json.version = version
+  return stringifyPackage(json, indent, newline)
+}
+
+module.exports.isPrivate = function (contents) {
+  return JSON.parse(contents).private
+}
diff --git a/lib/updaters/types/plain-text.js b/lib/updaters/types/plain-text.js
new file mode 100644
index 0000000..18bcabe
--- /dev/null
+++ b/lib/updaters/types/plain-text.js
@@ -0,0 +1,7 @@
+module.exports.readVersion = function (contents) {
+  return contents
+}
+
+module.exports.writeVersion = function (_contents, version) {
+  return version
+}
diff --git a/package.json b/package.json
index ddae599..98273db 100644
--- a/package.json
+++ b/package.json
@@ -39,30 +39,31 @@
   "homepage": "https://github.com/conventional-changelog/standard-version#readme",
   "dependencies": {
     "chalk": "2.4.2",
-    "conventional-changelog": "3.1.12",
+    "conventional-changelog": "3.1.15",
     "conventional-changelog-config-spec": "2.1.0",
-    "conventional-recommended-bump": "6.0.2",
+    "conventional-changelog-conventionalcommits": "4.2.3",
+    "conventional-recommended-bump": "6.0.5",
     "detect-indent": "6.0.0",
-    "detect-newline": "3.0.0",
+    "detect-newline": "3.1.0",
     "dotgitignore": "2.1.0",
-    "figures": "3.0.0",
+    "figures": "3.1.0",
     "find-up": "4.1.0",
     "fs-access": "1.0.1",
-    "git-semver-tags": "3.0.0",
+    "git-semver-tags": "3.0.1",
     "semver": "6.3.0",
     "stringify-package": "1.0.1",
-    "yargs": "14.2.0"
+    "yargs": "15.0.2"
   },
   "devDependencies": {
     "chai": "4.2.0",
-    "coveralls": "3.0.7",
-    "eslint": "6.2.2",
+    "coveralls": "3.0.9",
+    "eslint": "6.7.2",
     "eslint-config-standard": "14.1.0",
     "eslint-plugin-import": "2.18.2",
-    "eslint-plugin-node": "9.2.0",
+    "eslint-plugin-node": "10.0.0",
     "eslint-plugin-promise": "4.2.1",
     "eslint-plugin-standard": "4.0.1",
-    "mocha": "6.2.0",
+    "mocha": "6.2.2",
     "mock-git": "2.0.0",
     "mockery": "2.1.0",
     "nyc": "14.1.1",
diff --git a/test.js b/test.js
index 2780916..19120bc 100644
--- a/test.js
+++ b/test.js
@@ -922,6 +922,74 @@
     })
   })
 
+  describe('custom `bumpFiles` support', function () {
+    it('mix.exs + version.txt', function () {
+      // @todo This file path is relative to the `tmp` directory, which is a little confusing
+      fs.copyFileSync('../test/mocks/mix.exs', 'mix.exs')
+      fs.copyFileSync('../test/mocks/version.txt', 'version.txt')
+      fs.copyFileSync('../test/mocks/updater/customer-updater.js', 'custom-updater.js')
+      commit('feat: first commit')
+      shell.exec('git tag -a v1.0.0 -m "my awesome first release"')
+      commit('feat: new feature!')
+      return require('./index')({
+        silent: true,
+        bumpFiles: [
+          'version.txt',
+          {
+            filename: 'mix.exs',
+            updater: 'custom-updater.js'
+          }
+        ]
+      })
+        .then(() => {
+          fs.readFileSync('mix.exs', 'utf-8').should.contain('version: "1.1.0"')
+          fs.readFileSync('version.txt', 'utf-8').should.equal('1.1.0')
+        })
+    })
+
+    it('bumps a custom `plain-text` file', function () {
+      fs.copyFileSync('../test/mocks/VERSION-1.0.0.txt', 'VERSION_TRACKER.txt')
+      commit('feat: first commit')
+      return require('./index')({
+        silent: true,
+        bumpFiles: [
+          {
+            filename: 'VERSION_TRACKER.txt',
+            type: 'plain-text'
+          }
+        ]
+      })
+        .then(() => {
+          fs.readFileSync('VERSION_TRACKER.txt', 'utf-8').should.equal('1.1.0')
+        })
+    })
+  })
+
+  describe('custom `packageFiles` support', function () {
+    it('reads and writes to a custom `plain-text` file', function () {
+      fs.copyFileSync('../test/mocks/VERSION-6.3.1.txt', 'VERSION_TRACKER.txt')
+      commit('feat: yet another commit')
+      return require('./index')({
+        silent: true,
+        packageFiles: [
+          {
+            filename: 'VERSION_TRACKER.txt',
+            type: 'plain-text'
+          }
+        ],
+        bumpFiles: [
+          {
+            filename: 'VERSION_TRACKER.txt',
+            type: 'plain-text'
+          }
+        ]
+      })
+        .then(() => {
+          fs.readFileSync('VERSION_TRACKER.txt', 'utf-8').should.equal('6.4.0')
+        })
+    })
+  })
+
   describe('npm-shrinkwrap.json support', function () {
     beforeEach(function () {
       writeNpmShrinkwrapJson('1.0.0')
@@ -1073,6 +1141,22 @@
   })
 
   describe('configuration', () => {
+    it('reads config from package.json', function () {
+      writePackageJson('1.0.0', {
+        repository: {
+          url: 'git+https://company@scm.org/office/app.git'
+        },
+        'standard-version': {
+          issueUrlFormat: 'https://standard-version.company.net/browse/{{id}}'
+        }
+      })
+      commit('feat: another commit addresses issue #1')
+      execCli()
+      // CHANGELOG should have the new issue URL format.
+      const content = fs.readFileSync('CHANGELOG.md', 'utf-8')
+      content.should.include('https://standard-version.company.net/browse/1')
+    })
+
     it('reads config from .versionrc', function () {
       // write configuration that overrides default issue
       // URL format.
diff --git a/test/mocks/VERSION-1.0.0.txt b/test/mocks/VERSION-1.0.0.txt
new file mode 100644
index 0000000..afaf360
--- /dev/null
+++ b/test/mocks/VERSION-1.0.0.txt
@@ -0,0 +1 @@
+1.0.0
\ No newline at end of file
diff --git a/test/mocks/VERSION-6.3.1.txt b/test/mocks/VERSION-6.3.1.txt
new file mode 100644
index 0000000..39ee137
--- /dev/null
+++ b/test/mocks/VERSION-6.3.1.txt
@@ -0,0 +1 @@
+6.3.1
\ No newline at end of file
diff --git a/test/mocks/mix.exs b/test/mocks/mix.exs
new file mode 100644
index 0000000..bc53913
--- /dev/null
+++ b/test/mocks/mix.exs
@@ -0,0 +1,28 @@
+defmodule StandardVersion.MixProject do
+  use Mix.Project
+
+  def project do
+    [
+      app: :standard_version,
+      version: "0.1.0",
+      elixir: "~> 1.9",
+      start_permanent: Mix.env() == :prod,
+      deps: deps()
+    ]
+  end
+
+  # Run "mix help compile.app" to learn about applications.
+  def application do
+    [
+      extra_applications: [:logger]
+    ]
+  end
+
+  # Run "mix help deps" to learn about dependencies.
+  defp deps do
+    [
+      # {:dep_from_hexpm, "~> 0.3.0"},
+      # {:dep_from_git, git: "https://github.com/elixir-lang/my_dep.git", tag: "0.1.0"}
+    ]
+  end
+end
diff --git a/test/mocks/updater/customer-updater.js b/test/mocks/updater/customer-updater.js
new file mode 100644
index 0000000..989aba3
--- /dev/null
+++ b/test/mocks/updater/customer-updater.js
@@ -0,0 +1,12 @@
+const REPLACER = /version: "(.*)"/
+
+module.exports.readVersion = function (contents) {
+  return REPLACER.exec(contents)[1]
+}
+
+module.exports.writeVersion = function (contents, version) {
+  return contents.replace(
+    REPLACER.exec(contents)[0],
+    `version: "${version}"`
+  )
+}
diff --git a/test/mocks/version.txt b/test/mocks/version.txt
new file mode 100644
index 0000000..e69de29
--- /dev/null
+++ b/test/mocks/version.txt

=====================================================================
start time: Tue Jul 30 00:00:00 CST 2019
end time: Thu Nov 07 00:00:00 CST 2019
### Bug Fixes* **deps:** update dependency conventional-changelog to v3.1.12 ([#463](https://github.com/conventional-changelog/standard-version/issues/463)) ([f04161a](https://github.com/conventional-changelog/standard-version/commit/f04161ae624705e68f9018d563e9f3c09ccf6f30))* **deps:** update dependency conventional-changelog-config-spec to v2.1.0 ([#442](https://github.com/conventional-changelog/standard-version/issues/442)) ([a2c5747](https://github.com/conventional-changelog/standard-version/commit/a2c574735ac5a165a190661b7735ea284bdc7dda))* **deps:** update dependency conventional-recommended-bump to v6.0.2 ([#462](https://github.com/conventional-changelog/standard-version/issues/462)) ([84bb581](https://github.com/conventional-changelog/standard-version/commit/84bb581209b50357761cbec45bb8253f6a182801))* **deps:** update dependency stringify-package to v1.0.1 ([#459](https://github.com/conventional-changelog/standard-version/issues/459)) ([e06a835](https://github.com/conventional-changelog/standard-version/commit/e06a835c8296a92f4fa7c07f98057d765c1a91e5))* **deps:** update dependency yargs to v14 ([#440](https://github.com/conventional-changelog/standard-version/issues/440)) ([fe37e73](https://github.com/conventional-changelog/standard-version/commit/fe37e7390760d8d16d1b94ca58d8123e292c46a8))* **deps:** update dependency yargs to v14.2.0 ([#461](https://github.com/conventional-changelog/standard-version/issues/461)) ([fb21851](https://github.com/conventional-changelog/standard-version/commit/fb2185107a90ba4b9dc7c9c1d873ed1283706ac1))
diff --git a/CHANGELOG.md b/CHANGELOG.md
index 2d8e9f2..211fdc1 100644
--- a/CHANGELOG.md
+++ b/CHANGELOG.md
@@ -2,6 +2,31 @@
 
 All notable changes to this project will be documented in this file. See [standard-version](https://github.com/conventional-changelog/standard-version) for commit guidelines.
 
+## [7.0.0](https://github.com/conventional-changelog/standard-version/compare/v6.0.1...v7.0.0) (2019-07-30)
+
+
+### âš  BREAKING CHANGES
+
+* we were accepting .version.json as a config file, rather than .versionrc.json
+
+### Bug Fixes
+
+* **bump:** transmit tag prefix argument to conventionalRecommendedBump ([#393](https://github.com/conventional-changelog/standard-version/issues/393)) ([8205222](https://github.com/conventional-changelog/standard-version/commit/8205222))
+* **cli:** display only one, correct default for --preset flag ([#377](https://github.com/conventional-changelog/standard-version/issues/377)) ([d17fc81](https://github.com/conventional-changelog/standard-version/commit/d17fc81))
+* **commit:** don't try to process and add changelog if skipped ([#318](https://github.com/conventional-changelog/standard-version/issues/318)) ([3e4fdec](https://github.com/conventional-changelog/standard-version/commit/3e4fdec))
+* **deps:** update dependency conventional-changelog-config-spec to v2 ([#352](https://github.com/conventional-changelog/standard-version/issues/352)) ([f586844](https://github.com/conventional-changelog/standard-version/commit/f586844))
+* **deps:** update dependency conventional-recommended-bump to v6 ([#417](https://github.com/conventional-changelog/standard-version/issues/417)) ([4c5cad1](https://github.com/conventional-changelog/standard-version/commit/4c5cad1))
+* **deps:** update dependency find-up to v4 ([#355](https://github.com/conventional-changelog/standard-version/issues/355)) ([73b35f8](https://github.com/conventional-changelog/standard-version/commit/73b35f8))
+* **deps:** update dependency find-up to v4.1.0 ([#383](https://github.com/conventional-changelog/standard-version/issues/383)) ([b621a4a](https://github.com/conventional-changelog/standard-version/commit/b621a4a))
+* **deps:** update dependency git-semver-tags to v3 ([#418](https://github.com/conventional-changelog/standard-version/issues/418)) ([1ce3f4a](https://github.com/conventional-changelog/standard-version/commit/1ce3f4a))
+* **deps:** update dependency semver to v6.3.0 ([#366](https://github.com/conventional-changelog/standard-version/issues/366)) ([cd866c7](https://github.com/conventional-changelog/standard-version/commit/cd866c7))
+* **deps:** update dependency yargs to v13.3.0 ([#401](https://github.com/conventional-changelog/standard-version/issues/401)) ([3d0e8c7](https://github.com/conventional-changelog/standard-version/commit/3d0e8c7))
+* adds support for `releaseCommitMessageFormat` ([#351](https://github.com/conventional-changelog/standard-version/issues/351)) ([a7133cc](https://github.com/conventional-changelog/standard-version/commit/a7133cc))
+* stop suggesting npm publish if package.json was not updated ([#319](https://github.com/conventional-changelog/standard-version/issues/319)) ([a5ac845](https://github.com/conventional-changelog/standard-version/commit/a5ac845))
+* Updates package.json to _actual_ supported (tested) NodeJS versions. ([#379](https://github.com/conventional-changelog/standard-version/issues/379)) ([15eec8a](https://github.com/conventional-changelog/standard-version/commit/15eec8a))
+* **deps:** update dependency yargs to v13.2.4 ([#356](https://github.com/conventional-changelog/standard-version/issues/356)) ([00b2ce6](https://github.com/conventional-changelog/standard-version/commit/00b2ce6))
+* update config file name in command based on README.md ([#357](https://github.com/conventional-changelog/standard-version/issues/357)) ([ce44dd2](https://github.com/conventional-changelog/standard-version/commit/ce44dd2))
+
 ### [6.0.1](https://github.com/conventional-changelog/standard-version/compare/v6.0.0...v6.0.1) (2019-05-05)
 
 
diff --git a/README.md b/README.md
index a349585..e614ff2 100644
--- a/README.md
+++ b/README.md
@@ -71,11 +71,13 @@
 
 1. Placing a `standard-version` stanza in your `package.json` (assuming
    your project is JavaScript).
-1. Creating a `.versionrc` or `.versionrc.json`.
+2. Creating a `.versionrc`, `.versionrc.json` or `.versionrc.js`.
+  - If you are using a `.versionrc.js` your default export must be a configuration object, or a function returning a configuration object.
 
-Any of the command line paramters accepted by `standard-version` can instead
+Any of the command line parameters accepted by `standard-version` can instead
 be provided via configuration. Please refer to the [conventional-changelog-config-spec](https://github.com/conventional-changelog/conventional-changelog-config-spec/) for details on available configuration options.
 
+
 ### Customizing CHANGELOG Generation
 
 By default, `standard-version` uses the [conventionalcommits preset](https://github.com/conventional-changelog/conventional-changelog/tree/master/packages/conventional-changelog-conventionalcommits).
@@ -353,13 +355,13 @@
 
 ### How is `standard-version` different from `semantic-release`?
 
-[`semantic-release`](https://github.com/semantic-release/semantic-release) is a fully automated library/system for versioning, changelog generation, git tagging, and publishing to the npm registry.
+[`semantic-release`](https://github.com/semantic-release/semantic-release) is described as:
 
-`standard-version` is different because it handles the versioning, changelog generation, and git tagging for you **without** automatic pushing (to GitHub) or publishing (to an npm registry). Use of `standard-version` only affects your local git repo - it doesn't affect remote resources at all. After you run `standard-version`, you still have the ability to review things and correct mistakes if you want to.
+> semantic-release automates the whole package release workflow including: determining the next version number, generating the release notes and publishing the package.
 
-They are both based on the same foundation of structured commit messages (using [Angular format](https://github.com/bcoe/conventional-changelog-standard/blob/master/convention.md)), but `standard-version` is a good choice for folks who are not yet comfortable letting publishes go out automatically. In this way, you can view `standard-version` as an incremental step to adopting `semantic-release`.
+While both are based on the same foundation of structured commit messages, `standard-version`  takes a different approach by handling versioning, changelog generation, and git tagging for you **without** automatic pushing (to GitHub) or publishing (to an npm registry). Use of `standard-version` only affects your local git repo - it doesn't affect remote resources at all. After you run `standard-version`, you can review your release state, correct mistakes and follow the release strategy that makes the most sense for your codebase.
 
-We think they are both fantastic tools, and we encourage folks to use `semantic-release` instead of `standard-version` if it makes sense for them.
+We think they are both fantastic tools, and we encourage folks to use `semantic-release` instead of `standard-version` if it makes sense for their use-case.
 
 ### Should I always squash commits when merging PRs?
 
diff --git a/command.js b/command.js
index c03ce56..1674aec 100755
--- a/command.js
+++ b/command.js
@@ -1,10 +1,6 @@
-const findUp = require('find-up')
-const defaults = require('./defaults')
-const { readFileSync } = require('fs')
-
-const configPath = findUp.sync(['.versionrc', '.versionrc.json'])
-const config = configPath ? JSON.parse(readFileSync(configPath)) : {}
 const spec = require('conventional-changelog-config-spec')
+const { getConfiguration } = require('./lib/configuration')
+const defaults = require('./defaults')
 const { START_OF_LAST_RELEASE_PATTERN } = require('./lib/lifecycles/changelog')
 
 const yargs = require('yargs')
@@ -81,7 +77,7 @@
   .option('git-tag-fallback', {
     type: 'boolean',
     default: defaults.gitTagFallback,
-    describe: `fallback to git tags for version, if no meta-information file is found (e.g., package.json)`
+    describe: 'fallback to git tags for version, if no meta-information file is found (e.g., package.json)'
   })
   .option('path', {
     type: 'string',
@@ -110,7 +106,7 @@
   .example('$0', 'Update changelog and tag release')
   .example('$0 -m "%s: see changelog for details"', 'Update changelog and tag release with custom commit message')
   .pkgConf('standard-version')
-  .config(config)
+  .config(getConfiguration())
   .wrap(97)
   .check((args) => {
     if (args.changelogHeader && args.changelogHeader.search(START_OF_LAST_RELEASE_PATTERN) !== -1) {
diff --git a/index.js b/index.js
index e403398..00dbadd 100755
--- a/index.js
+++ b/index.js
@@ -27,15 +27,15 @@
   let pkg
   bump.pkgFiles.forEach((filename) => {
     if (pkg) return
-    let pkgPath = path.resolve(process.cwd(), filename)
+    const pkgPath = path.resolve(process.cwd(), filename)
     try {
-      let data = fs.readFileSync(pkgPath, 'utf8')
+      const data = fs.readFileSync(pkgPath, 'utf8')
       pkg = JSON.parse(data)
     } catch (err) {}
   })
   let newVersion
-  let defaults = require('./defaults')
-  let args = Object.assign({}, defaults, argv)
+  const defaults = require('./defaults')
+  const args = Object.assign({}, defaults, argv)
 
   return Promise.resolve()
     .then(() => {
diff --git a/lib/configuration.js b/lib/configuration.js
new file mode 100644
index 0000000..4b74b14
--- /dev/null
+++ b/lib/configuration.js
@@ -0,0 +1,39 @@
+const path = require('path')
+const findUp = require('find-up')
+const { readFileSync } = require('fs')
+
+const CONFIGURATION_FILES = [
+  '.versionrc',
+  '.versionrc.json',
+  '.versionrc.js'
+]
+
+module.exports.getConfiguration = function () {
+  let config = {}
+  const configPath = findUp.sync(CONFIGURATION_FILES)
+  if (!configPath) {
+    return config
+  }
+  if (path.extname(configPath) === '.js') {
+    const jsConfiguration = require(configPath)
+    if (typeof jsConfiguration === 'function') {
+      config = jsConfiguration()
+    } else {
+      config = jsConfiguration
+    }
+  } else {
+    config = JSON.parse(readFileSync(configPath))
+  }
+
+  /**
+   * @todo we could eventually have deeper validation of the configuration (using `ajv`) and
+   * provide a more helpful error.
+   */
+  if (typeof config !== 'object') {
+    throw Error(
+      `[standard-version] Invalid configuration in ${configPath} provided. Expected an object but found ${typeof config}.`
+    )
+  }
+
+  return config
+}
diff --git a/lib/lifecycles/bump.js b/lib/lifecycles/bump.js
index a2a5335..86bb774 100644
--- a/lib/lifecycles/bump.js
+++ b/lib/lifecycles/bump.js
@@ -32,7 +32,7 @@
     })
     .then((release) => {
       if (!args.firstRelease) {
-        let releaseType = getReleaseType(args.prerelease, release.releaseType, version)
+        const releaseType = getReleaseType(args.prerelease, release.releaseType, version)
         newVersion = semver.valid(releaseType) || semver.inc(version, releaseType, args.prerelease)
         updateConfigs(args, newVersion)
       } else {
@@ -101,7 +101,7 @@
   return Array.isArray(semver.prerelease(version))
 }
 
-let TypeList = ['major', 'minor', 'patch'].reverse()
+const TypeList = ['major', 'minor', 'patch'].reverse()
 
 /**
  * extract the in-pre-release type in target version
@@ -110,7 +110,7 @@
  * @return {string}
  */
 function getCurrentActiveType (version) {
-  let typelist = TypeList
+  const typelist = TypeList
   for (let i = 0; i < typelist.length; i++) {
     if (semver[typelist[i]](version)) {
       return typelist[i]
@@ -164,15 +164,15 @@
 function updateConfigs (args, newVersion) {
   const dotgit = DotGitignore()
   Bump.pkgFiles.concat(Bump.lockFiles).forEach(function (filename) {
-    let configPath = path.resolve(process.cwd(), filename)
+    const configPath = path.resolve(process.cwd(), filename)
     try {
       if (dotgit.ignore(configPath)) return
-      let stat = fs.lstatSync(configPath)
+      const stat = fs.lstatSync(configPath)
       if (stat.isFile()) {
-        let data = fs.readFileSync(configPath, 'utf8')
-        let indent = detectIndent(data).indent
-        let newline = detectNewline(data)
-        let config = JSON.parse(data)
+        const data = fs.readFileSync(configPath, 'utf8')
+        const indent = detectIndent(data).indent
+        const newline = detectNewline(data)
+        const config = JSON.parse(data)
         checkpoint(args, 'bumping version in ' + filename + ' from %s to %s', [config.version, newVersion])
         config.version = newVersion
         writeFile(args, configPath, stringifyPackage(config, indent, newline))
diff --git a/lib/lifecycles/changelog.js b/lib/lifecycles/changelog.js
index 689ed38..0f3616a 100644
--- a/lib/lifecycles/changelog.js
+++ b/lib/lifecycles/changelog.js
@@ -29,14 +29,14 @@
     const header = args.changelogHeader || '# Changelog\n\nAll notable changes to this project will be documented in this file. See [standard-version](https://github.com/conventional-changelog/standard-version) for commit guidelines.\n'
 
     let oldContent = args.dryRun ? '' : fs.readFileSync(args.infile, 'utf-8')
-    let oldContentStart = oldContent.search(START_OF_LAST_RELEASE_PATTERN)
+    const oldContentStart = oldContent.search(START_OF_LAST_RELEASE_PATTERN)
     // find the position of the last release and remove header:
     if (oldContentStart !== -1) {
       oldContent = oldContent.substring(oldContentStart)
     }
     let content = ''
     const context = { version: newVersion }
-    let changelogStream = conventionalChangelog({
+    const changelogStream = conventionalChangelog({
       debug: args.verbose && console.info.bind(console, 'conventional-changelog'),
       preset: presetLoader(args),
       tagPrefix: args.tagPrefix
diff --git a/lib/lifecycles/commit.js b/lib/lifecycles/commit.js
index 4ec0006..e8fe17c 100644
--- a/lib/lifecycles/commit.js
+++ b/lib/lifecycles/commit.js
@@ -20,7 +20,7 @@
 function execCommit (args, newVersion) {
   let msg = 'committing %s'
   let paths = []
-  let verify = args.verify === false || args.n ? '--no-verify ' : ''
+  const verify = args.verify === false || args.n ? '--no-verify ' : ''
   let toAdd = ''
 
   // only start with a pre-populated paths list when CHANGELOG processing is not skipped
diff --git a/lib/run-lifecycle-hook.js b/lib/run-lifecycle-hook.js
index 9c0dc2c..f96b8d1 100644
--- a/lib/run-lifecycle-hook.js
+++ b/lib/run-lifecycle-hook.js
@@ -5,7 +5,7 @@
 
 module.exports = function (args, hookName, newVersion, hooks, cb) {
   if (!hooks[hookName]) return Promise.resolve()
-  let command = hooks[hookName] + ' --new-version="' + newVersion + '"'
+  const command = hooks[hookName] + ' --new-version="' + newVersion + '"'
   checkpoint(args, 'Running lifecycle hook "%s"', [hookName])
   checkpoint(args, '- hook command: "%s"', [command], chalk.blue(figures.info))
   return runExec(args, command)
diff --git a/lib/run-lifecycle-script.js b/lib/run-lifecycle-script.js
index 7a9b2a2..a4c88c2 100644
--- a/lib/run-lifecycle-script.js
+++ b/lib/run-lifecycle-script.js
@@ -6,7 +6,7 @@
 module.exports = function (args, hookName) {
   const scripts = args.scripts
   if (!scripts || !scripts[hookName]) return Promise.resolve()
-  let command = scripts[hookName]
+  const command = scripts[hookName]
   checkpoint(args, 'Running lifecycle script "%s"', [hookName])
   checkpoint(args, '- execute command: "%s"', [command], chalk.blue(figures.info))
   return runExec(args, command)
diff --git a/package.json b/package.json
index c408445..b59805f 100644
--- a/package.json
+++ b/package.json
@@ -1,6 +1,6 @@
 {
   "name": "standard-version",
-  "version": "6.0.1",
+  "version": "7.0.0",
   "description": "replacement for `npm version` with automatic CHANGELOG generation",
   "bin": "bin/cli.js",
   "scripts": {
@@ -39,9 +39,9 @@
   "homepage": "https://github.com/conventional-changelog/standard-version#readme",
   "dependencies": {
     "chalk": "2.4.2",
-    "conventional-changelog": "3.1.9",
-    "conventional-changelog-config-spec": "2.0.0",
-    "conventional-recommended-bump": "5.0.0",
+    "conventional-changelog": "3.1.12",
+    "conventional-changelog-config-spec": "2.1.0",
+    "conventional-recommended-bump": "6.0.2",
     "detect-indent": "6.0.0",
     "detect-newline": "3.0.0",
     "dotgitignore": "2.1.0",
@@ -49,19 +49,19 @@
     "find-up": "4.1.0",
     "fs-access": "1.0.1",
     "git-semver-tags": "3.0.0",
-    "semver": "6.0.0",
-    "stringify-package": "1.0.0",
-    "yargs": "13.3.0"
+    "semver": "6.3.0",
+    "stringify-package": "1.0.1",
+    "yargs": "14.2.0"
   },
   "devDependencies": {
     "chai": "4.2.0",
-    "coveralls": "3.0.5",
-    "eslint": "6.1.0",
-    "eslint-config-standard": "12.0.0",
+    "coveralls": "3.0.7",
+    "eslint": "6.2.2",
+    "eslint-config-standard": "14.1.0",
     "eslint-plugin-import": "2.18.2",
-    "eslint-plugin-node": "9.1.0",
+    "eslint-plugin-node": "9.2.0",
     "eslint-plugin-promise": "4.2.1",
-    "eslint-plugin-standard": "4.0.0",
+    "eslint-plugin-standard": "4.0.1",
     "mocha": "6.2.0",
     "mock-git": "2.0.0",
     "mockery": "2.1.0",
diff --git a/test.js b/test.js
index 55a11bd..2780916 100644
--- a/test.js
+++ b/test.js
@@ -15,7 +15,7 @@
 
 require('chai').should()
 
-let cliPath = path.resolve(__dirname, './bin/cli.js')
+const cliPath = path.resolve(__dirname, './bin/cli.js')
 
 function branch (branch) {
   shell.exec('git branch ' + branch)
@@ -43,31 +43,31 @@
 
 function writePackageJson (version, option) {
   option = option || {}
-  let pkg = Object.assign(option, { version: version })
+  const pkg = Object.assign(option, { version: version })
   fs.writeFileSync('package.json', JSON.stringify(pkg), 'utf-8')
 }
 
 function writeBowerJson (version, option) {
   option = option || {}
-  let bower = Object.assign(option, { version: version })
+  const bower = Object.assign(option, { version: version })
   fs.writeFileSync('bower.json', JSON.stringify(bower), 'utf-8')
 }
 
 function writeManifestJson (version, option) {
   option = option || {}
-  let manifest = Object.assign(option, { version: version })
+  const manifest = Object.assign(option, { version: version })
   fs.writeFileSync('manifest.json', JSON.stringify(manifest), 'utf-8')
 }
 
 function writeNpmShrinkwrapJson (version, option) {
   option = option || {}
-  let shrinkwrap = Object.assign(option, { version: version })
+  const shrinkwrap = Object.assign(option, { version: version })
   fs.writeFileSync('npm-shrinkwrap.json', JSON.stringify(shrinkwrap), 'utf-8')
 }
 
 function writePackageLockJson (version, option) {
   option = option || {}
-  let pkgLock = Object.assign(option, { version: version })
+  const pkgLock = Object.assign(option, { version: version })
   fs.writeFileSync('package-lock.json', JSON.stringify(pkgLock), 'utf-8')
 }
 
@@ -132,7 +132,7 @@
 
       execCli().code.should.equal(0)
 
-      let content = fs.readFileSync('CHANGELOG.md', 'utf-8')
+      const content = fs.readFileSync('CHANGELOG.md', 'utf-8')
       content.should.match(/patch release/)
       content.should.not.match(/first commit/)
     })
@@ -144,7 +144,7 @@
       commit('fix: patch release')
       execCli('--first-release').code.should.equal(0)
 
-      let content = fs.readFileSync('CHANGELOG.md', 'utf-8')
+      const content = fs.readFileSync('CHANGELOG.md', 'utf-8')
       content.should.match(/patch release/)
       content.should.match(/first commit/)
       shell.exec('git tag').stdout.should.match(/1\.0\.1/)
@@ -178,7 +178,7 @@
       commit('fix: patch release')
 
       execCli().code.should.equal(0)
-      let content = fs.readFileSync('CHANGELOG.md', 'utf-8')
+      const content = fs.readFileSync('CHANGELOG.md', 'utf-8')
       content.should.match(/1\.0\.1/)
       content.should.not.match(/legacy header format/)
     })
@@ -223,8 +223,8 @@
 
       execCli('--commit-all').code.should.equal(0)
 
-      let content = fs.readFileSync('CHANGELOG.md', 'utf-8')
-      let status = shell.exec('git status --porcelain') // see http://unix.stackexchange.com/questions/155046/determine-if-git-working-directory-is-clean-from-a-script
+      const content = fs.readFileSync('CHANGELOG.md', 'utf-8')
+      const status = shell.exec('git status --porcelain') // see http://unix.stackexchange.com/questions/155046/determine-if-git-working-directory-is-clean-from-a-script
 
       status.should.equal('')
       status.should.not.match(/STUFF.md/)
@@ -237,7 +237,7 @@
       fs.writeFileSync('CHANGELOG.md', '', 'utf-8')
       commit('feat: first commit')
       execCli('--changelogHeader="# Pork Chop Log"').code.should.equal(0)
-      let content = fs.readFileSync('CHANGELOG.md', 'utf-8')
+      const content = fs.readFileSync('CHANGELOG.md', 'utf-8')
       content.should.match(/# Pork Chop Log/)
     })
 
@@ -255,7 +255,7 @@
         .then(function (unmock) {
           execCli('--sign').code.should.equal(0)
 
-          let captured = shell.cat('gitcapture.log').stdout.split('\n').map(function (line) {
+          const captured = shell.cat('gitcapture.log').stdout.split('\n').map(function (line) {
             return line ? JSON.parse(line) : line
           })
           captured[captured.length - 4].should.deep.equal(['commit', '-S', 'CHANGELOG.md', 'package.json', '-m', 'chore(release): 1.0.1'])
@@ -269,7 +269,7 @@
       // mock git by throwing on attempt to commit
       return mockGit('console.error("commit yourself"); process.exit(128);', 'commit')
         .then(function (unmock) {
-          let result = execCli()
+          const result = execCli()
           result.code.should.equal(1)
           result.stderr.should.match(/commit yourself/)
 
@@ -281,7 +281,7 @@
       // mock git by throwing on attempt to add
       return mockGit('console.error("addition is hard"); process.exit(128);', 'add')
         .then(function (unmock) {
-          let result = execCli()
+          const result = execCli()
           result.code.should.equal(1)
           result.stderr.should.match(/addition is hard/)
 
@@ -293,7 +293,7 @@
       // mock git by throwing on attempt to commit
       return mockGit('console.error("tag, you\'re it"); process.exit(128);', 'tag')
         .then(function (unmock) {
-          let result = execCli()
+          const result = execCli()
           result.code.should.equal(1)
           result.stderr.should.match(/tag, you're it/)
 
@@ -307,7 +307,7 @@
         .then(function (unmock) {
           writePackageJson('1.0.0')
 
-          let result = execCli()
+          const result = execCli()
           result.code.should.equal(1)
           result.stderr.should.match(/haha, kidding, this is just a warning/)
 
@@ -321,8 +321,8 @@
       it('should run the prerelease hook when provided', function () {
         writePackageJson('1.0.0', {
           'standard-version': {
-            'scripts': {
-              'prerelease': 'node scripts/prerelease'
+            scripts: {
+              prerelease: 'node scripts/prerelease'
             }
           }
         })
@@ -330,7 +330,7 @@
         fs.writeFileSync('CHANGELOG.md', 'legacy header format<a name="1.0.0">\n', 'utf-8')
 
         commit('feat: first commit')
-        let result = execCli('--patch')
+        const result = execCli('--patch')
         result.code.should.equal(0)
         result.stderr.should.match(/prerelease ran/)
       })
@@ -338,8 +338,8 @@
       it('should abort if the hook returns a non-zero exit code', function () {
         writePackageJson('1.0.0', {
           'standard-version': {
-            'scripts': {
-              'prerelease': 'node scripts/prerelease && exit 1'
+            scripts: {
+              prerelease: 'node scripts/prerelease && exit 1'
             }
           }
         })
@@ -347,7 +347,7 @@
         fs.writeFileSync('CHANGELOG.md', 'legacy header format<a name="1.0.0">\n', 'utf-8')
 
         commit('feat: first commit')
-        let result = execCli('--patch')
+        const result = execCli('--patch')
         result.code.should.equal(1)
         result.stderr.should.match(/prerelease ran/)
       })
@@ -357,8 +357,8 @@
       it('should allow prebump hook to return an alternate version #', function () {
         writePackageJson('1.0.0', {
           'standard-version': {
-            'scripts': {
-              'prebump': 'node scripts/prebump'
+            scripts: {
+              prebump: 'node scripts/prebump'
             }
           }
         })
@@ -366,7 +366,7 @@
         fs.writeFileSync('CHANGELOG.md', 'legacy header format<a name="1.0.0">\n', 'utf-8')
 
         commit('feat: first commit')
-        let result = execCli('--patch')
+        const result = execCli('--patch')
         result.stdout.should.match(/9\.9\.9/)
         result.code.should.equal(0)
       })
@@ -376,8 +376,8 @@
       it('should run the postbump hook when provided', function () {
         writePackageJson('1.0.0', {
           'standard-version': {
-            'scripts': {
-              'postbump': 'node scripts/postbump'
+            scripts: {
+              postbump: 'node scripts/postbump'
             }
           }
         })
@@ -385,7 +385,7 @@
         fs.writeFileSync('CHANGELOG.md', 'legacy header format<a name="1.0.0">\n', 'utf-8')
 
         commit('feat: first commit')
-        let result = execCli('--patch')
+        const result = execCli('--patch')
         result.code.should.equal(0)
         result.stderr.should.match(/postbump ran/)
       })
@@ -393,8 +393,8 @@
       it('should run the postbump and exit with error when postbump fails', function () {
         writePackageJson('1.0.0', {
           'standard-version': {
-            'scripts': {
-              'postbump': 'node scripts/postbump'
+            scripts: {
+              postbump: 'node scripts/postbump'
             }
           }
         })
@@ -402,7 +402,7 @@
         fs.writeFileSync('CHANGELOG.md', 'legacy header format<a name="1.0.0">\n', 'utf-8')
 
         commit('feat: first commit')
-        let result = execCli('--patch')
+        const result = execCli('--patch')
         result.code.should.equal(1)
         result.stderr.should.match(/postbump-failure/)
       })
@@ -411,15 +411,15 @@
     describe('precommit hook', function () {
       it('should run the precommit hook when provided via .versionrc.json (#371)', function () {
         fs.writeFileSync('.versionrc.json', JSON.stringify({
-          'scripts': {
-            'precommit': 'node scripts/precommit'
+          scripts: {
+            precommit: 'node scripts/precommit'
           }
         }), 'utf-8')
 
         writeHook('precommit')
         fs.writeFileSync('CHANGELOG.md', 'legacy header format<a name="1.0.0">\n', 'utf-8')
         commit('feat: first commit')
-        let result = execCli()
+        const result = execCli()
         result.code.should.equal(0)
         result.stderr.should.match(/precommit ran/)
       })
@@ -427,8 +427,8 @@
       it('should run the precommit hook when provided', function () {
         writePackageJson('1.0.0', {
           'standard-version': {
-            'scripts': {
-              'precommit': 'node scripts/precommit'
+            scripts: {
+              precommit: 'node scripts/precommit'
             }
           }
         })
@@ -436,7 +436,7 @@
         fs.writeFileSync('CHANGELOG.md', 'legacy header format<a name="1.0.0">\n', 'utf-8')
 
         commit('feat: first commit')
-        let result = execCli('--patch')
+        const result = execCli('--patch')
         result.code.should.equal(0)
         result.stderr.should.match(/precommit ran/)
       })
@@ -444,8 +444,8 @@
       it('should run the precommit hook and exit with error when precommit fails', function () {
         writePackageJson('1.0.0', {
           'standard-version': {
-            'scripts': {
-              'precommit': 'node scripts/precommit'
+            scripts: {
+              precommit: 'node scripts/precommit'
             }
           }
         })
@@ -453,7 +453,7 @@
         fs.writeFileSync('CHANGELOG.md', 'legacy header format<a name="1.0.0">\n', 'utf-8')
 
         commit('feat: first commit')
-        let result = execCli('--patch')
+        const result = execCli('--patch')
         result.code.should.equal(1)
         result.stderr.should.match(/precommit-failure/)
       })
@@ -461,8 +461,8 @@
       it('should allow an alternate commit message to be provided by precommit script', function () {
         writePackageJson('1.0.0', {
           'standard-version': {
-            'scripts': {
-              'precommit': 'node scripts/precommit'
+            scripts: {
+              precommit: 'node scripts/precommit'
             }
           }
         })
@@ -470,7 +470,7 @@
         fs.writeFileSync('CHANGELOG.md', 'legacy header format<a name="1.0.0">\n', 'utf-8')
 
         commit('feat: first commit')
-        let result = execCli('--patch')
+        const result = execCli('--patch')
         result.code.should.equal(0)
         shell.exec('git log --oneline -n1').should.match(/delivers #222/)
       })
@@ -525,11 +525,11 @@
     })
 
     describe('release-types', function () {
-      let regularTypes = ['major', 'minor', 'patch']
+      const regularTypes = ['major', 'minor', 'patch']
 
       regularTypes.forEach(function (type) {
         it('creates a ' + type + ' release', function () {
-          let originVer = '1.0.0'
+          const originVer = '1.0.0'
           writePackageJson(originVer)
           fs.writeFileSync('CHANGELOG.md', 'legacy header format<a name="1.0.0">\n', 'utf-8')
 
@@ -537,7 +537,7 @@
 
           return execCliAsync('--release-as ' + type)
             .then(function () {
-              let version = {
+              const version = {
                 major: semver.major(originVer),
                 minor: semver.minor(originVer),
                 patch: semver.patch(originVer)
@@ -553,7 +553,7 @@
       // this is for pre-releases
       regularTypes.forEach(function (type) {
         it('creates a pre' + type + ' release', function () {
-          let originVer = '1.0.0'
+          const originVer = '1.0.0'
           writePackageJson(originVer)
           fs.writeFileSync('CHANGELOG.md', 'legacy header format<a name="1.0.0">\n', 'utf-8')
 
@@ -561,7 +561,7 @@
 
           return execCliAsync('--release-as ' + type + ' --prerelease ' + type)
             .then(function () {
-              let version = {
+              const version = {
                 major: semver.major(originVer),
                 minor: semver.minor(originVer),
                 patch: semver.patch(originVer)
@@ -577,7 +577,7 @@
 
     describe('release-as-exact', function () {
       it('releases as v100.0.0', function () {
-        let originVer = '1.0.0'
+        const originVer = '1.0.0'
         writePackageJson(originVer)
         fs.writeFileSync('CHANGELOG.md', 'legacy header format<a name="1.0.0">\n', 'utf-8')
 
@@ -590,7 +590,7 @@
       })
 
       it('releases as 200.0.0-amazing', function () {
-        let originVer = '1.0.0'
+        const originVer = '1.0.0'
         writePackageJson(originVer)
         fs.writeFileSync('CHANGELOG.md', 'legacy header format<a name="1.0.0">\n', 'utf-8')
 
@@ -656,7 +656,7 @@
 
     execCli().code.should.equal(0)
 
-    let content = fs.readFileSync('CHANGELOG.md', 'utf-8')
+    const content = fs.readFileSync('CHANGELOG.md', 'utf-8')
     content.should.match(/this is my fairly long commit message which is testing whether or not we allow for long commit messages/)
   })
 
@@ -676,45 +676,45 @@
   it('appends line feed at end of package.json', function () {
     execCli().code.should.equal(0)
 
-    let pkgJson = fs.readFileSync('package.json', 'utf-8')
+    const pkgJson = fs.readFileSync('package.json', 'utf-8')
     pkgJson.should.equal(['{', '  "version": "1.0.1"', '}', ''].join('\n'))
   })
 
   it('preserves indentation of tabs in package.json', function () {
-    let indentation = '\t'
-    let newPkgJson = ['{', indentation + '"version": "1.0.0"', '}', ''].join('\n')
+    const indentation = '\t'
+    const newPkgJson = ['{', indentation + '"version": "1.0.0"', '}', ''].join('\n')
     fs.writeFileSync('package.json', newPkgJson, 'utf-8')
 
     execCli().code.should.equal(0)
-    let pkgJson = fs.readFileSync('package.json', 'utf-8')
+    const pkgJson = fs.readFileSync('package.json', 'utf-8')
     pkgJson.should.equal(['{', indentation + '"version": "1.0.1"', '}', ''].join('\n'))
   })
 
   it('preserves indentation of spaces in package.json', function () {
-    let indentation = '     '
-    let newPkgJson = ['{', indentation + '"version": "1.0.0"', '}', ''].join('\n')
+    const indentation = '     '
+    const newPkgJson = ['{', indentation + '"version": "1.0.0"', '}', ''].join('\n')
     fs.writeFileSync('package.json', newPkgJson, 'utf-8')
 
     execCli().code.should.equal(0)
-    let pkgJson = fs.readFileSync('package.json', 'utf-8')
+    const pkgJson = fs.readFileSync('package.json', 'utf-8')
     pkgJson.should.equal(['{', indentation + '"version": "1.0.1"', '}', ''].join('\n'))
   })
 
   it('preserves line feed in package.json', function () {
-    let newPkgJson = ['{', '  "version": "1.0.0"', '}', ''].join('\n')
+    const newPkgJson = ['{', '  "version": "1.0.0"', '}', ''].join('\n')
     fs.writeFileSync('package.json', newPkgJson, 'utf-8')
 
     execCli().code.should.equal(0)
-    let pkgJson = fs.readFileSync('package.json', 'utf-8')
+    const pkgJson = fs.readFileSync('package.json', 'utf-8')
     pkgJson.should.equal(['{', '  "version": "1.0.1"', '}', ''].join('\n'))
   })
 
   it('preserves carriage return + line feed in package.json', function () {
-    let newPkgJson = ['{', '  "version": "1.0.0"', '}', ''].join('\r\n')
+    const newPkgJson = ['{', '  "version": "1.0.0"', '}', ''].join('\r\n')
     fs.writeFileSync('package.json', newPkgJson, 'utf-8')
 
     execCli().code.should.equal(0)
-    let pkgJson = fs.readFileSync('package.json', 'utf-8')
+    const pkgJson = fs.readFileSync('package.json', 'utf-8')
     pkgJson.should.equal(['{', '  "version": "1.0.1"', '}', ''].join('\r\n'))
   })
 
@@ -728,7 +728,7 @@
   })
 
   it('does not print output when the --silent flag is passed', function () {
-    let result = execCli('--silent')
+    const result = execCli('--silent')
     result.code.should.equal(0)
     result.stdout.should.equal('')
     result.stderr.should.equal('')
@@ -737,7 +737,7 @@
   it('does not display `npm publish` if the package is private', function () {
     writePackageJson('1.0.0', { private: true })
 
-    let result = execCli()
+    const result = execCli()
     result.code.should.equal(0)
     result.stdout.should.not.match(/npm publish/)
   })
@@ -755,7 +755,7 @@
   })
 
   it('includes merge commits', function () {
-    let branchName = 'new-feature'
+    const branchName = 'new-feature'
     commit('feat: first commit')
     shell.exec('git tag -a v1.0.0 -m "my awesome first release"')
     branch(branchName)
@@ -766,10 +766,10 @@
 
     execCli().code.should.equal(0)
 
-    let content = fs.readFileSync('CHANGELOG.md', 'utf-8')
+    const content = fs.readFileSync('CHANGELOG.md', 'utf-8')
     content.should.match(/new feature from branch/)
 
-    let pkgJson = fs.readFileSync('package.json', 'utf-8')
+    const pkgJson = fs.readFileSync('package.json', 'utf-8')
     pkgJson.should.equal(['{', '  "version": "1.1.0"', '}', ''].join('\n'))
   })
 
@@ -781,7 +781,7 @@
     })
 
     commit('feat: first commit')
-    let result = execCli()
+    const result = execCli()
     result.code.should.equal(1)
     result.stderr.should.match(/scripts must be an object/)
   })
@@ -794,7 +794,7 @@
     })
 
     commit('feat: first commit')
-    let result = execCli()
+    const result = execCli()
     result.code.should.equal(1)
     result.stderr.should.match(/skip must be an object/)
   })
@@ -834,7 +834,7 @@
     beforeEach(function () {
       mockery.enable({ warnOnUnregistered: false, useCleanCache: true })
       mockery.registerMock('conventional-changelog', function () {
-        let readable = new stream.Readable({ objectMode: true })
+        const readable = new stream.Readable({ objectMode: true })
         readable._read = function () {
         }
         setImmediate(readable.emit.bind(readable), 'error', new Error('changelog err'))
@@ -973,7 +973,7 @@
 
   describe('skip', () => {
     it('allows bump and changelog generation to be skipped', function () {
-      let changelogContent = 'legacy header format<a name="1.0.0">\n'
+      const changelogContent = 'legacy header format<a name="1.0.0">\n'
       writePackageJson('1.0.0')
       fs.writeFileSync('CHANGELOG.md', changelogContent, 'utf-8')
 
@@ -981,13 +981,13 @@
       return execCliAsync('--skip.bump true --skip.changelog true')
         .then(function () {
           getPackageVersion().should.equal('1.0.0')
-          let content = fs.readFileSync('CHANGELOG.md', 'utf-8')
+          const content = fs.readFileSync('CHANGELOG.md', 'utf-8')
           content.should.equal(changelogContent)
         })
     })
 
     it('allows the commit phase to be skipped', function () {
-      let changelogContent = 'legacy header format<a name="1.0.0">\n'
+      const changelogContent = 'legacy header format<a name="1.0.0">\n'
       writePackageJson('1.0.0')
       fs.writeFileSync('CHANGELOG.md', changelogContent, 'utf-8')
 
@@ -995,7 +995,7 @@
       return execCliAsync('--skip.commit true')
         .then(function () {
           getPackageVersion().should.equal('1.1.0')
-          let content = fs.readFileSync('CHANGELOG.md', 'utf-8')
+          const content = fs.readFileSync('CHANGELOG.md', 'utf-8')
           content.should.match(/new feature from branch/)
           // check last commit message
           shell.exec('git log --oneline -n1').stdout.should.match(/feat: new feature from branch/)
@@ -1099,6 +1099,54 @@
       content.should.include('http://www.foo.com/1')
     })
 
+    it('evaluates a config-function from .versionrc.js', function () {
+      // write configuration that overrides default issue
+      // URL format.
+      fs.writeFileSync(
+        '.versionrc.js',
+        `module.exports = function() {
+          return {
+            issueUrlFormat: 'http://www.versionrc.js/function/{{id}}'
+          }
+        }`,
+        'utf-8'
+      )
+      commit('feat: another commit addresses issue #1')
+      execCli()
+      // CHANGELOG should have the new issue URL format.
+      const content = fs.readFileSync('CHANGELOG.md', 'utf-8')
+      content.should.include('http://www.versionrc.js/function/1')
+    })
+
+    it('evaluates a config-object from .versionrc.js', function () {
+      // write configuration that overrides default issue
+      // URL format.
+      fs.writeFileSync(
+        '.versionrc.js',
+        `module.exports = {
+          issueUrlFormat: 'http://www.versionrc.js/object/{{id}}'
+        }`,
+        'utf-8'
+      )
+      commit('feat: another commit addresses issue #1')
+      execCli()
+      // CHANGELOG should have the new issue URL format.
+      const content = fs.readFileSync('CHANGELOG.md', 'utf-8')
+      content.should.include('http://www.versionrc.js/object/1')
+    })
+
+    it('throws an error when a non-object is returned from .versionrc.js', function () {
+      // write configuration that overrides default issue
+      // URL format.
+      fs.writeFileSync(
+        '.versionrc.js',
+        'module.exports = 3',
+        'utf-8'
+      )
+      commit('feat: another commit addresses issue #1')
+      execCli().code.should.equal(1)
+    })
+
     it('.versionrc : releaseCommitMessageFormat', function () {
       // write configuration that overrides default issue
       // URL format.
@@ -1116,6 +1164,27 @@
       shell.exec('git log --oneline -n1').should.include('1.1.0 is the version.')
     })
 
+    it('.versionrc : issuePrefixes', function () {
+      // write configuration that overrides default issuePrefixes
+      // and reference prefix in issue URL format.
+      fs.writeFileSync('.versionrc', JSON.stringify({
+        issueUrlFormat: 'http://www.foo.com/{{prefix}}{{id}}',
+        issuePrefixes: ['ABC-']
+      }), 'utf-8')
+      commit('feat: another commit addresses issue ABC-1')
+      execCli()
+      // CHANGELOG should have the new issue URL format.
+      const content = fs.readFileSync('CHANGELOG.md', 'utf-8')
+      content.should.include('http://www.foo.com/ABC-1')
+    })
+
+    it('--issuePrefixes and --issueUrlFormat', function () {
+      commit('feat: another commit addresses issue ABC-1')
+      execCli('--issuePrefixes="ABC-" --issueUrlFormat="http://www.foo.com/{{prefix}}{{id}}"')
+      const content = fs.readFileSync('CHANGELOG.md', 'utf-8')
+      content.should.include('http://www.foo.com/ABC-1')
+    })
+
     it('[LEGACY] supports --message (and single %s replacement)', function () {
       commit('feat: another commit addresses issue #1')
       execCli('--message="V:%s"')

=====================================================================
start time: Sun May 05 00:00:00 CST 2019
end time: Tue Jul 30 00:00:00 CST 2019
### âš  BREAKING CHANGES* we were accepting .version.json as a config file, rather than .versionrc.json### Bug Fixes* **bump:** transmit tag prefix argument to conventionalRecommendedBump ([#393](https://github.com/conventional-changelog/standard-version/issues/393)) ([8205222](https://github.com/conventional-changelog/standard-version/commit/8205222))* **cli:** display only one, correct default for --preset flag ([#377](https://github.com/conventional-changelog/standard-version/issues/377)) ([d17fc81](https://github.com/conventional-changelog/standard-version/commit/d17fc81))* **commit:** don't try to process and add changelog if skipped ([#318](https://github.com/conventional-changelog/standard-version/issues/318)) ([3e4fdec](https://github.com/conventional-changelog/standard-version/commit/3e4fdec))* **deps:** update dependency conventional-changelog-config-spec to v2 ([#352](https://github.com/conventional-changelog/standard-version/issues/352)) ([f586844](https://github.com/conventional-changelog/standard-version/commit/f586844))* **deps:** update dependency conventional-recommended-bump to v6 ([#417](https://github.com/conventional-changelog/standard-version/issues/417)) ([4c5cad1](https://github.com/conventional-changelog/standard-version/commit/4c5cad1))* **deps:** update dependency find-up to v4 ([#355](https://github.com/conventional-changelog/standard-version/issues/355)) ([73b35f8](https://github.com/conventional-changelog/standard-version/commit/73b35f8))* **deps:** update dependency find-up to v4.1.0 ([#383](https://github.com/conventional-changelog/standard-version/issues/383)) ([b621a4a](https://github.com/conventional-changelog/standard-version/commit/b621a4a))* **deps:** update dependency git-semver-tags to v3 ([#418](https://github.com/conventional-changelog/standard-version/issues/418)) ([1ce3f4a](https://github.com/conventional-changelog/standard-version/commit/1ce3f4a))* **deps:** update dependency semver to v6.3.0 ([#366](https://github.com/conventional-changelog/standard-version/issues/366)) ([cd866c7](https://github.com/conventional-changelog/standard-version/commit/cd866c7))* **deps:** update dependency yargs to v13.3.0 ([#401](https://github.com/conventional-changelog/standard-version/issues/401)) ([3d0e8c7](https://github.com/conventional-changelog/standard-version/commit/3d0e8c7))* adds support for `releaseCommitMessageFormat` ([#351](https://github.com/conventional-changelog/standard-version/issues/351)) ([a7133cc](https://github.com/conventional-changelog/standard-version/commit/a7133cc))* stop suggesting npm publish if package.json was not updated ([#319](https://github.com/conventional-changelog/standard-version/issues/319)) ([a5ac845](https://github.com/conventional-changelog/standard-version/commit/a5ac845))* Updates package.json to _actual_ supported (tested) NodeJS versions. ([#379](https://github.com/conventional-changelog/standard-version/issues/379)) ([15eec8a](https://github.com/conventional-changelog/standard-version/commit/15eec8a))* **deps:** update dependency yargs to v13.2.4 ([#356](https://github.com/conventional-changelog/standard-version/issues/356)) ([00b2ce6](https://github.com/conventional-changelog/standard-version/commit/00b2ce6))* update config file name in command based on README.md ([#357](https://github.com/conventional-changelog/standard-version/issues/357)) ([ce44dd2](https://github.com/conventional-changelog/standard-version/commit/ce44dd2))
diff --git a/.travis.yml b/.travis.yml
index 5960012..64f2049 100644
--- a/.travis.yml
+++ b/.travis.yml
@@ -1,8 +1,11 @@
 language: node_js
+os:
+  - linux
+  - windows
 node_js:
-  - "6"
+  - "8"
   - "10"
-  - "stable"
+  - "node"
 before_script:
   - git config --global user.name 'Travis-CI'
   - git config --global user.email 'dummy@example.org'
diff --git a/.versionrc b/.versionrc
new file mode 100644
index 0000000..2f185cd
--- /dev/null
+++ b/.versionrc
@@ -0,0 +1,10 @@
+{
+  "types": [
+    {"type":"feat","section":"Features"},
+    {"type":"fix","section":"Bug Fixes"},
+    {"type":"test","section":"Tests", "hidden": true},
+    {"type":"build","section":"Build System", "hidden": true},
+    {"type":"ci","hidden":true}
+  ]
+}
+
diff --git a/CHANGELOG.md b/CHANGELOG.md
index eeaeacd..2d8e9f2 100644
--- a/CHANGELOG.md
+++ b/CHANGELOG.md
@@ -1,7 +1,59 @@
-# Change Log
+# Changelog
 
 All notable changes to this project will be documented in this file. See [standard-version](https://github.com/conventional-changelog/standard-version) for commit guidelines.
 
+### [6.0.1](https://github.com/conventional-changelog/standard-version/compare/v6.0.0...v6.0.1) (2019-05-05)
+
+
+### Bug Fixes
+
+* don't pass args to git rev-parse ([1ac72f7](https://github.com/conventional-changelog/standard-version/commit/1ac72f7))
+
+
+
+## [6.0.0](https://github.com/conventional-changelog/standard-version/compare/v5.0.2...v6.0.0) (2019-05-05)
+
+
+### Bug Fixes
+
+* always pass version to changelog context ([#327](https://github.com/conventional-changelog/standard-version/issues/327)) ([00e3381](https://github.com/conventional-changelog/standard-version/commit/00e3381))
+* **deps:** update dependency detect-indent to v6 ([#341](https://github.com/conventional-changelog/standard-version/issues/341)) ([234d9dd](https://github.com/conventional-changelog/standard-version/commit/234d9dd))
+* **deps:** update dependency detect-newline to v3 ([#342](https://github.com/conventional-changelog/standard-version/issues/342)) ([02a6093](https://github.com/conventional-changelog/standard-version/commit/02a6093))
+* **deps:** update dependency figures to v3 ([#343](https://github.com/conventional-changelog/standard-version/issues/343)) ([7208ded](https://github.com/conventional-changelog/standard-version/commit/7208ded))
+* **deps:** update dependency semver to v6 ([#344](https://github.com/conventional-changelog/standard-version/issues/344)) ([c40487a](https://github.com/conventional-changelog/standard-version/commit/c40487a))
+* **deps:** update dependency yargs to v13 ([#345](https://github.com/conventional-changelog/standard-version/issues/345)) ([b2c8e59](https://github.com/conventional-changelog/standard-version/commit/b2c8e59))
+* prevent duplicate headers from being added ([#305](https://github.com/conventional-changelog/standard-version/issues/305)) ([#307](https://github.com/conventional-changelog/standard-version/issues/307)) ([db2c6e5](https://github.com/conventional-changelog/standard-version/commit/db2c6e5))
+
+
+### Build System
+
+* add renovate.json ([#273](https://github.com/conventional-changelog/standard-version/issues/273)) ([bf41474](https://github.com/conventional-changelog/standard-version/commit/bf41474))
+* drop Node 6 from testing matrix ([#346](https://github.com/conventional-changelog/standard-version/issues/346)) ([6718428](https://github.com/conventional-changelog/standard-version/commit/6718428))
+
+
+### Features
+
+* adds configurable conventionalcommits preset ([#323](https://github.com/conventional-changelog/standard-version/issues/323)) ([4fcd4a7](https://github.com/conventional-changelog/standard-version/commit/4fcd4a7))
+* allow a user to provide a custom changelog header ([#335](https://github.com/conventional-changelog/standard-version/issues/335)) ([1c51064](https://github.com/conventional-changelog/standard-version/commit/1c51064))
+* bump minor rather than major, if release is < 1.0.0 ([#347](https://github.com/conventional-changelog/standard-version/issues/347)) ([5d972cf](https://github.com/conventional-changelog/standard-version/commit/5d972cf))
+* suggest branch name other than master ([#331](https://github.com/conventional-changelog/standard-version/issues/331)) ([304b49a](https://github.com/conventional-changelog/standard-version/commit/304b49a))
+* update commit msg for when using commitAll ([#320](https://github.com/conventional-changelog/standard-version/issues/320)) ([74a040a](https://github.com/conventional-changelog/standard-version/commit/74a040a))
+
+
+### Tests
+
+* disable gpg signing in temporary test repositories. ([#311](https://github.com/conventional-changelog/standard-version/issues/311)) ([bd0fcdf](https://github.com/conventional-changelog/standard-version/commit/bd0fcdf))
+* use const based on new eslint rules ([#329](https://github.com/conventional-changelog/standard-version/issues/329)) ([b6d3d13](https://github.com/conventional-changelog/standard-version/commit/b6d3d13))
+
+
+### BREAKING CHANGES
+
+* we now bump the minor rather than major if version < 1.0.0; --release-as can be used to bump to 1.0.0.
+* tests are no longer run for Node 6
+* we now use the conventionalcommits preset by default, which directly tracks conventionalcommits.org.
+
+
+
 ## [5.0.2](https://github.com/conventional-changelog/standard-version/compare/v5.0.1...v5.0.2) (2019-03-16)
 
 
diff --git a/README.md b/README.md
index 6d6b7d3..a349585 100644
--- a/README.md
+++ b/README.md
@@ -74,7 +74,7 @@
 1. Creating a `.versionrc` or `.versionrc.json`.
 
 Any of the command line paramters accepted by `standard-version` can instead
-be provided via configuration.
+be provided via configuration. Please refer to the [conventional-changelog-config-spec](https://github.com/conventional-changelog/conventional-changelog-config-spec/) for details on available configuration options.
 
 ### Customizing CHANGELOG Generation
 
@@ -100,6 +100,8 @@
 
 ## CLI Usage
 
+> **NOTE:** To pass nested configurations to the CLI without defining them in the `package.json` use dot notation as the parameters `e.g. --skip.changelog`.
+
 ### First Release
 
 To generate your changelog for your first release, simply do:
@@ -265,7 +267,7 @@
 
 ### Prefix Tags
 
-If you would like to prefix your tags with something, you can do so with the `-t` flag.
+Tags are prefixed with `v` by default. If you would like to prefix your tags with something else, you can do so with the `-t` flag.
 
 ```sh
 standard-version -t @scope/package\@
@@ -273,6 +275,8 @@
 
 This will prefix your tags to look something like `@scope/package@2.0.0`
 
+If you do not want to have any tag prefix you can use the `-t` flag without value.
+
 ### CLI Help
 
 ```sh
diff --git a/appveyor.yml b/appveyor.yml
deleted file mode 100644
index 3b190c9..0000000
--- a/appveyor.yml
+++ /dev/null
@@ -1,19 +0,0 @@
-environment:
-  matrix:
-    - nodejs_version: '10'
-install:
-  - ps: Install-Product node $env:nodejs_version
-  - git config --global user.name 'Appveyor'
-  - git config --global user.email 'dummy@example.org'
-  - set CI=true
-  - npm -g install npm@latest
-  - set PATH=%APPDATA%\npm;%PATH%
-  - npm install
-matrix:
-  fast_finish: true
-build: off
-version: '{build}'
-test_script:
-  - node --version
-  - npm --version
-  - npm test
diff --git a/command.js b/command.js
index 4ea6c1c..c03ce56 100755
--- a/command.js
+++ b/command.js
@@ -2,9 +2,10 @@
 const defaults = require('./defaults')
 const { readFileSync } = require('fs')
 
-const configPath = findUp.sync(['.versionrc', '.version.json'])
+const configPath = findUp.sync(['.versionrc', '.versionrc.json'])
 const config = configPath ? JSON.parse(readFileSync(configPath)) : {}
 const spec = require('conventional-changelog-config-spec')
+const { START_OF_LAST_RELEASE_PATTERN } = require('./lib/lifecycles/changelog')
 
 const yargs = require('yargs')
   .usage('Usage: $0 [options]')
@@ -25,10 +26,9 @@
     default: defaults.infile
   })
   .option('message', {
-    alias: 'm',
-    describe: 'Commit message, replaces %s with new version',
-    type: 'string',
-    default: defaults.message
+    alias: ['m'],
+    describe: '[DEPRECATED] Commit message, replaces %s with new version.\nThis option will be removed in the next major version, please use --releaseCommitMessageFormat.',
+    type: 'string'
   })
   .option('first-release', {
     alias: 'f',
@@ -87,10 +87,14 @@
     type: 'string',
     describe: 'Only populate commits made under this path'
   })
+  .option('changelogHeader', {
+    type: 'string',
+    describe: 'Use a custom header when generating and updating changelog.'
+  })
   .option('preset', {
     type: 'string',
     default: defaults.preset,
-    describe: 'Commit message guideline preset (default: angular)'
+    describe: 'Commit message guideline preset'
   })
   .check((argv) => {
     if (typeof argv.scripts !== 'object' || Array.isArray(argv.scripts)) {
@@ -108,6 +112,13 @@
   .pkgConf('standard-version')
   .config(config)
   .wrap(97)
+  .check((args) => {
+    if (args.changelogHeader && args.changelogHeader.search(START_OF_LAST_RELEASE_PATTERN) !== -1) {
+      throw Error(`custom changelog header must not match ${START_OF_LAST_RELEASE_PATTERN}`)
+    } else {
+      return true
+    }
+  })
 
 Object.keys(spec.properties).forEach(propertyKey => {
   const property = spec.properties[propertyKey]
@@ -120,6 +131,3 @@
 })
 
 module.exports = yargs
-
-// TODO: yargs should be populated with keys/descriptions from
-// https://github.com/conventional-changelog/conventional-changelog-config-spec
diff --git a/defaults.js b/defaults.js
new file mode 100644
index 0000000..202b8f4
--- /dev/null
+++ b/defaults.js
@@ -0,0 +1,26 @@
+const spec = require('conventional-changelog-config-spec')
+
+const defaults = {
+  infile: 'CHANGELOG.md',
+  firstRelease: false,
+  sign: false,
+  noVerify: false,
+  commitAll: false,
+  silent: false,
+  tagPrefix: 'v',
+  scripts: {},
+  skip: {},
+  dryRun: false,
+  gitTagFallback: true,
+  preset: 'conventionalcommits'
+}
+
+/**
+ * Merge in defaults provided by the spec
+ */
+Object.keys(spec.properties).forEach(propertyKey => {
+  const property = spec.properties[propertyKey]
+  defaults[propertyKey] = property.default
+})
+
+module.exports = defaults
diff --git a/defaults.json b/defaults.json
deleted file mode 100644
index c5bc421..0000000
--- a/defaults.json
+++ /dev/null
@@ -1,15 +0,0 @@
-{
-  "infile": "CHANGELOG.md",
-  "message": "chore(release): %s",
-  "firstRelease": false,
-  "sign": false,
-  "noVerify": false,
-  "commitAll": false,
-  "silent": false,
-  "tagPrefix": "v",
-  "scripts": {},
-  "skip": {},
-  "dryRun": false,
-  "gitTagFallback": true,
-  "preset": "conventionalcommits"
-}
\ No newline at end of file
diff --git a/index.js b/index.js
index 956e1e8..e403398 100755
--- a/index.js
+++ b/index.js
@@ -8,6 +8,22 @@
 const tag = require('./lib/lifecycles/tag')
 
 module.exports = function standardVersion (argv) {
+  /**
+   * `--message` (`-m`) support will be removed in the next major version.
+   */
+  const message = argv.m || argv.message
+  if (message) {
+    /**
+     * The `--message` flag uses `%s` for version substitutions, we swap this
+     * for the substitution defined in the config-spec for future-proofing upstream
+     * handling.
+     */
+    argv.releaseCommitMessageFormat = message.replace(/%s/g, '{{currentTag}}')
+    if (!argv.silent) {
+      console.warn('[standard-version]: --message (-m) will be removed in the next major release. Use --releaseCommitMessageFormat.')
+    }
+  }
+
   let pkg
   bump.pkgFiles.forEach((filename) => {
     if (pkg) return
diff --git a/lib/format-commit-message.js b/lib/format-commit-message.js
index b79ad2e..a597b51 100644
--- a/lib/format-commit-message.js
+++ b/lib/format-commit-message.js
@@ -1,10 +1,4 @@
-const util = require('util')
-
 module.exports = function (rawMsg, newVersion) {
   const message = String(rawMsg)
-  const matchCount = (message.match(/%s/g) || []).length
-  const args = Array(1 + matchCount)
-  args[0] = message
-  args.fill(newVersion, 1, args.length)
-  return util.format.apply(util, args)
+  return message.replace(/{{currentTag}}/g, newVersion)
 }
diff --git a/lib/lifecycles/bump.js b/lib/lifecycles/bump.js
index 0fd0a1a..a2a5335 100644
--- a/lib/lifecycles/bump.js
+++ b/lib/lifecycles/bump.js
@@ -28,7 +28,7 @@
     .then(runLifecycleScript.bind(this, args, 'prebump'))
     .then((stdout) => {
       if (stdout && stdout.trim().length) args.releaseAs = stdout.trim()
-      return bumpVersion(args.releaseAs, args)
+      return bumpVersion(args.releaseAs, version, args)
     })
     .then((release) => {
       if (!args.firstRelease) {
@@ -129,17 +129,22 @@
   return TypeList.indexOf(type)
 }
 
-function bumpVersion (releaseAs, args) {
+function bumpVersion (releaseAs, currentVersion, args) {
   return new Promise((resolve, reject) => {
     if (releaseAs) {
       return resolve({
         releaseType: releaseAs
       })
     } else {
+      const presetOptions = presetLoader(args)
+      if (typeof presetOptions === 'object') {
+        if (semver.lt(currentVersion, '1.0.0')) presetOptions.preMajor = true
+      }
       conventionalRecommendedBump({
         debug: args.verbose && console.info.bind(console, 'conventional-recommended-bump'),
-        preset: presetLoader(args),
-        path: args.path
+        preset: presetOptions,
+        path: args.path,
+        tagPrefix: args.tagPrefix
       }, function (err, release) {
         if (err) return reject(err)
         else return resolve(release)
@@ -158,10 +163,8 @@
  */
 function updateConfigs (args, newVersion) {
   const dotgit = DotGitignore()
-  Bump.pkgFiles.concat(Bump.lockFiles).forEach((filename) => {
-    configsToUpdate[path.resolve(process.cwd(), filename)] = false
-  })
-  Object.keys(configsToUpdate).forEach(function (configPath) {
+  Bump.pkgFiles.concat(Bump.lockFiles).forEach(function (filename) {
+    let configPath = path.resolve(process.cwd(), filename)
     try {
       if (dotgit.ignore(configPath)) return
       let stat = fs.lstatSync(configPath)
@@ -170,13 +173,12 @@
         let indent = detectIndent(data).indent
         let newline = detectNewline(data)
         let config = JSON.parse(data)
-        let filename = path.basename(configPath)
         checkpoint(args, 'bumping version in ' + filename + ' from %s to %s', [config.version, newVersion])
         config.version = newVersion
         writeFile(args, configPath, stringifyPackage(config, indent, newline))
         // flag any config files that we modify the version # for
         // as having been updated.
-        configsToUpdate[configPath] = true
+        configsToUpdate[filename] = true
       }
     } catch (err) {
       if (err.code !== 'ENOENT') console.warn(err.message)
diff --git a/lib/lifecycles/changelog.js b/lib/lifecycles/changelog.js
index f32eabd..689ed38 100644
--- a/lib/lifecycles/changelog.js
+++ b/lib/lifecycles/changelog.js
@@ -6,8 +6,9 @@
 const presetLoader = require('../preset-loader')
 const runLifecycleScript = require('../run-lifecycle-script')
 const writeFile = require('../write-file')
+const START_OF_LAST_RELEASE_PATTERN = /(^#+ \[?[0-9]+\.[0-9]+\.[0-9]+|<a name=)/m
 
-module.exports = function (args, newVersion) {
+function Changelog (args, newVersion) {
   if (args.skip.changelog) return Promise.resolve()
   return runLifecycleScript(args, 'prechangelog')
     .then(() => {
@@ -18,19 +19,23 @@
     })
 }
 
+Changelog.START_OF_LAST_RELEASE_PATTERN = START_OF_LAST_RELEASE_PATTERN
+
+module.exports = Changelog
+
 function outputChangelog (args, newVersion) {
   return new Promise((resolve, reject) => {
     createIfMissing(args)
-    let header = '# Change Log\n\nAll notable changes to this project will be documented in this file. See [standard-version](https://github.com/conventional-changelog/standard-version) for commit guidelines.\n'
+    const header = args.changelogHeader || '# Changelog\n\nAll notable changes to this project will be documented in this file. See [standard-version](https://github.com/conventional-changelog/standard-version) for commit guidelines.\n'
+
     let oldContent = args.dryRun ? '' : fs.readFileSync(args.infile, 'utf-8')
+    let oldContentStart = oldContent.search(START_OF_LAST_RELEASE_PATTERN)
     // find the position of the last release and remove header:
-    const changelogSectionRegExp = /<a name=|##? \[?[0-9]+\.[0-9]+\.[0-9]+\]?/
-    if (oldContent.search(changelogSectionRegExp) !== -1) {
-      oldContent = oldContent.substring(oldContent.search(changelogSectionRegExp))
+    if (oldContentStart !== -1) {
+      oldContent = oldContent.substring(oldContentStart)
     }
     let content = ''
-    let context
-    if (args.dryRun) context = { version: newVersion }
+    const context = { version: newVersion }
     let changelogStream = conventionalChangelog({
       debug: args.verbose && console.info.bind(console, 'conventional-changelog'),
       preset: presetLoader(args),
diff --git a/lib/lifecycles/commit.js b/lib/lifecycles/commit.js
index 7c7aa6a..4ec0006 100644
--- a/lib/lifecycles/commit.js
+++ b/lib/lifecycles/commit.js
@@ -9,7 +9,7 @@
   if (args.skip.commit) return Promise.resolve()
   return runLifecycleScript(args, 'precommit')
     .then((message) => {
-      if (message && message.length) args.message = message
+      if (message && message.length) args.releaseCommitMessageFormat = message
       return execCommit(args, newVersion)
     })
     .then(() => {
@@ -19,16 +19,25 @@
 
 function execCommit (args, newVersion) {
   let msg = 'committing %s'
-  let paths = [args.infile]
+  let paths = []
   let verify = args.verify === false || args.n ? '--no-verify ' : ''
   let toAdd = ''
+
+  // only start with a pre-populated paths list when CHANGELOG processing is not skipped
+  if (!args.skip.changelog) {
+    paths = [args.infile]
+    toAdd += ' ' + args.infile
+  }
+
   // commit any of the config files that we've updated
   // the version # for.
   Object.keys(bump.getUpdatedConfigs()).forEach(function (p) {
-    if (bump.getUpdatedConfigs()[p]) {
+    paths.unshift(p)
+    toAdd += ' ' + path.relative(process.cwd(), p)
+
+    // account for multiple files in the output message
+    if (paths.length > 1) {
       msg += ' and %s'
-      paths.unshift(path.basename(p))
-      toAdd += ' ' + path.relative(process.cwd(), p)
     }
   })
 
@@ -38,8 +47,14 @@
   }
 
   checkpoint(args, msg, paths)
-  return runExec(args, 'git add' + toAdd + ' ' + args.infile)
+
+  // nothing to do, exit without commit anything
+  if (args.skip.changelog && args.skip.bump && toAdd.length === 0) {
+    return Promise.resolve()
+  }
+
+  return runExec(args, 'git add' + toAdd)
     .then(() => {
-      return runExec(args, 'git commit ' + verify + (args.sign ? '-S ' : '') + (args.commitAll ? '' : (args.infile + toAdd)) + ' -m "' + formatCommitMessage(args.message, newVersion) + '"')
+      return runExec(args, 'git commit ' + verify + (args.sign ? '-S ' : '') + (args.commitAll ? '' : (toAdd)) + ' -m "' + formatCommitMessage(args.releaseCommitMessageFormat, newVersion) + '"')
     })
 }
diff --git a/lib/lifecycles/tag.js b/lib/lifecycles/tag.js
index a7b4019..f6a2108 100644
--- a/lib/lifecycles/tag.js
+++ b/lib/lifecycles/tag.js
@@ -1,3 +1,4 @@
+const bump = require('../lifecycles/bump')
 const chalk = require('chalk')
 const checkpoint = require('../checkpoint')
 const figures = require('figures')
@@ -24,10 +25,11 @@
     tagOption = '-a '
   }
   checkpoint(args, 'tagging release %s%s', [args.tagPrefix, newVersion])
-  return runExec(args, 'git tag ' + tagOption + args.tagPrefix + newVersion + ' -m "' + formatCommitMessage(args.message, newVersion) + '"')
-    .then(() => {
-      let message = 'git push --follow-tags origin master'
-      if (pkgPrivate !== true) {
+  return runExec(args, 'git tag ' + tagOption + args.tagPrefix + newVersion + ' -m "' + formatCommitMessage(args.releaseCommitMessageFormat, newVersion) + '"')
+    .then(() => runExec('', 'git rev-parse --abbrev-ref HEAD'))
+    .then((currentBranch) => {
+      let message = 'git push --follow-tags origin ' + currentBranch.trim()
+      if (pkgPrivate !== true && bump.getUpdatedConfigs()['package.json']) {
         message += ' && npm publish'
         if (args.prerelease !== undefined) {
           if (args.prerelease === '') {
diff --git a/package.json b/package.json
index 5bdcca0..74e7624 100644
--- a/package.json
+++ b/package.json
@@ -1,12 +1,12 @@
 {
   "name": "standard-version",
-  "version": "5.0.2",
+  "version": "6.0.1",
   "description": "replacement for `npm version` with automatic CHANGELOG generation",
   "bin": "bin/cli.js",
   "scripts": {
     "posttest": "eslint .",
     "coverage": "nyc report --reporter=text-lcov | coveralls",
-    "test": "nyc mocha --timeout=20000 test.js",
+    "test": "nyc mocha --timeout=30000 test.js",
     "release": "bin/cli.js"
   },
   "nyc": {
@@ -19,7 +19,7 @@
     "url": "git+https://github.com/conventional-changelog/standard-version.git"
   },
   "engines": {
-    "node": ">=4.0"
+    "node": ">=8.0"
   },
   "keywords": [
     "conventional-changelog",
@@ -38,34 +38,34 @@
   },
   "homepage": "https://github.com/conventional-changelog/standard-version#readme",
   "dependencies": {
-    "chalk": "^2.4.1",
-    "conventional-changelog": "^3.1.2",
-    "conventional-changelog-config-spec": "^1.0.0",
-    "conventional-recommended-bump": "^4.1.1",
-    "detect-indent": "^5.0.0",
-    "detect-newline": "^2.1.0",
-    "dotgitignore": "^2.1.0",
-    "figures": "^2.0.0",
-    "find-up": "^3.0.0",
-    "fs-access": "^1.0.0",
-    "git-semver-tags": "^2.0.2",
-    "semver": "^5.2.0",
-    "stringify-package": "^1.0.0",
-    "yargs": "^12.0.2"
+    "chalk": "2.4.2",
+    "conventional-changelog": "3.1.9",
+    "conventional-changelog-config-spec": "2.0.0",
+    "conventional-recommended-bump": "5.0.0",
+    "detect-indent": "6.0.0",
+    "detect-newline": "3.0.0",
+    "dotgitignore": "2.1.0",
+    "figures": "3.0.0",
+    "find-up": "4.1.0",
+    "fs-access": "1.0.1",
+    "git-semver-tags": "2.0.2",
+    "semver": "6.0.0",
+    "stringify-package": "1.0.0",
+    "yargs": "13.3.0"
   },
   "devDependencies": {
-    "chai": "^3.5.0",
-    "coveralls": "^3.0.3",
-    "eslint": "^5.16.0",
-    "eslint-config-standard": "^12.0.0",
-    "eslint-plugin-import": "^2.16.0",
-    "eslint-plugin-node": "^8.0.1",
-    "eslint-plugin-promise": "^4.0.1",
-    "eslint-plugin-standard": "^4.0.0",
-    "mocha": "^5.2.0",
-    "mock-git": "^1.0.3",
-    "mockery": "^2.0.0",
-    "nyc": "^13.3.0",
-    "shelljs": "^0.7.8"
+    "chai": "4.2.0",
+    "coveralls": "3.0.5",
+    "eslint": "6.1.0",
+    "eslint-config-standard": "12.0.0",
+    "eslint-plugin-import": "2.18.2",
+    "eslint-plugin-node": "9.1.0",
+    "eslint-plugin-promise": "4.2.1",
+    "eslint-plugin-standard": "4.0.0",
+    "mocha": "6.2.0",
+    "mock-git": "2.0.0",
+    "mockery": "2.1.0",
+    "nyc": "14.1.1",
+    "shelljs": "0.8.3"
   }
 }
diff --git a/renovate.json b/renovate.json
index 010732b..f45d8f1 100644
--- a/renovate.json
+++ b/renovate.json
@@ -1,3 +1,5 @@
 {
-  "enabled": false
+  "extends": [
+    "config:base"
+  ]
 }
diff --git a/test.js b/test.js
index 28d73e2..55a11bd 100644
--- a/test.js
+++ b/test.js
@@ -94,6 +94,7 @@
   shell.mkdir('tmp')
   shell.cd('tmp')
   shell.exec('git init')
+  shell.exec('git config commit.gpgSign false')
   commit('root-commit')
   writePackageJson('1.0.0')
 }
@@ -108,14 +109,14 @@
 }
 
 describe('format-commit-message', function () {
-  it('works for no %s', function () {
+  it('works for no {{currentTag}}', function () {
     formatCommitMessage('chore(release): 1.0.0', '1.0.0').should.equal('chore(release): 1.0.0')
   })
-  it('works for one %s', function () {
-    formatCommitMessage('chore(release): %s', '1.0.0').should.equal('chore(release): 1.0.0')
+  it('works for one {{currentTag}}', function () {
+    formatCommitMessage('chore(release): {{currentTag}}', '1.0.0').should.equal('chore(release): 1.0.0')
   })
-  it('works for two %s', function () {
-    formatCommitMessage('chore(release): %s \n\n* CHANGELOG: https://github.com/conventional-changelog/standard-version/blob/v%s/CHANGELOG.md', '1.0.0').should.equal('chore(release): 1.0.0 \n\n* CHANGELOG: https://github.com/conventional-changelog/standard-version/blob/v1.0.0/CHANGELOG.md')
+  it('works for two {{currentTag}}', function () {
+    formatCommitMessage('chore(release): {{currentTag}} \n\n* CHANGELOG: https://github.com/conventional-changelog/standard-version/blob/v{{currentTag}}/CHANGELOG.md', '1.0.0').should.equal('chore(release): 1.0.0 \n\n* CHANGELOG: https://github.com/conventional-changelog/standard-version/blob/v1.0.0/CHANGELOG.md')
   })
 })
 
@@ -148,10 +149,28 @@
       content.should.match(/first commit/)
       shell.exec('git tag').stdout.should.match(/1\.0\.1/)
     })
+
+    it('skipping changelog will not create a changelog file', function () {
+      writePackageJson('1.0.0')
+
+      commit('feat: first commit')
+      return execCliAsync('--skip.changelog true')
+        .then(function () {
+          getPackageVersion().should.equal('1.1.0')
+          let fileNotFound = false
+          try {
+            fs.readFileSync('CHANGELOG.md', 'utf-8')
+          } catch (err) {
+            fileNotFound = true
+          }
+
+          fileNotFound.should.equal(true)
+        })
+    })
   })
 
   describe('CHANGELOG.md exists', function () {
-    it('appends the new release above the last release, removing the old header', function () {
+    it('appends the new release above the last release, removing the old header (legacy format)', function () {
       fs.writeFileSync('CHANGELOG.md', 'legacy header format<a name="1.0.0">\n', 'utf-8')
 
       commit('feat: first commit')
@@ -164,6 +183,33 @@
       content.should.not.match(/legacy header format/)
     })
 
+    // TODO: we should use snapshots which are easier to update than large
+    // string assertions; we should also consider not using the CLI which
+    // is slower than calling standard-version directly.
+    it('appends the new release above the last release, removing the old header (new format)', function () {
+      // we don't create a package.json, so no {{host}} and {{repo}} tag
+      // will be populated, let's use a compareUrlFormat without these.
+      const cliArgs = '--compareUrlFormat=/compare/{{previousTag}}...{{currentTag}}'
+
+      commit('feat: first commit')
+      shell.exec('git tag -a v1.0.0 -m "my awesome first release"')
+      commit('fix: patch release')
+
+      execCli(cliArgs).code.should.equal(0)
+      let content = fs.readFileSync('CHANGELOG.md', 'utf-8')
+
+      // remove commit hashes and dates to make testing against a static string easier:
+      content = content.replace(/patch release [0-9a-f]{6,8}/g, 'patch release ABCDEFXY').replace(/\([0-9]{4}-[0-9]{2}-[0-9]{2}\)/g, '(YYYY-MM-DD)')
+      content.should.equal('# Changelog\n\nAll notable changes to this project will be documented in this file. See [standard-version](https://github.com/conventional-changelog/standard-version) for commit guidelines.\n\n### [1.0.1](/compare/v1.0.0...v1.0.1) (YYYY-MM-DD)\n\n\n### Bug Fixes\n\n* patch release ABCDEFXY\n')
+
+      commit('fix: another patch release')
+      // we've populated no package.json, so no {{host}} and
+      execCli(cliArgs).code.should.equal(0)
+      content = fs.readFileSync('CHANGELOG.md', 'utf-8')
+      content = content.replace(/patch release [0-9a-f]{6,8}/g, 'patch release ABCDEFXY').replace(/\([0-9]{4}-[0-9]{2}-[0-9]{2}\)/g, '(YYYY-MM-DD)')
+      content.should.equal('# Changelog\n\nAll notable changes to this project will be documented in this file. See [standard-version](https://github.com/conventional-changelog/standard-version) for commit guidelines.\n\n### [1.0.2](/compare/v1.0.1...v1.0.2) (YYYY-MM-DD)\n\n\n### Bug Fixes\n\n* another patch release ABCDEFXY\n\n### [1.0.1](/compare/v1.0.0...v1.0.1) (YYYY-MM-DD)\n\n\n### Bug Fixes\n\n* patch release ABCDEFXY\n')
+    })
+
     it('commits all staged files', function () {
       fs.writeFileSync('CHANGELOG.md', 'legacy header format<a name="1.0.0">\n', 'utf-8')
 
@@ -186,6 +232,20 @@
       content.should.match(/1\.0\.1/)
       content.should.not.match(/legacy header format/)
     })
+
+    it('allows for a custom changelog header', function () {
+      fs.writeFileSync('CHANGELOG.md', '', 'utf-8')
+      commit('feat: first commit')
+      execCli('--changelogHeader="# Pork Chop Log"').code.should.equal(0)
+      let content = fs.readFileSync('CHANGELOG.md', 'utf-8')
+      content.should.match(/# Pork Chop Log/)
+    })
+
+    it('exits with error if changelog header matches last version search regex', function () {
+      fs.writeFileSync('CHANGELOG.md', '', 'utf-8')
+      commit('feat: first commit')
+      execCli('--changelogHeader="## 3.0.2"').code.should.equal(1)
+    })
   })
 
   describe('with mocked git', function () {
@@ -198,8 +258,8 @@
           let captured = shell.cat('gitcapture.log').stdout.split('\n').map(function (line) {
             return line ? JSON.parse(line) : line
           })
-          captured[captured.length - 3].should.deep.equal(['commit', '-S', 'CHANGELOG.md', 'package.json', '-m', 'chore(release): 1.0.1'])
-          captured[captured.length - 2].should.deep.equal(['tag', '-s', 'v1.0.1', '-m', 'chore(release): 1.0.1'])
+          captured[captured.length - 4].should.deep.equal(['commit', '-S', 'CHANGELOG.md', 'package.json', '-m', 'chore(release): 1.0.1'])
+          captured[captured.length - 3].should.deep.equal(['tag', '-s', 'v1.0.1', '-m', 'chore(release): 1.0.1'])
 
           unmock()
         })
@@ -248,7 +308,7 @@
           writePackageJson('1.0.0')
 
           let result = execCli()
-          result.code.should.equal(0)
+          result.code.should.equal(1)
           result.stderr.should.match(/haha, kidding, this is just a warning/)
 
           unmock()
@@ -349,6 +409,21 @@
     })
 
     describe('precommit hook', function () {
+      it('should run the precommit hook when provided via .versionrc.json (#371)', function () {
+        fs.writeFileSync('.versionrc.json', JSON.stringify({
+          'scripts': {
+            'precommit': 'node scripts/precommit'
+          }
+        }), 'utf-8')
+
+        writeHook('precommit')
+        fs.writeFileSync('CHANGELOG.md', 'legacy header format<a name="1.0.0">\n', 'utf-8')
+        commit('feat: first commit')
+        let result = execCli()
+        result.code.should.equal(0)
+        result.stderr.should.match(/precommit ran/)
+      })
+
       it('should run the precommit hook when provided', function () {
         writePackageJson('1.0.0', {
           'standard-version': {
@@ -668,13 +743,13 @@
   })
 
   it('does not display `all staged files` without the --commit-all flag', function () {
-    let result = execCli()
+    const result = execCli()
     result.code.should.equal(0)
     result.stdout.should.not.match(/and all staged files/)
   })
 
   it('does display `all staged files` if the --commit-all flag is passed', function () {
-    let result = execCli('--commit-all')
+    const result = execCli('--commit-all')
     result.code.should.equal(0)
     result.stdout.should.match(/and all staged files/)
   })
@@ -988,21 +1063,17 @@
           output.stdout.should.include('v5.1.0')
         })
     })
+
+    it('does not display `npm publish` if there is no package.json', function () {
+      shell.rm('package.json')
+      const result = execCli()
+      result.code.should.equal(0)
+      result.stdout.should.not.match(/npm publish/)
+    })
   })
 
   describe('configuration', () => {
     it('reads config from .versionrc', function () {
-      // we currently skip several replacments in CHANGELOG
-      // generation if repository URL isn't set.
-      //
-      // TODO: consider modifying this logic in conventional-commits
-      // perhaps we should only skip the replacement if we rely on
-      // the {{host}} field?
-      writePackageJson('1.0.0', {
-        repository: {
-          url: 'https://github.com/yargs/yargs.git'
-        }
-      })
       // write configuration that overrides default issue
       // URL format.
       fs.writeFileSync('.versionrc', JSON.stringify({
@@ -1014,5 +1085,71 @@
       const content = fs.readFileSync('CHANGELOG.md', 'utf-8')
       content.should.include('http://www.foo.com/1')
     })
+
+    it('reads config from .versionrc.json', function () {
+      // write configuration that overrides default issue
+      // URL format.
+      fs.writeFileSync('.versionrc.json', JSON.stringify({
+        issueUrlFormat: 'http://www.foo.com/{{id}}'
+      }), 'utf-8')
+      commit('feat: another commit addresses issue #1')
+      execCli()
+      // CHANGELOG should have the new issue URL format.
+      const content = fs.readFileSync('CHANGELOG.md', 'utf-8')
+      content.should.include('http://www.foo.com/1')
+    })
+
+    it('.versionrc : releaseCommitMessageFormat', function () {
+      // write configuration that overrides default issue
+      // URL format.
+      fs.writeFileSync('.versionrc', JSON.stringify({
+        releaseCommitMessageFormat: 'This commit represents release: {{currentTag}}'
+      }), 'utf-8')
+      commit('feat: another commit addresses issue #1')
+      execCli()
+      shell.exec('git log --oneline -n1').should.include('This commit represents release: 1.1.0')
+    })
+
+    it('--releaseCommitMessageFormat', function () {
+      commit('feat: another commit addresses issue #1')
+      execCli('--releaseCommitMessageFormat="{{currentTag}} is the version."')
+      shell.exec('git log --oneline -n1').should.include('1.1.0 is the version.')
+    })
+
+    it('[LEGACY] supports --message (and single %s replacement)', function () {
+      commit('feat: another commit addresses issue #1')
+      execCli('--message="V:%s"')
+      shell.exec('git log --oneline -n1').should.include('V:1.1.0')
+    })
+
+    it('[LEGACY] supports -m (and multiple %s replacements)', function () {
+      commit('feat: another commit addresses issue #1')
+      execCli('--message="V:%s is the %s."')
+      shell.exec('git log --oneline -n1').should.include('V:1.1.0 is the 1.1.0.')
+    })
+  })
+
+  describe('pre-major', () => {
+    it('bumps the minor rather than major, if version < 1.0.0', function () {
+      writePackageJson('0.5.0', {
+        repository: {
+          url: 'https://github.com/yargs/yargs.git'
+        }
+      })
+      commit('feat!: this is a breaking change')
+      execCli()
+      getPackageVersion().should.equal('0.6.0')
+    })
+
+    it('bumps major if --release-as=major specified, if version < 1.0.0', function () {
+      writePackageJson('0.5.0', {
+        repository: {
+          url: 'https://github.com/yargs/yargs.git'
+        }
+      })
+      commit('feat!: this is a breaking change')
+      execCli('-r major')
+      getPackageVersion().should.equal('1.0.0')
+    })
   })
 })

=====================================================================
start time: Sat Mar 16 00:00:00 CST 2019
end time: Sun May 05 00:00:00 CST 2019
### Bug Fixes* always pass version to changelog context ([#327](https://github.com/conventional-changelog/standard-version/issues/327)) ([00e3381](https://github.com/conventional-changelog/standard-version/commit/00e3381))* **deps:** update dependency detect-indent to v6 ([#341](https://github.com/conventional-changelog/standard-version/issues/341)) ([234d9dd](https://github.com/conventional-changelog/standard-version/commit/234d9dd))* **deps:** update dependency detect-newline to v3 ([#342](https://github.com/conventional-changelog/standard-version/issues/342)) ([02a6093](https://github.com/conventional-changelog/standard-version/commit/02a6093))* **deps:** update dependency figures to v3 ([#343](https://github.com/conventional-changelog/standard-version/issues/343)) ([7208ded](https://github.com/conventional-changelog/standard-version/commit/7208ded))* **deps:** update dependency semver to v6 ([#344](https://github.com/conventional-changelog/standard-version/issues/344)) ([c40487a](https://github.com/conventional-changelog/standard-version/commit/c40487a))* **deps:** update dependency yargs to v13 ([#345](https://github.com/conventional-changelog/standard-version/issues/345)) ([b2c8e59](https://github.com/conventional-changelog/standard-version/commit/b2c8e59))* prevent duplicate headers from being added ([#305](https://github.com/conventional-changelog/standard-version/issues/305)) ([#307](https://github.com/conventional-changelog/standard-version/issues/307)) ([db2c6e5](https://github.com/conventional-changelog/standard-version/commit/db2c6e5))### Build System* add renovate.json ([#273](https://github.com/conventional-changelog/standard-version/issues/273)) ([bf41474](https://github.com/conventional-changelog/standard-version/commit/bf41474))* drop Node 6 from testing matrix ([#346](https://github.com/conventional-changelog/standard-version/issues/346)) ([6718428](https://github.com/conventional-changelog/standard-version/commit/6718428))### Features* adds configurable conventionalcommits preset ([#323](https://github.com/conventional-changelog/standard-version/issues/323)) ([4fcd4a7](https://github.com/conventional-changelog/standard-version/commit/4fcd4a7))* allow a user to provide a custom changelog header ([#335](https://github.com/conventional-changelog/standard-version/issues/335)) ([1c51064](https://github.com/conventional-changelog/standard-version/commit/1c51064))* bump minor rather than major, if release is < 1.0.0 ([#347](https://github.com/conventional-changelog/standard-version/issues/347)) ([5d972cf](https://github.com/conventional-changelog/standard-version/commit/5d972cf))* suggest branch name other than master ([#331](https://github.com/conventional-changelog/standard-version/issues/331)) ([304b49a](https://github.com/conventional-changelog/standard-version/commit/304b49a))* update commit msg for when using commitAll ([#320](https://github.com/conventional-changelog/standard-version/issues/320)) ([74a040a](https://github.com/conventional-changelog/standard-version/commit/74a040a))### Tests* disable gpg signing in temporary test repositories. ([#311](https://github.com/conventional-changelog/standard-version/issues/311)) ([bd0fcdf](https://github.com/conventional-changelog/standard-version/commit/bd0fcdf))* use const based on new eslint rules ([#329](https://github.com/conventional-changelog/standard-version/issues/329)) ([b6d3d13](https://github.com/conventional-changelog/standard-version/commit/b6d3d13))### BREAKING CHANGES* we now bump the minor rather than major if version < 1.0.0; --release-as can be used to bump to 1.0.0.* tests are no longer run for Node 6* we now use the conventionalcommits preset by default, which directly tracks conventionalcommits.org.
diff --git a/.eslintrc b/.eslintrc
new file mode 100644
index 0000000..42a52a6
--- /dev/null
+++ b/.eslintrc
@@ -0,0 +1,6 @@
+{
+  "extends": "standard",
+  "rules": {
+    "no-var": "error"
+  }
+}
\ No newline at end of file
diff --git a/CHANGELOG.md b/CHANGELOG.md
index bef5182..eeaeacd 100644
--- a/CHANGELOG.md
+++ b/CHANGELOG.md
@@ -2,6 +2,10 @@
 
 All notable changes to this project will be documented in this file. See [standard-version](https://github.com/conventional-changelog/standard-version) for commit guidelines.
 
+## [5.0.2](https://github.com/conventional-changelog/standard-version/compare/v5.0.1...v5.0.2) (2019-03-16)
+
+
+
 ## [5.0.1](https://github.com/conventional-changelog/standard-version/compare/v5.0.0...v5.0.1) (2019-02-28)
 
 
diff --git a/command.js b/command.js
index 3406cd0..23e3ab2 100755
--- a/command.js
+++ b/command.js
@@ -1,4 +1,4 @@
-var defaults = require('./defaults')
+let defaults = require('./defaults')
 
 module.exports = require('yargs')
   .usage('Usage: $0 [options]')
diff --git a/index.js b/index.js
index 8408def..956e1e8 100755
--- a/index.js
+++ b/index.js
@@ -11,9 +11,9 @@
   let pkg
   bump.pkgFiles.forEach((filename) => {
     if (pkg) return
-    var pkgPath = path.resolve(process.cwd(), filename)
+    let pkgPath = path.resolve(process.cwd(), filename)
     try {
-      var data = fs.readFileSync(pkgPath, 'utf8')
+      let data = fs.readFileSync(pkgPath, 'utf8')
       pkg = JSON.parse(data)
     } catch (err) {}
   })
diff --git a/lib/lifecycles/bump.js b/lib/lifecycles/bump.js
index 11028c8..a62d770 100644
--- a/lib/lifecycles/bump.js
+++ b/lib/lifecycles/bump.js
@@ -14,7 +14,7 @@
 const stringifyPackage = require('stringify-package')
 const writeFile = require('../write-file')
 
-var configsToUpdate = {}
+let configsToUpdate = {}
 
 function Bump (args, version) {
   // reset the cache of updated config files each
@@ -22,7 +22,7 @@
   configsToUpdate = {}
 
   if (args.skip.bump) return Promise.resolve()
-  var newVersion = version
+  let newVersion = version
   return runLifecycleScript(args, 'prerelease')
     .then(runLifecycleScript.bind(this, args, 'prebump'))
     .then((stdout) => {
@@ -31,7 +31,7 @@
     })
     .then((release) => {
       if (!args.firstRelease) {
-        var releaseType = getReleaseType(args.prerelease, release.releaseType, version)
+        let releaseType = getReleaseType(args.prerelease, release.releaseType, version)
         newVersion = semver.valid(releaseType) || semver.inc(version, releaseType, args.prerelease)
         updateConfigs(args, newVersion)
       } else {
@@ -100,7 +100,7 @@
   return Array.isArray(semver.prerelease(version))
 }
 
-var TypeList = ['major', 'minor', 'patch'].reverse()
+let TypeList = ['major', 'minor', 'patch'].reverse()
 
 /**
  * extract the in-pre-release type in target version
@@ -109,8 +109,8 @@
  * @return {string}
  */
 function getCurrentActiveType (version) {
-  var typelist = TypeList
-  for (var i = 0; i < typelist.length; i++) {
+  let typelist = TypeList
+  for (let i = 0; i < typelist.length; i++) {
     if (semver[typelist[i]](version)) {
       return typelist[i]
     }
@@ -163,13 +163,13 @@
   Object.keys(configsToUpdate).forEach(function (configPath) {
     try {
       if (dotgit.ignore(configPath)) return
-      var stat = fs.lstatSync(configPath)
+      let stat = fs.lstatSync(configPath)
       if (stat.isFile()) {
-        var data = fs.readFileSync(configPath, 'utf8')
-        var indent = detectIndent(data).indent
-        var newline = detectNewline(data)
-        var config = JSON.parse(data)
-        var filename = path.basename(configPath)
+        let data = fs.readFileSync(configPath, 'utf8')
+        let indent = detectIndent(data).indent
+        let newline = detectNewline(data)
+        let config = JSON.parse(data)
+        let filename = path.basename(configPath)
         checkpoint(args, 'bumping version in ' + filename + ' from %s to %s', [config.version, newVersion])
         config.version = newVersion
         writeFile(args, configPath, stringifyPackage(config, indent, newline))
diff --git a/lib/lifecycles/changelog.js b/lib/lifecycles/changelog.js
index ed383d5..da47f54 100644
--- a/lib/lifecycles/changelog.js
+++ b/lib/lifecycles/changelog.js
@@ -20,17 +20,17 @@
 function outputChangelog (args, newVersion) {
   return new Promise((resolve, reject) => {
     createIfMissing(args)
-    var header = '# Change Log\n\nAll notable changes to this project will be documented in this file. See [standard-version](https://github.com/conventional-changelog/standard-version) for commit guidelines.\n'
-    var oldContent = args.dryRun ? '' : fs.readFileSync(args.infile, 'utf-8')
+    let header = '# Change Log\n\nAll notable changes to this project will be documented in this file. See [standard-version](https://github.com/conventional-changelog/standard-version) for commit guidelines.\n'
+    let oldContent = args.dryRun ? '' : fs.readFileSync(args.infile, 'utf-8')
     // find the position of the last release and remove header:
     const changelogSectionRegExp = /<a name=|##? \[?[0-9]+\.[0-9]+\.[0-9]+\]?/
     if (oldContent.search(changelogSectionRegExp) !== -1) {
       oldContent = oldContent.substring(oldContent.search(changelogSectionRegExp))
     }
-    var content = ''
-    var context
+    let content = ''
+    let context
     if (args.dryRun) context = { version: newVersion }
-    var changelogStream = conventionalChangelog({
+    let changelogStream = conventionalChangelog({
       debug: args.verbose && console.info.bind(console, 'conventional-changelog'),
       preset: args.preset || 'angular',
       tagPrefix: args.tagPrefix
diff --git a/lib/lifecycles/commit.js b/lib/lifecycles/commit.js
index c273949..7c7aa6a 100644
--- a/lib/lifecycles/commit.js
+++ b/lib/lifecycles/commit.js
@@ -18,10 +18,10 @@
 }
 
 function execCommit (args, newVersion) {
-  var msg = 'committing %s'
-  var paths = [args.infile]
-  var verify = args.verify === false || args.n ? '--no-verify ' : ''
-  var toAdd = ''
+  let msg = 'committing %s'
+  let paths = [args.infile]
+  let verify = args.verify === false || args.n ? '--no-verify ' : ''
+  let toAdd = ''
   // commit any of the config files that we've updated
   // the version # for.
   Object.keys(bump.getUpdatedConfigs()).forEach(function (p) {
@@ -31,6 +31,12 @@
       toAdd += ' ' + path.relative(process.cwd(), p)
     }
   })
+
+  if (args.commitAll) {
+    msg += ' and %s'
+    paths.push('all staged files')
+  }
+
   checkpoint(args, msg, paths)
   return runExec(args, 'git add' + toAdd + ' ' + args.infile)
     .then(() => {
diff --git a/lib/lifecycles/tag.js b/lib/lifecycles/tag.js
index f59aedf..a7b4019 100644
--- a/lib/lifecycles/tag.js
+++ b/lib/lifecycles/tag.js
@@ -17,7 +17,7 @@
 }
 
 function execTag (newVersion, pkgPrivate, args) {
-  var tagOption
+  let tagOption
   if (args.sign) {
     tagOption = '-s '
   } else {
@@ -26,7 +26,7 @@
   checkpoint(args, 'tagging release %s%s', [args.tagPrefix, newVersion])
   return runExec(args, 'git tag ' + tagOption + args.tagPrefix + newVersion + ' -m "' + formatCommitMessage(args.message, newVersion) + '"')
     .then(() => {
-      var message = 'git push --follow-tags origin master'
+      let message = 'git push --follow-tags origin master'
       if (pkgPrivate !== true) {
         message += ' && npm publish'
         if (args.prerelease !== undefined) {
diff --git a/lib/run-lifecycle-hook.js b/lib/run-lifecycle-hook.js
index 17efd33..9c0dc2c 100644
--- a/lib/run-lifecycle-hook.js
+++ b/lib/run-lifecycle-hook.js
@@ -5,7 +5,7 @@
 
 module.exports = function (args, hookName, newVersion, hooks, cb) {
   if (!hooks[hookName]) return Promise.resolve()
-  var command = hooks[hookName] + ' --new-version="' + newVersion + '"'
+  let command = hooks[hookName] + ' --new-version="' + newVersion + '"'
   checkpoint(args, 'Running lifecycle hook "%s"', [hookName])
   checkpoint(args, '- hook command: "%s"', [command], chalk.blue(figures.info))
   return runExec(args, command)
diff --git a/lib/run-lifecycle-script.js b/lib/run-lifecycle-script.js
index a501448..7a9b2a2 100644
--- a/lib/run-lifecycle-script.js
+++ b/lib/run-lifecycle-script.js
@@ -6,7 +6,7 @@
 module.exports = function (args, hookName) {
   const scripts = args.scripts
   if (!scripts || !scripts[hookName]) return Promise.resolve()
-  var command = scripts[hookName]
+  let command = scripts[hookName]
   checkpoint(args, 'Running lifecycle script "%s"', [hookName])
   checkpoint(args, '- execute command: "%s"', [command], chalk.blue(figures.info))
   return runExec(args, command)
diff --git a/package.json b/package.json
index e7c39bf..8a19460 100644
--- a/package.json
+++ b/package.json
@@ -1,10 +1,10 @@
 {
   "name": "standard-version",
-  "version": "5.0.1",
+  "version": "5.0.2",
   "description": "replacement for `npm version` with automatic CHANGELOG generation",
   "bin": "bin/cli.js",
   "scripts": {
-    "pretest": "standard",
+    "pretest": "eslint .",
     "coverage": "nyc report --reporter=text-lcov | coveralls",
     "test": "nyc mocha --timeout=20000 test.js",
     "release": "bin/cli.js"
@@ -54,11 +54,16 @@
   "devDependencies": {
     "chai": "^3.5.0",
     "coveralls": "^3.0.1",
+    "eslint": "^5.16.0",
+    "eslint-config-standard": "^12.0.0",
+    "eslint-plugin-import": "^2.16.0",
+    "eslint-plugin-node": "^8.0.1",
+    "eslint-plugin-promise": "^4.0.1",
+    "eslint-plugin-standard": "^4.0.0",
     "mocha": "^5.2.0",
     "mock-git": "^1.0.3",
     "mockery": "^2.0.0",
     "nyc": "^13.3.0",
-    "shelljs": "^0.7.8",
-    "standard": "^12.0.1"
+    "shelljs": "^0.7.8"
   }
 }
diff --git a/test.js b/test.js
index 88126d4..363d07f 100644
--- a/test.js
+++ b/test.js
@@ -15,7 +15,7 @@
 
 require('chai').should()
 
-var cliPath = path.resolve(__dirname, './bin/cli.js')
+let cliPath = path.resolve(__dirname, './bin/cli.js')
 
 function branch (branch) {
   shell.exec('git branch ' + branch)
@@ -43,31 +43,31 @@
 
 function writePackageJson (version, option) {
   option = option || {}
-  var pkg = Object.assign(option, { version: version })
+  let pkg = Object.assign(option, { version: version })
   fs.writeFileSync('package.json', JSON.stringify(pkg), 'utf-8')
 }
 
 function writeBowerJson (version, option) {
   option = option || {}
-  var bower = Object.assign(option, { version: version })
+  let bower = Object.assign(option, { version: version })
   fs.writeFileSync('bower.json', JSON.stringify(bower), 'utf-8')
 }
 
 function writeManifestJson (version, option) {
   option = option || {}
-  var manifest = Object.assign(option, { version: version })
+  let manifest = Object.assign(option, { version: version })
   fs.writeFileSync('manifest.json', JSON.stringify(manifest), 'utf-8')
 }
 
 function writeNpmShrinkwrapJson (version, option) {
   option = option || {}
-  var shrinkwrap = Object.assign(option, { version: version })
+  let shrinkwrap = Object.assign(option, { version: version })
   fs.writeFileSync('npm-shrinkwrap.json', JSON.stringify(shrinkwrap), 'utf-8')
 }
 
 function writePackageLockJson (version, option) {
   option = option || {}
-  var pkgLock = Object.assign(option, { version: version })
+  let pkgLock = Object.assign(option, { version: version })
   fs.writeFileSync('package-lock.json', JSON.stringify(pkgLock), 'utf-8')
 }
 
@@ -82,7 +82,7 @@
 
 function writeHook (hookName, causeError, script) {
   shell.mkdir('-p', 'scripts')
-  var content = script || 'console.error("' + hookName + ' ran")'
+  let content = script || 'console.error("' + hookName + ' ran")'
   content += causeError ? '\nthrow new Error("' + hookName + '-failure")' : ''
   fs.writeFileSync('scripts/' + hookName + '.js', content, 'utf-8')
   fs.chmodSync('scripts/' + hookName + '.js', '755')
@@ -131,7 +131,7 @@
 
       execCli().code.should.equal(0)
 
-      var content = fs.readFileSync('CHANGELOG.md', 'utf-8')
+      let content = fs.readFileSync('CHANGELOG.md', 'utf-8')
       content.should.match(/patch release/)
       content.should.not.match(/first commit/)
     })
@@ -143,7 +143,7 @@
       commit('fix: patch release')
       execCli('--first-release').code.should.equal(0)
 
-      var content = fs.readFileSync('CHANGELOG.md', 'utf-8')
+      let content = fs.readFileSync('CHANGELOG.md', 'utf-8')
       content.should.match(/patch release/)
       content.should.match(/first commit/)
       shell.exec('git tag').stdout.should.match(/1\.0\.1/)
@@ -159,7 +159,7 @@
       commit('fix: patch release')
 
       execCli().code.should.equal(0)
-      var content = fs.readFileSync('CHANGELOG.md', 'utf-8')
+      let content = fs.readFileSync('CHANGELOG.md', 'utf-8')
       content.should.match(/1\.0\.1/)
       content.should.not.match(/legacy header format/)
     })
@@ -177,8 +177,8 @@
 
       execCli('--commit-all').code.should.equal(0)
 
-      var content = fs.readFileSync('CHANGELOG.md', 'utf-8')
-      var status = shell.exec('git status --porcelain') // see http://unix.stackexchange.com/questions/155046/determine-if-git-working-directory-is-clean-from-a-script
+      let content = fs.readFileSync('CHANGELOG.md', 'utf-8')
+      let status = shell.exec('git status --porcelain') // see http://unix.stackexchange.com/questions/155046/determine-if-git-working-directory-is-clean-from-a-script
 
       status.should.equal('')
       status.should.not.match(/STUFF.md/)
@@ -195,7 +195,7 @@
         .then(function (unmock) {
           execCli('--sign').code.should.equal(0)
 
-          var captured = shell.cat('gitcapture.log').stdout.split('\n').map(function (line) {
+          let captured = shell.cat('gitcapture.log').stdout.split('\n').map(function (line) {
             return line ? JSON.parse(line) : line
           })
           captured[captured.length - 3].should.deep.equal(['commit', '-S', 'CHANGELOG.md', 'package.json', '-m', 'chore(release): 1.0.1'])
@@ -209,7 +209,7 @@
       // mock git by throwing on attempt to commit
       return mockGit('console.error("commit yourself"); process.exit(128);', 'commit')
         .then(function (unmock) {
-          var result = execCli()
+          let result = execCli()
           result.code.should.equal(1)
           result.stderr.should.match(/commit yourself/)
 
@@ -221,7 +221,7 @@
       // mock git by throwing on attempt to add
       return mockGit('console.error("addition is hard"); process.exit(128);', 'add')
         .then(function (unmock) {
-          var result = execCli()
+          let result = execCli()
           result.code.should.equal(1)
           result.stderr.should.match(/addition is hard/)
 
@@ -233,7 +233,7 @@
       // mock git by throwing on attempt to commit
       return mockGit('console.error("tag, you\'re it"); process.exit(128);', 'tag')
         .then(function (unmock) {
-          var result = execCli()
+          let result = execCli()
           result.code.should.equal(1)
           result.stderr.should.match(/tag, you're it/)
 
@@ -247,7 +247,7 @@
         .then(function (unmock) {
           writePackageJson('1.0.0')
 
-          var result = execCli()
+          let result = execCli()
           result.code.should.equal(0)
           result.stderr.should.match(/haha, kidding, this is just a warning/)
 
@@ -270,7 +270,7 @@
         fs.writeFileSync('CHANGELOG.md', 'legacy header format<a name="1.0.0">\n', 'utf-8')
 
         commit('feat: first commit')
-        var result = execCli('--patch')
+        let result = execCli('--patch')
         result.code.should.equal(0)
         result.stderr.should.match(/prerelease ran/)
       })
@@ -287,7 +287,7 @@
         fs.writeFileSync('CHANGELOG.md', 'legacy header format<a name="1.0.0">\n', 'utf-8')
 
         commit('feat: first commit')
-        var result = execCli('--patch')
+        let result = execCli('--patch')
         result.code.should.equal(1)
         result.stderr.should.match(/prerelease ran/)
       })
@@ -306,7 +306,7 @@
         fs.writeFileSync('CHANGELOG.md', 'legacy header format<a name="1.0.0">\n', 'utf-8')
 
         commit('feat: first commit')
-        var result = execCli('--patch')
+        let result = execCli('--patch')
         result.stdout.should.match(/9\.9\.9/)
         result.code.should.equal(0)
       })
@@ -325,7 +325,7 @@
         fs.writeFileSync('CHANGELOG.md', 'legacy header format<a name="1.0.0">\n', 'utf-8')
 
         commit('feat: first commit')
-        var result = execCli('--patch')
+        let result = execCli('--patch')
         result.code.should.equal(0)
         result.stderr.should.match(/postbump ran/)
       })
@@ -342,7 +342,7 @@
         fs.writeFileSync('CHANGELOG.md', 'legacy header format<a name="1.0.0">\n', 'utf-8')
 
         commit('feat: first commit')
-        var result = execCli('--patch')
+        let result = execCli('--patch')
         result.code.should.equal(1)
         result.stderr.should.match(/postbump-failure/)
       })
@@ -361,7 +361,7 @@
         fs.writeFileSync('CHANGELOG.md', 'legacy header format<a name="1.0.0">\n', 'utf-8')
 
         commit('feat: first commit')
-        var result = execCli('--patch')
+        let result = execCli('--patch')
         result.code.should.equal(0)
         result.stderr.should.match(/precommit ran/)
       })
@@ -378,7 +378,7 @@
         fs.writeFileSync('CHANGELOG.md', 'legacy header format<a name="1.0.0">\n', 'utf-8')
 
         commit('feat: first commit')
-        var result = execCli('--patch')
+        let result = execCli('--patch')
         result.code.should.equal(1)
         result.stderr.should.match(/precommit-failure/)
       })
@@ -395,7 +395,7 @@
         fs.writeFileSync('CHANGELOG.md', 'legacy header format<a name="1.0.0">\n', 'utf-8')
 
         commit('feat: first commit')
-        var result = execCli('--patch')
+        let result = execCli('--patch')
         result.code.should.equal(0)
         shell.exec('git log --oneline -n1').should.match(/delivers #222/)
       })
@@ -450,11 +450,11 @@
     })
 
     describe('release-types', function () {
-      var regularTypes = ['major', 'minor', 'patch']
+      let regularTypes = ['major', 'minor', 'patch']
 
       regularTypes.forEach(function (type) {
         it('creates a ' + type + ' release', function () {
-          var originVer = '1.0.0'
+          let originVer = '1.0.0'
           writePackageJson(originVer)
           fs.writeFileSync('CHANGELOG.md', 'legacy header format<a name="1.0.0">\n', 'utf-8')
 
@@ -462,7 +462,7 @@
 
           return execCliAsync('--release-as ' + type)
             .then(function () {
-              var version = {
+              let version = {
                 major: semver.major(originVer),
                 minor: semver.minor(originVer),
                 patch: semver.patch(originVer)
@@ -478,7 +478,7 @@
       // this is for pre-releases
       regularTypes.forEach(function (type) {
         it('creates a pre' + type + ' release', function () {
-          var originVer = '1.0.0'
+          let originVer = '1.0.0'
           writePackageJson(originVer)
           fs.writeFileSync('CHANGELOG.md', 'legacy header format<a name="1.0.0">\n', 'utf-8')
 
@@ -486,7 +486,7 @@
 
           return execCliAsync('--release-as ' + type + ' --prerelease ' + type)
             .then(function () {
-              var version = {
+              let version = {
                 major: semver.major(originVer),
                 minor: semver.minor(originVer),
                 patch: semver.patch(originVer)
@@ -502,7 +502,7 @@
 
     describe('release-as-exact', function () {
       it('releases as v100.0.0', function () {
-        var originVer = '1.0.0'
+        let originVer = '1.0.0'
         writePackageJson(originVer)
         fs.writeFileSync('CHANGELOG.md', 'legacy header format<a name="1.0.0">\n', 'utf-8')
 
@@ -515,7 +515,7 @@
       })
 
       it('releases as 200.0.0-amazing', function () {
-        var originVer = '1.0.0'
+        let originVer = '1.0.0'
         writePackageJson(originVer)
         fs.writeFileSync('CHANGELOG.md', 'legacy header format<a name="1.0.0">\n', 'utf-8')
 
@@ -581,7 +581,7 @@
 
     execCli().code.should.equal(0)
 
-    var content = fs.readFileSync('CHANGELOG.md', 'utf-8')
+    let content = fs.readFileSync('CHANGELOG.md', 'utf-8')
     content.should.match(/this is my fairly long commit message which is testing whether or not we allow for long commit messages/)
   })
 
@@ -601,45 +601,45 @@
   it('appends line feed at end of package.json', function () {
     execCli().code.should.equal(0)
 
-    var pkgJson = fs.readFileSync('package.json', 'utf-8')
+    let pkgJson = fs.readFileSync('package.json', 'utf-8')
     pkgJson.should.equal(['{', '  "version": "1.0.1"', '}', ''].join('\n'))
   })
 
   it('preserves indentation of tabs in package.json', function () {
-    var indentation = '\t'
-    var newPkgJson = ['{', indentation + '"version": "1.0.0"', '}', ''].join('\n')
+    let indentation = '\t'
+    let newPkgJson = ['{', indentation + '"version": "1.0.0"', '}', ''].join('\n')
     fs.writeFileSync('package.json', newPkgJson, 'utf-8')
 
     execCli().code.should.equal(0)
-    var pkgJson = fs.readFileSync('package.json', 'utf-8')
+    let pkgJson = fs.readFileSync('package.json', 'utf-8')
     pkgJson.should.equal(['{', indentation + '"version": "1.0.1"', '}', ''].join('\n'))
   })
 
   it('preserves indentation of spaces in package.json', function () {
-    var indentation = '     '
-    var newPkgJson = ['{', indentation + '"version": "1.0.0"', '}', ''].join('\n')
+    let indentation = '     '
+    let newPkgJson = ['{', indentation + '"version": "1.0.0"', '}', ''].join('\n')
     fs.writeFileSync('package.json', newPkgJson, 'utf-8')
 
     execCli().code.should.equal(0)
-    var pkgJson = fs.readFileSync('package.json', 'utf-8')
+    let pkgJson = fs.readFileSync('package.json', 'utf-8')
     pkgJson.should.equal(['{', indentation + '"version": "1.0.1"', '}', ''].join('\n'))
   })
 
   it('preserves line feed in package.json', function () {
-    var newPkgJson = ['{', '  "version": "1.0.0"', '}', ''].join('\n')
+    let newPkgJson = ['{', '  "version": "1.0.0"', '}', ''].join('\n')
     fs.writeFileSync('package.json', newPkgJson, 'utf-8')
 
     execCli().code.should.equal(0)
-    var pkgJson = fs.readFileSync('package.json', 'utf-8')
+    let pkgJson = fs.readFileSync('package.json', 'utf-8')
     pkgJson.should.equal(['{', '  "version": "1.0.1"', '}', ''].join('\n'))
   })
 
   it('preserves carriage return + line feed in package.json', function () {
-    var newPkgJson = ['{', '  "version": "1.0.0"', '}', ''].join('\r\n')
+    let newPkgJson = ['{', '  "version": "1.0.0"', '}', ''].join('\r\n')
     fs.writeFileSync('package.json', newPkgJson, 'utf-8')
 
     execCli().code.should.equal(0)
-    var pkgJson = fs.readFileSync('package.json', 'utf-8')
+    let pkgJson = fs.readFileSync('package.json', 'utf-8')
     pkgJson.should.equal(['{', '  "version": "1.0.1"', '}', ''].join('\r\n'))
   })
 
@@ -653,7 +653,7 @@
   })
 
   it('does not print output when the --silent flag is passed', function () {
-    var result = execCli('--silent')
+    let result = execCli('--silent')
     result.code.should.equal(0)
     result.stdout.should.equal('')
     result.stderr.should.equal('')
@@ -662,13 +662,25 @@
   it('does not display `npm publish` if the package is private', function () {
     writePackageJson('1.0.0', { private: true })
 
-    var result = execCli()
+    let result = execCli()
     result.code.should.equal(0)
     result.stdout.should.not.match(/npm publish/)
   })
 
+  it('does not display `all staged files` without the --commit-all flag', function () {
+    var result = execCli()
+    result.code.should.equal(0)
+    result.stdout.should.not.match(/and all staged files/)
+  })
+
+  it('does display `all staged files` if the --commit-all flag is passed', function () {
+    var result = execCli('--commit-all')
+    result.code.should.equal(0)
+    result.stdout.should.match(/and all staged files/)
+  })
+
   it('includes merge commits', function () {
-    var branchName = 'new-feature'
+    let branchName = 'new-feature'
     commit('feat: first commit')
     shell.exec('git tag -a v1.0.0 -m "my awesome first release"')
     branch(branchName)
@@ -679,10 +691,10 @@
 
     execCli().code.should.equal(0)
 
-    var content = fs.readFileSync('CHANGELOG.md', 'utf-8')
+    let content = fs.readFileSync('CHANGELOG.md', 'utf-8')
     content.should.match(/new feature from branch/)
 
-    var pkgJson = fs.readFileSync('package.json', 'utf-8')
+    let pkgJson = fs.readFileSync('package.json', 'utf-8')
     pkgJson.should.equal(['{', '  "version": "1.1.0"', '}', ''].join('\n'))
   })
 
@@ -694,7 +706,7 @@
     })
 
     commit('feat: first commit')
-    var result = execCli()
+    let result = execCli()
     result.code.should.equal(1)
     result.stderr.should.match(/scripts must be an object/)
   })
@@ -707,7 +719,7 @@
     })
 
     commit('feat: first commit')
-    var result = execCli()
+    let result = execCli()
     result.code.should.equal(1)
     result.stderr.should.match(/skip must be an object/)
   })
@@ -747,7 +759,7 @@
     beforeEach(function () {
       mockery.enable({ warnOnUnregistered: false, useCleanCache: true })
       mockery.registerMock('conventional-changelog', function () {
-        var readable = new stream.Readable({ objectMode: true })
+        let readable = new stream.Readable({ objectMode: true })
         readable._read = function () {
         }
         setImmediate(readable.emit.bind(readable), 'error', new Error('changelog err'))
@@ -894,7 +906,7 @@
       return execCliAsync('--skip.bump true --skip.changelog true')
         .then(function () {
           getPackageVersion().should.equal('1.0.0')
-          var content = fs.readFileSync('CHANGELOG.md', 'utf-8')
+          let content = fs.readFileSync('CHANGELOG.md', 'utf-8')
           content.should.equal(changelogContent)
         })
     })
@@ -908,7 +920,7 @@
       return execCliAsync('--skip.commit true')
         .then(function () {
           getPackageVersion().should.equal('1.1.0')
-          var content = fs.readFileSync('CHANGELOG.md', 'utf-8')
+          let content = fs.readFileSync('CHANGELOG.md', 'utf-8')
           content.should.match(/new feature from branch/)
           // check last commit message
           shell.exec('git log --oneline -n1').stdout.should.match(/feat: new feature from branch/)

=====================================================================
start time: Thu Feb 28 00:00:00 CST 2019
end time: Sat Mar 16 00:00:00 CST 2019

diff --git a/CHANGELOG.md b/CHANGELOG.md
index 6e6a36f..bef5182 100644
--- a/CHANGELOG.md
+++ b/CHANGELOG.md
@@ -2,6 +2,15 @@
 
 All notable changes to this project will be documented in this file. See [standard-version](https://github.com/conventional-changelog/standard-version) for commit guidelines.
 
+## [5.0.1](https://github.com/conventional-changelog/standard-version/compare/v5.0.0...v5.0.1) (2019-02-28)
+
+
+### Bug Fixes
+
+* make pattern for finding CHANGELOG sections work for non anchors ([#292](https://github.com/conventional-changelog/standard-version/issues/292)) ([b684c78](https://github.com/conventional-changelog/standard-version/commit/b684c78))
+
+
+
 # [5.0.0](https://github.com/conventional-changelog/standard-version/compare/v4.4.0...v5.0.0) (2019-02-14)
 
 
diff --git a/package.json b/package.json
index 7f7e843..164781d 100644
--- a/package.json
+++ b/package.json
@@ -1,6 +1,6 @@
 {
   "name": "standard-version",
-  "version": "5.0.0",
+  "version": "5.0.1",
   "description": "replacement for `npm version` with automatic CHANGELOG generation",
   "bin": "bin/cli.js",
   "scripts": {

=====================================================================
start time: Thu Feb 14 00:00:00 CST 2019
end time: Thu Feb 28 00:00:00 CST 2019
### Bug Fixes* make pattern for finding CHANGELOG sections work for non anchors ([#292](https://github.com/conventional-changelog/standard-version/issues/292)) ([b684c78](https://github.com/conventional-changelog/standard-version/commit/b684c78))
diff --git a/CHANGELOG.md b/CHANGELOG.md
index c5af903..6e6a36f 100644
--- a/CHANGELOG.md
+++ b/CHANGELOG.md
@@ -2,6 +2,36 @@
 
 All notable changes to this project will be documented in this file. See [standard-version](https://github.com/conventional-changelog/standard-version) for commit guidelines.
 
+# [5.0.0](https://github.com/conventional-changelog/standard-version/compare/v4.4.0...v5.0.0) (2019-02-14)
+
+
+### Bug Fixes
+
+* bin now enforces Node.js > 4 ([#274](https://github.com/conventional-changelog/standard-version/issues/274)) ([e1b5780](https://github.com/conventional-changelog/standard-version/commit/e1b5780))
+* no --tag prerelease for private module ([#296](https://github.com/conventional-changelog/standard-version/issues/296)) ([27e2ab4](https://github.com/conventional-changelog/standard-version/commit/27e2ab4)), closes [#294](https://github.com/conventional-changelog/standard-version/issues/294)
+* show correct pre-release tag in help output ([#259](https://github.com/conventional-changelog/standard-version/issues/259)) ([d90154a](https://github.com/conventional-changelog/standard-version/commit/d90154a))
+
+
+### chore
+
+* update testing matrix ([1d46627](https://github.com/conventional-changelog/standard-version/commit/1d46627))
+
+
+### Features
+
+* adds support for bumping for composer versions ([#262](https://github.com/conventional-changelog/standard-version/issues/262)) ([fee872f](https://github.com/conventional-changelog/standard-version/commit/fee872f))
+* cli application accept path/preset option ([#279](https://github.com/conventional-changelog/standard-version/issues/279)) ([69c62cf](https://github.com/conventional-changelog/standard-version/commit/69c62cf))
+* fallback to tags if no meta-information file found ([#275](https://github.com/conventional-changelog/standard-version/issues/275)) ([844cde6](https://github.com/conventional-changelog/standard-version/commit/844cde6))
+* preserve formatting when writing to package.json ([#282](https://github.com/conventional-changelog/standard-version/issues/282)) ([96216da](https://github.com/conventional-changelog/standard-version/commit/96216da))
+
+
+### BREAKING CHANGES
+
+* if no package.json, bower.json, etc., is found, we now fallback to git tags
+* removed Node 4/5 from testing matrix
+
+
+
 <a name="4.4.0"></a>
 # [4.4.0](https://github.com/conventional-changelog/standard-version/compare/v4.3.0...v4.4.0) (2018-05-21)
 
diff --git a/README.md b/README.md
index f5ff0f7..956efb9 100644
--- a/README.md
+++ b/README.md
@@ -230,6 +230,16 @@
 standard-version --dry-run
 ```
 
+### Prefix Tags
+
+If you would like to prefix your tags with something, you can do so with the `-t` flag.
+
+```sh
+standard-version -t @scope/package\@
+```
+
+This will prefix your tags to look something like `@scope/package@2.0.0`
+
 ### CLI Help
 
 ```sh
diff --git a/command.js b/command.js
index 095f965..3406cd0 100755
--- a/command.js
+++ b/command.js
@@ -77,6 +77,15 @@
     default: defaults.gitTagFallback,
     describe: `fallback to git tags for version, if no meta-information file is found (e.g., package.json)`
   })
+  .option('path', {
+    type: 'string',
+    describe: 'Only populate commits made under this path'
+  })
+  .option('preset', {
+    type: 'string',
+    default: defaults.preset,
+    describe: 'Commit message guideline preset (default: angular)'
+  })
   .check((argv) => {
     if (typeof argv.scripts !== 'object' || Array.isArray(argv.scripts)) {
       throw Error('scripts must be an object')
diff --git a/defaults.json b/defaults.json
index b70e546..17035be 100644
--- a/defaults.json
+++ b/defaults.json
@@ -10,5 +10,6 @@
   "scripts": {},
   "skip": {},
   "dryRun": false,
-  "gitTagFallback": true
+  "gitTagFallback": true,
+  "preset": "angular"
 }
diff --git a/index.js b/index.js
index d8432b0..8408def 100755
--- a/index.js
+++ b/index.js
@@ -1,10 +1,10 @@
-const latestSemverTag = require('./lib/latest-semver-tag')
-const path = require('path')
-const printError = require('./lib/print-error')
-
 const bump = require('./lib/lifecycles/bump')
 const changelog = require('./lib/lifecycles/changelog')
 const commit = require('./lib/lifecycles/commit')
+const fs = require('fs')
+const latestSemverTag = require('./lib/latest-semver-tag')
+const path = require('path')
+const printError = require('./lib/print-error')
 const tag = require('./lib/lifecycles/tag')
 
 module.exports = function standardVersion (argv) {
@@ -13,7 +13,8 @@
     if (pkg) return
     var pkgPath = path.resolve(process.cwd(), filename)
     try {
-      pkg = require(pkgPath)
+      var data = fs.readFileSync(pkgPath, 'utf8')
+      pkg = JSON.parse(data)
     } catch (err) {}
   })
   let newVersion
diff --git a/lib/lifecycles/bump.js b/lib/lifecycles/bump.js
index 7fa0857..11028c8 100644
--- a/lib/lifecycles/bump.js
+++ b/lib/lifecycles/bump.js
@@ -3,12 +3,15 @@
 const chalk = require('chalk')
 const checkpoint = require('../checkpoint')
 const conventionalRecommendedBump = require('conventional-recommended-bump')
+const detectIndent = require('detect-indent')
+const detectNewline = require('detect-newline')
 const figures = require('figures')
 const fs = require('fs')
 const DotGitignore = require('dotgitignore')
 const path = require('path')
 const runLifecycleScript = require('../run-lifecycle-script')
 const semver = require('semver')
+const stringifyPackage = require('stringify-package')
 const writeFile = require('../write-file')
 
 var configsToUpdate = {}
@@ -24,7 +27,7 @@
     .then(runLifecycleScript.bind(this, args, 'prebump'))
     .then((stdout) => {
       if (stdout && stdout.trim().length) args.releaseAs = stdout.trim()
-      return bumpVersion(args.releaseAs)
+      return bumpVersion(args.releaseAs, args)
     })
     .then((release) => {
       if (!args.firstRelease) {
@@ -125,7 +128,7 @@
   return TypeList.indexOf(type)
 }
 
-function bumpVersion (releaseAs, callback) {
+function bumpVersion (releaseAs, args) {
   return new Promise((resolve, reject) => {
     if (releaseAs) {
       return resolve({
@@ -133,7 +136,9 @@
       })
     } else {
       conventionalRecommendedBump({
-        preset: 'angular'
+        debug: args.verbose && console.info.bind(console, 'conventional-recommended-bump'),
+        preset: args.preset || 'angular',
+        path: args.path
       }, function (err, release) {
         if (err) return reject(err)
         else return resolve(release)
@@ -160,11 +165,14 @@
       if (dotgit.ignore(configPath)) return
       var stat = fs.lstatSync(configPath)
       if (stat.isFile()) {
-        var config = require(configPath)
+        var data = fs.readFileSync(configPath, 'utf8')
+        var indent = detectIndent(data).indent
+        var newline = detectNewline(data)
+        var config = JSON.parse(data)
         var filename = path.basename(configPath)
         checkpoint(args, 'bumping version in ' + filename + ' from %s to %s', [config.version, newVersion])
         config.version = newVersion
-        writeFile(args, configPath, JSON.stringify(config, null, 2) + '\n')
+        writeFile(args, configPath, stringifyPackage(config, indent, newline))
         // flag any config files that we modify the version # for
         // as having been updated.
         configsToUpdate[configPath] = true
diff --git a/lib/lifecycles/changelog.js b/lib/lifecycles/changelog.js
index 084914d..fb2e0f9 100644
--- a/lib/lifecycles/changelog.js
+++ b/lib/lifecycles/changelog.js
@@ -30,9 +30,10 @@
     var context
     if (args.dryRun) context = { version: newVersion }
     var changelogStream = conventionalChangelog({
-      preset: 'angular',
+      debug: args.verbose && console.info.bind(console, 'conventional-changelog'),
+      preset: args.preset || 'angular',
       tagPrefix: args.tagPrefix
-    }, context, { merges: null })
+    }, context, { merges: null, path: args.path })
       .on('error', function (err) {
         return reject(err)
       })
diff --git a/lib/lifecycles/tag.js b/lib/lifecycles/tag.js
index fc41acb..f59aedf 100644
--- a/lib/lifecycles/tag.js
+++ b/lib/lifecycles/tag.js
@@ -27,12 +27,14 @@
   return runExec(args, 'git tag ' + tagOption + args.tagPrefix + newVersion + ' -m "' + formatCommitMessage(args.message, newVersion) + '"')
     .then(() => {
       var message = 'git push --follow-tags origin master'
-      if (pkgPrivate !== true) message += ' && npm publish'
-      if (args.prerelease !== undefined) {
-        if (args.prerelease === '') {
-          message += ' --tag prerelease'
-        } else {
-          message += ' --tag ' + args.prerelease
+      if (pkgPrivate !== true) {
+        message += ' && npm publish'
+        if (args.prerelease !== undefined) {
+          if (args.prerelease === '') {
+            message += ' --tag prerelease'
+          } else {
+            message += ' --tag ' + args.prerelease
+          }
         }
       }
 
diff --git a/package.json b/package.json
index 4e840f1..7f7e843 100644
--- a/package.json
+++ b/package.json
@@ -1,6 +1,6 @@
 {
   "name": "standard-version",
-  "version": "4.4.0",
+  "version": "5.0.0",
   "description": "replacement for `npm version` with automatic CHANGELOG generation",
   "bin": "bin/cli.js",
   "scripts": {
@@ -39,13 +39,16 @@
   "homepage": "https://github.com/conventional-changelog/standard-version#readme",
   "dependencies": {
     "chalk": "^2.4.1",
-    "conventional-changelog": "^3.0.5",
+    "conventional-changelog": "^3.0.6",
     "conventional-recommended-bump": "^4.0.4",
+    "detect-indent": "^5.0.0",
+    "detect-newline": "^2.1.0",
     "dotgitignore": "^1.0.3",
     "figures": "^2.0.0",
     "fs-access": "^1.0.0",
     "git-semver-tags": "^2.0.2",
     "semver": "^5.2.0",
+    "stringify-package": "^1.0.0",
     "yargs": "^12.0.2"
   },
   "devDependencies": {
@@ -54,7 +57,7 @@
     "mocha": "^5.2.0",
     "mock-git": "^1.0.3",
     "mockery": "^2.0.0",
-    "nyc": "^13.1.0",
+    "nyc": "^13.3.0",
     "shelljs": "^0.7.8",
     "standard": "^12.0.1"
   }
diff --git a/test.js b/test.js
index ec891f9..88126d4 100644
--- a/test.js
+++ b/test.js
@@ -95,16 +95,6 @@
   shell.cd('tmp')
   shell.exec('git init')
   commit('root-commit')
-  ;['package.json',
-    'manifest.json',
-    'bower.json'
-  ].forEach(metadata => {
-    try {
-      delete require.cache[require.resolve(path.join(process.cwd(), metadata))]
-    } catch (err) {
-      // we haven't loaded the metadata file yet.
-    }
-  })
   writePackageJson('1.0.0')
 }
 
@@ -440,6 +430,14 @@
       commit('feat: first commit')
       execCli('--prerelease alpha').stdout.should.include('--tag alpha')
     })
+
+    it('does not advise use of --tag prerelease for private modules', function () {
+      writePackageJson('1.0.0', { private: true })
+      fs.writeFileSync('CHANGELOG.md', 'legacy header format<a name="1.0.0">\n', 'utf-8')
+
+      commit('feat: first commit')
+      execCli('--prerelease').stdout.should.not.include('--tag prerelease')
+    })
   })
 
   describe('manual-release', function () {
@@ -607,6 +605,44 @@
     pkgJson.should.equal(['{', '  "version": "1.0.1"', '}', ''].join('\n'))
   })
 
+  it('preserves indentation of tabs in package.json', function () {
+    var indentation = '\t'
+    var newPkgJson = ['{', indentation + '"version": "1.0.0"', '}', ''].join('\n')
+    fs.writeFileSync('package.json', newPkgJson, 'utf-8')
+
+    execCli().code.should.equal(0)
+    var pkgJson = fs.readFileSync('package.json', 'utf-8')
+    pkgJson.should.equal(['{', indentation + '"version": "1.0.1"', '}', ''].join('\n'))
+  })
+
+  it('preserves indentation of spaces in package.json', function () {
+    var indentation = '     '
+    var newPkgJson = ['{', indentation + '"version": "1.0.0"', '}', ''].join('\n')
+    fs.writeFileSync('package.json', newPkgJson, 'utf-8')
+
+    execCli().code.should.equal(0)
+    var pkgJson = fs.readFileSync('package.json', 'utf-8')
+    pkgJson.should.equal(['{', indentation + '"version": "1.0.1"', '}', ''].join('\n'))
+  })
+
+  it('preserves line feed in package.json', function () {
+    var newPkgJson = ['{', '  "version": "1.0.0"', '}', ''].join('\n')
+    fs.writeFileSync('package.json', newPkgJson, 'utf-8')
+
+    execCli().code.should.equal(0)
+    var pkgJson = fs.readFileSync('package.json', 'utf-8')
+    pkgJson.should.equal(['{', '  "version": "1.0.1"', '}', ''].join('\n'))
+  })
+
+  it('preserves carriage return + line feed in package.json', function () {
+    var newPkgJson = ['{', '  "version": "1.0.0"', '}', ''].join('\r\n')
+    fs.writeFileSync('package.json', newPkgJson, 'utf-8')
+
+    execCli().code.should.equal(0)
+    var pkgJson = fs.readFileSync('package.json', 'utf-8')
+    pkgJson.should.equal(['{', '  "version": "1.0.1"', '}', ''].join('\r\n'))
+  })
+
   it('does not run git hooks if the --no-verify flag is passed', function () {
     writeGitPreCommitHook()
 

=====================================================================
start time: Mon May 21 00:00:00 CST 2018
end time: Thu Feb 14 00:00:00 CST 2019
### Bug Fixes* bin now enforces Node.js > 4 ([#274](https://github.com/conventional-changelog/standard-version/issues/274)) ([e1b5780](https://github.com/conventional-changelog/standard-version/commit/e1b5780))* no --tag prerelease for private module ([#296](https://github.com/conventional-changelog/standard-version/issues/296)) ([27e2ab4](https://github.com/conventional-changelog/standard-version/commit/27e2ab4)), closes [#294](https://github.com/conventional-changelog/standard-version/issues/294)* show correct pre-release tag in help output ([#259](https://github.com/conventional-changelog/standard-version/issues/259)) ([d90154a](https://github.com/conventional-changelog/standard-version/commit/d90154a))### chore* update testing matrix ([1d46627](https://github.com/conventional-changelog/standard-version/commit/1d46627))### Features* adds support for bumping for composer versions ([#262](https://github.com/conventional-changelog/standard-version/issues/262)) ([fee872f](https://github.com/conventional-changelog/standard-version/commit/fee872f))* cli application accept path/preset option ([#279](https://github.com/conventional-changelog/standard-version/issues/279)) ([69c62cf](https://github.com/conventional-changelog/standard-version/commit/69c62cf))* fallback to tags if no meta-information file found ([#275](https://github.com/conventional-changelog/standard-version/issues/275)) ([844cde6](https://github.com/conventional-changelog/standard-version/commit/844cde6))* preserve formatting when writing to package.json ([#282](https://github.com/conventional-changelog/standard-version/issues/282)) ([96216da](https://github.com/conventional-changelog/standard-version/commit/96216da))### BREAKING CHANGES* if no package.json, bower.json, etc., is found, we now fallback to git tags* removed Node 4/5 from testing matrix<a name="4.4.0"></a>
diff --git a/.travis.yml b/.travis.yml
index bab1008..5960012 100644
--- a/.travis.yml
+++ b/.travis.yml
@@ -1,7 +1,7 @@
 language: node_js
 node_js:
-  - "4"
-  - "5"
+  - "6"
+  - "10"
   - "stable"
 before_script:
   - git config --global user.name 'Travis-CI'
diff --git a/CHANGELOG.md b/CHANGELOG.md
index cec6fb0..c5af903 100644
--- a/CHANGELOG.md
+++ b/CHANGELOG.md
@@ -2,6 +2,23 @@
 
 All notable changes to this project will be documented in this file. See [standard-version](https://github.com/conventional-changelog/standard-version) for commit guidelines.
 
+<a name="4.4.0"></a>
+# [4.4.0](https://github.com/conventional-changelog/standard-version/compare/v4.3.0...v4.4.0) (2018-05-21)
+
+
+### Bug Fixes
+
+* show full tag name in checkpoint ([#241](https://github.com/conventional-changelog/standard-version/issues/241)) ([b4ed4f9](https://github.com/conventional-changelog/standard-version/commit/b4ed4f9))
+* use tagPrefix in CHANGELOG lifecycle step ([#243](https://github.com/conventional-changelog/standard-version/issues/243)) ([a56c7ac](https://github.com/conventional-changelog/standard-version/commit/a56c7ac))
+
+
+### Features
+
+* add prerelease lifecycle script hook (closes [#217](https://github.com/conventional-changelog/standard-version/issues/217)) ([#234](https://github.com/conventional-changelog/standard-version/issues/234)) ([ba4e7f6](https://github.com/conventional-changelog/standard-version/commit/ba4e7f6))
+* manifest.json support ([#236](https://github.com/conventional-changelog/standard-version/issues/236)) ([371d992](https://github.com/conventional-changelog/standard-version/commit/371d992))
+
+
+
 <a name="4.3.0"></a>
 # [4.3.0](https://github.com/conventional-changelog/standard-version/compare/v4.2.0...v4.3.0) (2018-01-03)
 
diff --git a/README.md b/README.md
index 41c059c..f5ff0f7 100644
--- a/README.md
+++ b/README.md
@@ -8,23 +8,23 @@
 
 _Having problems? want to contribute? join our [community slack](http://devtoolscommunity.herokuapp.com)_.
 
-> stop using `npm version`, use `standard-version` it rocks!
 
-Automatic versioning and CHANGELOG generation, using GitHub's squash button and
+Automate versioning and CHANGELOG generation, with [semver](https://semver.org/) and
 [conventional commit messages](https://conventionalcommits.org).
 
 _how it works:_
 
 1. when you land commits on your `master` branch, select the _Squash and Merge_ option.
 2. add a title and body that follows the [Conventional Commits Specification](https://conventionalcommits.org).
-3. when you're ready to release to npm:
+3. when you're ready to release:
   1. `git checkout master; git pull origin master`
   2. run `standard-version`
   3. `git push --follow-tags origin master && npm publish`
+     _(or, `docker push`, `gem push`, etc.)_
 
 `standard-version` does the following:
 
-1. bumps the version in _package.json/bower.json_ (based on your commit history)
+1. bumps the version in metadata files (package.json, composer.json, etc).
 2. uses [conventional-changelog](https://github.com/conventional-changelog/conventional-changelog) to update _CHANGELOG.md_
 3. commits _package.json (et al.)_ and _CHANGELOG.md_
 4. tags a new release
@@ -159,6 +159,9 @@
 own supplementary commands during the release. The following
 hooks are available and execute in the order documented:
 
+* `prerelease`: executed before anything happens. If the `prerelease` script returns a
+  non-zero exit code, versioning will be aborted, but it has no other effect on the
+  process.
 * `prebump`/`postbump`: executed before and after the version is bumped. If the `prebump`
   script returns a version #, it will be used rather than
   the version calculated by `standard-version`.
@@ -178,6 +181,19 @@
 }
 ```
 
+As an example to change from using GitHub to track your items to using your projects Jira use a
+`postchangelog` script to replace the url fragment containing 'https://github.com/`myproject`/issues/'
+with a link to your Jira - assuming you have already installed [replace](https://www.npmjs.com/package/replace)
+```json
+{
+  "standard-version": {
+    "scripts": {
+      "postchangelog": "replace 'https://github.com/myproject/issues/' 'https://myjira/browse/' CHANGELOG.md"
+    }
+  }
+}
+```
+
 ### Skipping lifecycle steps
 
 You can skip any of the lifecycle steps (`bump`, `changelog`, `commit`, `tag`),
@@ -229,18 +245,18 @@
 to the console.
 
 ```js
-var standardVersion = require('standard-version')
+const standardVersion = require('standard-version')
 
 // Options are the same as command line, except camelCase
+// standardVersion returns a Promise
 standardVersion({
   noVerify: true,
   infile: 'docs/CHANGELOG.md',
   silent: true
-}, function (err) {
-  if (err) {
-    console.error(`standard-version failed with message: ${err.message}`)
-  }
+}).then(() => {
   // standard-version is done
+}).catch(err => {
+    console.error(`standard-version failed with message: ${err.message}`)
 })
 ```
 
@@ -292,7 +308,7 @@
 
 [`semantic-release`](https://github.com/semantic-release/semantic-release) is a fully automated library/system for versioning, changelog generation, git tagging, and publishing to the npm registry.
 
-`standard-version` is different because it handles the versioning, changelog generation, and git tagging for you **without** automatic pushing (to GitHub) or publishing (to an npm registry). Use of `standard-version` only affects your local git repo - it doesn't affect remote resources at all. After you run `standard-version`, you still have to ability to review things and correct mistakes if you want to.
+`standard-version` is different because it handles the versioning, changelog generation, and git tagging for you **without** automatic pushing (to GitHub) or publishing (to an npm registry). Use of `standard-version` only affects your local git repo - it doesn't affect remote resources at all. After you run `standard-version`, you still have the ability to review things and correct mistakes if you want to.
 
 They are both based on the same foundation of structured commit messages (using [Angular format](https://github.com/bcoe/conventional-changelog-standard/blob/master/convention.md)), but `standard-version` is a good choice for folks who are not yet comfortable letting publishes go out automatically. In this way, you can view `standard-version` as an incremental step to adopting `semantic-release`.
 
diff --git a/appveyor.yml b/appveyor.yml
index ec5ba45..3b190c9 100644
--- a/appveyor.yml
+++ b/appveyor.yml
@@ -1,6 +1,6 @@
 environment:
   matrix:
-    - nodejs_version: '6'
+    - nodejs_version: '10'
 install:
   - ps: Install-Product node $env:nodejs_version
   - git config --global user.name 'Appveyor'
diff --git a/bin/cli.js b/bin/cli.js
index 70ef2d6..d430c82 100755
--- a/bin/cli.js
+++ b/bin/cli.js
@@ -1,11 +1,11 @@
 #!/usr/bin/env node
-var standardVersion = require('../index')
-var cmdParser = require('../command')
 
 /* istanbul ignore if */
-if (process.version.match(/v(\d+)\./)[1] < 4) {
-  console.error('standard-version: Node v4 or greater is required. `standard-version` did not run.')
+if (process.version.match(/v(\d+)\./)[1] < 6) {
+  console.error('standard-version: Node v6 or greater is required. `standard-version` did not run.')
 } else {
+  const standardVersion = require('../index')
+  const cmdParser = require('../command')
   standardVersion(cmdParser.argv)
     .catch(() => {
       process.exit(1)
diff --git a/command.js b/command.js
index c571494..095f965 100755
--- a/command.js
+++ b/command.js
@@ -72,6 +72,11 @@
     default: defaults.dryRun,
     describe: 'See the commands that running standard-version would run'
   })
+  .option('git-tag-fallback', {
+    type: 'boolean',
+    default: defaults.gitTagFallback,
+    describe: `fallback to git tags for version, if no meta-information file is found (e.g., package.json)`
+  })
   .check((argv) => {
     if (typeof argv.scripts !== 'object' || Array.isArray(argv.scripts)) {
       throw Error('scripts must be an object')
diff --git a/defaults.json b/defaults.json
index 2834fb3..b70e546 100644
--- a/defaults.json
+++ b/defaults.json
@@ -9,5 +9,6 @@
   "tagPrefix": "v",
   "scripts": {},
   "skip": {},
-  "dryRun": false
+  "dryRun": false,
+  "gitTagFallback": true
 }
diff --git a/index.js b/index.js
index b5936ee..d8432b0 100755
--- a/index.js
+++ b/index.js
@@ -1,3 +1,4 @@
+const latestSemverTag = require('./lib/latest-semver-tag')
 const path = require('path')
 const printError = require('./lib/print-error')
 
@@ -7,15 +8,33 @@
 const tag = require('./lib/lifecycles/tag')
 
 module.exports = function standardVersion (argv) {
-  var pkgPath = path.resolve(process.cwd(), './package.json')
-  var pkg = require(pkgPath)
-  var newVersion = pkg.version
-  var defaults = require('./defaults')
-  var args = Object.assign({}, defaults, argv)
+  let pkg
+  bump.pkgFiles.forEach((filename) => {
+    if (pkg) return
+    var pkgPath = path.resolve(process.cwd(), filename)
+    try {
+      pkg = require(pkgPath)
+    } catch (err) {}
+  })
+  let newVersion
+  let defaults = require('./defaults')
+  let args = Object.assign({}, defaults, argv)
 
   return Promise.resolve()
     .then(() => {
-      return bump(args, pkg)
+      if (!pkg && args.gitTagFallback) {
+        return latestSemverTag()
+      } else if (!pkg) {
+        throw new Error('no package file found')
+      } else {
+        return pkg.version
+      }
+    })
+    .then(version => {
+      newVersion = version
+    })
+    .then(() => {
+      return bump(args, newVersion)
     })
     .then((_newVersion) => {
       // if bump runs, it calculaes the new version that we
@@ -27,7 +46,7 @@
       return commit(args, newVersion)
     })
     .then(() => {
-      return tag(newVersion, pkg.private, args)
+      return tag(newVersion, pkg ? pkg.private : false, args)
     })
     .catch((err) => {
       printError(args, err.message)
diff --git a/lib/latest-semver-tag.js b/lib/latest-semver-tag.js
new file mode 100644
index 0000000..7c63ec4
--- /dev/null
+++ b/lib/latest-semver-tag.js
@@ -0,0 +1,15 @@
+const gitSemverTags = require('git-semver-tags')
+const semver = require('semver')
+
+module.exports = function () {
+  return new Promise((resolve, reject) => {
+    gitSemverTags(function (err, tags) {
+      if (err) return reject(err)
+      else if (!tags.length) return resolve('1.0.0')
+      // ensure that the largest semver tag is at the head.
+      tags = tags.map(tag => { return semver.clean(tag) })
+      tags.sort(semver.rcompare)
+      return resolve(tags[0])
+    })
+  })
+}
diff --git a/lib/lifecycles/bump.js b/lib/lifecycles/bump.js
index 4ab091c..7fa0857 100644
--- a/lib/lifecycles/bump.js
+++ b/lib/lifecycles/bump.js
@@ -13,22 +13,23 @@
 
 var configsToUpdate = {}
 
-function Bump (args, pkg) {
+function Bump (args, version) {
   // reset the cache of updated config files each
   // time we perform the version bump step.
   configsToUpdate = {}
 
   if (args.skip.bump) return Promise.resolve()
-  var newVersion = pkg.version
-  return runLifecycleScript(args, 'prebump')
+  var newVersion = version
+  return runLifecycleScript(args, 'prerelease')
+    .then(runLifecycleScript.bind(this, args, 'prebump'))
     .then((stdout) => {
       if (stdout && stdout.trim().length) args.releaseAs = stdout.trim()
       return bumpVersion(args.releaseAs)
     })
     .then((release) => {
       if (!args.firstRelease) {
-        var releaseType = getReleaseType(args.prerelease, release.releaseType, pkg.version)
-        newVersion = semver.valid(releaseType) || semver.inc(pkg.version, releaseType, args.prerelease)
+        var releaseType = getReleaseType(args.prerelease, release.releaseType, version)
+        newVersion = semver.valid(releaseType) || semver.inc(version, releaseType, args.prerelease)
         updateConfigs(args, newVersion)
       } else {
         checkpoint(args, 'skip version bump on first release', [], chalk.red(figures.cross))
@@ -46,6 +47,19 @@
   return configsToUpdate
 }
 
+Bump.pkgFiles = [
+  'package.json',
+  'bower.json',
+  'manifest.json',
+  'composer.json'
+]
+
+Bump.lockFiles = [
+  'package-lock.json',
+  'npm-shrinkwrap.json',
+  'composer.lock'
+]
+
 function getReleaseType (prerelease, expectedReleaseType, currentVersion) {
   if (isString(prerelease)) {
     if (isInPrerelease(currentVersion)) {
@@ -138,10 +152,9 @@
  */
 function updateConfigs (args, newVersion) {
   const dotgit = DotGitignore()
-  configsToUpdate[path.resolve(process.cwd(), './package.json')] = false
-  configsToUpdate[path.resolve(process.cwd(), './package-lock.json')] = false
-  configsToUpdate[path.resolve(process.cwd(), './npm-shrinkwrap.json')] = false
-  configsToUpdate[path.resolve(process.cwd(), './bower.json')] = false
+  Bump.pkgFiles.concat(Bump.lockFiles).forEach((filename) => {
+    configsToUpdate[path.resolve(process.cwd(), filename)] = false
+  })
   Object.keys(configsToUpdate).forEach(function (configPath) {
     try {
       if (dotgit.ignore(configPath)) return
diff --git a/lib/lifecycles/changelog.js b/lib/lifecycles/changelog.js
index 136f830..084914d 100644
--- a/lib/lifecycles/changelog.js
+++ b/lib/lifecycles/changelog.js
@@ -28,11 +28,11 @@
     }
     var content = ''
     var context
-    if (args.dryRun) context = {version: newVersion}
+    if (args.dryRun) context = { version: newVersion }
     var changelogStream = conventionalChangelog({
       preset: 'angular',
       tagPrefix: args.tagPrefix
-    }, context, {merges: null})
+    }, context, { merges: null })
       .on('error', function (err) {
         return reject(err)
       })
diff --git a/lib/lifecycles/tag.js b/lib/lifecycles/tag.js
index c7dc531..fc41acb 100644
--- a/lib/lifecycles/tag.js
+++ b/lib/lifecycles/tag.js
@@ -23,12 +23,18 @@
   } else {
     tagOption = '-a '
   }
-  checkpoint(args, 'tagging release %s', [newVersion])
+  checkpoint(args, 'tagging release %s%s', [args.tagPrefix, newVersion])
   return runExec(args, 'git tag ' + tagOption + args.tagPrefix + newVersion + ' -m "' + formatCommitMessage(args.message, newVersion) + '"')
     .then(() => {
       var message = 'git push --follow-tags origin master'
       if (pkgPrivate !== true) message += ' && npm publish'
-      if (args.prerelease !== undefined) message += ' --tag prerelease'
+      if (args.prerelease !== undefined) {
+        if (args.prerelease === '') {
+          message += ' --tag prerelease'
+        } else {
+          message += ' --tag ' + args.prerelease
+        }
+      }
 
       checkpoint(args, 'Run `%s` to publish', [message], chalk.blue(figures.info))
     })
diff --git a/lib/run-exec.js b/lib/run-exec.js
index 4ce3cb0..ffcd17d 100644
--- a/lib/run-exec.js
+++ b/lib/run-exec.js
@@ -12,7 +12,7 @@
         printError(args, stderr || err.message)
         return reject(err)
       } else if (stderr) {
-        printError(args, stderr, {level: 'warn', color: 'yellow'})
+        printError(args, stderr, { level: 'warn', color: 'yellow' })
       }
       return resolve(stdout)
     })
diff --git a/package.json b/package.json
index 833340e..7de0690 100644
--- a/package.json
+++ b/package.json
@@ -1,6 +1,6 @@
 {
   "name": "standard-version",
-  "version": "4.3.0",
+  "version": "4.4.0",
   "description": "replacement for `npm version` with automatic CHANGELOG generation",
   "bin": "bin/cli.js",
   "scripts": {
@@ -38,23 +38,23 @@
   },
   "homepage": "https://github.com/conventional-changelog/standard-version#readme",
   "dependencies": {
-    "chalk": "^1.1.3",
-    "conventional-changelog": "^1.1.0",
-    "conventional-recommended-bump": "^1.0.0",
+    "chalk": "^2.4.1",
+    "conventional-changelog": "^3.0.5",
+    "conventional-recommended-bump": "^4.0.4",
     "dotgitignore": "^1.0.3",
-    "figures": "^1.5.0",
+    "figures": "^2.0.0",
     "fs-access": "^1.0.0",
-    "semver": "^5.1.0",
-    "yargs": "^8.0.1"
+    "semver": "^5.2.0",
+    "yargs": "^12.0.2"
   },
   "devDependencies": {
     "chai": "^3.5.0",
-    "coveralls": "^2.11.9",
-    "mocha": "^3.1.0",
-    "mock-git": "^1.0.2",
+    "coveralls": "^3.0.1",
+    "mocha": "^5.2.0",
+    "mock-git": "^1.0.3",
     "mockery": "^2.0.0",
-    "nyc": "^11.0.2",
-    "shelljs": "^0.7.3",
-    "standard": "^10.0.0"
+    "nyc": "^13.1.0",
+    "shelljs": "^0.7.8",
+    "standard": "^12.0.1"
   }
 }
diff --git a/renovate.json b/renovate.json
new file mode 100644
index 0000000..010732b
--- /dev/null
+++ b/renovate.json
@@ -0,0 +1,3 @@
+{
+  "enabled": false
+}
diff --git a/test.js b/test.js
index a2e0450..ec891f9 100644
--- a/test.js
+++ b/test.js
@@ -2,16 +2,16 @@
 
 'use strict'
 
-var shell = require('shelljs')
-var fs = require('fs')
-var path = require('path')
-var stream = require('stream')
-var mockGit = require('mock-git')
-var mockery = require('mockery')
-var semver = require('semver')
-var formatCommitMessage = require('./lib/format-commit-message')
-var cli = require('./command')
-var standardVersion = require('./index')
+const shell = require('shelljs')
+const fs = require('fs')
+const path = require('path')
+const stream = require('stream')
+const mockGit = require('mock-git')
+const mockery = require('mockery')
+const semver = require('semver')
+const formatCommitMessage = require('./lib/format-commit-message')
+const cli = require('./command')
+const standardVersion = require('./index')
 
 require('chai').should()
 
@@ -43,17 +43,22 @@
 
 function writePackageJson (version, option) {
   option = option || {}
-  var pkg = Object.assign(option, {version: version})
+  var pkg = Object.assign(option, { version: version })
   fs.writeFileSync('package.json', JSON.stringify(pkg), 'utf-8')
-  delete require.cache[require.resolve(path.join(process.cwd(), 'package.json'))]
 }
 
 function writeBowerJson (version, option) {
   option = option || {}
-  var bower = Object.assign(option, {version: version})
+  var bower = Object.assign(option, { version: version })
   fs.writeFileSync('bower.json', JSON.stringify(bower), 'utf-8')
 }
 
+function writeManifestJson (version, option) {
+  option = option || {}
+  var manifest = Object.assign(option, { version: version })
+  fs.writeFileSync('manifest.json', JSON.stringify(manifest), 'utf-8')
+}
+
 function writeNpmShrinkwrapJson (version, option) {
   option = option || {}
   var shrinkwrap = Object.assign(option, { version: version })
@@ -90,6 +95,16 @@
   shell.cd('tmp')
   shell.exec('git init')
   commit('root-commit')
+  ;['package.json',
+    'manifest.json',
+    'bower.json'
+  ].forEach(metadata => {
+    try {
+      delete require.cache[require.resolve(path.join(process.cwd(), metadata))]
+    } catch (err) {
+      // we haven't loaded the metadata file yet.
+    }
+  })
   writePackageJson('1.0.0')
 }
 
@@ -252,6 +267,42 @@
   })
 
   describe('lifecycle scripts', () => {
+    describe('prerelease hook', function () {
+      it('should run the prerelease hook when provided', function () {
+        writePackageJson('1.0.0', {
+          'standard-version': {
+            'scripts': {
+              'prerelease': 'node scripts/prerelease'
+            }
+          }
+        })
+        writeHook('prerelease')
+        fs.writeFileSync('CHANGELOG.md', 'legacy header format<a name="1.0.0">\n', 'utf-8')
+
+        commit('feat: first commit')
+        var result = execCli('--patch')
+        result.code.should.equal(0)
+        result.stderr.should.match(/prerelease ran/)
+      })
+
+      it('should abort if the hook returns a non-zero exit code', function () {
+        writePackageJson('1.0.0', {
+          'standard-version': {
+            'scripts': {
+              'prerelease': 'node scripts/prerelease && exit 1'
+            }
+          }
+        })
+        writeHook('prerelease')
+        fs.writeFileSync('CHANGELOG.md', 'legacy header format<a name="1.0.0">\n', 'utf-8')
+
+        commit('feat: first commit')
+        var result = execCli('--patch')
+        result.code.should.equal(1)
+        result.stderr.should.match(/prerelease ran/)
+      })
+    })
+
     describe('prebump hook', function () {
       it('should allow prebump hook to return an alternate version #', function () {
         writePackageJson('1.0.0', {
@@ -381,6 +432,14 @@
       commit('feat: first commit')
       execCli('--prerelease').stdout.should.include('--tag prerelease')
     })
+
+    it('advises use of --tag alpha for publishing to npm when tagging alpha', function () {
+      writePackageJson('1.0.0')
+      fs.writeFileSync('CHANGELOG.md', 'legacy header format<a name="1.0.0">\n', 'utf-8')
+
+      commit('feat: first commit')
+      execCli('--prerelease alpha').stdout.should.include('--tag alpha')
+    })
   })
 
   describe('manual-release', function () {
@@ -565,7 +624,7 @@
   })
 
   it('does not display `npm publish` if the package is private', function () {
-    writePackageJson('1.0.0', {private: true})
+    writePackageJson('1.0.0', { private: true })
 
     var result = execCli()
     result.code.should.equal(0)
@@ -624,7 +683,7 @@
 
   describe('with mocked conventionalRecommendedBump', function () {
     beforeEach(function () {
-      mockery.enable({warnOnUnregistered: false, useCleanCache: true})
+      mockery.enable({ warnOnUnregistered: false, useCleanCache: true })
       mockery.registerMock('conventional-recommended-bump', function (_, cb) {
         cb(new Error('bump err'))
       })
@@ -640,7 +699,7 @@
       shell.exec('git tag -a v1.0.0 -m "my awesome first release"')
       commit('feat: new feature!')
 
-      require('./index')({silent: true})
+      require('./index')({ silent: true })
         .catch((err) => {
           err.message.should.match(/bump err/)
           done()
@@ -650,9 +709,9 @@
 
   describe('with mocked conventionalChangelog', function () {
     beforeEach(function () {
-      mockery.enable({warnOnUnregistered: false, useCleanCache: true})
+      mockery.enable({ warnOnUnregistered: false, useCleanCache: true })
       mockery.registerMock('conventional-changelog', function () {
-        var readable = new stream.Readable({objectMode: true})
+        var readable = new stream.Readable({ objectMode: true })
         readable._read = function () {
         }
         setImmediate(readable.emit.bind(readable), 'error', new Error('changelog err'))
@@ -670,7 +729,7 @@
       shell.exec('git tag -a v1.0.0 -m "my awesome first release"')
       commit('feat: new feature!')
 
-      require('./index')({silent: true})
+      require('./index')({ silent: true })
         .catch((err) => {
           err.message.should.match(/changelog err/)
           return done()
@@ -683,7 +742,7 @@
     shell.exec('git tag -a v1.0.0 -m "my awesome first release"')
     commit('feat: new feature!')
 
-    require('./index')({silent: true})
+    require('./index')({ silent: true })
       .then(() => {
         // check last commit message
         shell.exec('git log --oneline -n1').stdout.should.match(/chore\(release\): 1\.1\.0/)
@@ -693,6 +752,19 @@
       })
   })
 
+  describe('without a package file to bump', function () {
+    it('should exit with error', function () {
+      shell.rm('package.json')
+      return require('./index')({
+        silent: true,
+        gitTagFallback: false
+      })
+        .catch((err) => {
+          err.message.should.equal('no package file found')
+        })
+    })
+  })
+
   describe('bower.json support', function () {
     beforeEach(function () {
       writeBowerJson('1.0.0')
@@ -702,7 +774,7 @@
       commit('feat: first commit')
       shell.exec('git tag -a v1.0.0 -m "my awesome first release"')
       commit('feat: new feature!')
-      return require('./index')({silent: true})
+      return require('./index')({ silent: true })
         .then(() => {
           JSON.parse(fs.readFileSync('bower.json', 'utf-8')).version.should.equal('1.1.0')
           getPackageVersion().should.equal('1.1.0')
@@ -710,6 +782,23 @@
     })
   })
 
+  describe('manifest.json support', function () {
+    beforeEach(function () {
+      writeManifestJson('1.0.0')
+    })
+
+    it('bumps version # in manifest.json', function () {
+      commit('feat: first commit')
+      shell.exec('git tag -a v1.0.0 -m "my awesome first release"')
+      commit('feat: new feature!')
+      return require('./index')({ silent: true })
+        .then(() => {
+          JSON.parse(fs.readFileSync('manifest.json', 'utf-8')).version.should.equal('1.1.0')
+          getPackageVersion().should.equal('1.1.0')
+        })
+    })
+  })
+
   describe('npm-shrinkwrap.json support', function () {
     beforeEach(function () {
       writeNpmShrinkwrapJson('1.0.0')
@@ -719,7 +808,7 @@
       commit('feat: first commit')
       shell.exec('git tag -a v1.0.0 -m "my awesome first release"')
       commit('feat: new feature!')
-      require('./index')({silent: true})
+      require('./index')({ silent: true })
         .then(() => {
           JSON.parse(fs.readFileSync('npm-shrinkwrap.json', 'utf-8')).version.should.equal('1.1.0')
           getPackageVersion().should.equal('1.1.0')
@@ -738,7 +827,7 @@
       commit('feat: first commit')
       shell.exec('git tag -a v1.0.0 -m "my awesome first release"')
       commit('feat: new feature!')
-      return require('./index')({silent: true})
+      return require('./index')({ silent: true })
         .then(() => {
           JSON.parse(fs.readFileSync('package-lock.json', 'utf-8')).version.should.equal('1.1.0')
           getPackageVersion().should.equal('1.1.0')
@@ -802,11 +891,54 @@
       commit('feat: first commit')
       shell.exec('git tag -a v1.0.0 -m "my awesome first release"')
       commit('feat: new feature!')
-      return require('./index')({silent: true})
+      return require('./index')({ silent: true })
         .then(() => {
           JSON.parse(fs.readFileSync('bower.json', 'utf-8')).version.should.equal('1.0.0')
           getPackageVersion().should.equal('1.1.0')
         })
     })
   })
+
+  describe('.gitignore', () => {
+    beforeEach(function () {
+      writeBowerJson('1.0.0')
+    })
+
+    it('does not update files present in .gitignore', () => {
+      fs.writeFileSync('.gitignore', 'bower.json', 'utf-8')
+
+      commit('feat: first commit')
+      shell.exec('git tag -a v1.0.0 -m "my awesome first release"')
+      commit('feat: new feature!')
+      return require('./index')({ silent: true })
+        .then(() => {
+          JSON.parse(fs.readFileSync('bower.json', 'utf-8')).version.should.equal('1.0.0')
+          getPackageVersion().should.equal('1.1.0')
+        })
+    })
+  })
+
+  describe('gitTagFallback', () => {
+    it('defaults to 1.0.0 if no tags in git history', () => {
+      shell.rm('package.json')
+      commit('feat: first commit')
+      return require('./index')({ silent: true })
+        .then(() => {
+          const output = shell.exec('git tag')
+          output.stdout.should.include('v1.1.0')
+        })
+    })
+
+    it('bases version on last tag, if tags are found', () => {
+      shell.rm('package.json')
+      shell.exec('git tag -a v5.0.0 -m "a release"')
+      shell.exec('git tag -a v3.0.0 -m "another release"')
+      commit('feat: another commit')
+      return require('./index')({ silent: true })
+        .then(() => {
+          const output = shell.exec('git tag')
+          output.stdout.should.include('v5.1.0')
+        })
+    })
+  })
 })

=====================================================================
start time: Wed Jan 03 00:00:00 CST 2018
end time: Mon May 21 00:00:00 CST 2018
### Bug Fixes* show full tag name in checkpoint ([#241](https://github.com/conventional-changelog/standard-version/issues/241)) ([b4ed4f9](https://github.com/conventional-changelog/standard-version/commit/b4ed4f9))* use tagPrefix in CHANGELOG lifecycle step ([#243](https://github.com/conventional-changelog/standard-version/issues/243)) ([a56c7ac](https://github.com/conventional-changelog/standard-version/commit/a56c7ac))### Features* add prerelease lifecycle script hook (closes [#217](https://github.com/conventional-changelog/standard-version/issues/217)) ([#234](https://github.com/conventional-changelog/standard-version/issues/234)) ([ba4e7f6](https://github.com/conventional-changelog/standard-version/commit/ba4e7f6))* manifest.json support ([#236](https://github.com/conventional-changelog/standard-version/issues/236)) ([371d992](https://github.com/conventional-changelog/standard-version/commit/371d992))<a name="4.3.0"></a>
diff --git a/.gitignore b/.gitignore
index 7e95d3c..7d21798 100644
--- a/.gitignore
+++ b/.gitignore
@@ -14,3 +14,4 @@
 
 # coverage
 coverage
+package-lock.json
\ No newline at end of file
diff --git a/CHANGELOG.md b/CHANGELOG.md
index c5242fb..cec6fb0 100644
--- a/CHANGELOG.md
+++ b/CHANGELOG.md
@@ -2,6 +2,24 @@
 
 All notable changes to this project will be documented in this file. See [standard-version](https://github.com/conventional-changelog/standard-version) for commit guidelines.
 
+<a name="4.3.0"></a>
+# [4.3.0](https://github.com/conventional-changelog/standard-version/compare/v4.2.0...v4.3.0) (2018-01-03)
+
+
+### Bug Fixes
+
+* recommend `--tag` prerelease for npm publish of prereleases ([#196](https://github.com/conventional-changelog/standard-version/issues/196)) ([709dae1](https://github.com/conventional-changelog/standard-version/commit/709dae1)), closes [#183](https://github.com/conventional-changelog/standard-version/issues/183)
+* use the `skip` default value for skip cli arg ([#211](https://github.com/conventional-changelog/standard-version/issues/211)) ([3fdd7fa](https://github.com/conventional-changelog/standard-version/commit/3fdd7fa))
+
+
+### Features
+
+* **format-commit-message:** support multiple %s in the message ([45fcad5](https://github.com/conventional-changelog/standard-version/commit/45fcad5))
+* do not update/commit files in .gitignore ([#230](https://github.com/conventional-changelog/standard-version/issues/230)) ([4fd3bc2](https://github.com/conventional-changelog/standard-version/commit/4fd3bc2))
+* publish only if commit+push succeed ([#229](https://github.com/conventional-changelog/standard-version/issues/229)) ([c5e1ee2](https://github.com/conventional-changelog/standard-version/commit/c5e1ee2))
+
+
+
 <a name="4.2.0"></a>
 # [4.2.0](https://github.com/conventional-changelog/standard-version/compare/v4.1.0...v4.2.0) (2017-06-12)
 
diff --git a/lib/lifecycles/bump.js b/lib/lifecycles/bump.js
index 47ad11f..4ab091c 100644
--- a/lib/lifecycles/bump.js
+++ b/lib/lifecycles/bump.js
@@ -1,8 +1,11 @@
+'use strict'
+
 const chalk = require('chalk')
 const checkpoint = require('../checkpoint')
 const conventionalRecommendedBump = require('conventional-recommended-bump')
 const figures = require('figures')
 const fs = require('fs')
+const DotGitignore = require('dotgitignore')
 const path = require('path')
 const runLifecycleScript = require('../run-lifecycle-script')
 const semver = require('semver')
@@ -134,12 +137,14 @@
  * @return {string}
  */
 function updateConfigs (args, newVersion) {
+  const dotgit = DotGitignore()
   configsToUpdate[path.resolve(process.cwd(), './package.json')] = false
   configsToUpdate[path.resolve(process.cwd(), './package-lock.json')] = false
   configsToUpdate[path.resolve(process.cwd(), './npm-shrinkwrap.json')] = false
   configsToUpdate[path.resolve(process.cwd(), './bower.json')] = false
   Object.keys(configsToUpdate).forEach(function (configPath) {
     try {
+      if (dotgit.ignore(configPath)) return
       var stat = fs.lstatSync(configPath)
       if (stat.isFile()) {
         var config = require(configPath)
diff --git a/lib/lifecycles/changelog.js b/lib/lifecycles/changelog.js
index 1eb1617..136f830 100644
--- a/lib/lifecycles/changelog.js
+++ b/lib/lifecycles/changelog.js
@@ -30,7 +30,8 @@
     var context
     if (args.dryRun) context = {version: newVersion}
     var changelogStream = conventionalChangelog({
-      preset: 'angular'
+      preset: 'angular',
+      tagPrefix: args.tagPrefix
     }, context, {merges: null})
       .on('error', function (err) {
         return reject(err)
diff --git a/package.json b/package.json
index eecc1d3..833340e 100644
--- a/package.json
+++ b/package.json
@@ -1,6 +1,6 @@
 {
   "name": "standard-version",
-  "version": "4.2.0",
+  "version": "4.3.0",
   "description": "replacement for `npm version` with automatic CHANGELOG generation",
   "bin": "bin/cli.js",
   "scripts": {
@@ -41,6 +41,7 @@
     "chalk": "^1.1.3",
     "conventional-changelog": "^1.1.0",
     "conventional-recommended-bump": "^1.0.0",
+    "dotgitignore": "^1.0.3",
     "figures": "^1.5.0",
     "fs-access": "^1.0.0",
     "semver": "^5.1.0",
diff --git a/test.js b/test.js
index b18cf71..a2e0450 100644
--- a/test.js
+++ b/test.js
@@ -590,6 +590,32 @@
     var pkgJson = fs.readFileSync('package.json', 'utf-8')
     pkgJson.should.equal(['{', '  "version": "1.1.0"', '}', ''].join('\n'))
   })
+
+  it('exits with error code if "scripts" is not an object', () => {
+    writePackageJson('1.0.0', {
+      'standard-version': {
+        scripts: 'echo hello'
+      }
+    })
+
+    commit('feat: first commit')
+    var result = execCli()
+    result.code.should.equal(1)
+    result.stderr.should.match(/scripts must be an object/)
+  })
+
+  it('exits with error code if "skip" is not an object', () => {
+    writePackageJson('1.0.0', {
+      'standard-version': {
+        skip: true
+      }
+    })
+
+    commit('feat: first commit')
+    var result = execCli()
+    result.code.should.equal(1)
+    result.stderr.should.match(/skip must be an object/)
+  })
 })
 
 describe('standard-version', function () {
@@ -672,15 +698,14 @@
       writeBowerJson('1.0.0')
     })
 
-    it('bumps version # in bower.json', function (done) {
+    it('bumps version # in bower.json', function () {
       commit('feat: first commit')
       shell.exec('git tag -a v1.0.0 -m "my awesome first release"')
       commit('feat: new feature!')
-      require('./index')({silent: true})
+      return require('./index')({silent: true})
         .then(() => {
           JSON.parse(fs.readFileSync('bower.json', 'utf-8')).version.should.equal('1.1.0')
           getPackageVersion().should.equal('1.1.0')
-          return done()
         })
     })
   })
@@ -706,17 +731,17 @@
   describe('package-lock.json support', function () {
     beforeEach(function () {
       writePackageLockJson('1.0.0')
+      fs.writeFileSync('.gitignore', '', 'utf-8')
     })
 
-    it('bumps version # in package-lock.json', function (done) {
+    it('bumps version # in package-lock.json', function () {
       commit('feat: first commit')
       shell.exec('git tag -a v1.0.0 -m "my awesome first release"')
       commit('feat: new feature!')
-      require('./index')({silent: true})
+      return require('./index')({silent: true})
         .then(() => {
           JSON.parse(fs.readFileSync('package-lock.json', 'utf-8')).version.should.equal('1.1.0')
           getPackageVersion().should.equal('1.1.0')
-          return done()
         })
     })
   })
@@ -765,4 +790,23 @@
         })
     })
   })
+
+  describe('.gitignore', () => {
+    beforeEach(function () {
+      writeBowerJson('1.0.0')
+    })
+
+    it('does not update files present in .gitignore', () => {
+      fs.writeFileSync('.gitignore', 'bower.json', 'utf-8')
+
+      commit('feat: first commit')
+      shell.exec('git tag -a v1.0.0 -m "my awesome first release"')
+      commit('feat: new feature!')
+      return require('./index')({silent: true})
+        .then(() => {
+          JSON.parse(fs.readFileSync('bower.json', 'utf-8')).version.should.equal('1.0.0')
+          getPackageVersion().should.equal('1.1.0')
+        })
+    })
+  })
 })

=====================================================================
start time: Mon Jun 12 00:00:00 CST 2017
end time: Wed Jan 03 00:00:00 CST 2018
### Bug Fixes* recommend `--tag` prerelease for npm publish of prereleases ([#196](https://github.com/conventional-changelog/standard-version/issues/196)) ([709dae1](https://github.com/conventional-changelog/standard-version/commit/709dae1)), closes [#183](https://github.com/conventional-changelog/standard-version/issues/183)* use the `skip` default value for skip cli arg ([#211](https://github.com/conventional-changelog/standard-version/issues/211)) ([3fdd7fa](https://github.com/conventional-changelog/standard-version/commit/3fdd7fa))### Features* **format-commit-message:** support multiple %s in the message ([45fcad5](https://github.com/conventional-changelog/standard-version/commit/45fcad5))* do not update/commit files in .gitignore ([#230](https://github.com/conventional-changelog/standard-version/issues/230)) ([4fd3bc2](https://github.com/conventional-changelog/standard-version/commit/4fd3bc2))* publish only if commit+push succeed ([#229](https://github.com/conventional-changelog/standard-version/issues/229)) ([c5e1ee2](https://github.com/conventional-changelog/standard-version/commit/c5e1ee2))<a name="4.2.0"></a>
diff --git a/README.md b/README.md
index 5e57f46..2148df4 100644
--- a/README.md
+++ b/README.md
@@ -1,11 +1,12 @@
 # Standard Version
 
-[![Join the chat at https://gitter.im/conventional-changelog/standard-version](https://badges.gitter.im/conventional-changelog/standard-version.svg)](https://gitter.im/conventional-changelog/standard-version?utm_source=badge&utm_medium=badge&utm_campaign=pr-badge&utm_content=badge)
-
 [![Build Status](https://travis-ci.org/conventional-changelog/standard-version.svg?branch=master)](https://travis-ci.org/conventional-changelog/standard-version)
 [![NPM version](https://img.shields.io/npm/v/standard-version.svg)](https://www.npmjs.com/package/standard-version)
 [![Coverage Status](https://coveralls.io/repos/conventional-changelog/standard-version/badge.svg?branch=)](https://coveralls.io/r/conventional-changelog/standard-version?branch=master)
 [![Conventional Commits](https://img.shields.io/badge/Conventional%20Commits-1.0.0-yellow.svg)](https://conventionalcommits.org)
+[![community slack](http://devtoolscommunity.herokuapp.com/badge.svg)](http://devtoolscommunity.herokuapp.com)
+
+_Having problems? want to contribute? join our [community slack](http://devtoolscommunity.herokuapp.com)_.
 
 > stop using `npm version`, use `standard-version` it rocks!
 
diff --git a/command.js b/command.js
index 0fa0442..c571494 100755
--- a/command.js
+++ b/command.js
@@ -65,7 +65,7 @@
   })
   .option('skip', {
     describe: 'Map of steps in the release process that should be skipped',
-    default: defaults.scripts
+    default: defaults.skip
   })
   .option('dry-run', {
     type: 'boolean',
diff --git a/lib/lifecycles/tag.js b/lib/lifecycles/tag.js
index b5bf7ae..1491801 100644
--- a/lib/lifecycles/tag.js
+++ b/lib/lifecycles/tag.js
@@ -28,6 +28,7 @@
     .then(() => {
       var message = 'git push --follow-tags origin master'
       if (pkgPrivate !== true) message += '; npm publish'
+      if (args.prerelease !== undefined) message += ' --tag prerelease'
 
       checkpoint(args, 'Run `%s` to publish', [message], chalk.blue(figures.info))
     })
diff --git a/test.js b/test.js
index 001c858..b18cf71 100644
--- a/test.js
+++ b/test.js
@@ -9,6 +9,7 @@
 var mockGit = require('mock-git')
 var mockery = require('mockery')
 var semver = require('semver')
+var formatCommitMessage = require('./lib/format-commit-message')
 var cli = require('./command')
 var standardVersion = require('./index')
 
@@ -101,6 +102,18 @@
   return JSON.parse(fs.readFileSync('package.json', 'utf-8')).version
 }
 
+describe('format-commit-message', function () {
+  it('works for no %s', function () {
+    formatCommitMessage('chore(release): 1.0.0', '1.0.0').should.equal('chore(release): 1.0.0')
+  })
+  it('works for one %s', function () {
+    formatCommitMessage('chore(release): %s', '1.0.0').should.equal('chore(release): 1.0.0')
+  })
+  it('works for two %s', function () {
+    formatCommitMessage('chore(release): %s \n\n* CHANGELOG: https://github.com/conventional-changelog/standard-version/blob/v%s/CHANGELOG.md', '1.0.0').should.equal('chore(release): 1.0.0 \n\n* CHANGELOG: https://github.com/conventional-changelog/standard-version/blob/v1.0.0/CHANGELOG.md')
+  })
+})
+
 describe('cli', function () {
   beforeEach(initInTempFolder)
   afterEach(finishTemp)
@@ -360,6 +373,14 @@
           getPackageVersion().should.equal('1.1.0-0')
         })
     })
+
+    it('advises use of --tag prerelease for publishing to npm', function () {
+      writePackageJson('1.0.0')
+      fs.writeFileSync('CHANGELOG.md', 'legacy header format<a name="1.0.0">\n', 'utf-8')
+
+      commit('feat: first commit')
+      execCli('--prerelease').stdout.should.include('--tag prerelease')
+    })
   })
 
   describe('manual-release', function () {

=====================================================================
start time: Tue Jun 06 00:00:00 CST 2017
end time: Mon Jun 12 00:00:00 CST 2017
### Features* add support for `package-lock.json` ([#190](https://github.com/conventional-changelog/standard-version/issues/190)) ([bc0fc53](https://github.com/conventional-changelog/standard-version/commit/bc0fc53))<a name="4.1.0"></a>
diff --git a/CHANGELOG.md b/CHANGELOG.md
index 4da1451..b145abe 100644
--- a/CHANGELOG.md
+++ b/CHANGELOG.md
@@ -2,6 +2,21 @@
 
 All notable changes to this project will be documented in this file. See [standard-version](https://github.com/conventional-changelog/standard-version) for commit guidelines.
 
+<a name="4.1.0"></a>
+# [4.1.0](https://github.com/conventional-changelog/standard-version/compare/v4.0.0...v4.1.0) (2017-06-06)
+
+
+### Features
+
+* **cli:** print error and don't run with node <4, closes [#124](https://github.com/conventional-changelog/standard-version/issues/124) ([d0d71a5](https://github.com/conventional-changelog/standard-version/commit/d0d71a5))
+* add dry-run mode ([#187](https://github.com/conventional-changelog/standard-version/issues/187)) ([d073353](https://github.com/conventional-changelog/standard-version/commit/d073353))
+* add prebump, postbump, precommit, lifecycle scripts ([#186](https://github.com/conventional-changelog/standard-version/issues/186)) ([dfd1d12](https://github.com/conventional-changelog/standard-version/commit/dfd1d12))
+* add support for `npm-shrinkwrap.json` ([#185](https://github.com/conventional-changelog/standard-version/issues/185)) ([86af7fc](https://github.com/conventional-changelog/standard-version/commit/86af7fc))
+* add support for skipping lifecycle steps, polish lifecycle work ([#188](https://github.com/conventional-changelog/standard-version/issues/188)) ([d31dcdb](https://github.com/conventional-changelog/standard-version/commit/d31dcdb))
+* allow a version # to be provided for release-as, rather than just major, minor, patch. ([13eb9cd](https://github.com/conventional-changelog/standard-version/commit/13eb9cd))
+
+
+
 <a name="4.0.0"></a>
 # [4.0.0](https://github.com/conventional-changelog/standard-version/compare/v4.0.0-1...v4.0.0) (2016-12-02)
 
diff --git a/README.md b/README.md
index 9dc47ae..5e57f46 100644
--- a/README.md
+++ b/README.md
@@ -156,18 +156,16 @@
 
 `standard-version` supports lifecycle scripts. These allow you to execute your
 own supplementary commands during the release. The following
-hooks are available:
+hooks are available and execute in the order documented:
 
-* `prebump`: executed before the version bump is calculated. If the `prebump`
+* `prebump`/`postbump`: executed before and after the version is bumped. If the `prebump`
   script returns a version #, it will be used rather than
   the version calculated by `standard-version`.
-* `postbump`: executed after the version has been bumped and written to
-  package.json. The flag `--new-version` is populated with the version that is
-  being released.
-* `precommit`: called after CHANGELOG.md and package.json have been updated,
-  but before changes have been committed to git.
+* `prechangelog`/`postchangelog`: executes before and after the CHANGELOG is generated.
+* `precommit`/`postcommit`: called before and after the commit step.
+* `pretag`/`posttag`: called before and after the tagging step.
 
-Simply add the following to your package.json, to enable lifecycle scripts:
+Simply add the following to your package.json to configure lifecycle scripts:
 
 ```json
 {
@@ -179,6 +177,21 @@
 }
 ```
 
+### Skipping lifecycle steps
+
+You can skip any of the lifecycle steps (`bump`, `changelog`, `commit`, `tag`),
+by adding the following to your package.json:
+
+```json
+{
+  "standard-version": {
+    "skip": {
+      "changelog": true
+    }
+  }
+}
+```
+
 ### Committing generated artifacts in the release commit
 
 If you want to commit generated artifacts in the release commit (e.g. [#96](https://github.com/conventional-changelog/standard-version/issues/96)), you can use the `--commit-all` or `-a` flag. You will need to stage the artifacts you want to commit, so your `release` command could look like this:
diff --git a/command.js b/command.js
index 3c65226..0fa0442 100755
--- a/command.js
+++ b/command.js
@@ -60,7 +60,11 @@
     default: defaults.tagPrefix
   })
   .option('scripts', {
-    describe: 'Scripts to execute for lifecycle events (prebump, precommit, etc.,)',
+    describe: 'Provide scripts to execute for lifecycle events (prebump, precommit, etc.,)',
+    default: defaults.scripts
+  })
+  .option('skip', {
+    describe: 'Map of steps in the release process that should be skipped',
     default: defaults.scripts
   })
   .option('dry-run', {
@@ -71,6 +75,8 @@
   .check((argv) => {
     if (typeof argv.scripts !== 'object' || Array.isArray(argv.scripts)) {
       throw Error('scripts must be an object')
+    } else if (typeof argv.skip !== 'object' || Array.isArray(argv.skip)) {
+      throw Error('skip must be an object')
     } else {
       return true
     }
diff --git a/defaults.json b/defaults.json
index b737c0c..2834fb3 100644
--- a/defaults.json
+++ b/defaults.json
@@ -8,5 +8,6 @@
   "silent": false,
   "tagPrefix": "v",
   "scripts": {},
+  "skip": {},
   "dryRun": false
 }
diff --git a/index.js b/index.js
index 5b56f3c..b5936ee 100755
--- a/index.js
+++ b/index.js
@@ -1,19 +1,10 @@
-const conventionalRecommendedBump = require('conventional-recommended-bump')
-const conventionalChangelog = require('conventional-changelog')
 const path = require('path')
-
-const chalk = require('chalk')
-const figures = require('figures')
-const fs = require('fs')
-const accessSync = require('fs-access').sync
-const semver = require('semver')
-const util = require('util')
-
-const checkpoint = require('./lib/checkpoint')
 const printError = require('./lib/print-error')
-const runExec = require('./lib/run-exec')
-const runLifecycleScript = require('./lib/run-lifecycle-script')
-const writeFile = require('./lib/write-file')
+
+const bump = require('./lib/lifecycles/bump')
+const changelog = require('./lib/lifecycles/changelog')
+const commit = require('./lib/lifecycles/commit')
+const tag = require('./lib/lifecycles/tag')
 
 module.exports = function standardVersion (argv) {
   var pkgPath = path.resolve(process.cwd(), './package.json')
@@ -22,30 +13,17 @@
   var defaults = require('./defaults')
   var args = Object.assign({}, defaults, argv)
 
-  return runLifecycleScript(args, 'prebump', null)
-    .then((stdout) => {
-      if (stdout && stdout.trim().length) args.releaseAs = stdout.trim()
-      return bumpVersion(args.releaseAs)
+  return Promise.resolve()
+    .then(() => {
+      return bump(args, pkg)
     })
-    .then((release) => {
-      if (!args.firstRelease) {
-        var releaseType = getReleaseType(args.prerelease, release.releaseType, pkg.version)
-        newVersion = semver.valid(releaseType) || semver.inc(pkg.version, releaseType, args.prerelease)
-        updateConfigs(args, newVersion)
-      } else {
-        checkpoint(args, 'skip version bump on first release', [], chalk.red(figures.cross))
-      }
-
-      return runLifecycleScript(args, 'postbump', newVersion, args)
+    .then((_newVersion) => {
+      // if bump runs, it calculaes the new version that we
+      // should release at.
+      if (_newVersion) newVersion = _newVersion
+      return changelog(args, newVersion)
     })
     .then(() => {
-      return outputChangelog(args, newVersion)
-    })
-    .then(() => {
-      return runLifecycleScript(args, 'precommit', newVersion, args)
-    })
-    .then((message) => {
-      if (message && message.length) args.message = message
       return commit(args, newVersion)
     })
     .then(() => {
@@ -56,203 +34,3 @@
       throw err
     })
 }
-
-/**
- * attempt to update the version # in a collection of common config
- * files, e.g., package.json, bower.json.
- *
- * @param args config object
- * @param newVersion version # to update to.
- * @return {string}
- */
-var configsToUpdate = {}
-function updateConfigs (args, newVersion) {
-  configsToUpdate[path.resolve(process.cwd(), './package.json')] = false
-  configsToUpdate[path.resolve(process.cwd(), './npm-shrinkwrap.json')] = false
-  configsToUpdate[path.resolve(process.cwd(), './bower.json')] = false
-  Object.keys(configsToUpdate).forEach(function (configPath) {
-    try {
-      var stat = fs.lstatSync(configPath)
-      if (stat.isFile()) {
-        var config = require(configPath)
-        var filename = path.basename(configPath)
-        checkpoint(args, 'bumping version in ' + filename + ' from %s to %s', [config.version, newVersion])
-        config.version = newVersion
-        writeFile(args, configPath, JSON.stringify(config, null, 2) + '\n')
-        // flag any config files that we modify the version # for
-        // as having been updated.
-        configsToUpdate[configPath] = true
-      }
-    } catch (err) {
-      if (err.code !== 'ENOENT') console.warn(err.message)
-    }
-  })
-}
-
-function getReleaseType (prerelease, expectedReleaseType, currentVersion) {
-  if (isString(prerelease)) {
-    if (isInPrerelease(currentVersion)) {
-      if (shouldContinuePrerelease(currentVersion, expectedReleaseType) ||
-        getTypePriority(getCurrentActiveType(currentVersion)) > getTypePriority(expectedReleaseType)
-      ) {
-        return 'prerelease'
-      }
-    }
-
-    return 'pre' + expectedReleaseType
-  } else {
-    return expectedReleaseType
-  }
-}
-
-function isString (val) {
-  return typeof val === 'string'
-}
-
-/**
- * if a version is currently in pre-release state,
- * and if it current in-pre-release type is same as expect type,
- * it should continue the pre-release with the same type
- *
- * @param version
- * @param expectType
- * @return {boolean}
- */
-function shouldContinuePrerelease (version, expectType) {
-  return getCurrentActiveType(version) === expectType
-}
-
-function isInPrerelease (version) {
-  return Array.isArray(semver.prerelease(version))
-}
-
-var TypeList = ['major', 'minor', 'patch'].reverse()
-
-/**
- * extract the in-pre-release type in target version
- *
- * @param version
- * @return {string}
- */
-function getCurrentActiveType (version) {
-  var typelist = TypeList
-  for (var i = 0; i < typelist.length; i++) {
-    if (semver[typelist[i]](version)) {
-      return typelist[i]
-    }
-  }
-}
-
-/**
- * calculate the priority of release type,
- * major - 2, minor - 1, patch - 0
- *
- * @param type
- * @return {number}
- */
-function getTypePriority (type) {
-  return TypeList.indexOf(type)
-}
-
-function bumpVersion (releaseAs, callback) {
-  return new Promise((resolve, reject) => {
-    if (releaseAs) {
-      return resolve({
-        releaseType: releaseAs
-      })
-    } else {
-      conventionalRecommendedBump({
-        preset: 'angular'
-      }, function (err, release) {
-        if (err) return reject(err)
-        else return resolve(release)
-      })
-    }
-  })
-}
-
-function outputChangelog (args, newVersion) {
-  return new Promise((resolve, reject) => {
-    createIfMissing(args)
-    var header = '# Change Log\n\nAll notable changes to this project will be documented in this file. See [standard-version](https://github.com/conventional-changelog/standard-version) for commit guidelines.\n'
-    var oldContent = args.dryRun ? '' : fs.readFileSync(args.infile, 'utf-8')
-    // find the position of the last release and remove header:
-    if (oldContent.indexOf('<a name=') !== -1) {
-      oldContent = oldContent.substring(oldContent.indexOf('<a name='))
-    }
-    var content = ''
-    var context
-    if (args.dryRun) context = {version: newVersion}
-    var changelogStream = conventionalChangelog({
-      preset: 'angular'
-    }, context, {merges: null})
-      .on('error', function (err) {
-        return reject(err)
-      })
-
-    changelogStream.on('data', function (buffer) {
-      content += buffer.toString()
-    })
-
-    changelogStream.on('end', function () {
-      checkpoint(args, 'outputting changes to %s', [args.infile])
-      if (args.dryRun) console.info(`\n---\n${chalk.gray(content.trim())}\n---\n`)
-      else writeFile(args, args.infile, header + '\n' + (content + oldContent).replace(/\n+$/, '\n'))
-      return resolve()
-    })
-  })
-}
-
-function commit (args, newVersion) {
-  var msg = 'committing %s'
-  var paths = [args.infile]
-  var verify = args.verify === false || args.n ? '--no-verify ' : ''
-  var toAdd = ''
-  // commit any of the config files that we've updated
-  // the version # for.
-  Object.keys(configsToUpdate).forEach(function (p) {
-    if (configsToUpdate[p]) {
-      msg += ' and %s'
-      paths.unshift(path.basename(p))
-      toAdd += ' ' + path.relative(process.cwd(), p)
-    }
-  })
-  checkpoint(args, msg, paths)
-  return runExec(args, 'git add' + toAdd + ' ' + args.infile)
-    .then(() => {
-      return runExec(args, 'git commit ' + verify + (args.sign ? '-S ' : '') + (args.commitAll ? '' : (args.infile + toAdd)) + ' -m "' + formatCommitMessage(args.message, newVersion) + '"')
-    })
-}
-
-function formatCommitMessage (msg, newVersion) {
-  return String(msg).indexOf('%s') !== -1 ? util.format(msg, newVersion) : msg
-}
-
-function tag (newVersion, pkgPrivate, args) {
-  var tagOption
-  if (args.sign) {
-    tagOption = '-s '
-  } else {
-    tagOption = '-a '
-  }
-  checkpoint(args, 'tagging release %s', [newVersion])
-  return runExec(args, 'git tag ' + tagOption + args.tagPrefix + newVersion + ' -m "' + formatCommitMessage(args.message, newVersion) + '"')
-    .then(() => {
-      var message = 'git push --follow-tags origin master'
-      if (pkgPrivate !== true) message += '; npm publish'
-
-      checkpoint(args, 'Run `%s` to publish', [message], chalk.blue(figures.info))
-    })
-}
-
-function createIfMissing (args) {
-  try {
-    accessSync(args.infile, fs.F_OK)
-  } catch (err) {
-    if (err.code === 'ENOENT') {
-      checkpoint(args, 'created %s', [args.infile])
-      args.outputUnreleased = true
-      writeFile(args, args.infile, '\n')
-    }
-  }
-}
diff --git a/lib/checkpoint.js b/lib/checkpoint.js
index 516ab56..634c8b5 100644
--- a/lib/checkpoint.js
+++ b/lib/checkpoint.js
@@ -2,10 +2,10 @@
 const figures = require('figures')
 const util = require('util')
 
-module.exports = function (args, msg, vars, figure) {
+module.exports = function (argv, msg, args, figure) {
   const defaultFigure = args.dryRun ? chalk.yellow(figures.tick) : chalk.green(figures.tick)
-  if (!args.silent) {
-    console.info((figure || defaultFigure) + ' ' + util.format.apply(util, [msg].concat(vars.map(function (arg) {
+  if (!argv.silent) {
+    console.info((figure || defaultFigure) + ' ' + util.format.apply(util, [msg].concat(args.map(function (arg) {
       return chalk.bold(arg)
     }))))
   }
diff --git a/lib/format-commit-message.js b/lib/format-commit-message.js
new file mode 100644
index 0000000..06b8702
--- /dev/null
+++ b/lib/format-commit-message.js
@@ -0,0 +1,5 @@
+const util = require('util')
+
+module.exports = function (msg, newVersion) {
+  return String(msg).indexOf('%s') !== -1 ? util.format(msg, newVersion) : msg
+}
diff --git a/lib/lifecycles/bump.js b/lib/lifecycles/bump.js
new file mode 100644
index 0000000..47ad11f
--- /dev/null
+++ b/lib/lifecycles/bump.js
@@ -0,0 +1,160 @@
+const chalk = require('chalk')
+const checkpoint = require('../checkpoint')
+const conventionalRecommendedBump = require('conventional-recommended-bump')
+const figures = require('figures')
+const fs = require('fs')
+const path = require('path')
+const runLifecycleScript = require('../run-lifecycle-script')
+const semver = require('semver')
+const writeFile = require('../write-file')
+
+var configsToUpdate = {}
+
+function Bump (args, pkg) {
+  // reset the cache of updated config files each
+  // time we perform the version bump step.
+  configsToUpdate = {}
+
+  if (args.skip.bump) return Promise.resolve()
+  var newVersion = pkg.version
+  return runLifecycleScript(args, 'prebump')
+    .then((stdout) => {
+      if (stdout && stdout.trim().length) args.releaseAs = stdout.trim()
+      return bumpVersion(args.releaseAs)
+    })
+    .then((release) => {
+      if (!args.firstRelease) {
+        var releaseType = getReleaseType(args.prerelease, release.releaseType, pkg.version)
+        newVersion = semver.valid(releaseType) || semver.inc(pkg.version, releaseType, args.prerelease)
+        updateConfigs(args, newVersion)
+      } else {
+        checkpoint(args, 'skip version bump on first release', [], chalk.red(figures.cross))
+      }
+    })
+    .then(() => {
+      return runLifecycleScript(args, 'postbump')
+    })
+    .then(() => {
+      return newVersion
+    })
+}
+
+Bump.getUpdatedConfigs = function () {
+  return configsToUpdate
+}
+
+function getReleaseType (prerelease, expectedReleaseType, currentVersion) {
+  if (isString(prerelease)) {
+    if (isInPrerelease(currentVersion)) {
+      if (shouldContinuePrerelease(currentVersion, expectedReleaseType) ||
+        getTypePriority(getCurrentActiveType(currentVersion)) > getTypePriority(expectedReleaseType)
+      ) {
+        return 'prerelease'
+      }
+    }
+
+    return 'pre' + expectedReleaseType
+  } else {
+    return expectedReleaseType
+  }
+}
+
+function isString (val) {
+  return typeof val === 'string'
+}
+
+/**
+ * if a version is currently in pre-release state,
+ * and if it current in-pre-release type is same as expect type,
+ * it should continue the pre-release with the same type
+ *
+ * @param version
+ * @param expectType
+ * @return {boolean}
+ */
+function shouldContinuePrerelease (version, expectType) {
+  return getCurrentActiveType(version) === expectType
+}
+
+function isInPrerelease (version) {
+  return Array.isArray(semver.prerelease(version))
+}
+
+var TypeList = ['major', 'minor', 'patch'].reverse()
+
+/**
+ * extract the in-pre-release type in target version
+ *
+ * @param version
+ * @return {string}
+ */
+function getCurrentActiveType (version) {
+  var typelist = TypeList
+  for (var i = 0; i < typelist.length; i++) {
+    if (semver[typelist[i]](version)) {
+      return typelist[i]
+    }
+  }
+}
+
+/**
+ * calculate the priority of release type,
+ * major - 2, minor - 1, patch - 0
+ *
+ * @param type
+ * @return {number}
+ */
+function getTypePriority (type) {
+  return TypeList.indexOf(type)
+}
+
+function bumpVersion (releaseAs, callback) {
+  return new Promise((resolve, reject) => {
+    if (releaseAs) {
+      return resolve({
+        releaseType: releaseAs
+      })
+    } else {
+      conventionalRecommendedBump({
+        preset: 'angular'
+      }, function (err, release) {
+        if (err) return reject(err)
+        else return resolve(release)
+      })
+    }
+  })
+}
+
+/**
+ * attempt to update the version # in a collection of common config
+ * files, e.g., package.json, bower.json.
+ *
+ * @param args config object
+ * @param newVersion version # to update to.
+ * @return {string}
+ */
+function updateConfigs (args, newVersion) {
+  configsToUpdate[path.resolve(process.cwd(), './package.json')] = false
+  configsToUpdate[path.resolve(process.cwd(), './package-lock.json')] = false
+  configsToUpdate[path.resolve(process.cwd(), './npm-shrinkwrap.json')] = false
+  configsToUpdate[path.resolve(process.cwd(), './bower.json')] = false
+  Object.keys(configsToUpdate).forEach(function (configPath) {
+    try {
+      var stat = fs.lstatSync(configPath)
+      if (stat.isFile()) {
+        var config = require(configPath)
+        var filename = path.basename(configPath)
+        checkpoint(args, 'bumping version in ' + filename + ' from %s to %s', [config.version, newVersion])
+        config.version = newVersion
+        writeFile(args, configPath, JSON.stringify(config, null, 2) + '\n')
+        // flag any config files that we modify the version # for
+        // as having been updated.
+        configsToUpdate[configPath] = true
+      }
+    } catch (err) {
+      if (err.code !== 'ENOENT') console.warn(err.message)
+    }
+  })
+}
+
+module.exports = Bump
diff --git a/lib/lifecycles/changelog.js b/lib/lifecycles/changelog.js
new file mode 100644
index 0000000..1eb1617
--- /dev/null
+++ b/lib/lifecycles/changelog.js
@@ -0,0 +1,62 @@
+const accessSync = require('fs-access').sync
+const chalk = require('chalk')
+const checkpoint = require('../checkpoint')
+const conventionalChangelog = require('conventional-changelog')
+const fs = require('fs')
+const runLifecycleScript = require('../run-lifecycle-script')
+const writeFile = require('../write-file')
+
+module.exports = function (args, newVersion) {
+  if (args.skip.changelog) return Promise.resolve()
+  return runLifecycleScript(args, 'prechangelog')
+    .then(() => {
+      return outputChangelog(args, newVersion)
+    })
+    .then(() => {
+      return runLifecycleScript(args, 'postchangelog')
+    })
+}
+
+function outputChangelog (args, newVersion) {
+  return new Promise((resolve, reject) => {
+    createIfMissing(args)
+    var header = '# Change Log\n\nAll notable changes to this project will be documented in this file. See [standard-version](https://github.com/conventional-changelog/standard-version) for commit guidelines.\n'
+    var oldContent = args.dryRun ? '' : fs.readFileSync(args.infile, 'utf-8')
+    // find the position of the last release and remove header:
+    if (oldContent.indexOf('<a name=') !== -1) {
+      oldContent = oldContent.substring(oldContent.indexOf('<a name='))
+    }
+    var content = ''
+    var context
+    if (args.dryRun) context = {version: newVersion}
+    var changelogStream = conventionalChangelog({
+      preset: 'angular'
+    }, context, {merges: null})
+      .on('error', function (err) {
+        return reject(err)
+      })
+
+    changelogStream.on('data', function (buffer) {
+      content += buffer.toString()
+    })
+
+    changelogStream.on('end', function () {
+      checkpoint(args, 'outputting changes to %s', [args.infile])
+      if (args.dryRun) console.info(`\n---\n${chalk.gray(content.trim())}\n---\n`)
+      else writeFile(args, args.infile, header + '\n' + (content + oldContent).replace(/\n+$/, '\n'))
+      return resolve()
+    })
+  })
+}
+
+function createIfMissing (args) {
+  try {
+    accessSync(args.infile, fs.F_OK)
+  } catch (err) {
+    if (err.code === 'ENOENT') {
+      checkpoint(args, 'created %s', [args.infile])
+      args.outputUnreleased = true
+      writeFile(args, args.infile, '\n')
+    }
+  }
+}
diff --git a/lib/lifecycles/commit.js b/lib/lifecycles/commit.js
new file mode 100644
index 0000000..c273949
--- /dev/null
+++ b/lib/lifecycles/commit.js
@@ -0,0 +1,39 @@
+const bump = require('../lifecycles/bump')
+const checkpoint = require('../checkpoint')
+const formatCommitMessage = require('../format-commit-message')
+const path = require('path')
+const runExec = require('../run-exec')
+const runLifecycleScript = require('../run-lifecycle-script')
+
+module.exports = function (args, newVersion) {
+  if (args.skip.commit) return Promise.resolve()
+  return runLifecycleScript(args, 'precommit')
+    .then((message) => {
+      if (message && message.length) args.message = message
+      return execCommit(args, newVersion)
+    })
+    .then(() => {
+      return runLifecycleScript(args, 'postcommit')
+    })
+}
+
+function execCommit (args, newVersion) {
+  var msg = 'committing %s'
+  var paths = [args.infile]
+  var verify = args.verify === false || args.n ? '--no-verify ' : ''
+  var toAdd = ''
+  // commit any of the config files that we've updated
+  // the version # for.
+  Object.keys(bump.getUpdatedConfigs()).forEach(function (p) {
+    if (bump.getUpdatedConfigs()[p]) {
+      msg += ' and %s'
+      paths.unshift(path.basename(p))
+      toAdd += ' ' + path.relative(process.cwd(), p)
+    }
+  })
+  checkpoint(args, msg, paths)
+  return runExec(args, 'git add' + toAdd + ' ' + args.infile)
+    .then(() => {
+      return runExec(args, 'git commit ' + verify + (args.sign ? '-S ' : '') + (args.commitAll ? '' : (args.infile + toAdd)) + ' -m "' + formatCommitMessage(args.message, newVersion) + '"')
+    })
+}
diff --git a/lib/lifecycles/tag.js b/lib/lifecycles/tag.js
new file mode 100644
index 0000000..b5bf7ae
--- /dev/null
+++ b/lib/lifecycles/tag.js
@@ -0,0 +1,34 @@
+const chalk = require('chalk')
+const checkpoint = require('../checkpoint')
+const figures = require('figures')
+const formatCommitMessage = require('../format-commit-message')
+const runExec = require('../run-exec')
+const runLifecycleScript = require('../run-lifecycle-script')
+
+module.exports = function (newVersion, pkgPrivate, args) {
+  if (args.skip.tag) return Promise.resolve()
+  return runLifecycleScript(args, 'pretag')
+    .then(() => {
+      return execTag(newVersion, pkgPrivate, args)
+    })
+    .then(() => {
+      return runLifecycleScript(args, 'posttag')
+    })
+}
+
+function execTag (newVersion, pkgPrivate, args) {
+  var tagOption
+  if (args.sign) {
+    tagOption = '-s '
+  } else {
+    tagOption = '-a '
+  }
+  checkpoint(args, 'tagging release %s', [newVersion])
+  return runExec(args, 'git tag ' + tagOption + args.tagPrefix + newVersion + ' -m "' + formatCommitMessage(args.message, newVersion) + '"')
+    .then(() => {
+      var message = 'git push --follow-tags origin master'
+      if (pkgPrivate !== true) message += '; npm publish'
+
+      checkpoint(args, 'Run `%s` to publish', [message], chalk.blue(figures.info))
+    })
+}
diff --git a/lib/run-lifecycle-script.js b/lib/run-lifecycle-script.js
index f4c2baa..a501448 100644
--- a/lib/run-lifecycle-script.js
+++ b/lib/run-lifecycle-script.js
@@ -3,11 +3,10 @@
 const figures = require('figures')
 const runExec = require('./run-exec')
 
-module.exports = function (args, hookName, newVersion) {
+module.exports = function (args, hookName) {
   const scripts = args.scripts
   if (!scripts || !scripts[hookName]) return Promise.resolve()
   var command = scripts[hookName]
-  if (newVersion) command += ' --new-version="' + newVersion + '"'
   checkpoint(args, 'Running lifecycle script "%s"', [hookName])
   checkpoint(args, '- execute command: "%s"', [command], chalk.blue(figures.info))
   return runExec(args, command)
diff --git a/package.json b/package.json
index 7f21bc8..5b7cc04 100644
--- a/package.json
+++ b/package.json
@@ -1,6 +1,6 @@
 {
   "name": "standard-version",
-  "version": "4.0.0",
+  "version": "4.1.0",
   "description": "replacement for `npm version` with automatic CHANGELOG generation",
   "bin": "bin/cli.js",
   "scripts": {
@@ -10,7 +10,9 @@
     "release": "bin/cli.js"
   },
   "nyc": {
-    "exclude": ["tmp/**"]
+    "exclude": [
+      "tmp/**"
+    ]
   },
   "repository": {
     "type": "git",
diff --git a/test.js b/test.js
index e1702fd..001c858 100644
--- a/test.js
+++ b/test.js
@@ -59,6 +59,12 @@
   fs.writeFileSync('npm-shrinkwrap.json', JSON.stringify(shrinkwrap), 'utf-8')
 }
 
+function writePackageLockJson (version, option) {
+  option = option || {}
+  var pkgLock = Object.assign(option, { version: version })
+  fs.writeFileSync('package-lock.json', JSON.stringify(pkgLock), 'utf-8')
+}
+
 function writeGitPreCommitHook () {
   fs.writeFileSync('.git/hooks/pre-commit', '#!/bin/sh\necho "precommit ran"\nexit 1', 'utf-8')
   fs.chmodSync('.git/hooks/pre-commit', '755')
@@ -676,6 +682,24 @@
     })
   })
 
+  describe('package-lock.json support', function () {
+    beforeEach(function () {
+      writePackageLockJson('1.0.0')
+    })
+
+    it('bumps version # in package-lock.json', function (done) {
+      commit('feat: first commit')
+      shell.exec('git tag -a v1.0.0 -m "my awesome first release"')
+      commit('feat: new feature!')
+      require('./index')({silent: true})
+        .then(() => {
+          JSON.parse(fs.readFileSync('package-lock.json', 'utf-8')).version.should.equal('1.1.0')
+          getPackageVersion().should.equal('1.1.0')
+          return done()
+        })
+    })
+  })
+
   describe('dry-run', function () {
     it('skips all non-idempotent steps', function (done) {
       commit('feat: first commit')
@@ -688,4 +712,36 @@
       return done()
     })
   })
+
+  describe('skip', () => {
+    it('allows bump and changelog generation to be skipped', function () {
+      let changelogContent = 'legacy header format<a name="1.0.0">\n'
+      writePackageJson('1.0.0')
+      fs.writeFileSync('CHANGELOG.md', changelogContent, 'utf-8')
+
+      commit('feat: first commit')
+      return execCliAsync('--skip.bump true --skip.changelog true')
+        .then(function () {
+          getPackageVersion().should.equal('1.0.0')
+          var content = fs.readFileSync('CHANGELOG.md', 'utf-8')
+          content.should.equal(changelogContent)
+        })
+    })
+
+    it('allows the commit phase to be skipped', function () {
+      let changelogContent = 'legacy header format<a name="1.0.0">\n'
+      writePackageJson('1.0.0')
+      fs.writeFileSync('CHANGELOG.md', changelogContent, 'utf-8')
+
+      commit('feat: new feature from branch')
+      return execCliAsync('--skip.commit true')
+        .then(function () {
+          getPackageVersion().should.equal('1.1.0')
+          var content = fs.readFileSync('CHANGELOG.md', 'utf-8')
+          content.should.match(/new feature from branch/)
+          // check last commit message
+          shell.exec('git log --oneline -n1').stdout.should.match(/feat: new feature from branch/)
+        })
+    })
+  })
 })

=====================================================================
start time: Fri Dec 02 00:00:00 CST 2016
end time: Tue Jun 06 00:00:00 CST 2017
### Features* **cli:** print error and don't run with node <4, closes [#124](https://github.com/conventional-changelog/standard-version/issues/124) ([d0d71a5](https://github.com/conventional-changelog/standard-version/commit/d0d71a5))* add dry-run mode ([#187](https://github.com/conventional-changelog/standard-version/issues/187)) ([d073353](https://github.com/conventional-changelog/standard-version/commit/d073353))* add prebump, postbump, precommit, lifecycle scripts ([#186](https://github.com/conventional-changelog/standard-version/issues/186)) ([dfd1d12](https://github.com/conventional-changelog/standard-version/commit/dfd1d12))* add support for `npm-shrinkwrap.json` ([#185](https://github.com/conventional-changelog/standard-version/issues/185)) ([86af7fc](https://github.com/conventional-changelog/standard-version/commit/86af7fc))* add support for skipping lifecycle steps, polish lifecycle work ([#188](https://github.com/conventional-changelog/standard-version/issues/188)) ([d31dcdb](https://github.com/conventional-changelog/standard-version/commit/d31dcdb))* allow a version # to be provided for release-as, rather than just major, minor, patch. ([13eb9cd](https://github.com/conventional-changelog/standard-version/commit/13eb9cd))<a name="4.0.0"></a>
diff --git a/.travis.yml b/.travis.yml
index ed30357..bab1008 100644
--- a/.travis.yml
+++ b/.travis.yml
@@ -2,7 +2,7 @@
 node_js:
   - "4"
   - "5"
-  - "node"
+  - "stable"
 before_script:
   - git config --global user.name 'Travis-CI'
   - git config --global user.email 'dummy@example.org'
diff --git a/CHANGELOG.md b/CHANGELOG.md
index 4f73185..4da1451 100644
--- a/CHANGELOG.md
+++ b/CHANGELOG.md
@@ -6,11 +6,6 @@
 # [4.0.0](https://github.com/conventional-changelog/standard-version/compare/v4.0.0-1...v4.0.0) (2016-12-02)
 
 
-
-<a name="4.0.0-1"></a>
-# [4.0.0-1](https://github.com/conventional-changelog/standard-version/compare/v3.0.0...v4.0.0-1) (2016-11-27)
-
-
 ### Bug Fixes
 
 * include merge commits in the changelog ([#139](https://github.com/conventional-changelog/standard-version/issues/139)) ([b6e1562](https://github.com/conventional-changelog/standard-version/commit/b6e1562))
diff --git a/README.md b/README.md
index 3e9e3bb..1440caf 100644
--- a/README.md
+++ b/README.md
@@ -5,17 +5,17 @@
 [![Build Status](https://travis-ci.org/conventional-changelog/standard-version.svg?branch=master)](https://travis-ci.org/conventional-changelog/standard-version)
 [![NPM version](https://img.shields.io/npm/v/standard-version.svg)](https://www.npmjs.com/package/standard-version)
 [![Coverage Status](https://coveralls.io/repos/conventional-changelog/standard-version/badge.svg?branch=)](https://coveralls.io/r/conventional-changelog/standard-version?branch=master)
-[![Standard Version](https://img.shields.io/badge/release-standard%20version-brightgreen.svg)](https://github.com/conventional-changelog/standard-version)
+[![Conventional Commits](https://img.shields.io/badge/Conventional%20Commits-1.0.0-yellow.svg)](https://conventionalcommits.org)
 
 > stop using `npm version`, use `standard-version` it rocks!
 
-Automatic versioning and CHANGELOG management, using GitHub's new squash button and
-the [recommended workflow](https://github.com/conventional-changelog/conventional-changelog-cli#recommended-workflow) for `conventional-changelog`.
+Automatic versioning and CHANGELOG generation, using GitHub's squash button and
+[conventional commit messages](https://conventionalcommits.org).
 
 _how it works:_
 
 1. when you land commits on your `master` branch, select the _Squash and Merge_ option.
-2. add a title and body that follows the [conventional-changelog-standard conventions](https://github.com/bcoe/conventional-changelog-standard/blob/master/convention.md).
+2. add a title and body that follows the [Conventional Commits Specification](https://conventionalcommits.org).
 3. when you're ready to release to npm:
   1. `git checkout master; git pull origin master`
   2. run `standard-version`
@@ -129,6 +129,8 @@
 ```bash
 # npm run script
 npm run release -- --release-as minor
+# Or
+npm run release -- --release-as 1.1.0
 ```
 
 you will get version `1.1.0` rather than the auto generated version `1.0.1`.
@@ -150,6 +152,33 @@
 
 If you have your GPG key set up, add the `--sign` or `-s` flag to your `standard-version` command.
 
+### Lifecycle scripts
+
+`standard-version` supports lifecycle scripts. These allow you to execute your
+own supplementary commands during the release. The following
+hooks are available:
+
+* `prebump`: executed before the version bump is calculated. If the `prebump`
+  script returns a version #, it will be used rather than
+  the version calculated by `standard-version`.
+* `postbump`: executed after the version has been bumped and written to
+  package.json. The flag `--new-version` is populated with the version that is
+  being released.
+* `precommit`: called after CHANGELOG.md and package.json have been updated,
+  but before changes have been committed to git.
+
+Simply add the following to your package.json, to enable lifecycle scripts:
+
+```json
+{
+  "standard-version": {
+    "scripts": {
+      "prebump": "echo 9.9.9"
+    }
+  }
+}
+```
+
 ### Committing generated artifacts in the release commit
 
 If you want to commit generated artifacts in the release commit (e.g. [#96](https://github.com/conventional-changelog/standard-version/issues/96)), you can use the `--commit-all` or `-a` flag. You will need to stage the artifacts you want to commit, so your `release` command could look like this:
@@ -225,10 +254,10 @@
 
 ## Badges!
 
-Tell your users that you adhere to the `standard-version` commit guidelines:
+Tell your users that you adhere to the Conventional Commits specification:
 
 ```markdown
-[![Standard Version](https://img.shields.io/badge/release-standard%20version-brightgreen.svg)](https://github.com/conventional-changelog/standard-version)
+[![Conventional Commits](https://img.shields.io/badge/Conventional%20Commits-1.0.0-yellow.svg)](https://conventionalcommits.org)
 ```
 
 ## FAQ
diff --git a/appveyor.yml b/appveyor.yml
index 538cdfb..ec5ba45 100644
--- a/appveyor.yml
+++ b/appveyor.yml
@@ -1,10 +1,10 @@
 environment:
   matrix:
     - nodejs_version: '6'
-    - nodejs_version: '5'
-    - nodejs_version: '4'
 install:
   - ps: Install-Product node $env:nodejs_version
+  - git config --global user.name 'Appveyor'
+  - git config --global user.email 'dummy@example.org'
   - set CI=true
   - npm -g install npm@latest
   - set PATH=%APPDATA%\npm;%PATH%
diff --git a/bin/cli.js b/bin/cli.js
index c80a2e1..70ef2d6 100755
--- a/bin/cli.js
+++ b/bin/cli.js
@@ -2,8 +2,12 @@
 var standardVersion = require('../index')
 var cmdParser = require('../command')
 
-standardVersion(cmdParser.argv, function (err) {
-  if (err) {
-    process.exit(1)
-  }
-})
+/* istanbul ignore if */
+if (process.version.match(/v(\d+)\./)[1] < 4) {
+  console.error('standard-version: Node v4 or greater is required. `standard-version` did not run.')
+} else {
+  standardVersion(cmdParser.argv)
+    .catch(() => {
+      process.exit(1)
+    })
+}
diff --git a/command.js b/command.js
index 60bdfd0..0c41c6b 100755
--- a/command.js
+++ b/command.js
@@ -7,7 +7,6 @@
     describe: 'Specify the release type manually (like npm version <major|minor|patch>)',
     requiresArg: true,
     string: true,
-    choices: ['major', 'minor', 'patch'],
     global: true
   })
   .option('prerelease', {
@@ -70,10 +69,22 @@
     default: defaults.tagPrefix,
     global: true
   })
+  .option('scripts', {
+    describe: 'Scripts to execute for lifecycle events (prebump, precommit, etc.,)',
+    default: {}
+  })
+  .check((argv) => {
+    if (typeof argv.scripts !== 'object' || Array.isArray(argv.scripts)) {
+      throw Error('hooks must be an object')
+    } else {
+      return true
+    }
+  })
   .version()
   .alias('version', 'v')
   .help()
   .alias('help', 'h')
   .example('$0', 'Update changelog and tag release')
   .example('$0 -m "%s: see changelog for details"', 'Update changelog and tag release with custom commit message')
+  .pkgConf('standard-version')
   .wrap(97)
diff --git a/index.js b/index.js
index c7aa5ca..73e5dd1 100755
--- a/index.js
+++ b/index.js
@@ -1,50 +1,60 @@
-var conventionalRecommendedBump = require('conventional-recommended-bump')
-var conventionalChangelog = require('conventional-changelog')
-var path = require('path')
+const conventionalRecommendedBump = require('conventional-recommended-bump')
+const conventionalChangelog = require('conventional-changelog')
+const path = require('path')
 
-var chalk = require('chalk')
-var figures = require('figures')
-var exec = require('child_process').exec
-var fs = require('fs')
-var accessSync = require('fs-access').sync
-var semver = require('semver')
-var util = require('util')
-var objectAssign = require('object-assign')
+const chalk = require('chalk')
+const figures = require('figures')
+const fs = require('fs')
+const accessSync = require('fs-access').sync
+const semver = require('semver')
+const util = require('util')
 
-module.exports = function standardVersion (argv, done) {
+const checkpoint = require('./lib/checkpoint')
+const printError = require('./lib/print-error')
+const runExec = require('./lib/run-exec')
+const runLifecycleScript = require('./lib/run-lifecycle-script')
+
+module.exports = function standardVersion (argv) {
   var pkgPath = path.resolve(process.cwd(), './package.json')
   var pkg = require(pkgPath)
+  var newVersion = pkg.version
+  var scripts = argv.scripts || {}
   var defaults = require('./defaults')
-  var args = objectAssign({}, defaults, argv)
+  var args = Object.assign({}, defaults, argv)
 
-  bumpVersion(args.releaseAs, function (err, release) {
-    if (err) {
-      printError(args, err.message)
-      return done(err)
-    }
-
-    var newVersion = pkg.version
-
-    if (!args.firstRelease) {
-      var releaseType = getReleaseType(args.prerelease, release.releaseType, pkg.version)
-      newVersion = semver.inc(pkg.version, releaseType, args.prerelease)
-      updateConfigs(args, newVersion)
-    } else {
-      checkpoint(args, 'skip version bump on first release', [], chalk.red(figures.cross))
-    }
-
-    outputChangelog(args, function (err) {
-      if (err) {
-        return done(err)
-      }
-      commit(args, newVersion, function (err) {
-        if (err) {
-          return done(err)
-        }
-        return tag(newVersion, pkg.private, args, done)
-      })
+  return runLifecycleScript(args, 'prebump', null, scripts)
+    .then((stdout) => {
+      if (stdout && stdout.trim().length) args.releaseAs = stdout.trim()
+      return bumpVersion(args.releaseAs)
     })
-  })
+    .then((release) => {
+      if (!args.firstRelease) {
+        var releaseType = getReleaseType(args.prerelease, release.releaseType, pkg.version)
+        newVersion = semver.valid(releaseType) || semver.inc(pkg.version, releaseType, args.prerelease)
+        updateConfigs(args, newVersion)
+      } else {
+        checkpoint(args, 'skip version bump on first release', [], chalk.red(figures.cross))
+      }
+
+      return runLifecycleScript(args, 'postbump', newVersion, scripts)
+    })
+    .then(() => {
+      return outputChangelog(args)
+    })
+    .then(() => {
+      return runLifecycleScript(args, 'precommit', newVersion, scripts)
+    })
+    .then((message) => {
+      if (message && message.length) args.message = message
+      return commit(args, newVersion)
+    })
+    .then(() => {
+      return tag(newVersion, pkg.private, args)
+    })
+    .catch((err) => {
+      printError(args, err.message)
+      throw err
+    })
 }
 
 /**
@@ -58,6 +68,7 @@
 var configsToUpdate = {}
 function updateConfigs (args, newVersion) {
   configsToUpdate[path.resolve(process.cwd(), './package.json')] = false
+  configsToUpdate[path.resolve(process.cwd(), './npm-shrinkwrap.json')] = false
   configsToUpdate[path.resolve(process.cwd(), './bower.json')] = false
   Object.keys(configsToUpdate).forEach(function (configPath) {
     try {
@@ -144,62 +155,52 @@
 }
 
 function bumpVersion (releaseAs, callback) {
-  if (releaseAs) {
-    callback(null, {
-      releaseType: releaseAs
-    })
-  } else {
-    conventionalRecommendedBump({
-      preset: 'angular'
-    }, function (err, release) {
-      callback(err, release)
-    })
-  }
-}
-
-function outputChangelog (argv, cb) {
-  createIfMissing(argv)
-  var header = '# Change Log\n\nAll notable changes to this project will be documented in this file. See [standard-version](https://github.com/conventional-changelog/standard-version) for commit guidelines.\n'
-  var oldContent = fs.readFileSync(argv.infile, 'utf-8')
-  // find the position of the last release and remove header:
-  if (oldContent.indexOf('<a name=') !== -1) {
-    oldContent = oldContent.substring(oldContent.indexOf('<a name='))
-  }
-  var content = ''
-  var changelogStream = conventionalChangelog({
-    preset: 'angular'
-  }, undefined, {merges: null})
-    .on('error', function (err) {
-      return cb(err)
-    })
-
-  changelogStream.on('data', function (buffer) {
-    content += buffer.toString()
-  })
-
-  changelogStream.on('end', function () {
-    checkpoint(argv, 'outputting changes to %s', [argv.infile])
-    fs.writeFileSync(argv.infile, header + '\n' + (content + oldContent).replace(/\n+$/, '\n'), 'utf-8')
-    return cb()
-  })
-}
-
-function handledExec (argv, cmd, errorCb, successCb) {
-  // Exec given cmd and handle possible errors
-  exec(cmd, function (err, stdout, stderr) {
-    // If exec returns content in stderr, but no error, print it as a warning
-    // If exec returns an error, print it and exit with return code 1
-    if (err) {
-      printError(argv, stderr || err.message)
-      return errorCb(err)
-    } else if (stderr) {
-      printError(argv, stderr, {level: 'warn', color: 'yellow'})
+  return new Promise((resolve, reject) => {
+    if (releaseAs) {
+      return resolve({
+        releaseType: releaseAs
+      })
+    } else {
+      conventionalRecommendedBump({
+        preset: 'angular'
+      }, function (err, release) {
+        if (err) return reject(err)
+        else return resolve(release)
+      })
     }
-    successCb()
   })
 }
 
-function commit (argv, newVersion, cb) {
+function outputChangelog (argv) {
+  return new Promise((resolve, reject) => {
+    createIfMissing(argv)
+    var header = '# Change Log\n\nAll notable changes to this project will be documented in this file. See [standard-version](https://github.com/conventional-changelog/standard-version) for commit guidelines.\n'
+    var oldContent = fs.readFileSync(argv.infile, 'utf-8')
+    // find the position of the last release and remove header:
+    if (oldContent.indexOf('<a name=') !== -1) {
+      oldContent = oldContent.substring(oldContent.indexOf('<a name='))
+    }
+    var content = ''
+    var changelogStream = conventionalChangelog({
+      preset: 'angular'
+    }, undefined, {merges: null})
+      .on('error', function (err) {
+        return reject(err)
+      })
+
+    changelogStream.on('data', function (buffer) {
+      content += buffer.toString()
+    })
+
+    changelogStream.on('end', function () {
+      checkpoint(argv, 'outputting changes to %s', [argv.infile])
+      fs.writeFileSync(argv.infile, header + '\n' + (content + oldContent).replace(/\n+$/, '\n'), 'utf-8')
+      return resolve()
+    })
+  })
+}
+
+function commit (argv, newVersion) {
   var msg = 'committing %s'
   var args = [argv.infile]
   var verify = argv.verify === false || argv.n ? '--no-verify ' : ''
@@ -214,18 +215,17 @@
     }
   })
   checkpoint(argv, msg, args)
-  handledExec(argv, 'git add' + toAdd + ' ' + argv.infile, cb, function () {
-    handledExec(argv, 'git commit ' + verify + (argv.sign ? '-S ' : '') + (argv.commitAll ? '' : (argv.infile + toAdd)) + ' -m "' + formatCommitMessage(argv.message, newVersion) + '"', cb, function () {
-      cb()
+  return runExec(argv, 'git add' + toAdd + ' ' + argv.infile)
+    .then(() => {
+      return runExec(argv, 'git commit ' + verify + (argv.sign ? '-S ' : '') + (argv.commitAll ? '' : (argv.infile + toAdd)) + ' -m "' + formatCommitMessage(argv.message, newVersion) + '"')
     })
-  })
 }
 
 function formatCommitMessage (msg, newVersion) {
   return String(msg).indexOf('%s') !== -1 ? util.format(msg, newVersion) : msg
 }
 
-function tag (newVersion, pkgPrivate, argv, cb) {
+function tag (newVersion, pkgPrivate, argv) {
   var tagOption
   if (argv.sign) {
     tagOption = '-s '
@@ -233,13 +233,13 @@
     tagOption = '-a '
   }
   checkpoint(argv, 'tagging release %s', [newVersion])
-  handledExec(argv, 'git tag ' + tagOption + argv.tagPrefix + newVersion + ' -m "' + formatCommitMessage(argv.message, newVersion) + '"', cb, function () {
-    var message = 'git push --follow-tags origin master'
-    if (pkgPrivate !== true) message += '; npm publish'
+  return runExec(argv, 'git tag ' + tagOption + argv.tagPrefix + newVersion + ' -m "' + formatCommitMessage(argv.message, newVersion) + '"')
+    .then(() => {
+      var message = 'git push --follow-tags origin master'
+      if (pkgPrivate !== true) message += '; npm publish'
 
-    checkpoint(argv, 'Run `%s` to publish', [message], chalk.blue(figures.info))
-    cb()
-  })
+      checkpoint(argv, 'Run `%s` to publish', [message], chalk.blue(figures.info))
+    })
 }
 
 function createIfMissing (argv) {
@@ -253,22 +253,3 @@
     }
   }
 }
-
-function checkpoint (argv, msg, args, figure) {
-  if (!argv.silent) {
-    console.info((figure || chalk.green(figures.tick)) + ' ' + util.format.apply(util, [msg].concat(args.map(function (arg) {
-      return chalk.bold(arg)
-    }))))
-  }
-}
-
-function printError (argv, msg, opts) {
-  if (!argv.silent) {
-    opts = objectAssign({
-      level: 'error',
-      color: 'red'
-    }, opts)
-
-    console[opts.level](chalk[opts.color](msg))
-  }
-}
diff --git a/lib/checkpoint.js b/lib/checkpoint.js
new file mode 100644
index 0000000..ff7f5d1
--- /dev/null
+++ b/lib/checkpoint.js
@@ -0,0 +1,11 @@
+const chalk = require('chalk')
+const figures = require('figures')
+const util = require('util')
+
+module.exports = function (argv, msg, args, figure) {
+  if (!argv.silent) {
+    console.info((figure || chalk.green(figures.tick)) + ' ' + util.format.apply(util, [msg].concat(args.map(function (arg) {
+      return chalk.bold(arg)
+    }))))
+  }
+}
diff --git a/lib/print-error.js b/lib/print-error.js
new file mode 100644
index 0000000..983aeac
--- /dev/null
+++ b/lib/print-error.js
@@ -0,0 +1,12 @@
+const chalk = require('chalk')
+
+module.exports = function (argv, msg, opts) {
+  if (!argv.silent) {
+    opts = Object.assign({
+      level: 'error',
+      color: 'red'
+    }, opts)
+
+    console[opts.level](chalk[opts.color](msg))
+  }
+}
diff --git a/lib/run-exec.js b/lib/run-exec.js
new file mode 100644
index 0000000..bfca976
--- /dev/null
+++ b/lib/run-exec.js
@@ -0,0 +1,19 @@
+const exec = require('child_process').exec
+const printError = require('./print-error')
+
+module.exports = function (argv, cmd) {
+  return new Promise((resolve, reject) => {
+    // Exec given cmd and handle possible errors
+    exec(cmd, function (err, stdout, stderr) {
+      // If exec returns content in stderr, but no error, print it as a warning
+      // If exec returns an error, print it and exit with return code 1
+      if (err) {
+        printError(argv, stderr || err.message)
+        return reject(err)
+      } else if (stderr) {
+        printError(argv, stderr, {level: 'warn', color: 'yellow'})
+      }
+      return resolve(stdout)
+    })
+  })
+}
diff --git a/lib/run-lifecycle-hook.js b/lib/run-lifecycle-hook.js
new file mode 100644
index 0000000..caaeeba
--- /dev/null
+++ b/lib/run-lifecycle-hook.js
@@ -0,0 +1,12 @@
+const chalk = require('chalk')
+const checkpoint = require('./checkpoint')
+const figures = require('figures')
+const runExec = require('./run-exec')
+
+module.exports = function (argv, hookName, newVersion, hooks, cb) {
+  if (!hooks[hookName]) return Promise.resolve()
+  var command = hooks[hookName] + ' --new-version="' + newVersion + '"'
+  checkpoint(argv, 'Running lifecycle hook "%s"', [hookName])
+  checkpoint(argv, '- hook command: "%s"', [command], chalk.blue(figures.info))
+  return runExec(argv, command)
+}
diff --git a/lib/run-lifecycle-script.js b/lib/run-lifecycle-script.js
new file mode 100644
index 0000000..2ad322b
--- /dev/null
+++ b/lib/run-lifecycle-script.js
@@ -0,0 +1,13 @@
+const chalk = require('chalk')
+const checkpoint = require('./checkpoint')
+const figures = require('figures')
+const runExec = require('./run-exec')
+
+module.exports = function (argv, hookName, newVersion, scripts, cb) {
+  if (!scripts[hookName]) return Promise.resolve()
+  var command = scripts[hookName]
+  if (newVersion) command += ' --new-version="' + newVersion + '"'
+  checkpoint(argv, 'Running lifecycle script "%s"', [hookName])
+  checkpoint(argv, '- execute command: "%s"', [command], chalk.blue(figures.info))
+  return runExec(argv, command)
+}
diff --git a/package.json b/package.json
index dd128ff..7f21bc8 100644
--- a/package.json
+++ b/package.json
@@ -9,6 +9,9 @@
     "test": "nyc mocha --timeout=20000 test.js",
     "release": "bin/cli.js"
   },
+  "nyc": {
+    "exclude": ["tmp/**"]
+  },
   "repository": {
     "type": "git",
     "url": "git+https://github.com/conventional-changelog/standard-version.git"
@@ -35,22 +38,20 @@
   "dependencies": {
     "chalk": "^1.1.3",
     "conventional-changelog": "^1.1.0",
-    "conventional-recommended-bump": "^0.3.0",
+    "conventional-recommended-bump": "^1.0.0",
     "figures": "^1.5.0",
     "fs-access": "^1.0.0",
-    "object-assign": "^4.1.0",
     "semver": "^5.1.0",
-    "yargs": "^6.0.0"
+    "yargs": "^8.0.1"
   },
   "devDependencies": {
-    "bluebird": "^3.4.6",
     "chai": "^3.5.0",
     "coveralls": "^2.11.9",
     "mocha": "^3.1.0",
     "mock-git": "^1.0.2",
     "mockery": "^2.0.0",
-    "nyc": "^10.0.0",
+    "nyc": "^11.0.2",
     "shelljs": "^0.7.3",
-    "standard": "^8.0.0"
+    "standard": "^10.0.0"
   }
 }
diff --git a/test.js b/test.js
index af217bc..77db31d 100644
--- a/test.js
+++ b/test.js
@@ -2,7 +2,6 @@
 
 'use strict'
 
-var objectAssign = require('object-assign')
 var shell = require('shelljs')
 var fs = require('fs')
 var path = require('path')
@@ -10,11 +9,10 @@
 var mockGit = require('mock-git')
 var mockery = require('mockery')
 var semver = require('semver')
-var Promise = require('bluebird')
 var cli = require('./command')
 var standardVersion = require('./index')
 
-var should = require('chai').should()
+require('chai').should()
 
 var cliPath = path.resolve(__dirname, './bin/cli.js')
 
@@ -39,27 +37,45 @@
 }
 
 function execCliAsync (argString) {
-  return Promise.promisify(standardVersion)(cli.parse('standard-version ' + argString + ' --silent'))
+  return standardVersion(cli.parse('standard-version ' + argString + ' --silent'))
 }
 
 function writePackageJson (version, option) {
   option = option || {}
-  var pkg = objectAssign(option, {version: version})
+  var pkg = Object.assign(option, {version: version})
   fs.writeFileSync('package.json', JSON.stringify(pkg), 'utf-8')
   delete require.cache[require.resolve(path.join(process.cwd(), 'package.json'))]
 }
 
 function writeBowerJson (version, option) {
   option = option || {}
-  var bower = objectAssign(option, { version: version })
+  var bower = Object.assign(option, {version: version})
   fs.writeFileSync('bower.json', JSON.stringify(bower), 'utf-8')
 }
 
+function writeNpmShrinkwrapJson (version, option) {
+  option = option || {}
+  var shrinkwrap = Object.assign(option, { version: version })
+  fs.writeFileSync('npm-shrinkwrap.json', JSON.stringify(shrinkwrap), 'utf-8')
+}
+
 function writeGitPreCommitHook () {
   fs.writeFileSync('.git/hooks/pre-commit', '#!/bin/sh\necho "precommit ran"\nexit 1', 'utf-8')
   fs.chmodSync('.git/hooks/pre-commit', '755')
 }
 
+function writePostBumpHook (causeError) {
+  writeHook('postbump', causeError)
+}
+
+function writeHook (hookName, causeError, script) {
+  shell.mkdir('-p', 'scripts')
+  var content = script || 'console.error("' + hookName + ' ran")'
+  content += causeError ? '\nthrow new Error("' + hookName + '-failure")' : ''
+  fs.writeFileSync('scripts/' + hookName + '.js', content, 'utf-8')
+  fs.chmodSync('scripts/' + hookName + '.js', '755')
+}
+
 function initInTempFolder () {
   shell.rm('-rf', 'tmp')
   shell.config.silent = true
@@ -216,6 +232,116 @@
     })
   })
 
+  describe('lifecycle scripts', () => {
+    describe('prebump hook', function () {
+      it('should allow prebump hook to return an alternate version #', function () {
+        writePackageJson('1.0.0', {
+          'standard-version': {
+            'scripts': {
+              'prebump': 'node scripts/prebump'
+            }
+          }
+        })
+        writeHook('prebump', false, 'console.log("9.9.9")')
+        fs.writeFileSync('CHANGELOG.md', 'legacy header format<a name="1.0.0">\n', 'utf-8')
+
+        commit('feat: first commit')
+        var result = execCli('--patch')
+        result.stdout.should.match(/9\.9\.9/)
+        result.code.should.equal(0)
+      })
+    })
+
+    describe('postbump hook', function () {
+      it('should run the postbump hook when provided', function () {
+        writePackageJson('1.0.0', {
+          'standard-version': {
+            'scripts': {
+              'postbump': 'node scripts/postbump'
+            }
+          }
+        })
+        writePostBumpHook()
+        fs.writeFileSync('CHANGELOG.md', 'legacy header format<a name="1.0.0">\n', 'utf-8')
+
+        commit('feat: first commit')
+        var result = execCli('--patch')
+        result.code.should.equal(0)
+        result.stderr.should.match(/postbump ran/)
+      })
+
+      it('should run the postbump and exit with error when postbump fails', function () {
+        writePackageJson('1.0.0', {
+          'standard-version': {
+            'scripts': {
+              'postbump': 'node scripts/postbump'
+            }
+          }
+        })
+        writePostBumpHook(true)
+        fs.writeFileSync('CHANGELOG.md', 'legacy header format<a name="1.0.0">\n', 'utf-8')
+
+        commit('feat: first commit')
+        var result = execCli('--patch')
+        result.code.should.equal(1)
+        result.stderr.should.match(/postbump-failure/)
+      })
+    })
+
+    describe('precommit hook', function () {
+      it('should run the precommit hook when provided', function () {
+        writePackageJson('1.0.0', {
+          'standard-version': {
+            'scripts': {
+              'precommit': 'node scripts/precommit'
+            }
+          }
+        })
+        writeHook('precommit')
+        fs.writeFileSync('CHANGELOG.md', 'legacy header format<a name="1.0.0">\n', 'utf-8')
+
+        commit('feat: first commit')
+        var result = execCli('--patch')
+        result.code.should.equal(0)
+        result.stderr.should.match(/precommit ran/)
+      })
+
+      it('should run the precommit hook and exit with error when precommit fails', function () {
+        writePackageJson('1.0.0', {
+          'standard-version': {
+            'scripts': {
+              'precommit': 'node scripts/precommit'
+            }
+          }
+        })
+        writeHook('precommit', true)
+        fs.writeFileSync('CHANGELOG.md', 'legacy header format<a name="1.0.0">\n', 'utf-8')
+
+        commit('feat: first commit')
+        var result = execCli('--patch')
+        result.code.should.equal(1)
+        result.stderr.should.match(/precommit-failure/)
+      })
+
+      it('should allow an alternate commit message to be provided by precommit script', function () {
+        writePackageJson('1.0.0', {
+          'standard-version': {
+            'scripts': {
+              'precommit': 'node scripts/precommit'
+            }
+          }
+        })
+        writeHook('precommit', false, 'console.log("releasing %s delivers #222")')
+        fs.writeFileSync('CHANGELOG.md', 'legacy header format<a name="1.0.0">\n', 'utf-8')
+
+        commit('feat: first commit')
+        var result = execCli('--patch')
+        result.code.should.equal(0)
+        shell.exec('git log --oneline -n1').should.match(/delivers #222/)
+      })
+    })
+  })
+
   describe('pre-release', function () {
     it('works fine without specifying a tag id when prereleasing', function () {
       writePackageJson('1.0.0')
@@ -290,6 +416,34 @@
       })
     })
 
+    describe('release-as-exact', function () {
+      it('releases as v100.0.0', function () {
+        var originVer = '1.0.0'
+        writePackageJson(originVer)
+        fs.writeFileSync('CHANGELOG.md', 'legacy header format<a name="1.0.0">\n', 'utf-8')
+
+        commit('fix: first commit')
+
+        return execCliAsync('--release-as v100.0.0')
+          .then(function () {
+            getPackageVersion().should.equal('100.0.0')
+          })
+      })
+
+      it('releases as 200.0.0-amazing', function () {
+        var originVer = '1.0.0'
+        writePackageJson(originVer)
+        fs.writeFileSync('CHANGELOG.md', 'legacy header format<a name="1.0.0">\n', 'utf-8')
+
+        commit('fix: first commit')
+
+        return execCliAsync('--release-as 200.0.0-amazing')
+          .then(function () {
+            getPackageVersion().should.equal('200.0.0-amazing')
+          })
+      })
+    })
+
     it('creates a prerelease with a new minor version after two prerelease patches', function () {
       writePackageJson('1.0.0')
       fs.writeFileSync('CHANGELOG.md', 'legacy header format<a name="1.0.0">\n', 'utf-8')
@@ -433,11 +587,11 @@
       shell.exec('git tag -a v1.0.0 -m "my awesome first release"')
       commit('feat: new feature!')
 
-      require('./index')({silent: true}, function (err) {
-        should.exist(err)
-        err.message.should.match(/bump err/)
-        done()
-      })
+      require('./index')({silent: true})
+        .catch((err) => {
+          err.message.should.match(/bump err/)
+          done()
+        })
     })
   })
 
@@ -463,11 +617,11 @@
       shell.exec('git tag -a v1.0.0 -m "my awesome first release"')
       commit('feat: new feature!')
 
-      require('./index')({silent: true}, function (err) {
-        should.exist(err)
-        err.message.should.match(/changelog err/)
-        done()
-      })
+      require('./index')({silent: true})
+        .catch((err) => {
+          err.message.should.match(/changelog err/)
+          return done()
+        })
     })
   })
 
@@ -476,15 +630,14 @@
     shell.exec('git tag -a v1.0.0 -m "my awesome first release"')
     commit('feat: new feature!')
 
-    require('./index')({silent: true}, function (err) {
-      should.not.exist(err)
-
-      // check last commit message
-      shell.exec('git log --oneline -n1').stdout.should.match(/chore\(release\): 1\.1\.0/)
-      // check annotated tag message
-      shell.exec('git tag -l -n1 v1.1.0').stdout.should.match(/chore\(release\): 1\.1\.0/)
-      done()
-    })
+    require('./index')({silent: true})
+      .then(() => {
+        // check last commit message
+        shell.exec('git log --oneline -n1').stdout.should.match(/chore\(release\): 1\.1\.0/)
+        // check annotated tag message
+        shell.exec('git tag -l -n1 v1.1.0').stdout.should.match(/chore\(release\): 1\.1\.0/)
+        done()
+      })
   })
 
   describe('bower.json support', function () {
@@ -492,16 +645,34 @@
       writeBowerJson('1.0.0')
     })
 
-    it('bumps verson # in bower.json', function (done) {
+    it('bumps version # in bower.json', function (done) {
       commit('feat: first commit')
       shell.exec('git tag -a v1.0.0 -m "my awesome first release"')
       commit('feat: new feature!')
-      require('./index')({silent: true}, function (err) {
-        if (err) return done(err)
-        JSON.parse(fs.readFileSync('package.json', 'utf-8')).version.should.equal('1.1.0')
-        getPackageVersion().should.equal('1.1.0')
-        done()
-      })
+      require('./index')({silent: true})
+        .then(() => {
+          JSON.parse(fs.readFileSync('bower.json', 'utf-8')).version.should.equal('1.1.0')
+          getPackageVersion().should.equal('1.1.0')
+          return done()
+        })
+    })
+  })
+
+  describe('npm-shrinkwrap.json support', function () {
+    beforeEach(function () {
+      writeNpmShrinkwrapJson('1.0.0')
+    })
+
+    it('bumps version # in npm-shrinkwrap.json', function (done) {
+      commit('feat: first commit')
+      shell.exec('git tag -a v1.0.0 -m "my awesome first release"')
+      commit('feat: new feature!')
+      require('./index')({silent: true})
+        .then(() => {
+          JSON.parse(fs.readFileSync('npm-shrinkwrap.json', 'utf-8')).version.should.equal('1.1.0')
+          getPackageVersion().should.equal('1.1.0')
+          return done()
+        })
     })
   })
 })

=====================================================================
start time: Thu Oct 06 00:00:00 CST 2016
end time: Fri Dec 02 00:00:00 CST 2016
### Bug Fixes* include merge commits in the changelog ([#139](https://github.com/conventional-changelog/standard-version/issues/139)) ([b6e1562](https://github.com/conventional-changelog/standard-version/commit/b6e1562))* should print message before we bump version ([2894bbc](https://github.com/conventional-changelog/standard-version/commit/2894bbc))* support a wording change made to git status in git v2.9.1 ([#140](https://github.com/conventional-changelog/standard-version/issues/140)) ([80004ec](https://github.com/conventional-changelog/standard-version/commit/80004ec))### Features* add support for bumping version # in bower.json ([#148](https://github.com/conventional-changelog/standard-version/issues/148)) ([b788c5f](https://github.com/conventional-changelog/standard-version/commit/b788c5f))* make tag prefix configurable ([#143](https://github.com/conventional-changelog/standard-version/issues/143)) ([70b20c8](https://github.com/conventional-changelog/standard-version/commit/70b20c8))* support releasing a custom version, including pre-releases ([#129](https://github.com/conventional-changelog/standard-version/issues/129)) ([068008d](https://github.com/conventional-changelog/standard-version/commit/068008d))### BREAKING CHANGES* merge commits are now included in the CHANGELOG.<a name="3.0.0"></a>
diff --git a/.gitignore b/.gitignore
index 3588495..7e95d3c 100644
--- a/.gitignore
+++ b/.gitignore
@@ -11,3 +11,6 @@
 /.settings
 /.idea
 /.vscode
+
+# coverage
+coverage
diff --git a/CHANGELOG.md b/CHANGELOG.md
index 0a5af4b..6c9768b 100644
--- a/CHANGELOG.md
+++ b/CHANGELOG.md
@@ -2,6 +2,58 @@
 
 All notable changes to this project will be documented in this file. See [standard-version](https://github.com/conventional-changelog/standard-version) for commit guidelines.
 
+<a name="4.0.0-1"></a>
+# [4.0.0-1](https://github.com/conventional-changelog/standard-version/compare/v3.0.0...v4.0.0-1) (2016-11-27)
+
+
+### Bug Fixes
+
+* include merge commits in the changelog ([#139](https://github.com/conventional-changelog/standard-version/issues/139)) ([b6e1562](https://github.com/conventional-changelog/standard-version/commit/b6e1562))
+* should print message before we bump version ([2894bbc](https://github.com/conventional-changelog/standard-version/commit/2894bbc))
+* support a wording change made to git status in git v2.9.1 ([#140](https://github.com/conventional-changelog/standard-version/issues/140)) ([80004ec](https://github.com/conventional-changelog/standard-version/commit/80004ec))
+
+
+### Features
+
+* add support for bumping version # in bower.json ([#148](https://github.com/conventional-changelog/standard-version/issues/148)) ([b788c5f](https://github.com/conventional-changelog/standard-version/commit/b788c5f))
+* make tag prefix configurable ([#143](https://github.com/conventional-changelog/standard-version/issues/143)) ([70b20c8](https://github.com/conventional-changelog/standard-version/commit/70b20c8))
+* support releasing a custom version, including pre-releases ([#129](https://github.com/conventional-changelog/standard-version/issues/129)) ([068008d](https://github.com/conventional-changelog/standard-version/commit/068008d))
+
+
+### BREAKING CHANGES
+
+* merge commits are now included in the CHANGELOG.
+
+
+<a name="3.0.0"></a>
+# [3.0.0](https://github.com/conventional-changelog/standard-version/compare/v2.3.0...v3.0.0) (2016-10-06)
+
+
+### Bug Fixes
+
+* check the private field in package.json([#102](https://github.com/conventional-changelog/standard-version/issues/102)) ([#103](https://github.com/conventional-changelog/standard-version/issues/103)) ([2ce4160](https://github.com/conventional-changelog/standard-version/commit/2ce4160))
+* **err:** don't fail on stderr output, but print the output to stderr ([#110](https://github.com/conventional-changelog/standard-version/issues/110)) ([f7a4915](https://github.com/conventional-changelog/standard-version/commit/f7a4915)), closes [#91](https://github.com/conventional-changelog/standard-version/issues/91)
+
+
+### Chores
+
+* package.json engines field >=4.0, drop Node 0.10 and 0.12 ([28ff65a](https://github.com/conventional-changelog/standard-version/commit/28ff65a))
+
+
+### Features
+
+* **options:** add --silent flag and option for squelching output ([2a3fa61](https://github.com/conventional-changelog/standard-version/commit/2a3fa61))
+* added support for commitAll option in CLI ([#121](https://github.com/conventional-changelog/standard-version/issues/121)) ([a903f4d](https://github.com/conventional-changelog/standard-version/commit/a903f4d))
+* separate cli and defaults from base functionality ([34a6a4e](https://github.com/conventional-changelog/standard-version/commit/34a6a4e))
+
+
+### BREAKING CHANGES
+
+* drop support for Node < 4.0 to enable usage of
+new tools and packages.
+
+
+
 <a name="2.4.0"></a>
 # [2.4.0](https://github.com/conventional-changelog/standard-version/compare/v2.3.1...v2.4.0) (2016-07-13)
 
diff --git a/README.md b/README.md
index 9edfeb7..3e9e3bb 100644
--- a/README.md
+++ b/README.md
@@ -23,9 +23,9 @@
 
 `standard-version` does the following:
 
-1. bumps the version in _package.json_ (based on your commit history)
+1. bumps the version in _package.json/bower.json_ (based on your commit history)
 2. uses [conventional-changelog](https://github.com/conventional-changelog/conventional-changelog) to update _CHANGELOG.md_
-3. commits _package.json_ and _CHANGELOG.md_
+3. commits _package.json (et al.)_ and _CHANGELOG.md_
 4. tags a new release
 
 ## Installation
@@ -77,7 +77,7 @@
 standard-version --first-release
 ```
 
-This will tag a release **without bumping the version in package.json**.
+This will tag a release **without bumping the version in package.json (_et al._)**.
 
 When ready, push the git tag and `npm publish` your first release. \o/
 
@@ -96,6 +96,45 @@
 
 After you cut a release, you can push the new git tag and `npm publish` (or `npm publish --tag next`) when you're ready.
 
+### Release as a pre-release
+
+Use the flag `--prerelease` to generate pre-releases:
+
+Suppose the last version of your code is `1.0.0`, and your code to be committed has patched changes. Run:
+
+```bash
+# npm run script
+npm run release -- --prerelease
+```
+you will get version `1.0.1-0`.
+
+If you want to name the pre-release, you specify the name via `--prerelease <name>`.
+
+For example, suppose your pre-release should contain the `alpha` prefix:
+
+```bash
+# npm run script
+npm run release -- --prerelease alpha
+```
+
+this will tag the version `1.0.1-alpha.0`
+
+### Release as a target type imperatively like `npm version`
+
+To forgo the automated version bump use `--release-as` with the argument `major`, `minor` or `patch`:
+
+Suppose the last version of your code is `1.0.0`, you've only landed `fix:` commits, but
+you would like your next release to be a `minor`. Simply do:
+
+```bash
+# npm run script
+npm run release -- --release-as minor
+```
+
+you will get version `1.1.0` rather than the auto generated version `1.0.1`.
+
+> **NOTE:** you can combine `--release-as` and `--prerelease` to generate a release. This is useful when publishing experimental feature(s).
+
 ### Prevent Git Hooks
 
 If you use git hooks, like pre-commit, to test your code before committing, you can prevent hooks from being verified during the commit step by passing the `--no-verify` option:
@@ -111,6 +150,15 @@
 
 If you have your GPG key set up, add the `--sign` or `-s` flag to your `standard-version` command.
 
+### Committing generated artifacts in the release commit
+
+If you want to commit generated artifacts in the release commit (e.g. [#96](https://github.com/conventional-changelog/standard-version/issues/96)), you can use the `--commit-all` or `-a` flag. You will need to stage the artifacts you want to commit, so your `release` command could look like this:
+
+```json
+"prerelease": "webpack -p --bail",
+"release": "git add <file(s) to commit> && standard-version -a"
+```
+
 ### CLI Help
 
 ```sh
diff --git a/bin/cli.js b/bin/cli.js
new file mode 100755
index 0000000..c80a2e1
--- /dev/null
+++ b/bin/cli.js
@@ -0,0 +1,9 @@
+#!/usr/bin/env node
+var standardVersion = require('../index')
+var cmdParser = require('../command')
+
+standardVersion(cmdParser.argv, function (err) {
+  if (err) {
+    process.exit(1)
+  }
+})
diff --git a/cli.js b/cli.js
deleted file mode 100644
index a23f874..0000000
--- a/cli.js
+++ /dev/null
@@ -1,58 +0,0 @@
-#!/usr/bin/env node
-var standardVersion = require('./index')
-var defaults = require('./defaults')
-
-var argv = require('yargs')
-  .usage('Usage: $0 [options]')
-  .option('infile', {
-    alias: 'i',
-    describe: 'Read the CHANGELOG from this file',
-    default: defaults.infile,
-    global: true
-  })
-  .option('message', {
-    alias: 'm',
-    describe: 'Commit message, replaces %s with new version',
-    type: 'string',
-    default: defaults.message,
-    global: true
-  })
-  .option('first-release', {
-    alias: 'f',
-    describe: 'Is this the first release?',
-    type: 'boolean',
-    default: defaults.firstRelease,
-    global: true
-  })
-  .option('sign', {
-    alias: 's',
-    describe: 'Should the git commit and tag be signed?',
-    type: 'boolean',
-    default: defaults.sign,
-    global: true
-  })
-  .option('no-verify', {
-    alias: 'n',
-    describe: 'Bypass pre-commit or commit-msg git hooks during the commit phase',
-    type: 'boolean',
-    default: defaults.noVerify,
-    global: true
-  })
-  .option('silent', {
-    describe: 'Don\'t print logs and errors',
-    type: 'boolean',
-    default: defaults.silent,
-    global: true
-  })
-  .help()
-  .alias('help', 'h')
-  .example('$0', 'Update changelog and tag release')
-  .example('$0 -m "%s: see changelog for details"', 'Update changelog and tag release with custom commit message')
-  .wrap(97)
-  .argv
-
-standardVersion(argv, function (err) {
-  if (err) {
-    process.exit(1)
-  }
-})
diff --git a/command.js b/command.js
new file mode 100755
index 0000000..60bdfd0
--- /dev/null
+++ b/command.js
@@ -0,0 +1,79 @@
+var defaults = require('./defaults')
+
+module.exports = require('yargs')
+  .usage('Usage: $0 [options]')
+  .option('release-as', {
+    alias: 'r',
+    describe: 'Specify the release type manually (like npm version <major|minor|patch>)',
+    requiresArg: true,
+    string: true,
+    choices: ['major', 'minor', 'patch'],
+    global: true
+  })
+  .option('prerelease', {
+    alias: 'p',
+    describe: 'make a pre-release with optional option value to specify a tag id',
+    string: true,
+    global: true
+  })
+  .option('infile', {
+    alias: 'i',
+    describe: 'Read the CHANGELOG from this file',
+    default: defaults.infile,
+    global: true
+  })
+  .option('message', {
+    alias: 'm',
+    describe: 'Commit message, replaces %s with new version',
+    type: 'string',
+    default: defaults.message,
+    global: true
+  })
+  .option('first-release', {
+    alias: 'f',
+    describe: 'Is this the first release?',
+    type: 'boolean',
+    default: defaults.firstRelease,
+    global: true
+  })
+  .option('sign', {
+    alias: 's',
+    describe: 'Should the git commit and tag be signed?',
+    type: 'boolean',
+    default: defaults.sign,
+    global: true
+  })
+  .option('no-verify', {
+    alias: 'n',
+    describe: 'Bypass pre-commit or commit-msg git hooks during the commit phase',
+    type: 'boolean',
+    default: defaults.noVerify,
+    global: true
+  })
+  .option('commit-all', {
+    alias: 'a',
+    describe: 'Commit all staged changes, not just files affected by standard-version',
+    type: 'boolean',
+    default: defaults.commitAll,
+    global: true
+  })
+  .option('silent', {
+    describe: 'Don\'t print logs and errors',
+    type: 'boolean',
+    default: defaults.silent,
+    global: true
+  })
+  .option('tag-prefix', {
+    alias: 't',
+    describe: 'Set a custom prefix for the git tag to be created',
+    type: 'string',
+    default: defaults.tagPrefix,
+    global: true
+  })
+  .version()
+  .alias('version', 'v')
+  .help()
+  .alias('help', 'h')
+  .example('$0', 'Update changelog and tag release')
+  .example('$0 -m "%s: see changelog for details"', 'Update changelog and tag release with custom commit message')
+  .wrap(97)
diff --git a/defaults.json b/defaults.json
index 196733e..26ef43c 100644
--- a/defaults.json
+++ b/defaults.json
@@ -4,5 +4,7 @@
   "firstRelease": false,
   "sign": false,
   "noVerify": false,
-  "silent": false
+  "commitAll": false,
+  "silent": false,
+  "tagPrefix": "v"
 }
diff --git a/index.js b/index.js
index e4212df..c7aa5ca 100755
--- a/index.js
+++ b/index.js
@@ -15,41 +15,148 @@
   var pkgPath = path.resolve(process.cwd(), './package.json')
   var pkg = require(pkgPath)
   var defaults = require('./defaults')
+  var args = objectAssign({}, defaults, argv)
 
-  argv = objectAssign(defaults, argv)
-
-  conventionalRecommendedBump({
-    preset: 'angular'
-  }, function (err, release) {
+  bumpVersion(args.releaseAs, function (err, release) {
     if (err) {
-      printError(argv, err.message)
+      printError(args, err.message)
       return done(err)
     }
 
     var newVersion = pkg.version
-    if (!argv.firstRelease) {
-      newVersion = semver.inc(pkg.version, release.releaseType)
-      checkpoint(argv, 'bumping version in package.json from %s to %s', [pkg.version, newVersion])
-      pkg.version = newVersion
-      fs.writeFileSync(pkgPath, JSON.stringify(pkg, null, 2) + '\n', 'utf-8')
+
+    if (!args.firstRelease) {
+      var releaseType = getReleaseType(args.prerelease, release.releaseType, pkg.version)
+      newVersion = semver.inc(pkg.version, releaseType, args.prerelease)
+      updateConfigs(args, newVersion)
     } else {
-      checkpoint(argv, 'skip version bump on first release', [], chalk.red(figures.cross))
+      checkpoint(args, 'skip version bump on first release', [], chalk.red(figures.cross))
     }
 
-    outputChangelog(argv, function (err) {
+    outputChangelog(args, function (err) {
       if (err) {
         return done(err)
       }
-      commit(argv, newVersion, function (err) {
+      commit(args, newVersion, function (err) {
         if (err) {
           return done(err)
         }
-        return tag(newVersion, pkg.private, argv, done)
+        return tag(newVersion, pkg.private, args, done)
       })
     })
   })
 }
 
+/**
+ * attempt to update the version # in a collection of common config
+ * files, e.g., package.json, bower.json.
+ *
+ * @param argv config object
+ * @param newVersion version # to update to.
+ * @return {string}
+ */
+var configsToUpdate = {}
+function updateConfigs (args, newVersion) {
+  configsToUpdate[path.resolve(process.cwd(), './package.json')] = false
+  configsToUpdate[path.resolve(process.cwd(), './bower.json')] = false
+  Object.keys(configsToUpdate).forEach(function (configPath) {
+    try {
+      var stat = fs.lstatSync(configPath)
+      if (stat.isFile()) {
+        var config = require(configPath)
+        var filename = path.basename(configPath)
+        checkpoint(args, 'bumping version in ' + filename + ' from %s to %s', [config.version, newVersion])
+        config.version = newVersion
+        fs.writeFileSync(configPath, JSON.stringify(config, null, 2) + '\n', 'utf-8')
+        // flag any config files that we modify the version # for
+        // as having been updated.
+        configsToUpdate[configPath] = true
+      }
+    } catch (err) {
+      if (err.code !== 'ENOENT') console.warn(err.message)
+    }
+  })
+}
+
+function getReleaseType (prerelease, expectedReleaseType, currentVersion) {
+  if (isString(prerelease)) {
+    if (isInPrerelease(currentVersion)) {
+      if (shouldContinuePrerelease(currentVersion, expectedReleaseType) ||
+        getTypePriority(getCurrentActiveType(currentVersion)) > getTypePriority(expectedReleaseType)
+      ) {
+        return 'prerelease'
+      }
+    }
+
+    return 'pre' + expectedReleaseType
+  } else {
+    return expectedReleaseType
+  }
+}
+
+function isString (val) {
+  return typeof val === 'string'
+}
+
+/**
+ * if a version is currently in pre-release state,
+ * and if it current in-pre-release type is same as expect type,
+ * it should continue the pre-release with the same type
+ *
+ * @param version
+ * @param expectType
+ * @return {boolean}
+ */
+function shouldContinuePrerelease (version, expectType) {
+  return getCurrentActiveType(version) === expectType
+}
+
+function isInPrerelease (version) {
+  return Array.isArray(semver.prerelease(version))
+}
+
+var TypeList = ['major', 'minor', 'patch'].reverse()
+
+/**
+ * extract the in-pre-release type in target version
+ *
+ * @param version
+ * @return {string}
+ */
+function getCurrentActiveType (version) {
+  var typelist = TypeList
+  for (var i = 0; i < typelist.length; i++) {
+    if (semver[typelist[i]](version)) {
+      return typelist[i]
+    }
+  }
+}
+
+/**
+ * calculate the priority of release type,
+ * major - 2, minor - 1, patch - 0
+ *
+ * @param type
+ * @return {number}
+ */
+function getTypePriority (type) {
+  return TypeList.indexOf(type)
+}
+
+function bumpVersion (releaseAs, callback) {
+  if (releaseAs) {
+    callback(null, {
+      releaseType: releaseAs
+    })
+  } else {
+    conventionalRecommendedBump({
+      preset: 'angular'
+    }, function (err, release) {
+      callback(err, release)
+    })
+  }
+}
+
 function outputChangelog (argv, cb) {
   createIfMissing(argv)
   var header = '# Change Log\n\nAll notable changes to this project will be documented in this file. See [standard-version](https://github.com/conventional-changelog/standard-version) for commit guidelines.\n'
@@ -61,7 +168,7 @@
   var content = ''
   var changelogStream = conventionalChangelog({
     preset: 'angular'
-  })
+  }, undefined, {merges: null})
     .on('error', function (err) {
       return cb(err)
     })
@@ -96,14 +203,19 @@
   var msg = 'committing %s'
   var args = [argv.infile]
   var verify = argv.verify === false || argv.n ? '--no-verify ' : ''
-  if (!argv.firstRelease) {
-    msg += ' and %s'
-    args.unshift('package.json')
-  }
+  var toAdd = ''
+  // commit any of the config files that we've updated
+  // the version # for.
+  Object.keys(configsToUpdate).forEach(function (p) {
+    if (configsToUpdate[p]) {
+      msg += ' and %s'
+      args.unshift(path.basename(p))
+      toAdd += ' ' + path.relative(process.cwd(), p)
+    }
+  })
   checkpoint(argv, msg, args)
-
-  handledExec(argv, 'git add package.json ' + argv.infile, cb, function () {
-    handledExec(argv, 'git commit ' + verify + (argv.sign ? '-S ' : '') + 'package.json ' + argv.infile + ' -m "' + formatCommitMessage(argv.message, newVersion) + '"', cb, function () {
+  handledExec(argv, 'git add' + toAdd + ' ' + argv.infile, cb, function () {
+    handledExec(argv, 'git commit ' + verify + (argv.sign ? '-S ' : '') + (argv.commitAll ? '' : (argv.infile + toAdd)) + ' -m "' + formatCommitMessage(argv.message, newVersion) + '"', cb, function () {
       cb()
     })
   })
@@ -121,7 +233,7 @@
     tagOption = '-a '
   }
   checkpoint(argv, 'tagging release %s', [newVersion])
-  handledExec(argv, 'git tag ' + tagOption + 'v' + newVersion + ' -m "' + formatCommitMessage(argv.message, newVersion) + '"', cb, function () {
+  handledExec(argv, 'git tag ' + tagOption + argv.tagPrefix + newVersion + ' -m "' + formatCommitMessage(argv.message, newVersion) + '"', cb, function () {
     var message = 'git push --follow-tags origin master'
     if (pkgPrivate !== true) message += '; npm publish'
 
diff --git a/package.json b/package.json
index ed27aba..adf2a97 100644
--- a/package.json
+++ b/package.json
@@ -1,19 +1,20 @@
 {
   "name": "standard-version",
-  "version": "2.4.0",
+  "version": "4.0.0-1",
   "description": "replacement for `npm version` with automatic CHANGELOG generation",
-  "bin": "cli.js",
+  "bin": "bin/cli.js",
   "scripts": {
     "pretest": "standard",
     "coverage": "nyc report --reporter=text-lcov | coveralls",
-    "test": "nyc mocha --timeout=20000 test.js"
+    "test": "nyc mocha --timeout=20000 test.js",
+    "release": "bin/cli.js"
   },
   "repository": {
     "type": "git",
     "url": "git+https://github.com/conventional-changelog/standard-version.git"
   },
   "engines": {
-    "node" : ">=4.0"
+    "node": ">=4.0"
   },
   "keywords": [
     "conventional-changelog",
@@ -42,12 +43,13 @@
     "yargs": "^6.0.0"
   },
   "devDependencies": {
+    "bluebird": "^3.4.6",
     "chai": "^3.5.0",
     "coveralls": "^2.11.9",
     "mocha": "^3.1.0",
     "mock-git": "^1.0.2",
-    "mockery": "^1.7.0",
-    "nyc": "^8.1.0",
+    "mockery": "^2.0.0",
+    "nyc": "^10.0.0",
     "shelljs": "^0.7.3",
     "standard": "^8.0.0"
   }
diff --git a/test.js b/test.js
index 6ade1a2..af217bc 100644
--- a/test.js
+++ b/test.js
@@ -2,30 +2,57 @@
 
 'use strict'
 
-var extend = Object.assign || require('util')._extend
+var objectAssign = require('object-assign')
 var shell = require('shelljs')
 var fs = require('fs')
 var path = require('path')
 var stream = require('stream')
 var mockGit = require('mock-git')
 var mockery = require('mockery')
+var semver = require('semver')
+var Promise = require('bluebird')
+var cli = require('./command')
+var standardVersion = require('./index')
 
 var should = require('chai').should()
 
-var cliPath = path.resolve(__dirname, './cli.js')
+var cliPath = path.resolve(__dirname, './bin/cli.js')
+
+function branch (branch) {
+  shell.exec('git branch ' + branch)
+}
+
+function checkout (branch) {
+  shell.exec('git checkout ' + branch)
+}
 
 function commit (msg) {
   shell.exec('git commit --allow-empty -m"' + msg + '"')
 }
 
+function merge (msg, branch) {
+  shell.exec('git merge --no-ff -m"' + msg + '" ' + branch)
+}
+
 function execCli (argString) {
   return shell.exec('node ' + cliPath + (argString != null ? ' ' + argString : ''))
 }
 
+function execCliAsync (argString) {
+  return Promise.promisify(standardVersion)(cli.parse('standard-version ' + argString + ' --silent'))
+}
+
 function writePackageJson (version, option) {
   option = option || {}
-  var pkg = extend(option, {version: version})
+  var pkg = objectAssign(option, {version: version})
   fs.writeFileSync('package.json', JSON.stringify(pkg), 'utf-8')
+  delete require.cache[require.resolve(path.join(process.cwd(), 'package.json'))]
+}
+
+function writeBowerJson (version, option) {
+  option = option || {}
+  var bower = objectAssign(option, { version: version })
+  fs.writeFileSync('bower.json', JSON.stringify(bower), 'utf-8')
 }
 
 function writeGitPreCommitHook () {
@@ -48,6 +75,10 @@
   shell.rm('-rf', 'tmp')
 }
 
+function getPackageVersion () {
+  return JSON.parse(fs.readFileSync('package.json', 'utf-8')).version
+}
+
 describe('cli', function () {
   beforeEach(initInTempFolder)
   afterEach(finishTemp)
@@ -92,6 +123,29 @@
       content.should.match(/1\.0\.1/)
       content.should.not.match(/legacy header format/)
     })
+
+    it('commits all staged files', function () {
+      fs.writeFileSync('CHANGELOG.md', 'legacy header format<a name="1.0.0">\n', 'utf-8')
+
+      commit('feat: first commit')
+      shell.exec('git tag -a v1.0.0 -m "my awesome first release"')
+      commit('fix: patch release')
+
+      fs.writeFileSync('STUFF.md', 'stuff\n', 'utf-8')
+
+      shell.exec('git add STUFF.md')
+
+      execCli('--commit-all').code.should.equal(0)
+
+      var content = fs.readFileSync('CHANGELOG.md', 'utf-8')
+      var status = shell.exec('git status --porcelain') // see http://unix.stackexchange.com/questions/155046/determine-if-git-working-directory-is-clean-from-a-script
+
+      status.should.equal('')
+      status.should.not.match(/STUFF.md/)
+
+      content.should.match(/1\.0\.1/)
+      content.should.not.match(/legacy header format/)
+    })
   })
 
   describe('with mocked git', function () {
@@ -104,7 +158,7 @@
           var captured = shell.cat('gitcapture.log').stdout.split('\n').map(function (line) {
             return line ? JSON.parse(line) : line
           })
-          captured[captured.length - 3].should.deep.equal(['commit', '-S', 'package.json', 'CHANGELOG.md', '-m', 'chore(release): 1.0.1'])
+          captured[captured.length - 3].should.deep.equal(['commit', '-S', 'CHANGELOG.md', 'package.json', '-m', 'chore(release): 1.0.1'])
           captured[captured.length - 2].should.deep.equal(['tag', '-s', 'v1.0.1', '-m', 'chore(release): 1.0.1'])
 
           unmock()
@@ -162,6 +216,126 @@
     })
   })
 
+  describe('pre-release', function () {
+    it('works fine without specifying a tag id when prereleasing', function () {
+      writePackageJson('1.0.0')
+      fs.writeFileSync('CHANGELOG.md', 'legacy header format<a name="1.0.0">\n', 'utf-8')
+
+      commit('feat: first commit')
+      return execCliAsync('--prerelease')
+        .then(function () {
+          // it's a feature commit, so it's minor type
+          getPackageVersion().should.equal('1.1.0-0')
+        })
+    })
+  })
+
+  describe('manual-release', function () {
+    it('throws error when not specifying a release type', function () {
+      writePackageJson('1.0.0')
+      fs.writeFileSync('CHANGELOG.md', 'legacy header format<a name="1.0.0">\n', 'utf-8')
+
+      commit('fix: first commit')
+      execCli('--release-as').code.should.above(0)
+    })
+
+    describe('release-types', function () {
+      var regularTypes = ['major', 'minor', 'patch']
+
+      regularTypes.forEach(function (type) {
+        it('creates a ' + type + ' release', function () {
+          var originVer = '1.0.0'
+          writePackageJson(originVer)
+          fs.writeFileSync('CHANGELOG.md', 'legacy header format<a name="1.0.0">\n', 'utf-8')
+
+          commit('fix: first commit')
+
+          return execCliAsync('--release-as ' + type)
+            .then(function () {
+              var version = {
+                major: semver.major(originVer),
+                minor: semver.minor(originVer),
+                patch: semver.patch(originVer)
+              }
+
+              version[type] += 1
+
+              getPackageVersion().should.equal(version.major + '.' + version.minor + '.' + version.patch)
+            })
+        })
+      })
+
+      // this is for pre-releases
+      regularTypes.forEach(function (type) {
+        it('creates a pre' + type + ' release', function () {
+          var originVer = '1.0.0'
+          writePackageJson(originVer)
+          fs.writeFileSync('CHANGELOG.md', 'legacy header format<a name="1.0.0">\n', 'utf-8')
+
+          commit('fix: first commit')
+
+          return execCliAsync('--release-as ' + type + ' --prerelease ' + type)
+            .then(function () {
+              var version = {
+                major: semver.major(originVer),
+                minor: semver.minor(originVer),
+                patch: semver.patch(originVer)
+              }
+
+              version[type] += 1
+
+              getPackageVersion().should.equal(version.major + '.' + version.minor + '.' + version.patch + '-' + type + '.0')
+            })
+        })
+      })
+    })
+
+    it('creates a prerelease with a new minor version after two prerelease patches', function () {
+      writePackageJson('1.0.0')
+      fs.writeFileSync('CHANGELOG.md', 'legacy header format<a name="1.0.0">\n', 'utf-8')
+
+      commit('fix: first patch')
+      return execCliAsync('--release-as patch --prerelease dev')
+        .then(function () {
+          getPackageVersion().should.equal('1.0.1-dev.0')
+        })
+
+        // second
+        .then(function () {
+          commit('fix: second patch')
+          return execCliAsync('--prerelease dev')
+        })
+        .then(function () {
+          getPackageVersion().should.equal('1.0.1-dev.1')
+        })
+
+        // third
+        .then(function () {
+          commit('feat: first new feat')
+          return execCliAsync('--release-as minor --prerelease dev')
+        })
+        .then(function () {
+          getPackageVersion().should.equal('1.1.0-dev.0')
+        })
+
+        .then(function () {
+          commit('fix: third patch')
+          return execCliAsync('--release-as minor --prerelease dev')
+        })
+        .then(function () {
+          getPackageVersion().should.equal('1.1.0-dev.1')
+        })
+
+        .then(function () {
+          commit('fix: forth patch')
+          return execCliAsync('--prerelease dev')
+        })
+        .then(function () {
+          getPackageVersion().should.equal('1.1.0-dev.2')
+        })
+    })
+  })
+
   it('handles commit messages longer than 80 characters', function () {
     commit('feat: first commit')
     shell.exec('git tag -a v1.0.0 -m "my awesome first release"')
@@ -216,6 +390,25 @@
     result.code.should.equal(0)
     result.stdout.should.not.match(/npm publish/)
   })
+
+  it('includes merge commits', function () {
+    var branchName = 'new-feature'
+    commit('feat: first commit')
+    shell.exec('git tag -a v1.0.0 -m "my awesome first release"')
+    branch(branchName)
+    checkout(branchName)
+    commit('Implementing new feature')
+    checkout('master')
+    merge('feat: new feature from branch', branchName)
+
+    execCli().code.should.equal(0)
+
+    var content = fs.readFileSync('CHANGELOG.md', 'utf-8')
+    content.should.match(/new feature from branch/)
+
+    var pkgJson = fs.readFileSync('package.json', 'utf-8')
+    pkgJson.should.equal(['{', '  "version": "1.1.0"', '}', ''].join('\n'))
+  })
 })
 
 describe('standard-version', function () {
@@ -293,4 +486,22 @@
       done()
     })
   })
+
+  describe('bower.json support', function () {
+    beforeEach(function () {
+      writeBowerJson('1.0.0')
+    })
+
+    it('bumps verson # in bower.json', function (done) {
+      commit('feat: first commit')
+      shell.exec('git tag -a v1.0.0 -m "my awesome first release"')
+      commit('feat: new feature!')
+      require('./index')({silent: true}, function (err) {
+        if (err) return done(err)
+        JSON.parse(fs.readFileSync('package.json', 'utf-8')).version.should.equal('1.1.0')
+        getPackageVersion().should.equal('1.1.0')
+        done()
+      })
+    })
+  })
 })

=====================================================================
start time: Wed Jul 13 00:00:00 CST 2016
end time: Thu Oct 06 00:00:00 CST 2016
### Bug Fixes* check the private field in package.json([#102](https://github.com/conventional-changelog/standard-version/issues/102)) ([#103](https://github.com/conventional-changelog/standard-version/issues/103)) ([2ce4160](https://github.com/conventional-changelog/standard-version/commit/2ce4160))* **err:** don't fail on stderr output, but print the output to stderr ([#110](https://github.com/conventional-changelog/standard-version/issues/110)) ([f7a4915](https://github.com/conventional-changelog/standard-version/commit/f7a4915)), closes [#91](https://github.com/conventional-changelog/standard-version/issues/91)### Chores* package.json engines field >=4.0, drop Node 0.10 and 0.12 ([28ff65a](https://github.com/conventional-changelog/standard-version/commit/28ff65a))### Features* **options:** add --silent flag and option for squelching output ([2a3fa61](https://github.com/conventional-changelog/standard-version/commit/2a3fa61))* added support for commitAll option in CLI ([#121](https://github.com/conventional-changelog/standard-version/issues/121)) ([a903f4d](https://github.com/conventional-changelog/standard-version/commit/a903f4d))* separate cli and defaults from base functionality ([34a6a4e](https://github.com/conventional-changelog/standard-version/commit/34a6a4e))### BREAKING CHANGES* drop support for Node < 4.0 to enable usage ofnew tools and packages.<a name="2.4.0"></a>
diff --git a/.editorconfig b/.editorconfig
new file mode 100644
index 0000000..c0db00a
--- /dev/null
+++ b/.editorconfig
@@ -0,0 +1,9 @@
+# EditorConfig is awesome: http://EditorConfig.org
+
+root = true
+
+[*]
+trim_trailing_whitespace=true
+indent_style = space
+indent_size = 2
+insert_final_newline = true
diff --git a/.gitignore b/.gitignore
index c9106a7..3588495 100644
--- a/.gitignore
+++ b/.gitignore
@@ -1,2 +1,13 @@
+# OS
+.DS_Store
+
+# node.js & npm
 node_modules
 .nyc_output
+npm-debug.log
+
+# Editor files
+/.project
+/.settings
+/.idea
+/.vscode
diff --git a/.travis.yml b/.travis.yml
index 91eedc5..ed30357 100644
--- a/.travis.yml
+++ b/.travis.yml
@@ -1,7 +1,5 @@
 language: node_js
 node_js:
-  - "0.10"
-  - "0.12"
   - "4"
   - "5"
   - "node"
diff --git a/README.md b/README.md
index 35ef574..9edfeb7 100644
--- a/README.md
+++ b/README.md
@@ -1,6 +1,8 @@
 # Standard Version
 
-[![Build Status](https://travis-ci.org/conventional-changelog/standard-version.svg)](https://travis-ci.org/conventional-changelog/standard-version)
+[![Join the chat at https://gitter.im/conventional-changelog/standard-version](https://badges.gitter.im/conventional-changelog/standard-version.svg)](https://gitter.im/conventional-changelog/standard-version?utm_source=badge&utm_medium=badge&utm_campaign=pr-badge&utm_content=badge)
+
+[![Build Status](https://travis-ci.org/conventional-changelog/standard-version.svg?branch=master)](https://travis-ci.org/conventional-changelog/standard-version)
 [![NPM version](https://img.shields.io/npm/v/standard-version.svg)](https://www.npmjs.com/package/standard-version)
 [![Coverage Status](https://coveralls.io/repos/conventional-changelog/standard-version/badge.svg?branch=)](https://coveralls.io/r/conventional-changelog/standard-version?branch=master)
 [![Standard Version](https://img.shields.io/badge/release-standard%20version-brightgreen.svg)](https://github.com/conventional-changelog/standard-version)
@@ -62,7 +64,7 @@
 
 This has the benefit of allowing you to use `standard-version` on any repo/package without adding a dev dependency to each one.
 
-## Usage
+## CLI Usage
 
 ### First Release
 
@@ -105,6 +107,10 @@
 standard-version --no-verify
 ```
 
+### Signing commits and tags
+
+If you have your GPG key set up, add the `--sign` or `-s` flag to your `standard-version` command.
+
 ### CLI Help
 
 ```sh
@@ -114,6 +120,27 @@
 standard-version --help
 ```
 
+## Code usage
+
+Use the `silent` option to stop `standard-version` from printing anything
+to the console.
+
+```js
+var standardVersion = require('standard-version')
+
+// Options are the same as command line, except camelCase
+standardVersion({
+  noVerify: true,
+  infile: 'docs/CHANGELOG.md',
+  silent: true
+}, function (err) {
+  if (err) {
+    console.error(`standard-version failed with message: ${err.message}`)
+  }
+  // standard-version is done
+})
+```
+
 ## Commit Message Convention, at a Glance
 
 _patches:_
diff --git a/appveyor.yml b/appveyor.yml
index e3bafae..538cdfb 100644
--- a/appveyor.yml
+++ b/appveyor.yml
@@ -3,7 +3,6 @@
     - nodejs_version: '6'
     - nodejs_version: '5'
     - nodejs_version: '4'
-    - nodejs_version: '0.12'
 install:
   - ps: Install-Product node $env:nodejs_version
   - set CI=true
diff --git a/cli.js b/cli.js
new file mode 100644
index 0000000..a23f874
--- /dev/null
+++ b/cli.js
@@ -0,0 +1,58 @@
+#!/usr/bin/env node
+var standardVersion = require('./index')
+var defaults = require('./defaults')
+
+var argv = require('yargs')
+  .usage('Usage: $0 [options]')
+  .option('infile', {
+    alias: 'i',
+    describe: 'Read the CHANGELOG from this file',
+    default: defaults.infile,
+    global: true
+  })
+  .option('message', {
+    alias: 'm',
+    describe: 'Commit message, replaces %s with new version',
+    type: 'string',
+    default: defaults.message,
+    global: true
+  })
+  .option('first-release', {
+    alias: 'f',
+    describe: 'Is this the first release?',
+    type: 'boolean',
+    default: defaults.firstRelease,
+    global: true
+  })
+  .option('sign', {
+    alias: 's',
+    describe: 'Should the git commit and tag be signed?',
+    type: 'boolean',
+    default: defaults.sign,
+    global: true
+  })
+  .option('no-verify', {
+    alias: 'n',
+    describe: 'Bypass pre-commit or commit-msg git hooks during the commit phase',
+    type: 'boolean',
+    default: defaults.noVerify,
+    global: true
+  })
+  .option('silent', {
+    describe: 'Don\'t print logs and errors',
+    type: 'boolean',
+    default: defaults.silent,
+    global: true
+  })
+  .help()
+  .alias('help', 'h')
+  .example('$0', 'Update changelog and tag release')
+  .example('$0 -m "%s: see changelog for details"', 'Update changelog and tag release with custom commit message')
+  .wrap(97)
+  .argv
+
+standardVersion(argv, function (err) {
+  if (err) {
+    process.exit(1)
+  }
+})
diff --git a/defaults.json b/defaults.json
new file mode 100644
index 0000000..196733e
--- /dev/null
+++ b/defaults.json
@@ -0,0 +1,8 @@
+{
+  "infile": "CHANGELOG.md",
+  "message": "chore(release): %s",
+  "firstRelease": false,
+  "sign": false,
+  "noVerify": false,
+  "silent": false
+}
diff --git a/index.js b/index.js
index 6bed6ed..e4212df 100755
--- a/index.js
+++ b/index.js
@@ -1,84 +1,54 @@
-#!/usr/bin/env node
 var conventionalRecommendedBump = require('conventional-recommended-bump')
 var conventionalChangelog = require('conventional-changelog')
 var path = require('path')
-var argv = require('yargs')
-  .usage('Usage: $0 [options]')
-  .option('infile', {
-    alias: 'i',
-    describe: 'Read the CHANGELOG from this file',
-    default: 'CHANGELOG.md',
-    global: true
-  })
-  .option('message', {
-    alias: 'm',
-    describe: 'Commit message, replaces %s with new version',
-    type: 'string',
-    default: 'chore(release): %s',
-    global: true
-  })
-  .option('first-release', {
-    alias: 'f',
-    describe: 'Is this the first release?',
-    type: 'boolean',
-    default: false,
-    global: true
-  })
-  .option('sign', {
-    alias: 's',
-    describe: 'Should the git commit and tag be signed?',
-    type: 'boolean',
-    default: false,
-    global: true
-  })
-  .option('no-verify', {
-    alias: 'n',
-    describe: 'Bypass pre-commit or commit-msg git hooks during the commit phase',
-    type: 'boolean',
-    default: false,
-    global: true
-  })
-  .help()
-  .alias('help', 'h')
-  .example('$0', 'Update changelog and tag release')
-  .example('$0 -m "%s: see changelog for details"', 'Update changelog and tag release with custom commit message')
-  .wrap(97)
-  .argv
 
 var chalk = require('chalk')
 var figures = require('figures')
 var exec = require('child_process').exec
 var fs = require('fs')
 var accessSync = require('fs-access').sync
-var pkgPath = path.resolve(process.cwd(), './package.json')
-var pkg = require(pkgPath)
 var semver = require('semver')
 var util = require('util')
+var objectAssign = require('object-assign')
 
-conventionalRecommendedBump({
-  preset: 'angular'
-}, function (err, release) {
-  if (err) {
-    console.error(chalk.red(err.message))
-    return
-  }
+module.exports = function standardVersion (argv, done) {
+  var pkgPath = path.resolve(process.cwd(), './package.json')
+  var pkg = require(pkgPath)
+  var defaults = require('./defaults')
 
-  var newVersion = pkg.version
-  if (!argv.firstRelease) {
-    newVersion = semver.inc(pkg.version, release.releaseAs)
-    checkpoint('bumping version in package.json from %s to %s', [pkg.version, newVersion])
-    pkg.version = newVersion
-    fs.writeFileSync(pkgPath, JSON.stringify(pkg, null, 2) + '\n', 'utf-8')
-  } else {
-    checkpoint('skip version bump on first release', [], chalk.red(figures.cross))
-  }
+  argv = objectAssign(defaults, argv)
 
-  outputChangelog(argv, function () {
-    commit(argv, newVersion, function () {
-      return tag(newVersion, argv)
+  conventionalRecommendedBump({
+    preset: 'angular'
+  }, function (err, release) {
+    if (err) {
+      printError(argv, err.message)
+      return done(err)
+    }
+
+    var newVersion = pkg.version
+    if (!argv.firstRelease) {
+      newVersion = semver.inc(pkg.version, release.releaseType)
+      checkpoint(argv, 'bumping version in package.json from %s to %s', [pkg.version, newVersion])
+      pkg.version = newVersion
+      fs.writeFileSync(pkgPath, JSON.stringify(pkg, null, 2) + '\n', 'utf-8')
+    } else {
+      checkpoint(argv, 'skip version bump on first release', [], chalk.red(figures.cross))
+    }
+
+    outputChangelog(argv, function (err) {
+      if (err) {
+        return done(err)
+      }
+      commit(argv, newVersion, function (err) {
+        if (err) {
+          return done(err)
+        }
+        return tag(newVersion, pkg.private, argv, done)
+      })
     })
   })
-})
+}
 
 function outputChangelog (argv, cb) {
   createIfMissing(argv)
@@ -92,22 +62,36 @@
   var changelogStream = conventionalChangelog({
     preset: 'angular'
   })
-  .on('error', function (err) {
-    console.error(chalk.red(err.message))
-    process.exit(1)
-  })
+    .on('error', function (err) {
+      return cb(err)
+    })
 
   changelogStream.on('data', function (buffer) {
     content += buffer.toString()
   })
 
   changelogStream.on('end', function () {
-    checkpoint('outputting changes to %s', [argv.infile])
+    checkpoint(argv, 'outputting changes to %s', [argv.infile])
     fs.writeFileSync(argv.infile, header + '\n' + (content + oldContent).replace(/\n+$/, '\n'), 'utf-8')
     return cb()
   })
 }
 
+function handledExec (argv, cmd, errorCb, successCb) {
+  // Exec given cmd and handle possible errors
+  exec(cmd, function (err, stdout, stderr) {
+    // If exec returns content in stderr, but no error, print it as a warning
+    // If exec returns an error, print it and exit with return code 1
+    if (err) {
+      printError(argv, stderr || err.message)
+      return errorCb(err)
+    } else if (stderr) {
+      printError(argv, stderr, {level: 'warn', color: 'yellow'})
+    }
+    successCb()
+  })
+}
+
 function commit (argv, newVersion, cb) {
   var msg = 'committing %s'
   var args = [argv.infile]
@@ -116,21 +100,11 @@
     msg += ' and %s'
     args.unshift('package.json')
   }
-  checkpoint(msg, args)
+  checkpoint(argv, msg, args)
 
-  function handleExecError (err, stderr) {
-    // If exec returns an error or content in stderr, log it and exit with return code 1
-    var errMessage = stderr || (err && err.message)
-    if (errMessage) {
-      console.log(chalk.red(errMessage))
-      process.exit(1)
-    }
-  }
-  exec('git add package.json ' + argv.infile, function (err, stdout, stderr) {
-    handleExecError(err, stderr)
-    exec('git commit ' + verify + (argv.sign ? '-S ' : '') + 'package.json ' + argv.infile + ' -m "' + formatCommitMessage(argv.message, newVersion) + '"', function (err, stdout, stderr) {
-      handleExecError(err, stderr)
-      return cb()
+  handledExec(argv, 'git add package.json ' + argv.infile, cb, function () {
+    handledExec(argv, 'git commit ' + verify + (argv.sign ? '-S ' : '') + 'package.json ' + argv.infile + ' -m "' + formatCommitMessage(argv.message, newVersion) + '"', cb, function () {
+      cb()
     })
   })
 }
@@ -139,26 +113,20 @@
   return String(msg).indexOf('%s') !== -1 ? util.format(msg, newVersion) : msg
 }
 
-function tag (newVersion, argv) {
+function tag (newVersion, pkgPrivate, argv, cb) {
   var tagOption
   if (argv.sign) {
     tagOption = '-s '
   } else {
     tagOption = '-a '
   }
-  checkpoint('tagging release %s', [newVersion])
-  exec('git tag ' + tagOption + 'v' + newVersion + ' -m "' + formatCommitMessage(argv.message, newVersion) + '"', function (err, stdout, stderr) {
-    var errMessage = null
-    if (err) errMessage = err.message
-    if (stderr) errMessage = stderr
-    if (errMessage) {
-      console.log(chalk.red(errMessage))
-      process.exit(1)
-    } else {
-      checkpoint('Run `%s` to publish', [
-        'git push --follow-tags origin master; npm publish'
-      ], chalk.blue(figures.info))
-    }
+  checkpoint(argv, 'tagging release %s', [newVersion])
+  handledExec(argv, 'git tag ' + tagOption + 'v' + newVersion + ' -m "' + formatCommitMessage(argv.message, newVersion) + '"', cb, function () {
+    var message = 'git push --follow-tags origin master'
+    if (pkgPrivate !== true) message += '; npm publish'
+
+    checkpoint(argv, 'Run `%s` to publish', [message], chalk.blue(figures.info))
+    cb()
   })
 }
 
@@ -167,15 +135,28 @@
     accessSync(argv.infile, fs.F_OK)
   } catch (err) {
     if (err.code === 'ENOENT') {
-      checkpoint('created %s', [argv.infile])
+      checkpoint(argv, 'created %s', [argv.infile])
       argv.outputUnreleased = true
       fs.writeFileSync(argv.infile, '\n', 'utf-8')
     }
   }
 }
 
-function checkpoint (msg, args, figure) {
-  console.info((figure || chalk.green(figures.tick)) + ' ' + util.format.apply(util, [msg].concat(args.map(function (arg) {
-    return chalk.bold(arg)
-  }))))
-};
+function checkpoint (argv, msg, args, figure) {
+  if (!argv.silent) {
+    console.info((figure || chalk.green(figures.tick)) + ' ' + util.format.apply(util, [msg].concat(args.map(function (arg) {
+      return chalk.bold(arg)
+    }))))
+  }
+}
+
+function printError (argv, msg, opts) {
+  if (!argv.silent) {
+    opts = objectAssign({
+      level: 'error',
+      color: 'red'
+    }, opts)
+
+    console[opts.level](chalk[opts.color](msg))
+  }
+}
diff --git a/package.json b/package.json
index 2e09f6c..4f627c9 100644
--- a/package.json
+++ b/package.json
@@ -2,7 +2,7 @@
   "name": "standard-version",
   "version": "2.4.0",
   "description": "replacement for `npm version` with automatic CHANGELOG generation",
-  "bin": "index.js",
+  "bin": "cli.js",
   "scripts": {
     "pretest": "standard",
     "coverage": "nyc report --reporter=text-lcov | coveralls",
@@ -12,6 +12,9 @@
     "type": "git",
     "url": "git+https://github.com/conventional-changelog/standard-version.git"
   },
+  "engines": {
+    "node" : ">=4.0"
+  },
   "keywords": [
     "conventional-changelog",
     "recommended",
@@ -31,19 +34,21 @@
   "dependencies": {
     "chalk": "^1.1.3",
     "conventional-changelog": "^1.1.0",
-    "conventional-recommended-bump": "^0.2.1",
+    "conventional-recommended-bump": "^0.3.0",
     "figures": "^1.5.0",
     "fs-access": "^1.0.0",
+    "object-assign": "^4.1.0",
     "semver": "^5.1.0",
-    "yargs": "^4.6.0"
+    "yargs": "^5.0.0"
   },
   "devDependencies": {
     "chai": "^3.5.0",
     "coveralls": "^2.11.9",
-    "mocha": "^2.5.1",
+    "mocha": "^3.1.0",
     "mock-git": "^1.0.2",
-    "nyc": "^7.0.0",
-    "shelljs": "^0.7.0",
-    "standard": "^7.0.1"
+    "mockery": "^1.7.0",
+    "nyc": "^8.1.0",
+    "shelljs": "^0.7.3",
+    "standard": "^8.0.0"
   }
 }
diff --git a/test.js b/test.js
index 19316a1..6ade1a2 100644
--- a/test.js
+++ b/test.js
@@ -2,13 +2,17 @@
 
 'use strict'
 
+var extend = Object.assign || require('util')._extend
 var shell = require('shelljs')
 var fs = require('fs')
 var path = require('path')
+var stream = require('stream')
 var mockGit = require('mock-git')
-var cliPath = path.resolve(__dirname, './index.js')
+var mockery = require('mockery')
 
-require('chai').should()
+var should = require('chai').should()
+
+var cliPath = path.resolve(__dirname, './cli.js')
 
 function commit (msg) {
   shell.exec('git commit --allow-empty -m"' + msg + '"')
@@ -18,10 +22,10 @@
   return shell.exec('node ' + cliPath + (argString != null ? ' ' + argString : ''))
 }
 
-function writePackageJson (version) {
-  fs.writeFileSync('package.json', JSON.stringify({
-    version: version
-  }), 'utf-8')
+function writePackageJson (version, option) {
+  option = option || {}
+  var pkg = extend(option, {version: version})
+  fs.writeFileSync('package.json', JSON.stringify(pkg), 'utf-8')
 }
 
 function writeGitPreCommitHook () {
@@ -29,25 +33,27 @@
   fs.chmodSync('.git/hooks/pre-commit', '755')
 }
 
-describe('cli', function () {
-  beforeEach(function () {
-    shell.rm('-rf', 'tmp')
-    shell.config.silent = true
-    shell.mkdir('tmp')
-    shell.cd('tmp')
-    shell.exec('git init')
-    commit('root-commit')
-  })
+function initInTempFolder () {
+  shell.rm('-rf', 'tmp')
+  shell.config.silent = true
+  shell.mkdir('tmp')
+  shell.cd('tmp')
+  shell.exec('git init')
+  commit('root-commit')
+  writePackageJson('1.0.0')
+}
 
-  afterEach(function () {
-    shell.cd('../')
-    shell.rm('-rf', 'tmp')
-  })
+function finishTemp () {
+  shell.cd('../')
+  shell.rm('-rf', 'tmp')
+}
+
+describe('cli', function () {
+  beforeEach(initInTempFolder)
+  afterEach(finishTemp)
 
   describe('CHANGELOG.md does not exist', function () {
     it('populates changelog with commits since last tag by default', function () {
-      writePackageJson('1.0.0')
-
       commit('feat: first commit')
       shell.exec('git tag -a v1.0.0 -m "my awesome first release"')
       commit('fix: patch release')
@@ -75,7 +81,6 @@
 
   describe('CHANGELOG.md exists', function () {
     it('appends the new release above the last release, removing the old header', function () {
-      writePackageJson('1.0.0')
       fs.writeFileSync('CHANGELOG.md', 'legacy header format<a name="1.0.0">\n', 'utf-8')
 
       commit('feat: first commit')
@@ -94,8 +99,6 @@
       // mock git with file that writes args to gitcapture.log
       return mockGit('require("fs").appendFileSync("gitcapture.log", JSON.stringify(process.argv.splice(2)) + "\\n")')
         .then(function (unmock) {
-          writePackageJson('1.0.0')
-
           execCli('--sign').code.should.equal(0)
 
           var captured = shell.cat('gitcapture.log').stdout.split('\n').map(function (line) {
@@ -112,11 +115,9 @@
       // mock git by throwing on attempt to commit
       return mockGit('console.error("commit yourself"); process.exit(128);', 'commit')
         .then(function (unmock) {
-          writePackageJson('1.0.0')
-
           var result = execCli()
           result.code.should.equal(1)
-          result.stdout.should.match(/commit yourself/)
+          result.stderr.should.match(/commit yourself/)
 
           unmock()
         })
@@ -126,11 +127,9 @@
       // mock git by throwing on attempt to add
       return mockGit('console.error("addition is hard"); process.exit(128);', 'add')
         .then(function (unmock) {
-          writePackageJson('1.0.0')
-
           var result = execCli()
           result.code.should.equal(1)
-          result.stdout.should.match(/addition is hard/)
+          result.stderr.should.match(/addition is hard/)
 
           unmock()
         })
@@ -140,11 +139,23 @@
       // mock git by throwing on attempt to commit
       return mockGit('console.error("tag, you\'re it"); process.exit(128);', 'tag')
         .then(function (unmock) {
+          var result = execCli()
+          result.code.should.equal(1)
+          result.stderr.should.match(/tag, you're it/)
+
+          unmock()
+        })
+    })
+
+    it('doesn\'t fail fast on stderr output from git', function () {
+      // mock git by throwing on attempt to commit
+      return mockGit('console.error("haha, kidding, this is just a warning"); process.exit(0);', 'add')
+        .then(function (unmock) {
           writePackageJson('1.0.0')
 
           var result = execCli()
-          result.code.should.equal(1)
-          result.stdout.should.match(/tag, you're it/)
+          result.code.should.equal(0)
+          result.stderr.should.match(/haha, kidding, this is just a warning/)
 
           unmock()
         })
@@ -152,8 +163,6 @@
   })
 
   it('handles commit messages longer than 80 characters', function () {
-    writePackageJson('1.0.0')
-
     commit('feat: first commit')
     shell.exec('git tag -a v1.0.0 -m "my awesome first release"')
     commit('fix: this is my fairly long commit message which is testing whether or not we allow for long commit messages')
@@ -165,8 +174,6 @@
   })
 
   it('formats the commit and tag messages appropriately', function () {
-    writePackageJson('1.0.0')
-
     commit('feat: first commit')
     shell.exec('git tag -a v1.0.0 -m "my awesome first release"')
     commit('feat: new feature!')
@@ -180,8 +187,6 @@
   })
 
   it('appends line feed at end of package.json', function () {
-    writePackageJson('1.0.0')
-
     execCli().code.should.equal(0)
 
     var pkgJson = fs.readFileSync('package.json', 'utf-8')
@@ -189,7 +194,6 @@
   })
 
   it('does not run git hooks if the --no-verify flag is passed', function () {
-    writePackageJson('1.0.0')
     writeGitPreCommitHook()
 
     commit('feat: first commit')
@@ -197,4 +201,96 @@
     commit('feat: second commit')
     execCli('-n').code.should.equal(0)
   })
+
+  it('does not print output when the --silent flag is passed', function () {
+    var result = execCli('--silent')
+    result.code.should.equal(0)
+    result.stdout.should.equal('')
+    result.stderr.should.equal('')
+  })
+
+  it('does not display `npm publish` if the package is private', function () {
+    writePackageJson('1.0.0', {private: true})
+
+    var result = execCli()
+    result.code.should.equal(0)
+    result.stdout.should.not.match(/npm publish/)
+  })
+})
+
+describe('standard-version', function () {
+  beforeEach(initInTempFolder)
+  afterEach(finishTemp)
+
+  describe('with mocked conventionalRecommendedBump', function () {
+    beforeEach(function () {
+      mockery.enable({warnOnUnregistered: false, useCleanCache: true})
+      mockery.registerMock('conventional-recommended-bump', function (_, cb) {
+        cb(new Error('bump err'))
+      })
+    })
+
+    afterEach(function () {
+      mockery.deregisterMock('conventional-recommended-bump')
+      mockery.disable()
+    })
+
+    it('should exit on bump error', function (done) {
+      commit('feat: first commit')
+      shell.exec('git tag -a v1.0.0 -m "my awesome first release"')
+      commit('feat: new feature!')
+
+      require('./index')({silent: true}, function (err) {
+        should.exist(err)
+        err.message.should.match(/bump err/)
+        done()
+      })
+    })
+  })
+
+  describe('with mocked conventionalChangelog', function () {
+    beforeEach(function () {
+      mockery.enable({warnOnUnregistered: false, useCleanCache: true})
+      mockery.registerMock('conventional-changelog', function () {
+        var readable = new stream.Readable({objectMode: true})
+        readable._read = function () {
+        }
+        setImmediate(readable.emit.bind(readable), 'error', new Error('changelog err'))
+        return readable
+      })
+    })
+
+    afterEach(function () {
+      mockery.deregisterMock('conventional-changelog')
+      mockery.disable()
+    })
+
+    it('should exit on changelog error', function (done) {
+      commit('feat: first commit')
+      shell.exec('git tag -a v1.0.0 -m "my awesome first release"')
+      commit('feat: new feature!')
+
+      require('./index')({silent: true}, function (err) {
+        should.exist(err)
+        err.message.should.match(/changelog err/)
+        done()
+      })
+    })
+  })
+
+  it('formats the commit and tag messages appropriately', function (done) {
+    commit('feat: first commit')
+    shell.exec('git tag -a v1.0.0 -m "my awesome first release"')
+    commit('feat: new feature!')
+
+    require('./index')({silent: true}, function (err) {
+      should.not.exist(err)
+
+      // check last commit message
+      shell.exec('git log --oneline -n1').stdout.should.match(/chore\(release\): 1\.1\.0/)
+      // check annotated tag message
+      shell.exec('git tag -l -n1 v1.1.0').stdout.should.match(/chore\(release\): 1\.1\.0/)
+      done()
+    })
+  })
 })

=====================================================================
start time: Wed Jun 15 00:00:00 CST 2016
end time: Wed Jul 13 00:00:00 CST 2016
### Bug Fixes* **index.js:** use blue figures.info for last checkpoint ([#64](https://github.com/conventional-changelog/standard-version/issues/64)) ([e600b42](https://github.com/conventional-changelog/standard-version/commit/e600b42))### Features* **changelogStream:** use more default opts ([#67](https://github.com/conventional-changelog/standard-version/issues/67)) ([3e0aa84](https://github.com/conventional-changelog/standard-version/commit/3e0aa84))<a name="2.3.1"></a>
diff --git a/.travis.yml b/.travis.yml
index bcf6c98..91eedc5 100644
--- a/.travis.yml
+++ b/.travis.yml
@@ -2,6 +2,8 @@
 node_js:
   - "0.10"
   - "0.12"
+  - "4"
+  - "5"
   - "node"
 before_script:
   - git config --global user.name 'Travis-CI'
diff --git a/appveyor.yml b/appveyor.yml
new file mode 100644
index 0000000..e3bafae
--- /dev/null
+++ b/appveyor.yml
@@ -0,0 +1,20 @@
+environment:
+  matrix:
+    - nodejs_version: '6'
+    - nodejs_version: '5'
+    - nodejs_version: '4'
+    - nodejs_version: '0.12'
+install:
+  - ps: Install-Product node $env:nodejs_version
+  - set CI=true
+  - npm -g install npm@latest
+  - set PATH=%APPDATA%\npm;%PATH%
+  - npm install
+matrix:
+  fast_finish: true
+build: off
+version: '{build}'
+test_script:
+  - node --version
+  - npm --version
+  - npm test
diff --git a/index.js b/index.js
index 3c593d8..6bed6ed 100755
--- a/index.js
+++ b/index.js
@@ -70,7 +70,7 @@
     pkg.version = newVersion
     fs.writeFileSync(pkgPath, JSON.stringify(pkg, null, 2) + '\n', 'utf-8')
   } else {
-    console.log(chalk.red(figures.cross) + ' skip version bump on first release')
+    checkpoint('skip version bump on first release', [], chalk.red(figures.cross))
   }
 
   outputChangelog(argv, function () {
@@ -90,11 +90,7 @@
   }
   var content = ''
   var changelogStream = conventionalChangelog({
-    preset: 'angular',
-    outputUnreleased: true,
-    pkg: {
-      path: path.resolve(process.cwd(), './package.json')
-    }
+    preset: 'angular'
   })
   .on('error', function (err) {
     console.error(chalk.red(err.message))
@@ -159,9 +155,9 @@
       console.log(chalk.red(errMessage))
       process.exit(1)
     } else {
-      checkpoint('Run `%s` to publish.', [
+      checkpoint('Run `%s` to publish', [
         'git push --follow-tags origin master; npm publish'
-      ])
+      ], chalk.blue(figures.info))
     }
   })
 }
@@ -178,8 +174,8 @@
   }
 }
 
-function checkpoint (msg, args) {
-  console.info(chalk.green(figures.tick) + ' ' + util.format.apply(util, [msg].concat(args.map(function (arg) {
+function checkpoint (msg, args, figure) {
+  console.info((figure || chalk.green(figures.tick)) + ' ' + util.format.apply(util, [msg].concat(args.map(function (arg) {
     return chalk.bold(arg)
   }))))
 };
diff --git a/package.json b/package.json
index bc9013b..8a18375 100644
--- a/package.json
+++ b/package.json
@@ -31,7 +31,6 @@
   "dependencies": {
     "chalk": "^1.1.3",
     "conventional-changelog": "^1.1.0",
-    "conventional-changelog-angular": "^1.1.0",
     "conventional-recommended-bump": "^0.2.1",
     "figures": "^1.5.0",
     "fs-access": "^1.0.0",
@@ -43,7 +42,7 @@
     "coveralls": "^2.11.9",
     "mocha": "^2.5.1",
     "mock-git": "^1.0.2",
-    "nyc": "^6.4.2",
+    "nyc": "^7.0.0",
     "shelljs": "^0.7.0",
     "standard": "^7.0.1"
   }

=====================================================================
start time: Thu Jun 02 00:00:00 CST 2016
end time: Wed Jun 15 00:00:00 CST 2016
### Bug Fixes* **commit:** fix windows by separating add and commit exec ([#55](https://github.com/conventional-changelog/standard-version/issues/55)) ([f361c46](https://github.com/conventional-changelog/standard-version/commit/f361c46)), closes [#55](https://github.com/conventional-changelog/standard-version/issues/55) [#49](https://github.com/conventional-changelog/standard-version/issues/49)<a name="2.3.0"></a>
diff --git a/CHANGELOG.md b/CHANGELOG.md
index 740ee7c..242b19a 100644
--- a/CHANGELOG.md
+++ b/CHANGELOG.md
@@ -2,6 +2,22 @@
 
 All notable changes to this project will be documented in this file. See [standard-version](https://github.com/conventional-changelog/standard-version) for commit guidelines.
 
+<a name="2.3.0"></a>
+# [2.3.0](https://github.com/conventional-changelog/standard-version/compare/v2.2.1...v2.3.0) (2016-06-02)
+
+
+### Bug Fixes
+
+* append line feed to end of package.json ([#42](https://github.com/conventional-changelog/standard-version/issues/42))([178e001](https://github.com/conventional-changelog/standard-version/commit/178e001))
+
+
+### Features
+
+* **index.js:** add checkpoint for publish script after tag successfully ([#47](https://github.com/conventional-changelog/standard-version/issues/47))([e414ed7](https://github.com/conventional-changelog/standard-version/commit/e414ed7))
+* add a --no-verify option to prevent git hooks from being verified ([#44](https://github.com/conventional-changelog/standard-version/issues/44))([026d844](https://github.com/conventional-changelog/standard-version/commit/026d844))
+
+
+
 <a name="2.2.1"></a>
 ## [2.2.1](https://github.com/conventional-changelog/standard-version/compare/v2.2.0...v2.2.1) (2016-05-02)
 
diff --git a/index.js b/index.js
index 5bec43e..3c593d8 100755
--- a/index.js
+++ b/index.js
@@ -121,15 +121,21 @@
     args.unshift('package.json')
   }
   checkpoint(msg, args)
-  exec('git add package.json ' + argv.infile + ';git commit ' + verify + (argv.sign ? '-S ' : '') + 'package.json ' + argv.infile + ' -m "' + formatCommitMessage(argv.message, newVersion) + '"', function (err, stdout, stderr) {
-    var errMessage = null
-    if (err) errMessage = err.message
-    if (stderr) errMessage = stderr
+
+  function handleExecError (err, stderr) {
+    // If exec returns an error or content in stderr, log it and exit with return code 1
+    var errMessage = stderr || (err && err.message)
     if (errMessage) {
       console.log(chalk.red(errMessage))
       process.exit(1)
     }
-    return cb()
+  }
+  exec('git add package.json ' + argv.infile, function (err, stdout, stderr) {
+    handleExecError(err, stderr)
+    exec('git commit ' + verify + (argv.sign ? '-S ' : '') + 'package.json ' + argv.infile + ' -m "' + formatCommitMessage(argv.message, newVersion) + '"', function (err, stdout, stderr) {
+      handleExecError(err, stderr)
+      return cb()
+    })
   })
 }
 
diff --git a/package.json b/package.json
index b084612..ad24dc1 100644
--- a/package.json
+++ b/package.json
@@ -1,6 +1,6 @@
 {
   "name": "standard-version",
-  "version": "2.2.1",
+  "version": "2.3.0",
   "description": "replacement for `npm version` with automatic CHANGELOG generation",
   "bin": "index.js",
   "scripts": {
diff --git a/test.js b/test.js
index c041469..19316a1 100644
--- a/test.js
+++ b/test.js
@@ -14,6 +14,10 @@
   shell.exec('git commit --allow-empty -m"' + msg + '"')
 }
 
+function execCli (argString) {
+  return shell.exec('node ' + cliPath + (argString != null ? ' ' + argString : ''))
+}
+
 function writePackageJson (version) {
   fs.writeFileSync('package.json', JSON.stringify({
     version: version
@@ -48,7 +52,7 @@
       shell.exec('git tag -a v1.0.0 -m "my awesome first release"')
       commit('fix: patch release')
 
-      shell.exec(cliPath).code.should.equal(0)
+      execCli().code.should.equal(0)
 
       var content = fs.readFileSync('CHANGELOG.md', 'utf-8')
       content.should.match(/patch release/)
@@ -60,7 +64,7 @@
 
       commit('feat: first commit')
       commit('fix: patch release')
-      shell.exec(cliPath + ' --first-release').code.should.equal(0)
+      execCli('--first-release').code.should.equal(0)
 
       var content = fs.readFileSync('CHANGELOG.md', 'utf-8')
       content.should.match(/patch release/)
@@ -78,7 +82,7 @@
       shell.exec('git tag -a v1.0.0 -m "my awesome first release"')
       commit('fix: patch release')
 
-      shell.exec(cliPath).code.should.equal(0)
+      execCli().code.should.equal(0)
       var content = fs.readFileSync('CHANGELOG.md', 'utf-8')
       content.should.match(/1\.0\.1/)
       content.should.not.match(/legacy header format/)
@@ -88,11 +92,11 @@
   describe('with mocked git', function () {
     it('--sign signs the commit and tag', function () {
       // mock git with file that writes args to gitcapture.log
-      mockGit('require("fs").appendFileSync("gitcapture.log", JSON.stringify(process.argv.splice(2)) + "\\n")')
+      return mockGit('require("fs").appendFileSync("gitcapture.log", JSON.stringify(process.argv.splice(2)) + "\\n")')
         .then(function (unmock) {
           writePackageJson('1.0.0')
 
-          shell.exec(cliPath + ' --sign').code.should.equal(0)
+          execCli('--sign').code.should.equal(0)
 
           var captured = shell.cat('gitcapture.log').stdout.split('\n').map(function (line) {
             return line ? JSON.parse(line) : line
@@ -106,11 +110,11 @@
 
     it('exits with error code if git commit fails', function () {
       // mock git by throwing on attempt to commit
-      mockGit('console.error("commit yourself"); process.exit(128);', 'commit')
+      return mockGit('console.error("commit yourself"); process.exit(128);', 'commit')
         .then(function (unmock) {
           writePackageJson('1.0.0')
 
-          var result = shell.exec(cliPath)
+          var result = execCli()
           result.code.should.equal(1)
           result.stdout.should.match(/commit yourself/)
 
@@ -118,13 +122,27 @@
         })
     })
 
+    it('exits with error code if git add fails', function () {
+      // mock git by throwing on attempt to add
+      return mockGit('console.error("addition is hard"); process.exit(128);', 'add')
+        .then(function (unmock) {
+          writePackageJson('1.0.0')
+
+          var result = execCli()
+          result.code.should.equal(1)
+          result.stdout.should.match(/addition is hard/)
+
+          unmock()
+        })
+    })
+
     it('exits with error code if git tag fails', function () {
       // mock git by throwing on attempt to commit
       return mockGit('console.error("tag, you\'re it"); process.exit(128);', 'tag')
         .then(function (unmock) {
           writePackageJson('1.0.0')
 
-          var result = shell.exec(cliPath)
+          var result = execCli()
           result.code.should.equal(1)
           result.stdout.should.match(/tag, you're it/)
 
@@ -140,7 +158,7 @@
     shell.exec('git tag -a v1.0.0 -m "my awesome first release"')
     commit('fix: this is my fairly long commit message which is testing whether or not we allow for long commit messages')
 
-    shell.exec(cliPath).code.should.equal(0)
+    execCli().code.should.equal(0)
 
     var content = fs.readFileSync('CHANGELOG.md', 'utf-8')
     content.should.match(/this is my fairly long commit message which is testing whether or not we allow for long commit messages/)
@@ -153,7 +171,7 @@
     shell.exec('git tag -a v1.0.0 -m "my awesome first release"')
     commit('feat: new feature!')
 
-    shell.exec(cliPath).code.should.equal(0)
+    execCli().code.should.equal(0)
 
     // check last commit message
     shell.exec('git log --oneline -n1').stdout.should.match(/chore\(release\): 1\.1\.0/)
@@ -164,7 +182,7 @@
   it('appends line feed at end of package.json', function () {
     writePackageJson('1.0.0')
 
-    shell.exec(cliPath).code.should.equal(0)
+    execCli().code.should.equal(0)
 
     var pkgJson = fs.readFileSync('package.json', 'utf-8')
     pkgJson.should.equal(['{', '  "version": "1.0.1"', '}', ''].join('\n'))
@@ -175,8 +193,8 @@
     writeGitPreCommitHook()
 
     commit('feat: first commit')
-    shell.exec(cliPath + ' --no-verify').code.should.equal(0)
+    execCli('--no-verify').code.should.equal(0)
     commit('feat: second commit')
-    shell.exec(cliPath + ' -n').code.should.equal(0)
+    execCli('-n').code.should.equal(0)
   })
 })

=====================================================================
start time: Mon May 02 00:00:00 CST 2016
end time: Thu Jun 02 00:00:00 CST 2016
### Bug Fixes* append line feed to end of package.json ([#42](https://github.com/conventional-changelog/standard-version/issues/42))([178e001](https://github.com/conventional-changelog/standard-version/commit/178e001))### Features* **index.js:** add checkpoint for publish script after tag successfully ([#47](https://github.com/conventional-changelog/standard-version/issues/47))([e414ed7](https://github.com/conventional-changelog/standard-version/commit/e414ed7))* add a --no-verify option to prevent git hooks from being verified ([#44](https://github.com/conventional-changelog/standard-version/issues/44))([026d844](https://github.com/conventional-changelog/standard-version/commit/026d844))<a name="2.2.1"></a>
diff --git a/CHANGELOG.md b/CHANGELOG.md
index dd05e96..740ee7c 100644
--- a/CHANGELOG.md
+++ b/CHANGELOG.md
@@ -2,6 +2,32 @@
 
 All notable changes to this project will be documented in this file. See [standard-version](https://github.com/conventional-changelog/standard-version) for commit guidelines.
 
+<a name="2.2.1"></a>
+## [2.2.1](https://github.com/conventional-changelog/standard-version/compare/v2.2.0...v2.2.1) (2016-05-02)
+
+
+### Bug Fixes
+
+* upgrade to version of nyc that works with new shelljs([c7ac6e2](https://github.com/conventional-changelog/standard-version/commit/c7ac6e2))
+
+
+
+<a name="2.2.0"></a>
+# [2.2.0](https://github.com/conventional-changelog/standard-version/compare/v2.1.2...v2.2.0) (2016-05-01)
+
+
+### Bug Fixes
+
+* format the annotated tag message ([#28](https://github.com/conventional-changelog/standard-version/issues/28))([8f02736](https://github.com/conventional-changelog/standard-version/commit/8f02736))
+* upgraded dependencies, switched back to angular format (fixes [#27](https://github.com/conventional-changelog/standard-version/issues/27)), pinned shelljs to version that works with nyc ([#30](https://github.com/conventional-changelog/standard-version/issues/30))([3f51e94](https://github.com/conventional-changelog/standard-version/commit/3f51e94))
+
+
+### Features
+
+* add --sign flag to sign git commit and tag ([#29](https://github.com/conventional-changelog/standard-version/issues/29))([de758bc](https://github.com/conventional-changelog/standard-version/commit/de758bc))
+
+
+
 <a name="2.1.2"></a>
 ## [2.1.2](https://github.com/conventional-changelog/standard-version/compare/v2.1.1...v2.1.2) (2016-04-11)
 
diff --git a/index.js b/index.js
index a0f6d93..632b9a8 100755
--- a/index.js
+++ b/index.js
@@ -24,6 +24,13 @@
     default: false,
     global: true
   })
+  .option('sign', {
+    alias: 's',
+    describe: 'Should the git commit and tag be signed?',
+    type: 'boolean',
+    default: false,
+    global: true
+  })
   .help()
   .alias('help', 'h')
   .example('$0', 'Update changelog and tag release')
@@ -54,7 +61,7 @@
     newVersion = semver.inc(pkg.version, release.releaseAs)
     checkpoint('bumping version in package.json from %s to %s', [pkg.version, newVersion])
     pkg.version = newVersion
-    fs.writeFileSync(pkgPath, JSON.stringify(pkg, null, 2), 'utf-8')
+    fs.writeFileSync(pkgPath, JSON.stringify(pkg, null, 2) + '\n', 'utf-8')
   } else {
     console.log(chalk.red(figures.cross) + ' skip version bump on first release')
   }
@@ -76,7 +83,7 @@
   }
   var content = ''
   var changelogStream = conventionalChangelog({
-    preset: 'standard',
+    preset: 'angular',
     outputUnreleased: true,
     pkg: {
       path: path.resolve(process.cwd(), './package.json')
@@ -106,7 +113,7 @@
     args.unshift('package.json')
   }
   checkpoint(msg, args)
-  exec('git add package.json ' + argv.infile + ';git commit package.json ' + argv.infile + ' -m "' + formatCommitMessage(argv.message, newVersion) + '"', function (err, stdout, stderr) {
+  exec('git add package.json ' + argv.infile + ';git commit ' + (argv.sign ? '-S ' : '') + 'package.json ' + argv.infile + ' -m "' + formatCommitMessage(argv.message, newVersion) + '"', function (err, stdout, stderr) {
     var errMessage = null
     if (err) errMessage = err.message
     if (stderr) errMessage = stderr
@@ -123,14 +130,24 @@
 }
 
 function tag (newVersion, argv) {
+  var tagOption
+  if (argv.sign) {
+    tagOption = '-s '
+  } else {
+    tagOption = '-a '
+  }
   checkpoint('tagging release %s', [newVersion])
-  exec('git tag -a v' + newVersion + ' -m "' + formatCommitMessage(argv.message, newVersion) + '"', function (err, stdout, stderr) {
+  exec('git tag ' + tagOption + 'v' + newVersion + ' -m "' + formatCommitMessage(argv.message, newVersion) + '"', function (err, stdout, stderr) {
     var errMessage = null
     if (err) errMessage = err.message
     if (stderr) errMessage = stderr
     if (errMessage) {
       console.log(chalk.red(errMessage))
       process.exit(1)
+    } else {
+      checkpoint('Run `%s` to publish.', [
+        'git push --follow-tags origin master; npm publish'
+      ])
     }
   })
 }
diff --git a/package.json b/package.json
index b64a3ef..b084612 100644
--- a/package.json
+++ b/package.json
@@ -1,12 +1,12 @@
 {
   "name": "standard-version",
-  "version": "2.1.2",
+  "version": "2.2.1",
   "description": "replacement for `npm version` with automatic CHANGELOG generation",
   "bin": "index.js",
   "scripts": {
     "pretest": "standard",
     "coverage": "nyc report --reporter=text-lcov | coveralls",
-    "test": "nyc mocha --timeout=10000 test.js"
+    "test": "nyc mocha --timeout=20000 test.js"
   },
   "repository": {
     "type": "git",
@@ -31,19 +31,20 @@
   "dependencies": {
     "chalk": "^1.1.3",
     "conventional-changelog": "^1.1.0",
-    "conventional-changelog-standard": "^1.2.1",
-    "conventional-recommended-bump": "^0.2.0",
+    "conventional-changelog-angular": "^1.1.0",
+    "conventional-recommended-bump": "^0.2.1",
     "figures": "^1.5.0",
     "fs-access": "^1.0.0",
     "semver": "^5.1.0",
-    "yargs": "^4.3.2"
+    "yargs": "^4.6.0"
   },
   "devDependencies": {
     "chai": "^3.5.0",
     "coveralls": "^2.11.9",
-    "mocha": "^2.4.5",
-    "nyc": "^6.2.1",
+    "mocha": "^2.5.1",
+    "mock-git": "^1.0.2",
+    "nyc": "^6.4.2",
     "shelljs": "^0.7.0",
-    "standard": "^6.0.8"
+    "standard": "^7.0.1"
   }
 }
diff --git a/test.js b/test.js
index 672c197..5c97cbf 100644
--- a/test.js
+++ b/test.js
@@ -5,6 +5,7 @@
 var shell = require('shelljs')
 var fs = require('fs')
 var path = require('path')
+var mockGit = require('mock-git')
 var cliPath = path.resolve(__dirname, './index.js')
 
 require('chai').should()
@@ -13,6 +14,12 @@
   shell.exec('git commit --allow-empty -m"' + msg + '"')
 }
 
+function writePackageJson (version) {
+  fs.writeFileSync('package.json', JSON.stringify({
+    version: version
+  }), 'utf-8')
+}
+
 describe('cli', function () {
   beforeEach(function () {
     shell.rm('-rf', 'tmp')
@@ -30,9 +37,7 @@
 
   describe('CHANGELOG.md does not exist', function () {
     it('populates changelog with commits since last tag by default', function () {
-      fs.writeFileSync('package.json', JSON.stringify({
-        version: '1.0.0'
-      }), 'utf-8')
+      writePackageJson('1.0.0')
 
       commit('feat: first commit')
       shell.exec('git tag -a v1.0.0 -m "my awesome first release"')
@@ -46,9 +51,7 @@
     })
 
     it('includes all commits if --first-release is true', function () {
-      fs.writeFileSync('package.json', JSON.stringify({
-        version: '1.0.1'
-      }), 'utf-8')
+      writePackageJson('1.0.1')
 
       commit('feat: first commit')
       commit('fix: patch release')
@@ -63,9 +66,7 @@
 
   describe('CHANGELOG.md exists', function () {
     it('appends the new release above the last release, removing the old header', function () {
-      fs.writeFileSync('package.json', JSON.stringify({
-        version: '1.0.0'
-      }), 'utf-8')
+      writePackageJson('1.0.0')
       fs.writeFileSync('CHANGELOG.md', 'legacy header format<a name="1.0.0">\n', 'utf-8')
 
       commit('feat: first commit')
@@ -79,10 +80,56 @@
     })
   })
 
+  describe('with mocked git', function () {
+    it('--sign signs the commit and tag', function () {
+      // mock git with file that writes args to gitcapture.log
+      mockGit('require("fs").appendFileSync("gitcapture.log", JSON.stringify(process.argv.splice(2)) + "\\n")')
+        .then(function (unmock) {
+          writePackageJson('1.0.0')
+
+          shell.exec(cliPath + ' --sign').code.should.equal(0)
+
+          var captured = shell.cat('gitcapture.log').stdout.split('\n').map(function (line) {
+            return line ? JSON.parse(line) : line
+          })
+          captured[captured.length - 3].should.deep.equal(['commit', '-S', 'package.json', 'CHANGELOG.md', '-m', 'chore(release): 1.0.1'])
+          captured[captured.length - 2].should.deep.equal(['tag', '-s', 'v1.0.1', '-m', 'chore(release): 1.0.1'])
+
+          unmock()
+        })
+    })
+
+    it('exits with error code if git commit fails', function () {
+      // mock git by throwing on attempt to commit
+      mockGit('console.error("commit yourself"); process.exit(128);', 'commit')
+        .then(function (unmock) {
+          writePackageJson('1.0.0')
+
+          var result = shell.exec(cliPath)
+          result.code.should.equal(1)
+          result.stdout.should.match(/commit yourself/)
+
+          unmock()
+        })
+    })
+
+    it('exits with error code if git tag fails', function () {
+      // mock git by throwing on attempt to commit
+      return mockGit('console.error("tag, you\'re it"); process.exit(128);', 'tag')
+        .then(function (unmock) {
+          writePackageJson('1.0.0')
+
+          var result = shell.exec(cliPath)
+          result.code.should.equal(1)
+          result.stdout.should.match(/tag, you're it/)
+
+          unmock()
+        })
+    })
+  })
+
   it('handles commit messages longer than 80 characters', function () {
-    fs.writeFileSync('package.json', JSON.stringify({
-      version: '1.0.0'
-    }), 'utf-8')
+    writePackageJson('1.0.0')
 
     commit('feat: first commit')
     shell.exec('git tag -a v1.0.0 -m "my awesome first release"')
@@ -95,9 +142,7 @@
   })
 
   it('formats the commit and tag messages appropriately', function () {
-    fs.writeFileSync('package.json', JSON.stringify({
-      version: '1.0.0'
-    }), 'utf-8')
+    writePackageJson('1.0.0')
 
     commit('feat: first commit')
     shell.exec('git tag -a v1.0.0 -m "my awesome first release"')
@@ -106,8 +151,17 @@
     shell.exec(cliPath).code.should.equal(0)
 
     // check last commit message
-    shell.exec('git log --oneline -n1').stdout.should.match(/chore\(release\)\: 1\.1\.0/)
+    shell.exec('git log --oneline -n1').stdout.should.match(/chore\(release\): 1\.1\.0/)
     // check annotated tag message
-    shell.exec('git tag -l -n1 v1.1.0').stdout.should.match(/chore\(release\)\: 1\.1\.0/)
+    shell.exec('git tag -l -n1 v1.1.0').stdout.should.match(/chore\(release\): 1\.1\.0/)
+  })
+
+  it('appends line feed at end of package.json', function () {
+    writePackageJson('1.0.0')
+
+    shell.exec(cliPath).code.should.equal(0)
+
+    var pkgJson = fs.readFileSync('package.json', 'utf-8')
+    pkgJson.should.equal(['{', '  "version": "1.0.1"', '}', ''].join('\n'))
   })
 })

=====================================================================
start time: Mon Apr 11 00:00:00 CST 2016
end time: Sun May 01 00:00:00 CST 2016
### Bug Fixes* format the annotated tag message ([#28](https://github.com/conventional-changelog/standard-version/issues/28))([8f02736](https://github.com/conventional-changelog/standard-version/commit/8f02736))* upgraded dependencies, switched back to angular format (fixes [#27](https://github.com/conventional-changelog/standard-version/issues/27)), pinned shelljs to version that works with nyc ([#30](https://github.com/conventional-changelog/standard-version/issues/30))([3f51e94](https://github.com/conventional-changelog/standard-version/commit/3f51e94))### Features* add --sign flag to sign git commit and tag ([#29](https://github.com/conventional-changelog/standard-version/issues/29))([de758bc](https://github.com/conventional-changelog/standard-version/commit/de758bc))<a name="2.1.2"></a>
diff --git a/CHANGELOG.md b/CHANGELOG.md
index ade7bc5..dd05e96 100644
--- a/CHANGELOG.md
+++ b/CHANGELOG.md
@@ -2,6 +2,16 @@
 
 All notable changes to this project will be documented in this file. See [standard-version](https://github.com/conventional-changelog/standard-version) for commit guidelines.
 
+<a name="2.1.2"></a>
+## [2.1.2](https://github.com/conventional-changelog/standard-version/compare/v2.1.1...v2.1.2) (2016-04-11)
+
+
+### Bug Fixes
+
+* we had too many \n characters ([#17](https://github.com/conventional-changelog/standard-version/issues/17)) ([67a01cd](https://github.com/conventional-changelog/standard-version/commit/67a01cd))
+
+
+
 <a name="2.1.1"></a>
 ## [2.1.1](https://github.com/conventional-changelog/standard-version/compare/v2.1.0...v2.1.1) (2016-04-10)
 
diff --git a/README.md b/README.md
index 73782a3..a4bbe9d 100644
--- a/README.md
+++ b/README.md
@@ -7,40 +7,36 @@
 
 > stop using `npm version`, use `standard-version` it rocks!
 
-Automatic release and CHANGELOG management, using GitHub's new squash button and
-the workflow outlined in [conventional-changelog-standard](https://github.com/bcoe/conventional-changelog-standard/blob/master/convention.md).
+Automatic versioning and CHANGELOG management, using GitHub's new squash button and
+the [recommended workflow](https://github.com/conventional-changelog/conventional-changelog-cli#recommended-workflow) for `conventional-changelog`.
 
 _how it works:_
 
 1. when you land commits on your `master` branch, select the _Squash and Merge_ option.
 2. add a title and body that follows the [conventional-changelog-standard conventions](https://github.com/bcoe/conventional-changelog-standard/blob/master/convention.md).
 3. when you're ready to release to npm:
-  1. checkout `master`.
-  2. run `standard-version`.
-  3. `git push --tags; git push origin master; npm publish`.
+  1. `git checkout master; git pull origin master`
+  2. run `standard-version`
+  3. `git push --follow-tags origin master; npm publish`
 
 `standard-version` does the following:
 
-1. bumps the version in package.json (based on your commit history).
-2. uses [conventional-changelog](https://github.com/conventional-changelog/conventional-changelog) to update _CHANGELOG.md._
-3. commits _package.json_ and _CHANGELOG.md_.
-4. tags a new release.
-
-## Initial CHANGELOG.md Generation
-
-When you're generating your changelog for the first time, simply do:
-
-`standard-version --first-release`
+1. bumps the version in _package.json_ (based on your commit history)
+2. uses [conventional-changelog](https://github.com/conventional-changelog/conventional-changelog) to update _CHANGELOG.md_
+3. commits _package.json_ and _CHANGELOG.md_
+4. tags a new release
 
 ## Installation
 
-`npm i standard-version -g`
+### As `npm run` script
 
-_Or, add it as a development dependency like so:_
+Install and add to `devDependencies`:
 
-`npm i standard-version --save-dev`
+```
+npm i --save-dev standard-version
+```
 
-_And add this to your _package.json:_
+Add an [`npm run` script](https://docs.npmjs.com/cli/run-script) to your _package.json_:
 
 ```json
 {
@@ -50,12 +46,69 @@
 }
 ```
 
+Now you can use `npm run release` in place of `npm version`.
+
+This has the benefit of making your repo/package more portable, so that other developers can cut releases without having to globally install `standard-version` on their machine.
+
+### As global bin
+
+Install globally (add to your `PATH`):
+
+```
+npm i -g standard-version
+```
+
+Now you can use `standard-version` in place of `npm version`.
+
+This has the benefit of allowing you to use `standard-version` on any repo/package without adding a dev dependency to each one.
+
+## Usage
+
+### First Release
+
+To generate your changelog for your first release, simply do:
+
+```sh
+# npm run script
+npm run release -- --first-release
+# or global bin
+standard-version --first-release
+```
+
+This will tag a release **without bumping the version in package.json**.
+
+When ready, push the git tag and `npm publish` your first release. \o/
+
+### Cut a Release
+
+If you typically use `npm version` to cut a new release, do this instead:
+
+```sh
+# npm run script
+npm run release
+# or global bin
+standard-version
+```
+
+As long as your git commit messages are conventional and accurate, you no longer need to specify the semver type - and you get CHANGELOG generation for free! \o/
+
+After you cut a release, you can push the new git tag and `npm publish` (or `npm publish --tag next`) when you're ready.
+
+### CLI Help
+
+```sh
+# npm run script
+npm run release -- --help
+# or global bin
+standard-version --help
+```
+
 ## Commit Message Convention, at a Glance
 
 _patches:_
 
 ```sh
--m "fix(parsing): fixed a bug in our parser"
+git commit -a -m "fix(parsing): fixed a bug in our parser"
 ```
 
 _features:_
@@ -92,6 +145,28 @@
 [![Standard Version](https://img.shields.io/badge/release-standard%20version-brightgreen.svg)](https://github.com/conventional-changelog/standard-version)
 ```
 
+## FAQ
+
+### How is `standard-version` different from `semantic-release`?
+
+[`semantic-release`](https://github.com/semantic-release/semantic-release) is a fully automated library/system for versioning, changelog generation, git tagging, and publishing to the npm registry.
+
+`standard-version` is different because it handles the versioning, changelog generation, and git tagging for you **without** automatic pushing (to GitHub) or publishing (to an npm registry). Use of `standard-version` only affects your local git repo - it doesn't affect remote resources at all. After you run `standard-version`, you still have to ability to review things and correct mistakes if you want to.
+
+They are both based on the same foundation of structured commit messages (using [Angular format](https://github.com/bcoe/conventional-changelog-standard/blob/master/convention.md)), but `standard-version` is a good choice for folks who are not yet comfortable letting publishes go out automatically. In this way, you can view `standard-version` as an incremental step to adopting `semantic-release`.
+
+We think they are both fantastic tools, and we encourage folks to use `semantic-release` instead of `standard-version` if it makes sense for them.
+
+### Should I always squash commits when merging PRs?
+
+The instructions to squash commits when merging pull requests assumes that **one PR equals, at most, one feature or fix**.
+
+If you have multiple features or fixes landing in a single PR and each commit uses a structured message, then you can do a standard merge when accepting the PR. This will preserve the commit history from your branch after the merge.
+
+Although this will allow each commit to be included as separate entries in your CHANGELOG, the entries will **not** be able to reference the PR that pulled the changes in because the preserved commit messages do not include the PR number.
+
+For this reason, we recommend keeping the scope of each PR to one general feature or fix. In practice, this allows you to use unstructured commit messages when committing each little change and then squash them into a single commit with a structured message (referencing the PR number) once they have been reviewed and accepted.
+
 ## License
 
 ISC
diff --git a/index.js b/index.js
index 4095c8d..5a18542 100755
--- a/index.js
+++ b/index.js
@@ -93,7 +93,7 @@
 
   changelogStream.on('end', function () {
     checkpoint('outputting changes to %s', [argv.infile])
-    fs.writeFileSync(argv.infile, header + '\n' + content + oldContent, 'utf-8')
+    fs.writeFileSync(argv.infile, header + '\n' + (content + oldContent).replace(/\n+$/, '\n'), 'utf-8')
     return cb()
   })
 }
diff --git a/package.json b/package.json
index 223805e..b64a3ef 100644
--- a/package.json
+++ b/package.json
@@ -1,6 +1,6 @@
 {
   "name": "standard-version",
-  "version": "2.1.1",
+  "version": "2.1.2",
   "description": "replacement for `npm version` with automatic CHANGELOG generation",
   "bin": "index.js",
   "scripts": {
@@ -19,7 +19,8 @@
     "automatic",
     "workflow",
     "version",
-    "angular"
+    "angular",
+    "standard"
   ],
   "author": "Ben Coe <ben@npmjs.com>",
   "license": "ISC",
@@ -42,7 +43,7 @@
     "coveralls": "^2.11.9",
     "mocha": "^2.4.5",
     "nyc": "^6.2.1",
-    "shelljs": "^0.6.0",
+    "shelljs": "^0.7.0",
     "standard": "^6.0.8"
   }
-}
\ No newline at end of file
+}
diff --git a/test.js b/test.js
index 7b537dd..e0ec097 100644
--- a/test.js
+++ b/test.js
@@ -57,7 +57,7 @@
       var content = fs.readFileSync('CHANGELOG.md', 'utf-8')
       content.should.match(/patch release/)
       content.should.match(/first commit/)
-      shell.exec('git tag').output.should.match(/1\.0\.1/)
+      shell.exec('git tag').stdout.should.match(/1\.0\.1/)
     })
   })
 

=====================================================================
start time: Sun Apr 10 00:00:00 CST 2016
end time: Mon Apr 11 00:00:00 CST 2016
### Bug Fixes* we had too many \n characters ([#17](https://github.com/conventional-changelog/standard-version/issues/17)) ([67a01cd](https://github.com/conventional-changelog/standard-version/commit/67a01cd))<a name="2.1.1"></a>
diff --git a/CHANGELOG.md b/CHANGELOG.md
index b3e587e..ade7bc5 100644
--- a/CHANGELOG.md
+++ b/CHANGELOG.md
@@ -2,15 +2,47 @@
 
 All notable changes to this project will be documented in this file. See [standard-version](https://github.com/conventional-changelog/standard-version) for commit guidelines.
 
-<a name="1.1.0"></a>
-# [1.1.0](https://github.com/conventional-changelog/standard-verison/compare/v1.0.0...v1.1.0) (2016-04-08)
+<a name="2.1.1"></a>
+## [2.1.1](https://github.com/conventional-changelog/standard-version/compare/v2.1.0...v2.1.1) (2016-04-10)
+
+
+### Bug Fixes
+
+* **docs:** had a bad URL in package.json, which was breaking all of our links ([caa6359](https://github.com/conventional-changelog/standard-version/commit/caa6359))
+
+
+
+<a name="2.1.0"></a>
+# [2.1.0](https://github.com/conventional-changelog/standard-version/compare/v2.0.0...v2.1.0) (2016-04-10)
 
 
 ### Features
 
-* **cli:** use conventional default commit message with version ([9fadc5f](https://github.com/conventional-changelog/standard-verison/commit/9fadc5f))
-* **rebrand:** rebrand recommended-workflow to standard-version (#9) ([1f673c0](https://github.com/conventional-changelog/standard-verison/commit/1f673c0))
-* **tests:** adds test suite, fixed several Node 0.10 issues along the way ([03bd86c](https://github.com/conventional-changelog/standard-verison/commit/03bd86c))
+* adds support for GitHub links (see [#13](https://github.com/conventional-changelog/standard-version/issues/13)), great idea [@bcoe](https://github.com/bcoe)! ([7bf6597](https://github.com/conventional-changelog/standard-version/commit/7bf6597))
+
+
+
+<a name="2.0.0"></a>
+# [2.0.0](https://github.com/conventional-changelog/standard-version/compare/v1.1.0...v2.0.0) (2016-04-09)
+
+
+* feat(conventional-changelog-standard): Move to conventional-changelog-standard style. This style lifts the character limit on commit messages, and puts us in a position to make more opinionated decisions in the future. ([c7ccadb](https://github.com/conventional-changelog/standard-version/commit/c7ccadb))
+
+
+### BREAKING CHANGES
+
+* we no longer accept the preset configuration option.
+
+
+<a name="1.1.0"></a>
+# [1.1.0](https://github.com/conventional-changelog/standard-version/compare/v1.0.0...v1.1.0) (2016-04-08)
+
+
+### Features
+
+* **cli:** use conventional default commit message with version ([9fadc5f](https://github.com/conventional-changelog/standard-version/commit/9fadc5f))
+* **rebrand:** rebrand recommended-workflow to standard-version (#9) ([1f673c0](https://github.com/conventional-changelog/standard-version/commit/1f673c0))
+* **tests:** adds test suite, fixed several Node 0.10 issues along the way ([03bd86c](https://github.com/conventional-changelog/standard-version/commit/03bd86c))
 
 
 
@@ -21,6 +53,3 @@
 ### Features
 
 * **initial-release:** adds flag for generating CHANGELOG.md on the first release. ([b812b44](https://github.com/bcoe/conventional-recommended-workflow/commit/b812b44))
-
-
-
diff --git a/README.md b/README.md
index 5ed8dad..250f574 100644
--- a/README.md
+++ b/README.md
@@ -5,7 +5,7 @@
 [![Coverage Status](https://coveralls.io/repos/conventional-changelog/standard-version/badge.svg?branch=)](https://coveralls.io/r/conventional-changelog/standard-version?branch=master)
 [![Standard Version](https://img.shields.io/badge/standard-version-brightgreen.svg)](https://github.com/conventional-changelog/standard-version)
 
-> stop using `npm version`, use `standard-version` it makes your life way easier.
+> stop using `npm version`, use `standard-version` it rocks!
 
 Automatic release and CHANGELOG management, using GitHub's new squash button and
 the workflow outlined in [conventional-changelog-standard](https://github.com/bcoe/conventional-changelog-standard/blob/master/convention.md).
@@ -22,7 +22,7 @@
 `standard-version` does the following:
 
 1. bumps the version in package.json (based on your commit history).
-2. runs `conventional-changelog` and updates _CHANGELOG.md._
+2. uses [conventional-changelog](https://github.com/conventional-changelog/conventional-changelog) to update _CHANGELOG.md._
 3. commits _package.json_ and _CHANGELOG.md_.
 4. tags a new release.
 
@@ -36,13 +36,11 @@
 
 `npm i standard-version -g`
 
-## Automating
-
-Do this:
+_Or, add it as a development dependency like so:_
 
 `npm i standard-version --save-dev`
 
-Add this to your _package.json_
+_And add this to your _package.json:_
 
 ```json
 {
@@ -69,8 +67,8 @@
 _breaking changes:_
 
 ```sh
-git commit -a -m "feat(new-parser):
-BREAKING CHANGE: swapping out our old parser for a new one"
+git commit -a -m "feat(new-parser): introduces a new parsing library
+BREAKING CHANGE: new library does not support foo-construct"
 ```
 
 _other changes:_
@@ -81,6 +79,11 @@
 git commit -a -m "docs: fixed up the docs a bit"
 ```
 
+_but wait, there's more!_
+
+Github usernames (`@bcoe`) and issue references (#133) will be swapped out for the
+appropriate URLs in your CHANGELOG.
+
 ## Badges!
 
 Tell your users that you adhere to the `standard-version` commit guidelines:
diff --git a/package.json b/package.json
index d627b94..223805e 100644
--- a/package.json
+++ b/package.json
@@ -1,6 +1,6 @@
 {
   "name": "standard-version",
-  "version": "1.1.0",
+  "version": "2.1.1",
   "description": "replacement for `npm version` with automatic CHANGELOG generation",
   "bin": "index.js",
   "scripts": {
@@ -10,7 +10,7 @@
   },
   "repository": {
     "type": "git",
-    "url": "git+https://github.com/conventional-changelog/standard-verison.git"
+    "url": "git+https://github.com/conventional-changelog/standard-version.git"
   },
   "keywords": [
     "conventional-changelog",
@@ -30,7 +30,7 @@
   "dependencies": {
     "chalk": "^1.1.3",
     "conventional-changelog": "^1.1.0",
-    "conventional-changelog-standard": "^1.1.0",
+    "conventional-changelog-standard": "^1.2.1",
     "conventional-recommended-bump": "^0.2.0",
     "figures": "^1.5.0",
     "fs-access": "^1.0.0",
@@ -45,4 +45,4 @@
     "shelljs": "^0.6.0",
     "standard": "^6.0.8"
   }
-}
+}
\ No newline at end of file

=====================================================================
start time: Sat Apr 09 00:00:00 CST 2016
end time: Sun Apr 10 00:00:00 CST 2016
### Features* adds support for GitHub links (see [#13](https://github.com/conventional-changelog/standard-version/issues/13)), great idea [@bcoe](https://github.com/bcoe)! ([7bf6597](https://github.com/conventional-changelog/standard-version/commit/7bf6597))<a name="2.0.0"></a>
diff --git a/CHANGELOG.md b/CHANGELOG.md
index bdd388d..b3e587e 100644
--- a/CHANGELOG.md
+++ b/CHANGELOG.md
@@ -1,3 +1,19 @@
+# 